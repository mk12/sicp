<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Mitchell Kember">
  <title>SICP Lecture 5A Notes</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
   var mathElements = document.getElementsByClassName("math");
   var macros = [];
   for (var i = 0; i < mathElements.length; i++) {
    var texText = mathElements[i].firstChild;
    if (mathElements[i].tagName == "SPAN") {
     katex.render(texText.data, mathElements[i], {
      displayMode: mathElements[i].classList.contains('display'),
      throwOnError: false,
      macros: macros,
      fleqn: false
     });
  }}});
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" />
  <link rel="stylesheet" href="../assets/style.css">
</head>
<body>
<header class="header ">
  <a class="title link" href="../index.html">SICP Study</a>
  <span class="gap"></span>
  <nav class="sitenav">
    <a class="sitenav__item link "
      href="../text/index.html">Text</a>
    <a class="sitenav__item link  sitenav__item--active"
      href="../lecture/index.html">Lecture</a>
    <a class="sitenav__item link "
      href="../exercise/index.html">Exercise</a>
    <a class="sitenav__item link" href="https://github.com/mk12/sicp">
      Source&nbsp;<svg class="github-mark" width="25" height="25" viewBox="0 0 136 133">
  <g transform="matrix(1,0,0,1,-568.001,-447.669)">
    <g transform="matrix(4.16667,0,0,4.16667,0,0)">
      <g transform="matrix(1,0,0,1,152.608,139.345)">
        <path d="M0,-31.904C-8.995,-31.904 -16.288,-24.611 -16.288,-15.614C-16.288,-8.417 -11.621,-2.312 -5.148,-0.157C-4.333,-0.008 -4.036,-0.511 -4.036,-0.943C-4.036,-1.329 -4.05,-2.354 -4.058,-3.713C-8.589,-2.729 -9.545,-5.897 -9.545,-5.897C-10.286,-7.778 -11.354,-8.279 -11.354,-8.279C-12.833,-9.29 -11.242,-9.27 -11.242,-9.27C-9.607,-9.154 -8.747,-7.591 -8.747,-7.591C-7.294,-5.102 -4.934,-5.821 -4.006,-6.237C-3.858,-7.29 -3.438,-8.008 -2.972,-8.415C-6.589,-8.826 -10.392,-10.224 -10.392,-16.466C-10.392,-18.244 -9.757,-19.698 -8.715,-20.837C-8.883,-21.249 -9.442,-22.905 -8.556,-25.148C-8.556,-25.148 -7.188,-25.586 -4.076,-23.478C-2.777,-23.839 -1.383,-24.02 0.002,-24.026C1.385,-24.02 2.779,-23.839 4.08,-23.478C7.19,-25.586 8.555,-25.148 8.555,-25.148C9.444,-22.905 8.885,-21.249 8.717,-20.837C9.761,-19.698 10.392,-18.244 10.392,-16.466C10.392,-10.208 6.583,-8.831 2.954,-8.428C3.539,-7.925 4.06,-6.931 4.06,-5.411C4.06,-3.234 4.04,-1.477 4.04,-0.943C4.04,-0.507 4.333,0 5.16,-0.159C11.628,-2.318 16.291,-8.419 16.291,-15.614C16.291,-24.611 8.997,-31.904 0,-31.904"/>
      </g>
    </g>
  </g>
</svg>
    </a>
  </nav>
</header>
<nav class="pagenav pagenav--top">
  <div class="pagenav__item pagenav__item--prev">
    <a class="pagenav__link link" href="4b.html">
      <svg class="arrow" width="18" height="18" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <line x1="5" y1="12" x2="19" y2="12"/>
  <line x1="5" y1="12" x2="11" y2="18"/>
  <line x1="5" y1="12" x2="11" y2="6"/>
</svg>&nbsp;Prev
    </a>
  </div>
  <div class="pagenav__item pagenav__item--up">
    <a class="pagenav__link link" href="index.html"><svg class="arrow" width="18" height="18" viewBox="0 0 24 24" stroke-width="1.75" stroke="currentColor" fill="none">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <line x1="12" y1="5" x2="12" y2="19"/>
  <line x1="18" y1="11" x2="12" y2="5"/>
  <line x1="6" y1="11" x2="12" y2="5"/>
</svg>&nbsp;Up</a>
  </div>
  <div class="pagenav__item pagenav__item--next">
    <a class="pagenav__link link" href="5b.html">
      Next&nbsp;<svg class="arrow" width="18" height="18" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <line x1="5" y1="12" x2="19" y2="12"/>
  <line x1="13" y1="18" x2="19" y2="12"/>
  <line x1="13" y1="6" x2="19" y2="12"/>
</svg>
    </a>
  </div>
</nav>
<h1>
<small class="number">5A</small>Assignment, State, and Side-Effects
</h1>
<h2 id="1" class="anchor">
<a class="anchor__link link" href="#1">#</a>Part 1
</h2>
<h3 id="1.1" class="anchor">
<a class="anchor__link link" href="#1.1">#</a>Introducing assignment
</h3>
<ul>
<li>We’ve learned enough about programming in Lisp to do fairly complex things.</li>
<li>We have done all of this without an assignment statement.</li>
<li>Today, we’re going to add the assignment statement.</li>
<li>If we can do so much without it, why should we add it?</li>
<li>After all, we only add something to the language if we have a good reason for doing so.</li>
<li>We are adding assignment because it will allow us to break some problems up into certain sets of pieces, and this new means of decomposition would be impossible without assignment.</li>
</ul>
<h3 id="1.2" class="anchor">
<a class="anchor__link link" href="#1.2">#</a>Functional programming
</h3>
<ul>
<li>Functional programs encode mathematical truths.</li>
<li>Processes evolved by these programs can be understood by substitution, which preserves truth (equals for equals).</li>
<li>Methods may be distinguished by the choice of truths expressed.</li>
<li>Although functional, Lisp is not quite the same as math. Math is declarative, but Lisp is imperative.</li>
</ul>
<h3 id="1.3" class="anchor">
<a class="anchor__link link" href="#1.3">#</a>Assignment and Time
</h3>
<ul>
<li>To do assignment, we use <code class="sourceCode scheme">(<span class="kw">set!</span> &lt;variable&gt; &lt;value&gt;)</code>.</li>
<li>By convention, we suffix a bang to the names of procedures that do assignment-like things.</li>
<li><code>set!</code> is like <code>define</code>, but the latter is only used once to create the variable in the beginning; the former can only be used on existing variables.</li>
<li>When we add assignment, we also have to consider <em>time</em>.</li>
<li>The assignment produces a moment in time: a difference between a <em>before</em> and an <em>after</em> in time.</li>
<li>After the moment, <code>&lt;variable&gt;</code> has the value <code>&lt;value&gt;</code>, independent of what value it had before.</li>
<li>So far, calling procedures with the same inputs always produced the same outputs. These procedures are functions.</li>
<li>This isn’t the case when we have assignment. The same expression can lead to different answers because it depends on time.</li>
<li>The substitution model completely breaks down. It is static.</li>
<li>We need a new model of computation for this “bad thing.” We had better have a good reason for introducing assignment.</li>
</ul>
<h3 id="1.4" class="anchor">
<a class="anchor__link link" href="#1.4">#</a>Identity
</h3>
<ul>
<li>Symbols for variables no longer refer directly to their values, but to some <em>place</em>.</li>
<li>A variable now refers to an <em>identity</em>. This is an entity associated with a series of causally related values over time.</li>
<li>The state of an identity is it’s current associated value.</li>
<li>When we talk about <em>time</em>, we mean the before/after ordering of causal values.</li>
</ul>
<h3 id="1.5" class="anchor">
<a class="anchor__link link" href="#1.5">#</a>Factorial example
</h3>
<ul>
<li>Here’s how we implemented factorial functionally:</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode scheme"><code class="sourceCode scheme"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>(<span class="ex">define</span><span class="fu"> </span>(fact n)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  (<span class="ex">define</span><span class="fu"> </span>(iter p i)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">if</span> (<span class="op">&gt;</span> i n) m (iter (<span class="op">*</span> i p) (<span class="op">+</span> i <span class="dv">1</span>))))</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  (iter <span class="dv">1</span> <span class="dv">1</span>))</span></code></pre></div>
<ul>
<li>We could instead write it with assignments:</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode scheme"><code class="sourceCode scheme"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>(<span class="ex">define</span><span class="fu"> </span>(fact n)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">let</span> ((p <span class="dv">1</span>) (i <span class="dv">1</span>))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    (<span class="ex">define</span><span class="fu"> </span>(loop)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>      (<span class="kw">cond</span> ((<span class="op">&gt;</span> i n) p)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>            (<span class="kw">else</span> (<span class="kw">set!</span> p (<span class="op">*</span> i p))</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                  (<span class="kw">set!</span> i (<span class="op">+</span> i <span class="dv">1</span>))</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>                  (loop))))</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    (loop)))</span></code></pre></div>
<ul>
<li>There are ways of making errors in the second program that simply didn’t exist when we couldn’t do assignment.</li>
<li>If we change the ordering of the assignments, the procedure calculates the wrong value.</li>
</ul>
<h2 id="2" class="anchor">
<a class="anchor__link link" href="#2">#</a>Part 2
</h2>
<h3 id="2.1" class="anchor">
<a class="anchor__link link" href="#2.1">#</a>Environment model
</h3>
<ul>
<li>We need a new model of computation that can allow us to understand programs that use assignment.</li>
<li>The new model is called the <em>environment model</em>.</li>
<li>Unfortunately, it is significantly more complicated than the substitution model.</li>
</ul>
<h3 id="2.2" class="anchor">
<a class="anchor__link link" href="#2.2">#</a>Free and bound variables
</h3>
<ul>
<li>A variable <code>v</code> is <em>bound</em> in an expression <code>E</code> if the meaning of <code>E</code> is unchanged by the uniform replacement of a variable <code>w</code> not occurring in <code>E</code>, for every occurrence of <code>v</code> in <code>E</code>.</li>
<li>We use bound variables all the time.</li>
<li>The <code>lambda</code> is the essential thing that binds variables.</li>
<li>If a variable isn’t bound, we say it is a <em>free</em> variable.</li>
<li>If <code>x</code> is a bound variable in <code>E</code> then there is λ-expression where it is bound.</li>
<li>The list of formal parameters is called the <em>bound variable list</em>. The λ-expression <em>binds</em> the variables <em>declared</em> in its bound variable list.</li>
<li>The parts of the expression where a variable has a value defined by the λ-expression binding it is the <em>scope</em> of the variable.</li>
</ul>
<h3 id="2.3" class="anchor">
<a class="anchor__link link" href="#2.3">#</a>Environments, frames, and bindings
</h3>
<ul>
<li>Environments are a way of doing substitutions virtually.</li>
<li>It’s the place where the names of the variables are associated with values.</li>
<li>An environment is a pointer to a <em>frame</em>. A frame is a table of <em>bindings</em>, plus a parent/enclosing environment.</li>
<li>A binding is a variable name associated with a value.</li>
<li>We look up the value of a variable in an environment by traversing up the frames, finding the first one that has a binding for the variable, and reading its associated value.</li>
<li>If a variable is bound twice in an environment, the binding in the earlier (lower) frame <em>shadows</em> the other.</li>
</ul>
<h3 id="2.4" class="anchor">
<a class="anchor__link link" href="#2.4">#</a>Procedure creation and application
</h3>
<ul>
<li>A procedure is a pair: some code, and (a pointer to) an environment. Free variables are found in this environment.</li>
<li>Procedure objects are created by evaluating λ-expressions.</li>
<li>A λ-expression is evaluated relative to a given environment as follows: a new procedure object is formed, combing the text (code) of the λ-expression with (a pointer to) the environment of evaluation.</li>
<li>A procedure is applied to a set of arguments by
<ol type="1">
<li>constructing a frame whose parent is the environment part of the procedure being applied,</li>
<li>binding the formal parameters of the procedure to the actual arguments of the call,</li>
<li>evaluating the body of the procedure in the context of the new environment.</li>
</ol></li>
<li>In other words we are taking the environment where the procedure was created, extending it with the frame for the parameters, and evaluating the body.</li>
</ul>
<h2 id="3" class="anchor">
<a class="anchor__link link" href="#3">#</a>Part 3
</h2>
<h3 id="3.1" class="anchor">
<a class="anchor__link link" href="#3.1">#</a>Counter example
</h3>
<ul>
<li>We’ve introduced a very complicated thing, assignment, which destroys most of the interesting mathematical properties of our programs.</li>
<li>We wouldn’t have done this if there wasn’t a good reason.</li>
<li>Consider the following program:</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode scheme"><code class="sourceCode scheme"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>(<span class="ex">define</span><span class="fu"> make-counter</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">lambda</span> (n)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">lambda</span> ()</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>      (<span class="kw">set!</span> n (inc n))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>      n)))</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>(<span class="ex">define</span><span class="fu"> c1 </span>(make-counter <span class="dv">0</span>))</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>(<span class="ex">define</span><span class="fu"> c2 </span>(make-counter <span class="dv">10</span>))</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>(c1)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>(c1)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>(c2)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>(c2)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="dv">12</span></span></code></pre></div>
<ul>
<li>These two counters are independent and have their own state.</li>
<li>The environment of <code>c1</code> points to some frame with <code>n</code>. That of <code>c2</code> points to a different frame with a different <code>n</code>. The parent of both frames is the global environment.</li>
<li>The <em>global environment</em> is the topmost environment. Its frame contains <code>car</code>, <code>+</code>, <code>*</code>, etc., and all top-level definitions.</li>
</ul>
<h3 id="3.2" class="anchor">
<a class="anchor__link link" href="#3.2">#</a>Objects
</h3>
<ul>
<li>We like to think about the world as being made up of independent objects, each having their own state.</li>
<li>The only way to see if two objects are the same (not just associated with an equal value) is to change one and see if the other changes in the same way.</li>
<li>The idea of objects, changed, and sameness raises deep problems.</li>
<li>If you cut off your fingernail, the “before” and “after” of you is enormously different in terms of atoms. You have changed and feel that you are the “same” person, but how do you know that?</li>
<li>By introducing assignment and therefore objects, we open ourselves up to all of these philosophical questions.</li>
</ul>
<h3 id="3.3" class="anchor">
<a class="anchor__link link" href="#3.3">#</a>Actions and identity
</h3>
<ul>
<li>An action <span class="math inline">A</span> had an effect on an object <span class="math inline">x</span> (or equivalently, that <span class="math inline">x</span> was changed by <span class="math inline">A</span>) if some property <span class="math inline">P</span> which was true of <span class="math inline">x</span> before <span class="math inline">A</span> became false of <span class="math inline">x</span> after <span class="math inline">A</span>.</li>
<li>Two objects <span class="math inline">x</span> and <span class="math inline">y</span> are the same if any action which has an effect on <span class="math inline">x</span> has the same effect on <span class="math inline">y</span>.</li>
</ul>
<h3 id="3.4" class="anchor">
<a class="anchor__link link" href="#3.4">#</a>Uses of objection orientation
</h3>
<ul>
<li>One of the nice things about objects is the way it lets us model the world. We like to think of the world as being made up of these independent objects.</li>
<li>If we want to understand the program well and we want small changes in the world to lead to small changes in the program, we would like isomorphisms between the world and the model.</li>
<li>For most things, objects and assignment are not the right way to think. We should only use them if we need them.</li>
<li>Sometimes, though, they are essential.</li>
<li>It can also improve modularity greatly – consider the procedure for a random number generator. Without an internal feedback loop via assignment, its state leaks out everywhere and we can’t decompose certain problems very well.</li>
</ul>
<nav class="pagenav pagenav--bottom">
  <div class="pagenav__item pagenav__item--prev">
    <a class="pagenav__link link" href="4b.html">
      <svg class="arrow" width="18" height="18" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <line x1="5" y1="12" x2="19" y2="12"/>
  <line x1="5" y1="12" x2="11" y2="18"/>
  <line x1="5" y1="12" x2="11" y2="6"/>
</svg>&nbsp;Prev
    </a>
  </div>
  <div class="pagenav__item pagenav__item--up">
    <a class="pagenav__link link" href="index.html"><svg class="arrow" width="18" height="18" viewBox="0 0 24 24" stroke-width="1.75" stroke="currentColor" fill="none">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <line x1="12" y1="5" x2="12" y2="19"/>
  <line x1="18" y1="11" x2="12" y2="5"/>
  <line x1="6" y1="11" x2="12" y2="5"/>
</svg>&nbsp;Up</a>
  </div>
  <div class="pagenav__item pagenav__item--next">
    <a class="pagenav__link link" href="5b.html">
      Next&nbsp;<svg class="arrow" width="18" height="18" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <line x1="5" y1="12" x2="19" y2="12"/>
  <line x1="13" y1="18" x2="19" y2="12"/>
  <line x1="13" y1="6" x2="19" y2="12"/>
</svg>
    </a>
  </div>
</nav>
<footer class="footer">
  © 2020 Mitchell Kember
</footer>
</body>
</html>
