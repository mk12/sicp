<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Mitchell Kember">
  <title>SICP Lecture 5A Notes</title>
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css">
  <link rel="stylesheet" href="../assets/style.css">
</head>
<body>
<div hidden>
  <svg>
    <symbol id="up" viewBox="0 0 11 12">
      <path fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" d="M5.5.8v10.4m4.457-5.943L5.5.8 1.043 5.257"/>
    </symbol>
    <symbol id="left" viewBox="0 0 12 11">
      <path fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" d="M.8 5.5h10.4M5.257 9.957L.8 5.5l4.457-4.457"/>
    </symbol>
    <symbol id="right" viewBox="0 0 12 11">
      <use xlink:href="#left" transform="matrix(-1 0 0 1 12 0)"/>
    </symbol>
    <symbol id="external" viewBox="0 0 24 24">
      <path fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" d="M10.688 5.438H4.125A2.65 2.65 0 001.5 8.063v11.812A2.65 2.65 0 004.125 22.5h11.813a2.65 2.65 0 002.624-2.625v-6.563m-9.187 1.313L22.5 1.5m-6.563 0H22.5v6.563"/>
    </symbol>
  </svg>
</div>
<a class="skip-link" href="#main">Skip to main content</a>
<header class="header">
  <a class="title link" href="../index.html">SICP Study</a>
  <nav class="sitenav" aria-label="site">
    <a class="sitenav__item link"
        href="../text/index.html" aria-label="textbook notes">Text</a>
    <a class="sitenav__item sitenav__item--active link"
        href="../lecture/index.html" aria-label="lecture notes">Lecture</a>
    <a class="sitenav__item link"
        href="../exercise/index.html" aria-label="exercises">Exercise</a>
    <a class="sitenav__item sitenav__item--last link"
        href="https://github.com/mk12/sicp" aria-label="GitHub repository">
      Source
      <svg class="github-mark" width="25" height="25" viewBox="0 0 136 133" aria-hidden="true">
        <path fill="currentColor" d="M67.866.002C30.387.002 0 30.39 0 67.877c0 29.988 19.446 55.425 46.417 64.404 3.396.621 4.633-1.475 4.633-3.275 0-1.608-.058-5.879-.091-11.541-18.88 4.1-22.863-9.1-22.863-9.1-3.087-7.838-7.537-9.925-7.537-9.925-6.163-4.213.466-4.13.466-4.13 6.813.484 10.396 6.996 10.396 6.996 6.054 10.371 15.888 7.375 19.754 5.642.617-4.387 2.367-7.38 4.309-9.075-15.071-1.712-30.917-7.537-30.917-33.546 0-7.408 2.646-13.466 6.988-18.212-.7-1.717-3.03-8.617.662-17.963 0 0 5.7-1.825 18.667 6.959 5.412-1.505 11.22-2.259 16.992-2.284 5.762.025 11.57.78 16.991 2.284 12.959-8.784 18.646-6.959 18.646-6.959 3.704 9.346 1.375 16.246.675 17.963 4.35 4.746 6.98 10.804 6.98 18.212 0 26.075-15.872 31.813-30.992 33.492 2.437 2.096 4.608 6.237 4.608 12.57 0 9.072-.083 16.392-.083 18.617 0 1.817 1.22 3.93 4.666 3.267 26.95-8.996 46.38-34.417 46.38-64.396 0-37.487-30.392-67.875-67.88-67.875"/>
      </svg>      
    </a>
  </nav>
</header>
<nav class="pagenav pagenav--top" aria-label="page">
  <div class="pagenav__item pagenav__item--left">
    <a class="pagenav__link link" href="4b.html" aria-label="previous page">
      <svg width="12" height="11" aria-hidden="true"><use xlink:href="#left"/>
      </svg><span class="pagenav__prev">Prev</span>
    </a>
  </div>
  <div class="pagenav__item pagenav__item--center">
    <a class="pagenav__link link" href="index.html" aria-label="parent page">
      <svg width="11" height="12" aria-hidden="true"><use xlink:href="#up"/>
      </svg><span class="pagenav__up">Up</span>
    </a>
  </div>
  <div class="pagenav__item pagenav__item--right">
    <a class="pagenav__link link" href="5b.html" aria-label="next page">
      <span class="pagenav__next">Next</span
        ><svg width="12" height="11" aria-hidden="true"
        ><use xlink:href="#right"/></svg>
    </a>
  </div>
</nav>
<main id="main">
<article>
<h1>
<span class="number">5A</span> <a class="link" href="https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-001-structure-and-interpretation-of-computer-programs-spring-2005/video-lectures/5a-assignment-state-and-side-effects">Assignment, State, and Side-Effects<span class="nowrap">﻿<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h1>
<h2 id="1" class="anchor">
<a class="anchor__link link" href="#1" aria-hidden="true">#</a> Part 1
</h2>
<h3 id="1.1" class="anchor">
<a class="anchor__link link" href="#1.1" aria-hidden="true">#</a> Introducing assignment
</h3>
<ul>
<li>We’ve learned enough about programming in Lisp to do fairly complex things.</li>
<li>We have done all of this without an assignment statement.</li>
<li>Today, we’re going to add the assignment statement.</li>
<li>If we can do so much without it, why should we add it?</li>
<li>After all, we only add something to the language if we have a good reason for doing so.</li>
<li>We are adding assignment because it will allow us to break some problems up into certain sets of pieces, and this new means of decomposition would be impossible without assignment.</li>
</ul>
<h3 id="1.2" class="anchor">
<a class="anchor__link link" href="#1.2" aria-hidden="true">#</a> Functional programming
</h3>
<ul>
<li>Functional programs encode mathematical truths.</li>
<li>Processes evolved by these programs can be understood by substitution, which preserves truth (equals for equals).</li>
<li>Methods may be distinguished by the choice of truths expressed.</li>
<li>Although functional, Lisp is not quite the same as math. Math is declarative, but Lisp is imperative.</li>
</ul>
<h3 id="1.3" class="anchor">
<a class="anchor__link link" href="#1.3" aria-hidden="true">#</a> Assignment and Time
</h3>
<ul>
<li>To do assignment, we use <code>(<span class="kw">set!</span> <span class="ss">variable</span> <span class="ss">value</span>)</code>.</li>
<li>By convention, we suffix a bang to the names of procedures that do assignment-like things.</li>
<li><code>set!</code> is like <code>define</code>, but the latter is only used once to create the variable in the beginning; the former can only be used on existing variables.</li>
<li>When we add assignment, we also have to consider <em>time</em>.</li>
<li>The assignment produces a moment in time: a difference between a <em>before</em> and an <em>after</em> in time.</li>
<li>After the moment, <code><span class="ss">variable</span></code> has the value <code class="sourceCode scheme"><span class="ss">value</span></code>, independent of what value it had before.</li>
<li>So far, calling procedures with the same inputs always produced the same outputs. These procedures are functions.</li>
<li>This isn’t the case when we have assignment. The same expression can lead to different answers because it depends on time.</li>
<li>The substitution model completely breaks down. It is static.</li>
<li>We need a new model of computation for this “bad thing.” We had better have a good reason for introducing assignment.</li>
</ul>
<h3 id="1.4" class="anchor">
<a class="anchor__link link" href="#1.4" aria-hidden="true">#</a> Identity
</h3>
<ul>
<li>Symbols for variables no longer refer directly to their values, but to some <em>place</em>.</li>
<li>A variable now refers to an <em>identity</em>. This is an entity associated with a series of causally related values over time.</li>
<li>The state of an identity is it’s current associated value.</li>
<li>When we talk about <em>time</em>, we mean the before/after ordering of causal values.</li>
</ul>
<h3 id="1.5" class="anchor">
<a class="anchor__link link" href="#1.5" aria-hidden="true">#</a> Factorial example
</h3>
<ul>
<li>Here’s how we implemented factorial functionally:</li>
</ul>
<pre><code class="blockcode">(<span class="kw">define</span> (fact n)
  (<span class="kw">define</span> (iter p i)
    (<span class="kw">if</span> (<span class="fu">&gt;</span> i n) m (iter (<span class="fu">*</span> i p) (<span class="fu">+</span> i <span class="cn">1</span>))))
  (iter <span class="cn">1</span> <span class="cn">1</span>))</code></pre>
<ul>
<li>We could instead write it with assignments:</li>
</ul>
<pre><code class="blockcode">(<span class="kw">define</span> (fact n)
  (<span class="kw">let</span> ((p <span class="cn">1</span>) (i <span class="cn">1</span>))
    (<span class="kw">define</span> (loop)
      (<span class="kw">cond</span> ((<span class="fu">&gt;</span> i n) p)
            (<span class="kw">else</span> (<span class="kw">set!</span> p (<span class="fu">*</span> i p))
                  (<span class="kw">set!</span> i (<span class="fu">+</span> i <span class="cn">1</span>))
                  (loop))))
    (loop)))</code></pre>
<ul>
<li>There are ways of making errors in the second program that simply didn’t exist when we couldn’t do assignment.</li>
<li>If we change the ordering of the assignments, the procedure calculates the wrong value.</li>
</ul>
<h2 id="2" class="anchor">
<a class="anchor__link link" href="#2" aria-hidden="true">#</a> Part 2
</h2>
<h3 id="2.1" class="anchor">
<a class="anchor__link link" href="#2.1" aria-hidden="true">#</a> Environment model
</h3>
<ul>
<li>We need a new model of computation that can allow us to understand programs that use assignment.</li>
<li>The new model is called the <em>environment model</em>.</li>
<li>Unfortunately, it is significantly more complicated than the substitution model.</li>
</ul>
<h3 id="2.2" class="anchor">
<a class="anchor__link link" href="#2.2" aria-hidden="true">#</a> Free and bound variables
</h3>
<ul>
<li>A variable <code>v</code> is <em>bound</em> in an expression <code>E</code> if the meaning of <code>E</code> is unchanged by the uniform replacement of a variable <code>w</code> not occurring in <code>E</code>, for every occurrence of <code>v</code> in <code>E</code>.</li>
<li>We use bound variables all the time.</li>
<li>The <code>lambda</code> is the essential thing that binds variables.</li>
<li>If a variable isn’t bound, we say it is a <em>free</em> variable.</li>
<li>If <code>x</code> is a bound variable in <code>E</code> then there is λ-expression where it is bound.</li>
<li>The list of formal parameters is called the <em>bound variable list</em>. The λ-expression <em>binds</em> the variables <em>declared</em> in its bound variable list.</li>
<li>The parts of the expression where a variable has a value defined by the λ-expression binding it is the <em>scope</em> of the variable.</li>
</ul>
<h3 id="2.3" class="anchor">
<a class="anchor__link link" href="#2.3" aria-hidden="true">#</a> Environments, frames, and bindings
</h3>
<ul>
<li>Environments are a way of doing substitutions virtually.</li>
<li>It’s the place where the names of the variables are associated with values.</li>
<li>An environment is a pointer to a <em>frame</em>. A frame is a table of <em>bindings</em>, plus a parent/enclosing environment.</li>
<li>A binding is a variable name associated with a value.</li>
<li>We look up the value of a variable in an environment by traversing up the frames, finding the first one that has a binding for the variable, and reading its associated value.</li>
<li>If a variable is bound twice in an environment, the binding in the earlier (lower) frame <em>shadows</em> the other.</li>
</ul>
<h3 id="2.4" class="anchor">
<a class="anchor__link link" href="#2.4" aria-hidden="true">#</a> Procedure creation and application
</h3>
<ul>
<li>A procedure is a pair: some code, and (a pointer to) an environment. Free variables are found in this environment.</li>
<li>Procedure objects are created by evaluating λ-expressions.</li>
<li>A λ-expression is evaluated relative to a given environment as follows: a new procedure object is formed, combing the text (code) of the λ-expression with (a pointer to) the environment of evaluation.</li>
<li>A procedure is applied to a set of arguments by
<ol type="1">
<li>constructing a frame whose parent is the environment part of the procedure being applied,</li>
<li>binding the formal parameters of the procedure to the actual arguments of the call,</li>
<li>evaluating the body of the procedure in the context of the new environment.</li>
</ol></li>
<li>In other words we are taking the environment where the procedure was created, extending it with the frame for the parameters, and evaluating the body.</li>
</ul>
<h2 id="3" class="anchor">
<a class="anchor__link link" href="#3" aria-hidden="true">#</a> Part 3
</h2>
<h3 id="3.1" class="anchor">
<a class="anchor__link link" href="#3.1" aria-hidden="true">#</a> Counter example
</h3>
<ul>
<li>We’ve introduced a very complicated thing, assignment, which destroys most of the interesting mathematical properties of our programs.</li>
<li>We wouldn’t have done this if there wasn’t a good reason.</li>
<li>Consider the following program:</li>
</ul>
<pre><code class="blockcode">(<span class="kw">define</span> make-counter
  (<span class="kw">lambda</span> (n)
    (<span class="kw">lambda</span> ()
      (<span class="kw">set!</span> n (inc n))
      n)))
(<span class="kw">define</span> c1 (make-counter <span class="cn">0</span>))
(<span class="kw">define</span> c2 (make-counter <span class="cn">10</span>))
(c1)
<span class="op">=&gt;</span> <span class="cn">1</span>
(c1)
<span class="op">=&gt;</span> <span class="cn">2</span>
(c2)
<span class="op">=&gt;</span> <span class="cn">11</span>
(c2)
<span class="op">=&gt;</span> <span class="cn">12</span></code></pre>
<ul>
<li>These two counters are independent and have their own state.</li>
<li>The environment of <code>c1</code> points to some frame with <code>n</code>. That of <code>c2</code> points to a different frame with a different <code>n</code>. The parent of both frames is the global environment.</li>
<li>The <em>global environment</em> is the topmost environment. Its frame contains <code>car</code>, <code>+</code>, <code>*</code>, etc., and all top-level definitions.</li>
</ul>
<h3 id="3.2" class="anchor">
<a class="anchor__link link" href="#3.2" aria-hidden="true">#</a> Objects
</h3>
<ul>
<li>We like to think about the world as being made up of independent objects, each having their own state.</li>
<li>The only way to see if two objects are the same (not just associated with an equal value) is to change one and see if the other changes in the same way.</li>
<li>The idea of objects, changed, and sameness raises deep problems.</li>
<li>If you cut off your fingernail, the “before” and “after” of you is enormously different in terms of atoms. You have changed and feel that you are the “same” person, but how do you know that?</li>
<li>By introducing assignment and therefore objects, we open ourselves up to all of these philosophical questions.</li>
</ul>
<h3 id="3.3" class="anchor">
<a class="anchor__link link" href="#3.3" aria-hidden="true">#</a> Actions and identity
</h3>
<ul>
<li>An action <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span> had an effect on an object <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> (or equivalently, that <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> was changed by <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span>) if some property <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> which was true of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> before <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span> became false of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> after <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span>.</li>
<li>Two objects <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> are the same if any action which has an effect on <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> has the same effect on <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>.</li>
</ul>
<h3 id="3.4" class="anchor">
<a class="anchor__link link" href="#3.4" aria-hidden="true">#</a> Uses of objection orientation
</h3>
<ul>
<li>One of the nice things about objects is the way it lets us model the world. We like to think of the world as being made up of these independent objects.</li>
<li>If we want to understand the program well and we want small changes in the world to lead to small changes in the program, we would like isomorphisms between the world and the model.</li>
<li>For most things, objects and assignment are not the right way to think. We should only use them if we need them.</li>
<li>Sometimes, though, they are essential.</li>
<li>It can also improve modularity greatly—consider the procedure for a random number generator. Without an internal feedback loop via assignment, its state leaks out everywhere and we can’t decompose certain problems very well.</li>
</ul>
</article>
</main>
<nav class="pagenav pagenav--bottom" aria-label="page">
  <div class="pagenav__item pagenav__item--left">
    <a class="pagenav__link link" href="4b.html" aria-label="previous page">
      <svg width="12" height="11" aria-hidden="true"><use xlink:href="#left"/>
      </svg><span class="pagenav__prev">Prev</span>
    </a>
  </div>
  <div class="pagenav__item pagenav__item--center">
    <a class="pagenav__link link" href="index.html" aria-label="parent page">
      <svg width="11" height="12" aria-hidden="true"><use xlink:href="#up"/>
      </svg><span class="pagenav__up">Up</span>
    </a>
  </div>
  <div class="pagenav__item pagenav__item--right">
    <a class="pagenav__link link" href="5b.html" aria-label="next page">
      <span class="pagenav__next">Next</span
        ><svg width="12" height="11" aria-hidden="true"
        ><use xlink:href="#right"/></svg>
    </a>
  </div>
</nav>
<footer class="footer">
  <p>© 2020 Mitchell Kember</p>
</footer>
</body>
</html>
