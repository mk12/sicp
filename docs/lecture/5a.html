<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SICP Lecture 5A Notes</title>
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css">
  <link rel="stylesheet" href="../style.css">
</head>
<body>
<div hidden>
  <svg>
    <symbol id="up" viewBox="0 0 11 12">
      <path fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" d="M5.5.8v10.4m4.457-5.943L5.5.8 1.043 5.257"/>
    </symbol>
    <symbol id="left" viewBox="0 0 12 11">
      <path fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" d="M.8 5.5h10.4M5.257 9.957L.8 5.5l4.457-4.457"/>
    </symbol>
    <symbol id="right" viewBox="0 0 12 11">
      <use xlink:href="#left" transform="matrix(-1 0 0 1 12 0)"/>
    </symbol>
    <symbol id="external" viewBox="0 0 24 24">
      <path fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" d="M10.688 5.438H4.125A2.65 2.65 0 001.5 8.063v11.812A2.65 2.65 0 004.125 22.5h11.813a2.65 2.65 0 002.624-2.625v-6.563m-9.187 1.313L22.5 1.5m-6.563 0H22.5v6.563"/>
    </symbol>
    <symbol id="circle-left" viewBox="0 0 18 18" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="9" stroke-width="1.69" transform="matrix(.8889 0 0 .8889 -1.667 -1.667)"/>
      <path stroke-width="1.5" d="M5.229 9h7.542M9 5.229L5.229 9 9 12.771"/>
    </symbol>
  </svg>
</div>
<a class="skip-link" href="#main">Skip to main content</a>
<header class="header">
  <a class="title link" href="../index.html">SICP Study</a>
  <nav class="sitenav" aria-label="site">
    <a class="sitenav__item link"
        href="../text/index.html" aria-label="textbook notes">Text</a>
    <a class="sitenav__item sitenav__item--active link"
        href="../lecture/index.html" aria-label="lecture notes">Lecture</a>
    <a class="sitenav__item link"
        href="../exercise/index.html" aria-label="exercises">Exercise</a>
    <a class="sitenav__item sitenav__item--last link"
        href="https://github.com/mk12/sicp" aria-label="GitHub repository">
      Source
      <svg class="github-mark" width="25" height="25" viewBox="0 0 136 133" aria-hidden="true">
        <path fill="currentColor" d="M67.866.002C30.387.002 0 30.39 0 67.877c0 29.988 19.446 55.425 46.417 64.404 3.396.621 4.633-1.475 4.633-3.275 0-1.608-.058-5.879-.091-11.541-18.88 4.1-22.863-9.1-22.863-9.1-3.087-7.838-7.537-9.925-7.537-9.925-6.163-4.213.466-4.13.466-4.13 6.813.484 10.396 6.996 10.396 6.996 6.054 10.371 15.888 7.375 19.754 5.642.617-4.387 2.367-7.38 4.309-9.075-15.071-1.712-30.917-7.537-30.917-33.546 0-7.408 2.646-13.466 6.988-18.212-.7-1.717-3.03-8.617.662-17.963 0 0 5.7-1.825 18.667 6.959 5.412-1.505 11.22-2.259 16.992-2.284 5.762.025 11.57.78 16.991 2.284 12.959-8.784 18.646-6.959 18.646-6.959 3.704 9.346 1.375 16.246.675 17.963 4.35 4.746 6.98 10.804 6.98 18.212 0 26.075-15.872 31.813-30.992 33.492 2.437 2.096 4.608 6.237 4.608 12.57 0 9.072-.083 16.392-.083 18.617 0 1.817 1.22 3.93 4.666 3.267 26.95-8.996 46.38-34.417 46.38-64.396 0-37.487-30.392-67.875-67.88-67.875"/>
      </svg>      
    </a>
  </nav>
</header>
<nav class="pagenav pagenav--top" aria-label="page">
  <div class="pagenav__item pagenav__item--left">
    <a class="pagenav__link link" href="4b.html" aria-label="previous page">
      <svg width="12" height="11" aria-hidden="true"><use xlink:href="#left"/>
      </svg><span class="pagenav__prev">Prev</span>
    </a>
  </div>
  <div class="pagenav__item pagenav__item--center">
    <a class="pagenav__link link" href="index.html" aria-label="parent page">
      <svg width="11" height="12" aria-hidden="true"><use xlink:href="#up"/>
      </svg><span class="pagenav__up">Up</span>
    </a>
  </div>
  <div class="pagenav__item pagenav__item--right">
    <a class="pagenav__link link" href="5b.html" aria-label="next page">
      <span class="pagenav__next">Next</span
        ><svg width="12" height="11" aria-hidden="true"
        ><use xlink:href="#right"/></svg>
    </a>
  </div>
</nav>
<main id="main">
<h1>
<span class="number">5A</span> <a class="link" href="https://ocw.mit.edu/courses/6-001-structure-and-interpretation-of-computer-programs-spring-2005/5a-assignment-state-and-side-effects">Assignment, State, and Side-Effects<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h1>
<h2 id="1" class="anchor">
<a class="anchor__link link" href="#1" aria-hidden="true">#</a> Part 1
</h2>
<h3 id="1.1" class="anchor">
<a class="anchor__link link" href="#1.1" aria-hidden="true">#</a> Introducing assignment
</h3>
<ul>
<li>We’ve learned enough about programming in Lisp to do fairly complex things.</li>
<li>Today, we’re going to add an assignment statement to the language.</li>
<li>If we can do so much without it, why should we add it?</li>
<li>We need to have a good reason for adding a new feature to the language!</li>
<li>We’re doing it because it gives us a new way of decomposing programs.</li>
</ul>
<h3 id="1.2" class="anchor">
<a class="anchor__link link" href="#1.2" aria-hidden="true">#</a> Functional programming
</h3>
<ul>
<li>Functional programs are a kind of encoding of mathematical truths.</li>
<li>Processes evolved by these programs can be understood by substitution.</li>
<li>It’s like simplifying an equation. You write a sequence of equalities, preserving truth.</li>
</ul>
<h3 id="1.3" class="anchor">
<a class="anchor__link link" href="#1.3" aria-hidden="true">#</a> Assignment and Time
</h3>
<ul>
<li>To do assignment, we use <code>(<span class="kw">set!</span> <span class="mv">variable</span> <span class="mv">value</span>)</code>.</li>
<li>The “!” suffix is a convention for procedures that do assignment-like things.</li>
<li>Now that we have assignment, we have to consider <em>time</em>.</li>
<li>Assignment produces a moment in time, which has a <em>before</em> and an <em>after</em>.</li>
<li>After that moment, <code><span class="mv">variable</span></code> has the value <code><span class="mv">value</span></code>, independent of what it was before.</li>
<li>So far, calling procedures with the same inputs always produced the same outputs.</li>
<li>With assignment, this is no longer true because the output depends on time.</li>
<li>The substitution model completely breaks down. It assumes that things don’t change.</li>
<li>We need a new model of computation for this “bad thing.<span class="tuck">”</span> We’d better have a good reason for introducing assignment.</li>
</ul>
<h3 id="1.4" class="anchor">
<a class="anchor__link link" href="#1.4" aria-hidden="true">#</a> Identity
</h3>
<ul>
<li>Symbols for variables no longer refer directly to their values, but to some <em>place</em>.</li>
<li>A variable now refers to an <em>identity</em> associated with a series of causally related values.</li>
<li>The state of an identity is its current associated value.</li>
<li>When we talk about <em>time</em>, we mean the before/after ordering of causal values.</li>
</ul>
<h3 id="1.5" class="anchor">
<a class="anchor__link link" href="#1.5" aria-hidden="true">#</a> Factorial example
</h3>
<ul>
<li>Here’s how we implemented factorial functionally:</li>
</ul>
<pre><code class="codeblock">(<span class="kw">define</span> (fact n)
  (<span class="kw">define</span> (iter p i)
    (<span class="kw">if</span> (<span class="fu">&gt;</span> i n) m (iter (<span class="fu">*</span> i p) (<span class="fu">+</span> i <span class="cn">1</span>))))
  (iter <span class="cn">1 1</span>))</code></pre>
<ul>
<li>We could instead write it with assignments:</li>
</ul>
<pre><code class="codeblock">(<span class="kw">define</span> (fact n)
  (<span class="kw">let</span> ((p <span class="cn">1</span>) (i <span class="cn">1</span>))
    (<span class="kw">define</span> (loop)
      (<span class="kw">cond</span> ((<span class="fu">&gt;</span> i n) p)
            (<span class="kw">else</span> (<span class="kw">set!</span> p (<span class="fu">*</span> i p))
                  (<span class="kw">set!</span> i (<span class="fu">+</span> i <span class="cn">1</span>))
                  (loop))))
    (loop)))</code></pre>
<ul>
<li>There are ways of making mistakes in the second program that simply didn’t exist when we couldn’t do assignment.</li>
<li>For example, it produces the wrong answer if we change the order of the assignments.</li>
</ul>
<h2 id="2" class="anchor">
<a class="anchor__link link" href="#2" aria-hidden="true">#</a> Part 2
</h2>
<h3 id="2.1" class="anchor">
<a class="anchor__link link" href="#2.1" aria-hidden="true">#</a> Environment model
</h3>
<ul>
<li>We need a new model of computation to understand programs that use assignment.</li>
<li>The new model is called the <em>environment model</em>.</li>
<li>Unfortunately, it is significantly more complicated than the substitution model.</li>
</ul>
<h3 id="2.2" class="anchor">
<a class="anchor__link link" href="#2.2" aria-hidden="true">#</a> Free and bound variables
</h3>
<ul>
<li>A variable <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span> is <em>bound</em> in an expression <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>E</mi></mrow><annotation encoding="application/x-tex">E</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span></span></span></span> if the meaning of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>E</mi></mrow><annotation encoding="application/x-tex">E</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span></span></span></span> is unchanged when we replace all occurrences of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span> by some other variable <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span> not already occuring in <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>E</mi><mtext>.</mtext></mrow><annotation encoding="application/x-tex">E\htmlClass{math-punctuation}{\text{.}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="enclosing math-punctuation"><span class="mord text"><span class="mord">.</span></span></span></span></span></span></li>
<li>We use bound variables all the time. In Lisp, variables are bound by <code>lambda</code>.</li>
<li>If a variable isn’t bound, we say it is a <em>free</em> variable.</li>
<li>The parts of an expression where a variable has a value defined by a <code>lambda</code> binding is the <em>scope</em> of that variable.</li>
</ul>
<h3 id="2.3" class="anchor">
<a class="anchor__link link" href="#2.3" aria-hidden="true">#</a> Environments, frames, and bindings
</h3>
<ul>
<li>Environments are a way of doing substitutions virtually.</li>
<li>It’s the place where the names of the variables are associated with values:
<ul>
<li>An <em>environment</em> is a pointer to a frame.</li>
<li>A <em>frame</em> is a table of bindings, with a pointer to a parent environment.</li>
<li>A <em>binding</em> associates a variable name with a value.</li>
</ul></li>
<li>To look up the value of a variable in an environment, we traverse its frames, finding the first one that has a binding for the variable, and read its associated value.</li>
<li>If a variable is bound twice in an environment, the second <em>shadows</em> the first.</li>
</ul>
<h3 id="2.4" class="anchor">
<a class="anchor__link link" href="#2.4" aria-hidden="true">#</a> Procedure creation and application
</h3>
<ul>
<li>A procedure is a pair consisting of some code and an environment.</li>
<li>We look up free variables in the procedure’s environment.</li>
<li>To evaluate a <code>lambda</code> expression, we create a new procedure object combining the <code>lambda</code>’s code with the current environment.</li>
<li>To apply a procedure to arguments:
<ol type="1">
<li>Construct a new frame whose parent is the procedure’s environment.</li>
<li>Bind the formal parameters of the procedure to the arguments provided.</li>
<li>Evaluate the body of the procedure in the context of the new environment.</li>
</ol></li>
</ul>
<h2 id="3" class="anchor">
<a class="anchor__link link" href="#3" aria-hidden="true">#</a> Part 3
</h2>
<h3 id="3.1" class="anchor">
<a class="anchor__link link" href="#3.1" aria-hidden="true">#</a> Counter example
</h3>
<ul>
<li>We’ve introduced a very complicated thing, assignment, which destroys most of the interesting mathematical properties of our programs.</li>
<li>We wouldn’t have done this without a good reason.</li>
<li>Consider the following program:</li>
</ul>
<pre><code class="codeblock">(<span class="kw">define</span> make-counter
  (<span class="kw">lambda</span> (n)
    (<span class="kw">lambda</span> ()
      (<span class="kw">set!</span> n (inc n))
      n)))

(<span class="kw">define</span> c1 (make-counter <span class="cn">0</span>))
(<span class="kw">define</span> c2 (make-counter <span class="cn">10</span>))

(c1)
<span class="cs">→ 1</span>

(c1)
<span class="cs">→ 2</span>

(c2)
<span class="cs">→ 11</span>

(c2)
<span class="cs">→ 12</span></code></pre>
<ul>
<li>These two counters are independent: they each have their own state.</li>
<li>The environments of <code>c1</code> and <code>c2</code> point to different frames with different bindings for <code>n</code>.</li>
<li>The parent of both frames is the <em>global</em> environment, which contains built-in procdures like <code>car</code>, <code>+</code>, <code>*</code>, etc., and the top-level definitions <code>make-counter</code>, <code>c1</code>, and <code>c2</code>.</li>
</ul>
<h3 id="3.2" class="anchor">
<a class="anchor__link link" href="#3.2" aria-hidden="true">#</a> Objects
</h3>
<ul>
<li>We like to think about the world as being made up of independent, stateful objects.</li>
<li>The only way to see if two objects are “the same,<span class="tuck">”</span> not just associated with values that are equal, is to change one and see if the other changes in the same way.</li>
<li>The idea of objects, change, and sameness raises deep philosophical problems.</li>
</ul>
<div id="q1" class="highlight">
<a class="highlight__link link" href="highlight.html#5a-q1" aria-label="view quote in highlights page"><svg class="circle-arrow" width="18" height="18" aria-hidden="true"><use xlink:href="#circle-left"/></svg> Highlights</a>
<blockquote>
<p>For example, here I am, I am a particular person, a particular object. Now, I can take out my knife, and cut my fingernail. A piece of my fingernail has fallen off onto the table. I believe I am the same person I was a second ago, but I’m not physically the same in the slightest. I have changed. Why am I the same? What is the identity of me? I don’t know. Except for the fact that I have some sort of identity. And so, I think by introducing assignment and objects, we have opened ourselves up to all the horrible questions of philosophy that have been plaguing philosophers for some thousands of years about this sort of thing. It’s why mathematics is a lot cleaner. <span class="citation">—<a href="https://ocw.mit.edu/courses/6-001-structure-and-interpretation-of-computer-programs-spring-2005/16ee3e36a574a5d66e45961725170e73_dO1aqPBJCPg.pdf#page=14" title="SICP Lecture 5A transcript, page 14">Sussman</a></span></p>
</blockquote>
</div>
<h3 id="3.3" class="anchor">
<a class="anchor__link link" href="#3.3" aria-hidden="true">#</a> Actions and identity
</h3>
<ul>
<li>An action <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span> has an effect on an object <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> (or equivalently, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> was changed by <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi><mtext>)</mtext></mrow><annotation encoding="application/x-tex">A\htmlClass{math-punctuation}{\text{)}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">A</span><span class="enclosing math-punctuation"><span class="mord text"><span class="mord">)</span></span></span></span></span></span> if some property which was true of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> before <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span> became false after.</li>
<li>We consider two objects to be the same if any action that has an effect on one has the same effect on the other.</li>
</ul>
<h3 id="3.4" class="anchor">
<a class="anchor__link link" href="#3.4" aria-hidden="true">#</a> Uses of objection orientation
</h3>
<ul>
<li>One of the nice things about objects is the way they let us model the world.</li>
<li>The modularity of the world can give us modularity in our programming.</li>
<li>For example, in the Monte Carlo program from <a href="../text/3/1.html#3.1.2">§&nbsp;3.1.2</a>, using the assignment statement for random number generation greatly enhances modularity.</li>
<li>But for most things, objects and assignment are not the right way to think. We should only use them if we need them.</li>
</ul>
</main>
<nav class="pagenav pagenav--bottom" aria-label="page">
  <div class="pagenav__item pagenav__item--left">
    <a class="pagenav__link link" href="4b.html" aria-label="previous page">
      <svg width="12" height="11" aria-hidden="true"><use xlink:href="#left"/>
      </svg><span class="pagenav__prev">Prev</span>
    </a>
  </div>
  <div class="pagenav__item pagenav__item--center">
    <a class="pagenav__link link" href="index.html" aria-label="parent page">
      <svg width="11" height="12" aria-hidden="true"><use xlink:href="#up"/>
      </svg><span class="pagenav__up">Up</span>
    </a>
  </div>
  <div class="pagenav__item pagenav__item--right">
    <a class="pagenav__link link" href="5b.html" aria-label="next page">
      <span class="pagenav__next">Next</span
        ><svg width="12" height="11" aria-hidden="true"
        ><use xlink:href="#right"/></svg>
    </a>
  </div>
</nav>
<footer class="footer">
  <p>© 2022 Mitchell Kember</p>
</footer>
</body>
</html>
