<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Mitchell Kember">
  <title>SICP Lecture 5B Notes</title>
  <link rel="stylesheet" href="../style.css">
</head>
<body>
<div hidden>
  <svg>
    <symbol id="up" viewBox="0 0 11 12">
      <path fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" d="M5.5.8v10.4m4.457-5.943L5.5.8 1.043 5.257"/>
    </symbol>
    <symbol id="left" viewBox="0 0 12 11">
      <path fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" d="M.8 5.5h10.4M5.257 9.957L.8 5.5l4.457-4.457"/>
    </symbol>
    <symbol id="right" viewBox="0 0 12 11">
      <use xlink:href="#left" transform="matrix(-1 0 0 1 12 0)"/>
    </symbol>
    <symbol id="external" viewBox="0 0 24 24">
      <path fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" d="M10.688 5.438H4.125A2.65 2.65 0 001.5 8.063v11.812A2.65 2.65 0 004.125 22.5h11.813a2.65 2.65 0 002.624-2.625v-6.563m-9.187 1.313L22.5 1.5m-6.563 0H22.5v6.563"/>
    </symbol>
    <symbol id="circle-left" viewBox="0 0 18 18" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="9" stroke-width="1.69" transform="matrix(.8889 0 0 .8889 -1.667 -1.667)"/>
      <path stroke-width="1.5" d="M5.229 9h7.542M9 5.229L5.229 9 9 12.771"/>
    </symbol>
  </svg>
</div>
<a class="skip-link" href="#main">Skip to main content</a>
<header class="header">
  <a class="title link" href="../index.html">SICP Study</a>
  <nav class="sitenav" aria-label="site">
    <a class="sitenav__item link"
        href="../text/index.html" aria-label="textbook notes">Text</a>
    <a class="sitenav__item sitenav__item--active link"
        href="../lecture/index.html" aria-label="lecture notes">Lecture</a>
    <a class="sitenav__item link"
        href="../exercise/index.html" aria-label="exercises">Exercise</a>
    <a class="sitenav__item sitenav__item--last link"
        href="https://github.com/mk12/sicp" aria-label="GitHub repository">
      Source
      <svg class="github-mark" width="25" height="25" viewBox="0 0 136 133" aria-hidden="true">
        <path fill="currentColor" d="M67.866.002C30.387.002 0 30.39 0 67.877c0 29.988 19.446 55.425 46.417 64.404 3.396.621 4.633-1.475 4.633-3.275 0-1.608-.058-5.879-.091-11.541-18.88 4.1-22.863-9.1-22.863-9.1-3.087-7.838-7.537-9.925-7.537-9.925-6.163-4.213.466-4.13.466-4.13 6.813.484 10.396 6.996 10.396 6.996 6.054 10.371 15.888 7.375 19.754 5.642.617-4.387 2.367-7.38 4.309-9.075-15.071-1.712-30.917-7.537-30.917-33.546 0-7.408 2.646-13.466 6.988-18.212-.7-1.717-3.03-8.617.662-17.963 0 0 5.7-1.825 18.667 6.959 5.412-1.505 11.22-2.259 16.992-2.284 5.762.025 11.57.78 16.991 2.284 12.959-8.784 18.646-6.959 18.646-6.959 3.704 9.346 1.375 16.246.675 17.963 4.35 4.746 6.98 10.804 6.98 18.212 0 26.075-15.872 31.813-30.992 33.492 2.437 2.096 4.608 6.237 4.608 12.57 0 9.072-.083 16.392-.083 18.617 0 1.817 1.22 3.93 4.666 3.267 26.95-8.996 46.38-34.417 46.38-64.396 0-37.487-30.392-67.875-67.88-67.875"/>
      </svg>      
    </a>
  </nav>
</header>
<nav class="pagenav pagenav--top" aria-label="page">
  <div class="pagenav__item pagenav__item--left">
    <a class="pagenav__link link" href="5a.html" aria-label="previous page">
      <svg width="12" height="11" aria-hidden="true"><use xlink:href="#left"/>
      </svg><span class="pagenav__prev">Prev</span>
    </a>
  </div>
  <div class="pagenav__item pagenav__item--center">
    <a class="pagenav__link link" href="index.html" aria-label="parent page">
      <svg width="11" height="12" aria-hidden="true"><use xlink:href="#up"/>
      </svg><span class="pagenav__up">Up</span>
    </a>
  </div>
  <div class="pagenav__item pagenav__item--right">
    <a class="pagenav__link link" href="6a.html" aria-label="next page">
      <span class="pagenav__next">Next</span
        ><svg width="12" height="11" aria-hidden="true"
        ><use xlink:href="#right"/></svg>
    </a>
  </div>
</nav>
<main id="main">
<h1>
<span class="number">5B</span> <a class="link" href="https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-001-structure-and-interpretation-of-computer-programs-spring-2005/video-lectures/5b-computational-objects">Computational Objects<span class="nowrap">﻿<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h1>
<h2 id="1" class="anchor">
<a class="anchor__link link" href="#1" aria-hidden="true">#</a> Part 1
</h2>
<h3 id="1.1" class="anchor">
<a class="anchor__link link" href="#1.1" aria-hidden="true">#</a> Recap
</h3>
<ul>
<li>We’re going to do some complicated programming to illustrate what you can do with mutable state.</li>
<li>We were motivated by the need to model physical systems.</li>
<li>Programming this way buys us modularity, if done correctly.</li>
</ul>
<h3 id="1.2" class="anchor">
<a class="anchor__link link" href="#1.2" aria-hidden="true">#</a> Electrical systems
</h3>
<ul>
<li>We are going to model electrical systems.</li>
<li>We can consider the things wires are connected to as objects.</li>
<li>The connections can be made abstract. We use ideal wires.</li>
<li>We create wires with <code>(make-wire)</code>, and we connect them with gates: <code>and-gate</code>, <code>or-gate</code>, and <code>inverter</code>.</li>
<li><code>(inverter a b)</code> connects wires <code>a</code> and <code>b</code> with an inverter.</li>
<li>Our language will be embedded in Lisp, like the Henderson picture language.</li>
<li>We can wire up half adders and full adders with these gates.</li>
<li>We have primitives (wires), means of combination (gates), and means of abstraction (lambda). Lambda is the ultimate glue.</li>
</ul>
<h3 id="1.3" class="anchor">
<a class="anchor__link link" href="#1.3" aria-hidden="true">#</a> Implementing the primitives
</h3>
<ul>
<li>All we have to do is implement the primitives. The rest is free.</li>
<li>An inverter works by adding an action to its input wire. When a new signal arrives, this action delays and then sets the signal of its output wire to the logical-not of its input signal.</li>
<li>And-gates and or-gates are implemented similarly. The action must be added to both input wires.</li>
<li>Each wires must remember its signals and its list of actions.</li>
<li>The actions procedures need to keep references to their wires. These are captured by the lambda inside the gate procedures.</li>
<li>We implement wires with the message-passing style. It responds to <code>get-signal</code>, <code>set-signal!</code>, and <code>add-action!</code>.</li>
<li>The wire executes all actions after its signal is set.</li>
</ul>
<h3 id="1.4" class="anchor">
<a class="anchor__link link" href="#1.4" aria-hidden="true">#</a> Scheduling delayed tasks
</h3>
<ul>
<li>The agenda is a schedule of actions to run. Whenever <code>after-delay</code> is used in an action, a task is added to the agenda.</li>
<li>These get executed in the proper order, with a time variable maintaining the correct time.</li>
<li>The <code>propagate</code> procedure executers everything the agenda, emptying it as it goes.</li>
</ul>
<h2 id="2" class="anchor">
<a class="anchor__link link" href="#2" aria-hidden="true">#</a> Part 2
</h2>
<h3 id="2.1" class="anchor">
<a class="anchor__link link" href="#2.1" aria-hidden="true">#</a> Implementing the agenda
</h3>
<ul>
<li>We’ve made a simulation where objects and state changed in the computer match the objects and state changes in the world.</li>
<li>We’re going to use agendas (priority queues) to organize time.</li>
<li>We have a constructor <code>make-agenda</code>; selector <code>current-time</code> and <code>first-item</code>; predicate <code>empty-agenda?</code>; and mutators <code>add-to-agenda!</code> and <code>remove-first-item!</code>.</li>
<li>We will represent it as a list a segments. Each segment is a time <code>cons</code> ed to a queue of tasks (procedures of no arguments).</li>
<li>To add a task, we either add it to the queue of the appropriate segment, or create a new segment with that time.</li>
</ul>
<h4 id="2.1.1" class="anchor">
<a class="anchor__link link" href="#2.1.1" aria-hidden="true">#</a> Queues
</h4>
<ul>
<li>We construct queues with <code>(make-queue)</code>.</li>
<li>There are two mutators, <code>(insert-queue! q x)</code> and <code>(delete-queue! q)</code>; a selector, <code>(front-queue q)</code>; and a predicate, <code>(empty-queue? q)</code>.</li>
<li>A queue is represented as a front pointer of a list <code>cons</code> ed to the rear pointer of the same list.</li>
<li>The mutators use <code>set-car!</code> and <code>set-cdr!</code>.</li>
</ul>
<h2 id="3" class="anchor">
<a class="anchor__link link" href="#3" aria-hidden="true">#</a> Part 3
</h2>
<h3 id="3.1" class="anchor">
<a class="anchor__link link" href="#3.1" aria-hidden="true">#</a> Identity of pairs
</h3>
<ul>
<li>Before, all we needed to know about <code>cons</code> was that for all values of <code>x</code> and <code>y</code>, <code>(<span class="fu">=</span> x (<span class="fu">car</span> (<span class="fu">cons</span> x y)))</code> and <code>(<span class="fu">=</span> y (<span class="fu">cdr</span> (<span class="fu">cons</span> x y)))</code>. This says nothing about identity.</li>
<li>These no longer tell the whole story, now that we have mutators.</li>
<li>This raises a question: if you change the <code>car</code> of a pair, do all pairs that look the same also change?</li>
<li>Cons pairs now have an identity.</li>
<li>When we have multiple names for the same object, they are called <em>aliases</em>. Changing one changes them all. Sometimes sharing is what we want.</li>
</ul>
<div id="q1" class="highlight">
<a class="highlight__link link" href="highlight.html#5b-q1" aria-label="view quote in highlights page"><svg class="circle-arrow" width="18" height="18" aria-hidden="true"><use xlink:href="#circle-left"/></svg> Highlights</a>
<blockquote>
<p>But inadvertent sharing, unanticipated interactions between objects, is the source of most of the bugs that occur in complicated programs. So by introducing this possibility of things having identity and sharing and having multiple names for the same thing, we get a lot of power. But we’re going to pay for it with lots of complexity and bugs. <span class="citation">—<a href="https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-001-structure-and-interpretation-of-computer-programs-spring-2005/video-lectures/5b-computational-objects/yedzRWhi-9E.pdf#page=12" title="SICP Lecture 5B transcript, page 12">Sussman</a></span></p>
</blockquote>
</div>
<h3 id="3.2" class="anchor">
<a class="anchor__link link" href="#3.2" aria-hidden="true">#</a> Lambda calculus
</h3>
<ul>
<li>Assignment and mutators are equally powerful. We can implement the cons mutators in terms of <code>set!</code>.</li>
<li>We’ve already seen Alonzo Church’s way of creating pairs just with lambda expressions:</li>
</ul>
<pre><code class="blockcode">(<span class="kw">define</span> (<span class="fu">cons</span> x y)
  (<span class="kw">lambda</span> (m)
    (m x y)))
(<span class="kw">define</span> (<span class="fu">car</span> x) (x (<span class="kw">lambda</span> (a d) a)))
(<span class="kw">define</span> (<span class="fu">cdr</span> x) (x (<span class="kw">lambda</span> (a d) d)))</code></pre>
<ul>
<li>We can change it to allow mutation:</li>
</ul>
<pre><code class="blockcode">(<span class="kw">define</span> (<span class="fu">cons</span> x y)
  (<span class="kw">lambda</span> (m)
    (m x
       y
       (<span class="kw">lambda</span> (n) (<span class="kw">set!</span> x n))
       (<span class="kw">lambda</span> (n) (<span class="kw">set!</span> y n)))))
(<span class="kw">define</span> (<span class="fu">car</span> x)
  (x (<span class="kw">lambda</span> (a d sa sd) a)))
(<span class="kw">define</span> (<span class="fu">cdr</span> x)
  (x (<span class="kw">lambda</span> (a d sa sd) d)))
(<span class="kw">define</span> (<span class="fu">set-car!</span> x v)
  (x (<span class="kw">lambda</span> (a d sa sd) (sa v))))
(<span class="kw">define</span> (<span class="fu">set-cdr!</span> x v)
  (x (<span class="kw">lambda</span> (a d sa sd) (sd v))))</code></pre>
<ul>
<li>(I just realized that creating objects this way, where you apply the object to a procedure that is passed all the state variables, is just like pattern matching.)</li>
</ul>
</main>
<nav class="pagenav pagenav--bottom" aria-label="page">
  <div class="pagenav__item pagenav__item--left">
    <a class="pagenav__link link" href="5a.html" aria-label="previous page">
      <svg width="12" height="11" aria-hidden="true"><use xlink:href="#left"/>
      </svg><span class="pagenav__prev">Prev</span>
    </a>
  </div>
  <div class="pagenav__item pagenav__item--center">
    <a class="pagenav__link link" href="index.html" aria-label="parent page">
      <svg width="11" height="12" aria-hidden="true"><use xlink:href="#up"/>
      </svg><span class="pagenav__up">Up</span>
    </a>
  </div>
  <div class="pagenav__item pagenav__item--right">
    <a class="pagenav__link link" href="6a.html" aria-label="next page">
      <span class="pagenav__next">Next</span
        ><svg width="12" height="11" aria-hidden="true"
        ><use xlink:href="#right"/></svg>
    </a>
  </div>
</nav>
<footer class="footer">
  <p>© 2021 Mitchell Kember</p>
</footer>
</body>
</html>
