<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SICP Section 2.2 Exercises</title>
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css">
  <link rel="stylesheet" href="../../style.css">
</head>
<body>
<div hidden>
  <svg>
    <symbol id="up" viewBox="0 0 11 12">
      <path fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" d="M5.5.8v10.4m4.457-5.943L5.5.8 1.043 5.257"/>
    </symbol>
    <symbol id="left" viewBox="0 0 12 11">
      <path fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" d="M.8 5.5h10.4M5.257 9.957L.8 5.5l4.457-4.457"/>
    </symbol>
    <symbol id="right" viewBox="0 0 12 11">
      <use xlink:href="#left" transform="matrix(-1 0 0 1 12 0)"/>
    </symbol>
    <symbol id="external" viewBox="0 0 24 24">
      <path fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" d="M10.688 5.438H4.125A2.65 2.65 0 001.5 8.063v11.812A2.65 2.65 0 004.125 22.5h11.813a2.65 2.65 0 002.624-2.625v-6.563m-9.187 1.313L22.5 1.5m-6.563 0H22.5v6.563"/>
    </symbol>
  </svg>
</div>
<a class="skip-link" href="#main">Skip to main content</a>
<header class="header">
  <a class="title link" href="../../index.html">SICP Study</a>
  <nav class="sitenav" aria-label="site">
    <a class="sitenav__item link"
        href="../../text/index.html" aria-label="textbook notes">Text</a>
    <a class="sitenav__item link"
        href="../../lecture/index.html" aria-label="lecture notes">Lecture</a>
    <a class="sitenav__item sitenav__item--active link"
        href="../../exercise/index.html" aria-label="exercises">Exercise</a>
    <a class="sitenav__item sitenav__item--last link"
        href="https://github.com/mk12/sicp" aria-label="GitHub repository">
      Source
      <svg class="github-mark" width="25" height="25" viewBox="0 0 136 133" aria-hidden="true">
        <path fill="currentColor" d="M67.866.002C30.387.002 0 30.39 0 67.877c0 29.988 19.446 55.425 46.417 64.404 3.396.621 4.633-1.475 4.633-3.275 0-1.608-.058-5.879-.091-11.541-18.88 4.1-22.863-9.1-22.863-9.1-3.087-7.838-7.537-9.925-7.537-9.925-6.163-4.213.466-4.13.466-4.13 6.813.484 10.396 6.996 10.396 6.996 6.054 10.371 15.888 7.375 19.754 5.642.617-4.387 2.367-7.38 4.309-9.075-15.071-1.712-30.917-7.537-30.917-33.546 0-7.408 2.646-13.466 6.988-18.212-.7-1.717-3.03-8.617.662-17.963 0 0 5.7-1.825 18.667 6.959 5.412-1.505 11.22-2.259 16.992-2.284 5.762.025 11.57.78 16.991 2.284 12.959-8.784 18.646-6.959 18.646-6.959 3.704 9.346 1.375 16.246.675 17.963 4.35 4.746 6.98 10.804 6.98 18.212 0 26.075-15.872 31.813-30.992 33.492 2.437 2.096 4.608 6.237 4.608 12.57 0 9.072-.083 16.392-.083 18.617 0 1.817 1.22 3.93 4.666 3.267 26.95-8.996 46.38-34.417 46.38-64.396 0-37.487-30.392-67.875-67.88-67.875"/>
      </svg>      
    </a>
  </nav>
</header>
<nav class="pagenav pagenav--top" aria-label="page">
  <div class="pagenav__item pagenav__item--left">
    <a class="pagenav__link link" href="1.html" aria-label="previous page">
      <svg width="12" height="11" aria-hidden="true"><use xlink:href="#left"/>
      </svg><span class="pagenav__prev">Prev</span>
    </a>
  </div>
  <div class="pagenav__item pagenav__item--center">
    <a class="pagenav__link link" href="index.html" aria-label="parent page">
      <svg width="11" height="12" aria-hidden="true"><use xlink:href="#up"/>
      </svg><span class="pagenav__up">Up</span>
    </a>
  </div>
  <div class="pagenav__item pagenav__item--right">
    <a class="pagenav__link link" href="3.html" aria-label="next page">
      <span class="pagenav__next">Next</span
        ><svg width="12" height="11" aria-hidden="true"
        ><use xlink:href="#right"/></svg>
    </a>
  </div>
</nav>
<main id="main">
<h1>
<span class="number">2.2</span> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html">Hierarchical Data and the Closure Property<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h1>
<h2 id="2.2.1" class="anchor">
<a class="anchor__link link" href="#2.2.1" aria-hidden="true">#</a> <span class="number">2.2.1</span> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_sec_2.2.1">Representing Sequences<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h2>
<pre><code class="blockcode">(<span class="kw">define</span> one-through-four (<span class="fu">list</span> <span class="cn">1</span> <span class="cn">2</span> <span class="cn">3</span> <span class="cn">4</span>))

one-through-four <span class="op">=&gt;</span> <span class="vs">&#39;(1 2 3 4)</span>
(<span class="fu">car</span> one-through-four) <span class="op">=&gt;</span> <span class="cn">1</span>
(<span class="fu">cdr</span> one-through-four) <span class="op">=&gt;</span> <span class="vs">&#39;(2 3 4)</span>
(<span class="fu">car</span> (<span class="fu">cdr</span> one-through-four)) <span class="op">=&gt;</span> <span class="cn">2</span>
(<span class="fu">cons</span> <span class="cn">10</span> one-through-four) <span class="op">=&gt;</span> <span class="vs">&#39;(10 1 2 3 4)</span>
(<span class="fu">cons</span> <span class="cn">5</span> one-through-four) <span class="op">=&gt;</span> <span class="vs">&#39;(5 1 2 3 4)</span></code></pre>
<h3 id="2.2.1.1" class="anchor">
<a class="anchor__link link" href="#2.2.1.1" aria-hidden="true">#</a> <span class="number">2.2.1.1</span> List operations
</h3>
<p>Iterative <code>list-ref</code>:</p>
<pre><code class="blockcode">(<span class="kw">define</span> (<span class="fu">list-ref</span> items n)
  (<span class="kw">if</span> (<span class="fu">=</span> n <span class="cn">0</span>)
      (<span class="fu">car</span> items)
      (<span class="fu">list-ref</span> (<span class="fu">cdr</span> items) (<span class="fu">-</span> n <span class="cn">1</span>))))

(<span class="kw">define</span> squares (<span class="fu">list</span> <span class="cn">1</span> <span class="cn">4</span> <span class="cn">9</span> <span class="cn">16</span> <span class="cn">25</span>))
(<span class="fu">list-ref</span> squares <span class="cn">3</span>) <span class="op">=&gt;</span> <span class="cn">16</span></code></pre>
<p>Recursive <code>length</code>:</p>
<pre><code class="blockcode">(<span class="kw">define</span> (<span class="fu">length</span> items)
  (<span class="kw">if</span> (<span class="fu">null?</span> items)
      <span class="cn">0</span>
      (<span class="fu">+</span> <span class="cn">1</span> (<span class="fu">length</span> (<span class="fu">cdr</span> items)))))

(<span class="kw">define</span> odds (<span class="fu">list</span> <span class="cn">1</span> <span class="cn">3</span> <span class="cn">5</span> <span class="cn">7</span>))
(<span class="fu">length</span> odds) <span class="op">=&gt;</span> <span class="cn">4</span></code></pre>
<p>Iterative <code>length</code>:</p>
<pre><code class="blockcode">(<span class="kw">define</span> (<span class="fu">length</span> items)
  (<span class="kw">define</span> (iter a count)
    (<span class="kw">if</span> (<span class="fu">null?</span> a)
        count
        (iter (<span class="fu">cdr</span> a) (<span class="fu">+</span> <span class="cn">1</span> count))))
  (iter items <span class="cn">0</span>))

(<span class="fu">length</span> odds) <span class="op">=&gt;</span> <span class="cn">4</span></code></pre>
<p>Recursive <code>append</code>:</p>
<pre><code class="blockcode">(<span class="kw">define</span> (<span class="fu">append</span> list1 list2)
  (<span class="kw">if</span> (<span class="fu">null?</span> list1)
      list2
      (<span class="fu">cons</span> (<span class="fu">car</span> list1)
            (<span class="fu">append</span> (<span class="fu">cdr</span> list1) list2))))

(<span class="fu">append</span> squares odds) <span class="op">=&gt;</span> <span class="vs">&#39;(1 4 9 16 25 1 3 5 7)</span>
(<span class="fu">append</span> odds squares) <span class="op">=&gt;</span> <span class="vs">&#39;(1 3 5 7 1 4 9 16 25)</span></code></pre>
<h3 id="ex2.17" class="anchor">
<a class="anchor__link link" href="#ex2.17" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.17">Exercise 2.17<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<pre><code class="blockcode">(<span class="kw">define</span> (last-pair xs)
  (<span class="kw">if</span> (<span class="fu">null?</span> (<span class="fu">cdr</span> xs))
      xs
      (last-pair (<span class="fu">cdr</span> xs))))

(last-pair (<span class="fu">list</span> <span class="cn">23</span> <span class="cn">72</span> <span class="cn">149</span> <span class="cn">34</span>)) <span class="op">=&gt;</span> <span class="vs">&#39;(34)</span></code></pre>
<h3 id="ex2.18" class="anchor">
<a class="anchor__link link" href="#ex2.18" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.18">Exercise 2.18<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<pre><code class="blockcode">(<span class="kw">define</span> (<span class="fu">reverse</span> xs)
  (<span class="kw">define</span> (iter xs ys)
    (<span class="kw">if</span> (<span class="fu">null?</span> xs)
        ys
        (iter (<span class="fu">cdr</span> xs)
              (<span class="fu">cons</span> (<span class="fu">car</span> xs) ys))))
  (iter xs <span class="vs">&#39;()</span>))

(<span class="fu">reverse</span> (<span class="fu">list</span> <span class="cn">1</span> <span class="cn">4</span> <span class="cn">9</span> <span class="cn">16</span> <span class="cn">25</span>)) <span class="op">=&gt;</span> <span class="vs">&#39;(25 16 9 4 1)</span></code></pre>
<h3 id="ex2.19" class="anchor">
<a class="anchor__link link" href="#ex2.19" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.19">Exercise 2.19<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<p>Generalizing <code>count-change</code> from <a href="../1/2.html#1.2.2.1">§&nbsp;1.2.2.1</a> to work with any currency:</p>
<pre><code class="blockcode">(<span class="kw">define</span> us-coins (<span class="fu">list</span> <span class="cn">50</span> <span class="cn">25</span> <span class="cn">10</span> <span class="cn">5</span> <span class="cn">1</span>))
(<span class="kw">define</span> uk-coins (<span class="fu">list</span> <span class="cn">100</span> <span class="cn">50</span> <span class="cn">20</span> <span class="cn">10</span> <span class="cn">5</span> <span class="cn">2</span> <span class="cn">1</span> <span class="cn">1/2</span>))

(<span class="kw">define</span> (cc amount coins)
  (<span class="kw">cond</span> ((<span class="fu">=</span> amount <span class="cn">0</span>) <span class="cn">1</span>)
        ((<span class="fu">&lt;</span> amount <span class="cn">0</span>) <span class="cn">0</span>)
        ((no-more? coins) <span class="cn">0</span>)
        (<span class="kw">else</span>
         (<span class="fu">+</span> (cc amount
                (except-first-denom coins))
            (cc (<span class="fu">-</span> amount (first-denom coins))
                coins)))))

(<span class="kw">define</span> first-denom <span class="fu">car</span>)
(<span class="kw">define</span> except-first-denom <span class="fu">cdr</span>)
(<span class="kw">define</span> no-more? <span class="fu">null?</span>)

(cc <span class="cn">20</span> uk-coins) <span class="op">=&gt;</span> <span class="cn">293</span></code></pre>
<p>The order of the coin list does not affect the answer produced by <code>cc</code>:</p>
<pre><code class="blockcode">(cc <span class="cn">100</span> us-coins) <span class="op">=&gt;</span> <span class="cn">292</span>
(cc <span class="cn">100</span> (<span class="fu">reverse</span> us-coins)) <span class="op">=&gt;</span> <span class="cn">292</span>
(cc <span class="cn">100</span> (<span class="fu">list</span> <span class="cn">5</span> <span class="cn">50</span> <span class="cn">1</span> <span class="cn">25</span> <span class="cn">10</span>)) <span class="op">=&gt;</span> <span class="cn">292</span></code></pre>
<p>The tree recursion will explore every possible combination. It makes no difference if you start with combinations that prefer fewer, larger coins, or with the combination that only uses pennies, or anything in between.</p>
<h3 id="ex2.20" class="anchor">
<a class="anchor__link link" href="#ex2.20" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.20">Exercise 2.20<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<pre><code class="blockcode">(<span class="kw">define</span> (same-parity . xs)
  (<span class="kw">define</span> (helper pred xs)
    (<span class="kw">cond</span> ((<span class="fu">null?</span> xs) xs)
          ((pred (<span class="fu">car</span> xs))
           (<span class="fu">cons</span> (<span class="fu">car</span> xs)
                 (helper pred (<span class="fu">cdr</span> xs))))
          (<span class="kw">else</span> (helper pred (<span class="fu">cdr</span> xs)))))
  (<span class="kw">cond</span> ((<span class="fu">null?</span> xs) xs)
        ((<span class="fu">even?</span> (<span class="fu">car</span> xs)) (helper <span class="fu">even?</span> xs))
        (<span class="kw">else</span> (helper <span class="fu">odd?</span> xs))))

(same-parity <span class="cn">1</span> <span class="cn">2</span> <span class="cn">3</span> <span class="cn">4</span> <span class="cn">5</span> <span class="cn">6</span> <span class="cn">7</span>) <span class="op">=&gt;</span> <span class="vs">&#39;(1 3 5 7)</span>
(same-parity <span class="cn">2</span> <span class="cn">3</span> <span class="cn">4</span> <span class="cn">5</span> <span class="cn">6</span> <span class="cn">7</span>) <span class="op">=&gt;</span> <span class="vs">&#39;(2 4 6)</span></code></pre>
<h3 id="2.2.1.2" class="anchor">
<a class="anchor__link link" href="#2.2.1.2" aria-hidden="true">#</a> <span class="number">2.2.1.2</span> Mapping over lists
</h3>
<pre><code class="blockcode">(<span class="kw">define</span> (scale-list items factor)
  (<span class="kw">if</span> (<span class="fu">null?</span> items)
      <span class="vs">&#39;()</span>
      (<span class="fu">cons</span> (<span class="fu">*</span> (<span class="fu">car</span> items) factor)
            (scale-list (<span class="fu">cdr</span> items) factor))))
(scale-list (<span class="fu">list</span> <span class="cn">1</span> <span class="cn">2</span> <span class="cn">3</span> <span class="cn">4</span> <span class="cn">5</span>) <span class="cn">10</span>) <span class="op">=&gt;</span> <span class="vs">&#39;(10 20 30 40 50)</span>

(<span class="kw">define</span> (<span class="fu">map</span> proc items)
  (<span class="kw">if</span> (<span class="fu">null?</span> items)
      <span class="vs">&#39;()</span>
      (<span class="fu">cons</span> (proc (<span class="fu">car</span> items))
            (<span class="fu">map</span> proc (<span class="fu">cdr</span> items)))))

(<span class="kw">define</span> (scale-list items factor)
  (<span class="fu">map</span> (<span class="kw">lambda</span> (x) (<span class="fu">*</span> x factor)) items))
(scale-list (<span class="fu">list</span> <span class="cn">1</span> <span class="cn">2</span> <span class="cn">3</span> <span class="cn">4</span> <span class="cn">5</span>) <span class="cn">10</span>) <span class="op">=&gt;</span> <span class="vs">&#39;(10 20 30 40 50)</span></code></pre>
<h3 id="ex2.21" class="anchor">
<a class="anchor__link link" href="#ex2.21" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.21">Exercise 2.21<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="../1/1.html#1.1.4">1.1.4</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>square</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> (square-list xs)
  (<span class="kw">if</span> (<span class="fu">null?</span> xs)
      <span class="vs">&#39;()</span>
      (<span class="fu">cons</span> (square (<span class="fu">car</span> xs))
            (square-list (<span class="fu">cdr</span> xs)))))
(square-list (<span class="fu">list</span> <span class="cn">1</span> <span class="cn">2</span> <span class="cn">3</span> <span class="cn">4</span>)) <span class="op">=&gt;</span> <span class="vs">&#39;(1 4 9 16)</span>

(<span class="kw">define</span> (square-list xs) (<span class="fu">map</span> square xs))
(square-list (<span class="fu">list</span> <span class="cn">1</span> <span class="cn">2</span> <span class="cn">3</span> <span class="cn">4</span>)) <span class="op">=&gt;</span> <span class="vs">&#39;(1 4 9 16)</span></code></pre>
<h3 id="ex2.22" class="anchor">
<a class="anchor__link link" href="#ex2.22" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.22">Exercise 2.22<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="../1/1.html#1.1.4">1.1.4</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>square</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> (square-list items)
  (<span class="kw">define</span> (iter things answer)
    (<span class="kw">if</span> (<span class="fu">null?</span> things)
        answer
        (iter (<span class="fu">cdr</span> things)
              (<span class="fu">cons</span> (square (<span class="fu">car</span> things))
                    answer))))
  (iter items <span class="vs">&#39;()</span>))

(square-list (<span class="fu">list</span> <span class="cn">1</span> <span class="cn">2</span> <span class="cn">3</span> <span class="cn">4</span>)) <span class="op">=&gt;</span> <span class="vs">&#39;(16 9 4 1)</span></code></pre>
<p>Louis’s procedure reverses the order of the list because of the way he builds the result. His first iteration creates a pair whose <code>car</code> is <code>(square (<span class="fu">car</span> things))</code> and whose <code>cdr</code> is the empty list, and further recursions prepend to this list. So the last item of the result is the first item of the original list, and vice versa.</p>
<pre><code class="blockcode">(<span class="kw">define</span> (square-list items)
  (<span class="kw">define</span> (iter things answer)
    (<span class="kw">if</span> (<span class="fu">null?</span> things)
        answer
        (iter (<span class="fu">cdr</span> things)
              (<span class="fu">cons</span> answer
                    (square (<span class="fu">car</span> things))))))
  (iter items <span class="vs">&#39;()</span>))

(square-list (<span class="fu">list</span> <span class="cn">1</span> <span class="cn">2</span> <span class="cn">3</span> <span class="cn">4</span> <span class="cn">5</span>)) <span class="op">=&gt;</span> <span class="vs">&#39;(((((() . 1) . 4) . 9) . 16) . 25)</span></code></pre>
<p>Interchanging the arguments to <code>cons</code> doesn’t work because now each <code>cdr</code> is a number, not a pair. The result is not a proper list, so Scheme prints it in explicit <code>(<span class="fu">car</span> . <span class="fu">cdr</span>)</code> notation. It is essentially the same reversed list as before, just the roles of <code>car</code> and <code>cdr</code> have been swapped.</p>
<h3 id="ex2.23" class="anchor">
<a class="anchor__link link" href="#ex2.23" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.23">Exercise 2.23<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<pre><code class="blockcode">(<span class="kw">define</span> (<span class="fu">for-each</span> f xs)
  (unless (<span class="fu">null?</span> xs)
    (f (<span class="fu">car</span> xs))
    (<span class="fu">for-each</span> f (<span class="fu">cdr</span> xs))))

(<span class="fu">for-each</span>
 (<span class="kw">lambda</span> (x)
   (<span class="fu">newline</span>)
   (<span class="fu">display</span> x))
 (<span class="fu">list</span> <span class="cn">57</span> <span class="cn">321</span> <span class="cn">88</span>))
<span class="op">=$&gt;</span> [<span class="cn">&quot;57&quot;</span> <span class="cn">&quot;321&quot;</span> <span class="cn">&quot;88&quot;</span>]</code></pre>
<h2 id="2.2.2" class="anchor">
<a class="anchor__link link" href="#2.2.2" aria-hidden="true">#</a> <span class="number">2.2.2</span> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_sec_2.2.2">Hierarchical Structures<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h2>
<pre><code class="blockcode">(<span class="kw">define</span> (count-leaves x)
  (<span class="kw">cond</span> ((<span class="fu">null?</span> x) <span class="cn">0</span>)
        ((<span class="fu">not</span> (<span class="fu">pair?</span> x)) <span class="cn">1</span>)
        (<span class="kw">else</span> (<span class="fu">+</span> (count-leaves (<span class="fu">car</span> x))
                 (count-leaves (<span class="fu">cdr</span> x))))))

(<span class="kw">define</span> x (<span class="fu">cons</span> (<span class="fu">list</span> <span class="cn">1</span> <span class="cn">2</span>) (<span class="fu">list</span> <span class="cn">3</span> <span class="cn">4</span>)))
(<span class="fu">length</span> x) <span class="op">=&gt;</span> <span class="cn">3</span>
(count-leaves x) <span class="op">=&gt;</span> <span class="cn">4</span>

(<span class="fu">list</span> x x) <span class="op">=&gt;</span> <span class="vs">&#39;(((1 2) 3 4) ((1 2) 3 4))</span>
(<span class="fu">length</span> (<span class="fu">list</span> x x)) <span class="op">=&gt;</span> <span class="cn">2</span>
(count-leaves (<span class="fu">list</span> x x)) <span class="op">=&gt;</span> <span class="cn">8</span></code></pre>
<h3 id="ex2.24" class="anchor">
<a class="anchor__link link" href="#ex2.24" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.24">Exercise 2.24<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<pre><code class="blockcode">(<span class="fu">list</span> <span class="cn">1</span> (<span class="fu">list</span> <span class="cn">2</span> (<span class="fu">list</span> <span class="cn">3</span> <span class="cn">4</span>))) <span class="op">=&gt;</span> <span class="vs">&#39;(1 (2 (3 4)))</span></code></pre>
<p>Box-and-pointer structure:</p>
<figure><svg class="diagram" viewBox="0 0 458 328" style="max-width:458px"><defs><marker id="m1a" viewBox="-2 -2 8 8" refX="4" refY="2" markerWidth="7" markerHeight="7" orient="auto-start-reverse"><path d="M0 0v4l4-2-4-2z"/></marker><marker id="m1c" viewBox="0 0 8 8" refX="4" refY="4" markerWidth="7" markerHeight="7" orient="auto-start-reverse"><circle cx="4" cy="4" r="2.5" stroke="none" fill="currentColor"/></marker></defs><rect x="50.286" y="100.571" width="36.571" height="36.571" rx="4.571"/><text x="64.286" y="123.429">1</text><rect x="150.857" y="192" width="36.571" height="36.571" rx="4.571"/><text x="164.857" y="214.857">2</text><rect x="251.429" y="283.429" width="36.571" height="36.571" rx="4.571"/><text x="265.429" y="306.286">3</text><rect x="370.286" y="283.429" width="36.571" height="36.571" rx="4.571"/><text x="384.286" y="306.286">4</text><path marker-end="url(#m1a)" d="M0 27.429h45.714"/><path marker-end="url(#m1c)" d="M68.571 54.857V27.429"/><path marker-end="url(#m1c)" d="M118.857 27.429h-13.714"/><path marker-end="url(#m1a)" d="M118.857 27.429h45.714"/><path marker-end="url(#m1c)" d="M187.429 54.857V27.429"/><path marker-end="url(#m1a)" d="M68.571 54.857v36.572"/><path marker-end="url(#m1a)" d="M187.429 54.857v36.572"/><path marker-end="url(#m1c)" d="M169.143 146.286v-27.429"/><path marker-end="url(#m1c)" d="M219.429 118.857h-13.715"/><path marker-end="url(#m1a)" d="M219.429 118.857h45.714"/><path marker-end="url(#m1c)" d="M288 146.286v-27.429"/><path marker-end="url(#m1a)" d="M169.143 146.286v36.571"/><path marker-end="url(#m1a)" d="M288 146.286v36.571"/><path marker-end="url(#m1c)" d="M269.714 237.714v-27.428"/><path marker-end="url(#m1c)" d="M320 210.286h-13.714"/><path marker-end="url(#m1a)" d="M320 210.286h45.714"/><path marker-end="url(#m1c)" d="M388.571 237.714v-27.428"/><path marker-end="url(#m1a)" d="M269.714 237.714v36.572"/><path marker-end="url(#m1a)" d="M388.571 237.714v36.572"/><path d="M54.857 9.143a4.571 4.571 0 0 0-4.571 4.571m0 0v27.429m4.571-32h64m-32 0v36.571m32-36.571a4.571 4.571 0 0 1 4.572 4.571m0 0v27.429m-73.143 0a4.571 4.571 0 0 0 4.571 4.571m0 0h64m4.572-4.571a4.571 4.571 0 0 1-4.572 4.571m54.857-36.571a4.571 4.571 0 0 0-4.571 4.571m0 0v27.429m4.571-32h64m-32 0v36.571m27.429-36.571-13.714 27.428m18.285-27.428a4.571 4.571 0 0 1 4.572 4.571m0 0v27.429m-73.143 0a4.571 4.571 0 0 0 4.571 4.571m0 0h64m-18.285-9.143-4.572 9.143m27.429-4.571a4.571 4.571 0 0 1-4.572 4.571m-82.285 54.857a4.571 4.571 0 0 0-4.572 4.572m0 0v27.428m4.572-32h64m-32 0v36.572m32-36.572a4.571 4.571 0 0 1 4.571 4.572m0 0v27.428m-73.143 0a4.571 4.571 0 0 0 4.572 4.572m0 0h64m4.571-4.572a4.571 4.571 0 0 1-4.571 4.572m54.857-36.572a4.571 4.571 0 0 0-4.572 4.572m0 0v27.428m4.572-32h64m-32 0v36.572m27.428-36.572L320 128m18.286-27.429a4.571 4.571 0 0 1 4.571 4.572m0 0v27.428m-73.143 0a4.571 4.571 0 0 0 4.572 4.572m0 0h64M320 128l-4.571 9.143m27.428-4.572a4.571 4.571 0 0 1-4.571 4.572M256 192a4.571 4.571 0 0 0-4.571 4.571m0 0V224M256 192h64m-32 0v36.571M320 192a4.571 4.571 0 0 1 4.571 4.571m0 0V224m-73.142 0a4.571 4.571 0 0 0 4.571 4.571m0 0h64m4.571-4.571a4.571 4.571 0 0 1-4.571 4.571M374.857 192a4.571 4.571 0 0 0-4.571 4.571m0 0V224m4.571-32h64m-32 0v36.571M434.286 192l-13.715 27.429M438.857 192a4.571 4.571 0 0 1 4.572 4.571m0 0V224m-73.143 0a4.571 4.571 0 0 0 4.571 4.571m0 0h64m-18.286-9.142L416 228.571M443.429 224a4.571 4.571 0 0 1-4.572 4.571"/></svg></figure>
<p>Tree interpretation:</p>
<figure><svg class="diagram" viewBox="0 0 165 218" style="max-width:165px"><text x="36.857" y="105.143">1</text><text x="64.286" y="160">2</text><text x="91.714" y="214.857">3</text><text x="146.571" y="214.857">4</text><text x="9.429" y="13.714">(1 (2 (3 4)))</text><text x="100.857" y="68.571">(2 (3 4))</text><text x="128.286" y="123.429">(3 4)</text><path d="M68.571 27.429 45.714 73.143m22.857-45.714 54.858 109.714M96 82.286 73.143 128m50.286 9.143-22.858 45.714m22.858-45.714 22.857 45.714"/></svg></figure>
<h3 id="ex2.25" class="anchor">
<a class="anchor__link link" href="#ex2.25" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.25">Exercise 2.25<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<pre><code class="blockcode">(<span class="fu">car</span> (<span class="fu">cdr</span> (<span class="fu">car</span> (<span class="fu">cdr</span> (<span class="fu">cdr</span> <span class="vs">&#39;(1 3 (5 7) 9)</span>)))))
<span class="op">=&gt;</span> <span class="cn">7</span>

(<span class="fu">car</span> (<span class="fu">car</span> <span class="vs">&#39;((7))</span>))
<span class="op">=&gt;</span> <span class="cn">7</span>

(<span class="fu">car</span> (<span class="fu">cdr</span> (<span class="fu">car</span> (<span class="fu">cdr</span> (<span class="fu">car</span> (<span class="fu">cdr</span> (<span class="fu">car</span> (<span class="fu">cdr</span> (<span class="fu">car</span> (<span class="fu">cdr</span> (<span class="fu">car</span> (<span class="fu">cdr</span>
  <span class="vs">&#39;(1 (2 (3 (4 (5 (6 7))))))</span>))))))))))))
<span class="op">=&gt;</span> <span class="cn">7</span></code></pre>
<h3 id="ex2.26" class="anchor">
<a class="anchor__link link" href="#ex2.26" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.26">Exercise 2.26<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<pre><code class="blockcode">(<span class="kw">define</span> x (<span class="fu">list</span> <span class="cn">1</span> <span class="cn">2</span> <span class="cn">3</span>))
(<span class="kw">define</span> y (<span class="fu">list</span> <span class="cn">4</span> <span class="cn">5</span> <span class="cn">6</span>))

(<span class="fu">append</span> x y) <span class="op">=&gt;</span> <span class="vs">&#39;(1 2 3 4 5 6)</span>
(<span class="fu">cons</span> x y) <span class="op">=&gt;</span> <span class="vs">&#39;((1 2 3) 4 5 6)</span>
(<span class="fu">list</span> x y) <span class="op">=&gt;</span> <span class="vs">&#39;((1 2 3) (4 5 6))</span></code></pre>
<h3 id="ex2.27" class="anchor">
<a class="anchor__link link" href="#ex2.27" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.27">Exercise 2.27<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<pre><code class="blockcode">(<span class="kw">define</span> (deep-reverse x)
  (<span class="kw">if</span> (<span class="fu">pair?</span> x)
      (<span class="fu">map</span> deep-reverse (<span class="fu">reverse</span> x))
      x))

(<span class="kw">define</span> x <span class="vs">&#39;((1 2) (3 4))</span>)
(<span class="fu">reverse</span> x) <span class="op">=&gt;</span> <span class="vs">&#39;((3 4) (1 2))</span>
(deep-reverse x) <span class="op">=&gt;</span> <span class="vs">&#39;((4 3) (2 1))</span></code></pre>
<h3 id="ex2.28" class="anchor">
<a class="anchor__link link" href="#ex2.28" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.28">Exercise 2.28<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<pre><code class="blockcode">(<span class="kw">define</span> (fringe t)
  (<span class="kw">cond</span> ((<span class="fu">null?</span> t) t)
        ((<span class="fu">pair?</span> (<span class="fu">car</span> t))
         (<span class="fu">append</span> (fringe (<span class="fu">car</span> t))
                 (fringe (<span class="fu">cdr</span> t))))
        (<span class="kw">else</span> (<span class="fu">cons</span> (<span class="fu">car</span> t)
                    (fringe (<span class="fu">cdr</span> t))))))

(<span class="kw">define</span> x <span class="vs">&#39;((1 2) (3 4))</span>)
(fringe x) <span class="op">=&gt;</span> <span class="vs">&#39;(1 2 3 4)</span>
(fringe (<span class="fu">list</span> x x)) <span class="op">=&gt;</span> <span class="vs">&#39;(1 2 3 4 1 2 3 4)</span>
(fringe <span class="vs">&#39;((((5) 2) ((3 2) 9)))</span>) <span class="op">=&gt;</span> <span class="vs">&#39;(5 2 3 2 9)</span></code></pre>
<h3 id="ex2.29" class="anchor">
<a class="anchor__link link" href="#ex2.29" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.29">Exercise 2.29<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<pre><code class="blockcode">(<span class="kw">define</span> (make-mobile left right) (<span class="fu">list</span> left right))
(<span class="kw">define</span> (make-branch <span class="fu">length</span> structure) (<span class="fu">list</span> <span class="fu">length</span> structure))</code></pre>
<ol type="a">
<li><p>Selectors:</p>
<pre><code class="blockcode">(<span class="kw">define</span> left-branch <span class="fu">car</span>)
(<span class="kw">define</span> right-branch <span class="fu">cadr</span>)
(<span class="kw">define</span> branch-length <span class="fu">car</span>)
(<span class="kw">define</span> branch-structure <span class="fu">cadr</span>)</code></pre></li>
<li><p>Total weight:</p>
<pre><code class="blockcode">(<span class="kw">define</span> (mobile-weight mobile)
  (<span class="fu">+</span> (branch-weight (left-branch mobile))
     (branch-weight (right-branch mobile))))

(<span class="kw">define</span> (branch-weight branch)
  (<span class="kw">let</span> ((struct (branch-structure branch)))
    (<span class="kw">if</span> (<span class="fu">number?</span> struct)
        struct
        (mobile-weight struct))))</code></pre></li>
<li><p>Balance:</p>
<pre><code class="blockcode">(<span class="kw">define</span> (torque branch)
  (<span class="fu">*</span> (branch-length branch)
     (branch-weight branch)))

(<span class="kw">define</span> (mobile-balanced? mobile)
  (<span class="kw">and</span> (<span class="fu">=</span> (torque (left-branch mobile))
          (torque (right-branch mobile)))
       (branch-balanced? (left-branch mobile))
       (branch-balanced? (right-branch mobile))))

(<span class="kw">define</span> (branch-balanced? branch)
  (<span class="kw">let</span> ((struct (branch-structure branch)))
    (<span class="kw">or</span> (<span class="fu">number?</span> struct)
        (mobile-balanced? struct))))</code></pre></li>
<li><p>If <code>make-mobile</code> and <code>make-branch</code> use <code>cons</code> instead of <code>list</code>, all we need to do is change the <code>right-branch</code> and <code>branch-structure</code> selectors:</p>
<pre><code class="blockcode">(<span class="kw">define</span> make-mobile <span class="fu">cons</span>)
(<span class="kw">define</span> make-branch <span class="fu">cons</span>)

(<span class="kw">define</span> right-branch <span class="fu">cdr</span>)
(<span class="kw">define</span> branch-structure <span class="fu">cdr</span>)</code></pre></li>
</ol>
<h3 id="2.2.2.1" class="anchor">
<a class="anchor__link link" href="#2.2.2.1" aria-hidden="true">#</a> <span class="number">2.2.2.1</span> Mapping over trees
</h3>
<pre><code class="blockcode">(<span class="kw">define</span> (scale-tree tree factor)
  (<span class="kw">cond</span> ((<span class="fu">null?</span> tree) <span class="vs">&#39;()</span>)
        ((<span class="fu">not</span> (<span class="fu">pair?</span> tree)) (<span class="fu">*</span> tree factor))
        (<span class="kw">else</span> (<span class="fu">cons</span> (scale-tree (<span class="fu">car</span> tree) factor)
                    (scale-tree (<span class="fu">cdr</span> tree) factor)))))

(scale-tree <span class="vs">&#39;(1 (2 (3 4) 5) (6 7))</span> <span class="cn">10</span>) <span class="op">=&gt;</span> <span class="vs">&#39;(10 (20 (30 40) 50) (60 70))</span>

(<span class="kw">define</span> (scale-tree tree factor)
  (<span class="fu">map</span> (<span class="kw">lambda</span> (sub-tree)
         (<span class="kw">if</span> (<span class="fu">pair?</span> sub-tree)
             (scale-tree sub-tree factor)
             (<span class="fu">*</span> sub-tree factor)))
       tree))

(scale-tree <span class="vs">&#39;(1 (2 (3 4) 5) (6 7))</span> <span class="cn">10</span>) <span class="op">=&gt;</span> <span class="vs">&#39;(10 (20 (30 40) 50) (60 70))</span></code></pre>
<h3 id="ex2.30" class="anchor">
<a class="anchor__link link" href="#ex2.30" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.30">Exercise 2.30<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="../1/1.html#1.1.4">1.1.4</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>square</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> tree <span class="vs">&#39;(1 (2 (3 4) 5) (6 7))</span>)
(<span class="kw">define</span> squared-tree <span class="vs">&#39;(1 (4 (9 16) 25) (36 49))</span>)</code></pre>
<p>Direct recursion:</p>
<pre><code class="blockcode">(<span class="kw">define</span> (square-tree t)
  (<span class="kw">cond</span> ((<span class="fu">null?</span> t) <span class="vs">&#39;()</span>)
        ((<span class="fu">not</span> (<span class="fu">pair?</span> t)) (square t))
        (<span class="kw">else</span> (<span class="fu">cons</span> (square-tree (<span class="fu">car</span> t))
                    (square-tree (<span class="fu">cdr</span> t))))))

(square-tree tree) <span class="op">=&gt;</span> squared-tree</code></pre>
<p>Using <code>map</code>:</p>
<pre><code class="blockcode">(<span class="kw">define</span> (square-tree t)
  (<span class="fu">map</span> (<span class="kw">lambda</span> (t)
         (<span class="kw">if</span> (<span class="fu">pair?</span> t)
             (square-tree t)
             (square t)))
       t))

(square-tree tree) <span class="op">=&gt;</span> squared-tree</code></pre>
<h3 id="ex2.31" class="anchor">
<a class="anchor__link link" href="#ex2.31" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.31">Exercise 2.31<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="../1/1.html#1.1.4">1.1.4</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>square</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.30">Ex 2.30</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>squared-tree</code>
</li>
<li class="flat__item nowrap">
<code>tree</code>
</li>
</ul>
</li>
</ul>
</aside>
<p>Direct recursion:</p>
<pre><code class="blockcode">(<span class="kw">define</span> (tree-map f t)
  (<span class="kw">cond</span> ((<span class="fu">null?</span> t) <span class="vs">&#39;()</span>)
        ((<span class="fu">not</span> (<span class="fu">pair?</span> t)) (f t))
        (<span class="kw">else</span> (<span class="fu">cons</span> (tree-map f (<span class="fu">car</span> t))
                    (tree-map f (<span class="fu">cdr</span> t))))))

(<span class="kw">define</span> (square-tree tree) (tree-map square tree))
(square-tree tree) <span class="op">=&gt;</span> squared-tree</code></pre>
<p>Using <code>map</code>:</p>
<pre><code class="blockcode">(<span class="kw">define</span> (tree-map f t)
  (<span class="fu">map</span> (<span class="kw">lambda</span> (t)
         (<span class="kw">if</span> (<span class="fu">pair?</span> t)
             (tree-map f t)
             (f t)))
       t))

(<span class="kw">define</span> (square-tree tree) (tree-map square tree))
(square-tree tree) <span class="op">=&gt;</span> squared-tree</code></pre>
<h3 id="ex2.32" class="anchor">
<a class="anchor__link link" href="#ex2.32" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.32">Exercise 2.32<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<p>The set of all subsets, or powerset, is defined recursively for finite sets:</p>
<ul>
<li>For the empty set, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">P</mi><mo stretchy="false">(</mo><mi mathvariant="normal">∅</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">{</mo><mi mathvariant="normal">∅</mi><mo stretchy="false">}</mo><mtext>.</mtext></mrow><annotation encoding="application/x-tex">\powerset{\varnothing}=\{\varnothing\}\htmlClass{math-punctuation}{\text{.}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.08222em;">P</span></span><span class="mopen">(</span><span class="mord amsrm">∅</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord amsrm">∅</span><span class="mclose">}</span><span class="enclosing math-punctuation"><span class="mord text"><span class="mord">.</span></span></span></span></span></span></li>
<li>Given a set <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span> and any <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi><mtext>,</mtext></mrow><annotation encoding="application/x-tex">x\htmlClass{math-punctuation}{\text{,}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">x</span><span class="enclosing math-punctuation"><span class="mord text"><span class="mord">,</span></span></span></span></span></span> <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">P</mi><mo stretchy="false">(</mo><mi>S</mi><mo>∪</mo><mo stretchy="false">{</mo><mi>x</mi><mo stretchy="false">}</mo><mo stretchy="false">)</mo><mo>=</mo><mi mathvariant="script">P</mi><mo stretchy="false">(</mo><mi>S</mi><mo stretchy="false">)</mo><mo>∪</mo><mo stretchy="false">{</mo><mi>R</mi><mo>∪</mo><mo stretchy="false">{</mo><mi>x</mi><mo stretchy="false">}</mo><mo>∣</mo><mi>R</mi><mo>∈</mo><mi mathvariant="script">P</mi><mo stretchy="false">(</mo><mi>S</mi><mo stretchy="false">)</mo><mo stretchy="false">}</mo><mtext>.</mtext></mrow><annotation encoding="application/x-tex">\powerset{S\cup\{x\}} = \powerset{S} \cup \{R\cup\{x\} \mid R\in\powerset{S}\}\htmlClass{math-punctuation}{\text{.}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.08222em;">P</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord mathnormal">x</span><span class="mclose">}</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.08222em;">P</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord mathnormal">x</span><span class="mclose">}</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72243em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.08222em;">P</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mclose">)</span><span class="mclose">}</span><span class="enclosing math-punctuation"><span class="mord text"><span class="mord">.</span></span></span></span></span></span></li>
</ul>
<p>This leads to the following implementation:</p>
<pre><code class="blockcode">(<span class="kw">define</span> (subsets s)
  (<span class="kw">if</span> (<span class="fu">null?</span> s)
      (<span class="fu">list</span> <span class="vs">&#39;()</span>)
      (<span class="kw">let</span> ((first-item (<span class="fu">car</span> s))
            (subsets-rest (subsets (<span class="fu">cdr</span> s))))
        (<span class="fu">append</span> subsets-rest
                (<span class="fu">map</span> (<span class="kw">lambda</span> (set) (<span class="fu">cons</span> first-item set))
                     subsets-rest)))))

(subsets <span class="vs">&#39;()</span>) <span class="op">=&gt;</span> <span class="vs">&#39;(())</span>
(subsets <span class="vs">&#39;(1)</span>) <span class="op">=&gt;</span> <span class="vs">&#39;(() (1))</span>
(subsets <span class="vs">&#39;(1 2)</span>) <span class="op">=&gt;</span> <span class="vs">&#39;(() (2) (1) (1 2))</span>
(subsets <span class="vs">&#39;(1 2 3)</span>) <span class="op">=&gt;</span> <span class="vs">&#39;(() (3) (2) (2 3) (1) (1 3) (1 2) (1 2 3))</span></code></pre>
<h2 id="2.2.3" class="anchor">
<a class="anchor__link link" href="#2.2.3" aria-hidden="true">#</a> <span class="number">2.2.3</span> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_sec_2.2.3">Sequences as Conventional Interfaces<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h2>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="../1/1.html#1.1.4">1.1.4</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>square</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="../1/2.html#ex1.19">Ex 1.19</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>fib</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> (sum-odd-squares tree)
  (<span class="kw">cond</span> ((<span class="fu">null?</span> tree) <span class="cn">0</span>)
        ((<span class="fu">not</span> (<span class="fu">pair?</span> tree))
         (<span class="kw">if</span> (<span class="fu">odd?</span> tree) (square tree) <span class="cn">0</span>))
        (<span class="kw">else</span> (<span class="fu">+</span> (sum-odd-squares (<span class="fu">car</span> tree))
                 (sum-odd-squares (<span class="fu">cdr</span> tree))))))

(sum-odd-squares <span class="vs">&#39;((1 2 3) (4 (5 6)))</span>) <span class="op">=&gt;</span> <span class="cn">35</span>

(<span class="kw">define</span> (even-fibs n)
  (<span class="kw">define</span> (next k)
    (<span class="kw">if</span> (<span class="fu">&gt;</span> k n)
        <span class="vs">&#39;()</span>
        (<span class="kw">let</span> ((f (fib k)))
          (<span class="kw">if</span> (<span class="fu">even?</span> f)
              (<span class="fu">cons</span> f (next (<span class="fu">+</span> k <span class="cn">1</span>)))
              (next (<span class="fu">+</span> k <span class="cn">1</span>))))))
  (next <span class="cn">0</span>))

(even-fibs <span class="cn">10</span>) <span class="op">=&gt;</span> <span class="vs">&#39;(0 2 8 34)</span></code></pre>
<h3 id="2.2.3.1" class="anchor">
<a class="anchor__link link" href="#2.2.3.1" aria-hidden="true">#</a> <span class="number">2.2.3.1</span> Sequence operations
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="../1/1.html#1.1.4">1.1.4</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>square</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="../1/2.html#ex1.19">Ex 1.19</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>fib</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="fu">map</span> square (<span class="fu">list</span> <span class="cn">1</span> <span class="cn">2</span> <span class="cn">3</span> <span class="cn">4</span> <span class="cn">5</span>)) <span class="op">=&gt;</span> <span class="vs">&#39;(1 4 9 16 25)</span>

(<span class="kw">define</span> (<span class="fu">filter</span> pred xs)
  (<span class="kw">cond</span> ((<span class="fu">null?</span> xs) <span class="vs">&#39;()</span>)
        ((pred (<span class="fu">car</span> xs))
         (<span class="fu">cons</span> (<span class="fu">car</span> xs) (<span class="fu">filter</span> pred (<span class="fu">cdr</span> xs))))
        (<span class="kw">else</span> (<span class="fu">filter</span> pred (<span class="fu">cdr</span> xs)))))

(<span class="fu">filter</span> <span class="fu">odd?</span> (<span class="fu">list</span> <span class="cn">1</span> <span class="cn">2</span> <span class="cn">3</span> <span class="cn">4</span> <span class="cn">5</span>)) <span class="op">=&gt;</span> <span class="vs">&#39;(1 3 5)</span>

(<span class="kw">define</span> (accumulate op initial xs)
  (<span class="kw">if</span> (<span class="fu">null?</span> xs)
      initial
      (op (<span class="fu">car</span> xs)
          (accumulate op initial (<span class="fu">cdr</span> xs)))))

(accumulate <span class="fu">+</span> <span class="cn">0</span> (<span class="fu">list</span> <span class="cn">1</span> <span class="cn">2</span> <span class="cn">3</span> <span class="cn">4</span> <span class="cn">5</span>)) <span class="op">=&gt;</span> <span class="cn">15</span>
(accumulate <span class="fu">*</span> <span class="cn">1</span> (<span class="fu">list</span> <span class="cn">1</span> <span class="cn">2</span> <span class="cn">3</span> <span class="cn">4</span> <span class="cn">5</span>)) <span class="op">=&gt;</span> <span class="cn">120</span>
(accumulate <span class="fu">cons</span> <span class="vs">&#39;()</span> (<span class="fu">list</span> <span class="cn">1</span> <span class="cn">2</span> <span class="cn">3</span> <span class="cn">4</span> <span class="cn">5</span>)) <span class="op">=&gt;</span> <span class="vs">&#39;(1 2 3 4 5)</span>

(<span class="kw">define</span> (enumerate-interval low high)
  (<span class="kw">if</span> (<span class="fu">&gt;</span> low high)
      <span class="vs">&#39;()</span>
      (<span class="fu">cons</span> low (enumerate-interval (<span class="fu">+</span> low <span class="cn">1</span>) high))))

(enumerate-interval <span class="cn">2</span> <span class="cn">7</span>) <span class="op">=&gt;</span> <span class="vs">&#39;(2 3 4 5 6 7)</span>

(<span class="kw">define</span> (enumerate-tree tree)
  (<span class="kw">cond</span> ((<span class="fu">null?</span> tree) <span class="vs">&#39;()</span>)
        ((<span class="fu">not</span> (<span class="fu">pair?</span> tree)) (<span class="fu">list</span> tree))
        (<span class="kw">else</span> (<span class="fu">append</span> (enumerate-tree (<span class="fu">car</span> tree))
                      (enumerate-tree (<span class="fu">cdr</span> tree))))))

(enumerate-tree (<span class="fu">list</span> <span class="cn">1</span> (<span class="fu">list</span> <span class="cn">2</span> (<span class="fu">list</span> <span class="cn">3</span> <span class="cn">4</span>)) <span class="cn">5</span>)) <span class="op">=&gt;</span> <span class="vs">&#39;(1 2 3 4 5)</span>

(<span class="kw">define</span> (sum-odd-squares tree)
  (accumulate <span class="fu">+</span> <span class="cn">0</span> (<span class="fu">map</span> square (<span class="fu">filter</span> <span class="fu">odd?</span> (enumerate-tree tree)))))

(sum-odd-squares <span class="vs">&#39;((1 2 3) (4 (5 6)))</span>) <span class="op">=&gt;</span> <span class="cn">35</span>

(<span class="kw">define</span> (even-fibs n)
  (accumulate <span class="fu">cons</span> <span class="vs">&#39;()</span> (<span class="fu">filter</span> <span class="fu">even?</span> (<span class="fu">map</span> fib (enumerate-interval <span class="cn">0</span> n)))))

(even-fibs <span class="cn">10</span>) <span class="op">=&gt;</span> <span class="vs">&#39;(0 2 8 34)</span>

(<span class="kw">define</span> (list-fib-squares n)
  (accumulate <span class="fu">cons</span> <span class="vs">&#39;()</span> (<span class="fu">map</span> square (<span class="fu">map</span> fib (enumerate-interval <span class="cn">0</span> n)))))

(list-fib-squares <span class="cn">10</span>) <span class="op">=&gt;</span> <span class="vs">&#39;(0 1 1 4 9 25 64 169 441 1156 3025)</span>

(<span class="kw">define</span> (product-of-squares-of-odd-elements sequence)
  (accumulate <span class="fu">*</span> <span class="cn">1</span> (<span class="fu">map</span> square (<span class="fu">filter</span> <span class="fu">odd?</span> sequence))))

(product-of-squares-of-odd-elements (<span class="fu">list</span> <span class="cn">1</span> <span class="cn">2</span> <span class="cn">3</span> <span class="cn">4</span> <span class="cn">5</span>)) <span class="op">=&gt;</span> <span class="cn">225</span></code></pre>
<h3 id="ex2.33" class="anchor">
<a class="anchor__link link" href="#ex2.33" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.33">Exercise 2.33<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.2.3.1">2.2.3.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>accumulate</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> (<span class="fu">map</span> f xs)
  (accumulate (<span class="kw">lambda</span> (x y) (<span class="fu">cons</span> (f x) y)) <span class="vs">&#39;()</span> xs))
(<span class="kw">define</span> (<span class="fu">append</span> xs ys)
  (accumulate <span class="fu">cons</span> ys xs))
(<span class="kw">define</span> (<span class="fu">length</span> xs)
  (accumulate (<span class="kw">lambda</span> (x n) (<span class="fu">+</span> n <span class="cn">1</span>)) <span class="cn">0</span> xs))</code></pre>
<h3 id="ex2.34" class="anchor">
<a class="anchor__link link" href="#ex2.34" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.34">Exercise 2.34<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.2.3.1">2.2.3.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>accumulate</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> (horner-eval x coefs)
  (accumulate (<span class="kw">lambda</span> (coef higher-terms)
                (<span class="fu">+</span> (<span class="fu">*</span> higher-terms x) coef))
              <span class="cn">0</span>
              coefs))

(<span class="kw">define</span> x <span class="cn">2</span>)
(horner-eval x <span class="vs">&#39;(1 3 0 5 0 1)</span>)
<span class="op">=&gt;</span> (<span class="fu">+</span> <span class="cn">1</span> (<span class="fu">*</span> <span class="cn">3</span> x) (<span class="fu">*</span> <span class="cn">5</span> (<span class="fu">expt</span> x <span class="cn">3</span>)) (<span class="fu">expt</span> x <span class="cn">5</span>))
<span class="op">=&gt;</span> <span class="cn">79</span></code></pre>
<h3 id="ex2.35" class="anchor">
<a class="anchor__link link" href="#ex2.35" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.35">Exercise 2.35<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.2.3.1">2.2.3.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>accumulate</code>
</li>
<li class="flat__item nowrap">
<code>enumerate-tree</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> (count-leaves t)
  (accumulate <span class="fu">+</span> <span class="cn">0</span> (<span class="fu">map</span> (<span class="kw">lambda</span> (x) <span class="cn">1</span>)
                       (enumerate-tree t))))

(count-leaves <span class="vs">&#39;(1 2 (3 (4) 5) (6 7))</span>) <span class="op">=&gt;</span> <span class="cn">7</span></code></pre>
<h3 id="ex2.36" class="anchor">
<a class="anchor__link link" href="#ex2.36" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.36">Exercise 2.36<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.2.3.1">2.2.3.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>accumulate</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> (accumulate-n op init seqs)
  (<span class="kw">if</span> (<span class="fu">null?</span> (<span class="fu">car</span> seqs))
      <span class="vs">&#39;()</span>
      (<span class="fu">cons</span> (accumulate op init (<span class="fu">map</span> <span class="fu">car</span> seqs))
            (accumulate-n op init (<span class="fu">map</span> <span class="fu">cdr</span> seqs)))))

(accumulate-n <span class="fu">+</span> <span class="cn">0</span> <span class="vs">&#39;((1 2 3) (4 5 6) (7 8 9) (10 11 12))</span>) <span class="op">=&gt;</span> <span class="vs">&#39;(22 26 30)</span></code></pre>
<h3 id="ex2.37" class="anchor">
<a class="anchor__link link" href="#ex2.37" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.37">Exercise 2.37<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.2.3.1">2.2.3.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>accumulate</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.36">Ex 2.36</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>accumulate-n</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> (dot-product v w)
  (accumulate <span class="fu">+</span> <span class="cn">0</span> (<span class="fu">map</span> <span class="fu">*</span> v w)))

(<span class="kw">define</span> (matrix-*-vector m v)
  (<span class="fu">map</span> (<span class="kw">lambda</span> (u) (dot-product u v)) m))

(<span class="kw">define</span> (transpose mat)
  (accumulate-n <span class="fu">cons</span> <span class="vs">&#39;()</span> mat))

(<span class="kw">define</span> (matrix-*-matrix m n)
  (<span class="kw">let</span> ((cols (transpose n)))
    (<span class="fu">map</span> (<span class="kw">lambda</span> (r)
           (<span class="fu">map</span> (<span class="kw">lambda</span> (c)
                  (dot-product r c))
                cols))
         m)))

(<span class="kw">define</span> mat <span class="vs">&#39;((1 2 3) (4 5 6) (7 8 9))</span>)
(<span class="kw">define</span> identity <span class="vs">&#39;((1 0 0) (0 1 0) (0 0 1))</span>)
(matrix-*-vector mat (<span class="fu">car</span> identity)) <span class="op">=&gt;</span> (<span class="fu">map</span> <span class="fu">car</span> mat)
(matrix-*-matrix mat identity) <span class="op">=&gt;</span> mat
(matrix-*-matrix identity mat) <span class="op">=&gt;</span> mat</code></pre>
<h3 id="ex2.38" class="anchor">
<a class="anchor__link link" href="#ex2.38" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.38">Exercise 2.38<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.2.3.1">2.2.3.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>accumulate</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> fold-right accumulate)

(<span class="kw">define</span> (fold-left op init xs)
  (<span class="kw">define</span> (iter result rest)
    (<span class="kw">if</span> (<span class="fu">null?</span> rest)
        result
        (iter (op result (<span class="fu">car</span> rest))
              (<span class="fu">cdr</span> rest))))
  (iter init xs))

(fold-right <span class="fu">/</span> <span class="cn">1</span> (<span class="fu">list</span> <span class="cn">1</span> <span class="cn">2</span> <span class="cn">3</span>)) <span class="op">=&gt;</span> <span class="cn">3/2</span>
(fold-left <span class="fu">/</span> <span class="cn">1</span> (<span class="fu">list</span> <span class="cn">1</span> <span class="cn">2</span> <span class="cn">3</span>)) <span class="op">=&gt;</span> <span class="cn">1/6</span>
(fold-right <span class="fu">list</span> <span class="vs">&#39;()</span> (<span class="fu">list</span> <span class="cn">1</span> <span class="cn">2</span> <span class="cn">3</span>)) <span class="op">=&gt;</span> <span class="vs">&#39;(1 (2 (3 ())))</span>
(fold-left <span class="fu">list</span> <span class="vs">&#39;()</span> (<span class="fu">list</span> <span class="cn">1</span> <span class="cn">2</span> <span class="cn">3</span>)) <span class="op">=&gt;</span> <span class="vs">&#39;(((() 1) 2) 3)</span></code></pre>
<p>For <code>fold-left</code> and <code>fold-right</code> to produce the same value on any sequence, <code>op</code> must satisfy the commutative property <code>(<span class="fu">=</span> (op x y) (op y x))</code>.</p>
<h3 id="ex2.39" class="anchor">
<a class="anchor__link link" href="#ex2.39" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.39">Exercise 2.39<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#ex2.38">Ex 2.38</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>fold-left</code>
</li>
<li class="flat__item nowrap">
<code>fold-right</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> (<span class="fu">reverse</span> xs)
  (fold-right (<span class="kw">lambda</span> (x y) (<span class="fu">append</span> y (<span class="fu">list</span> x))) <span class="vs">&#39;()</span> xs))

(<span class="fu">reverse</span> (<span class="fu">list</span> <span class="cn">1</span> <span class="cn">2</span> <span class="cn">3</span> <span class="cn">4</span> <span class="cn">5</span>)) <span class="op">=&gt;</span> <span class="vs">&#39;(5 4 3 2 1)</span>

(<span class="kw">define</span> (<span class="fu">reverse</span> xs)
  (fold-left (<span class="kw">lambda</span> (x y) (<span class="fu">cons</span> y x)) <span class="vs">&#39;()</span> xs))

(<span class="fu">reverse</span> (<span class="fu">list</span> <span class="cn">1</span> <span class="cn">2</span> <span class="cn">3</span> <span class="cn">4</span> <span class="cn">5</span>)) <span class="op">=&gt;</span> <span class="vs">&#39;(5 4 3 2 1)</span></code></pre>
<h3 id="2.2.3.2" class="anchor">
<a class="anchor__link link" href="#2.2.3.2" aria-hidden="true">#</a> <span class="number">2.2.3.2</span> Nested mappings
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.2.3.1">2.2.3.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>accumulate</code>
</li>
<li class="flat__item nowrap">
<code>enumerate-interval</code>
</li>
<li class="flat__item nowrap">
<code>filter</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="../1/2.html#ex1.23">Ex 1.23</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>prime?</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> (flatmap proc seq)
  (accumulate <span class="fu">append</span> <span class="vs">&#39;()</span> (<span class="fu">map</span> proc seq)))

(<span class="kw">define</span> (prime-sum? pair)
  (prime? (<span class="fu">+</span> (<span class="fu">car</span> pair) (<span class="fu">cadr</span> pair))))

(<span class="kw">define</span> (make-pair-sum pair)
  (<span class="fu">list</span> (<span class="fu">car</span> pair) (<span class="fu">cadr</span> pair) (<span class="fu">+</span> (<span class="fu">car</span> pair) (<span class="fu">cadr</span> pair))))

(<span class="kw">define</span> (prime-sum-pairs n)
  (<span class="fu">map</span> make-pair-sum
       (<span class="fu">filter</span> prime-sum?
               (flatmap (<span class="kw">lambda</span> (i)
                          (<span class="fu">map</span> (<span class="kw">lambda</span> (j) (<span class="fu">list</span> i j))
                               (enumerate-interval <span class="cn">1</span> (<span class="fu">-</span> i <span class="cn">1</span>))))
                        (enumerate-interval <span class="cn">1</span> n)))))

(prime-sum-pairs <span class="cn">5</span>) <span class="op">=&gt;</span> <span class="vs">&#39;((2 1 3) (3 2 5) (4 1 5) (4 3 7) (5 2 7))</span>

(<span class="kw">define</span> (permutations s)
  (<span class="kw">if</span> (<span class="fu">null?</span> s)
      (<span class="fu">list</span> <span class="vs">&#39;()</span>)
      (flatmap (<span class="kw">lambda</span> (x)
                 (<span class="fu">map</span> (<span class="kw">lambda</span> (p) (<span class="fu">cons</span> x p))
                      (permutations (<span class="fu">remove</span> x s))))
               s)))

(<span class="kw">define</span> (<span class="fu">remove</span> item sequence)
  (<span class="fu">filter</span> (<span class="kw">lambda</span> (x) (<span class="fu">not</span> (<span class="fu">equal?</span> x item))) sequence))

(permutations <span class="vs">&#39;(a b c)</span>) <span class="op">=&gt;</span> <span class="vs">&#39;((a b c) (a c b) (b a c) (b c a) (c a b) (c b a))</span></code></pre>
<h3 id="ex2.40" class="anchor">
<a class="anchor__link link" href="#ex2.40" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.40">Exercise 2.40<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.2.3.1">2.2.3.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>enumerate-interval</code>
</li>
<li class="flat__item nowrap">
<code>filter</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.2.3.2">2.2.3.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>flatmap</code>
</li>
<li class="flat__item nowrap">
<code>make-pair-sum</code>
</li>
<li class="flat__item nowrap">
<code>prime-sum?</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> (unique-pairs n)
  (flatmap (<span class="kw">lambda</span> (i)
             (<span class="fu">map</span> (<span class="kw">lambda</span> (j) (<span class="fu">list</span> i j))
                  (enumerate-interval <span class="cn">1</span> (<span class="fu">-</span> i <span class="cn">1</span>))))
           (enumerate-interval <span class="cn">1</span> n)))

(<span class="kw">define</span> (prime-sum-pairs n)
  (<span class="fu">map</span> make-pair-sum (<span class="fu">filter</span> prime-sum? (unique-pairs n))))

(prime-sum-pairs <span class="cn">5</span>) <span class="op">=&gt;</span> <span class="vs">&#39;((2 1 3) (3 2 5) (4 1 5) (4 3 7) (5 2 7))</span></code></pre>
<h3 id="ex2.41" class="anchor">
<a class="anchor__link link" href="#ex2.41" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.41">Exercise 2.41<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.2.3.1">2.2.3.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>enumerate-interval</code>
</li>
<li class="flat__item nowrap">
<code>filter</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.2.3.2">2.2.3.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>flatmap</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> (unique-triples n)
  (flatmap (<span class="kw">lambda</span> (i)
             (flatmap (<span class="kw">lambda</span> (j)
                        (<span class="fu">map</span> (<span class="kw">lambda</span> (k) (<span class="fu">list</span> i j k))
                             (enumerate-interval <span class="cn">1</span> (<span class="fu">-</span> j <span class="cn">1</span>))))
                      (enumerate-interval <span class="cn">1</span> (<span class="fu">-</span> i <span class="cn">1</span>))))
           (enumerate-interval <span class="cn">1</span> n)))

(<span class="kw">define</span> (triple-sums n s)
  (<span class="fu">filter</span> (<span class="kw">lambda</span> (t)
            (<span class="fu">=</span> s (<span class="fu">+</span> (<span class="fu">car</span> t) (<span class="fu">cadr</span> t) (<span class="fu">caddr</span> t))))
          (unique-triples n)))

(triple-sums <span class="cn">8</span> <span class="cn">10</span>) <span class="op">=&gt;</span> <span class="vs">&#39;((5 3 2) (5 4 1) (6 3 1) (7 2 1))</span></code></pre>
<h3 id="ex2.42" class="anchor">
<a class="anchor__link link" href="#ex2.42" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.42">Exercise 2.42<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.2.3.1">2.2.3.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>enumerate-interval</code>
</li>
<li class="flat__item nowrap">
<code>filter</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.2.3.2">2.2.3.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>flatmap</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> make-position <span class="fu">list</span>)
(<span class="kw">define</span> get-row <span class="fu">car</span>)
(<span class="kw">define</span> get-col <span class="fu">cadr</span>)

(<span class="kw">define</span> empty-board <span class="vs">&#39;()</span>)
(<span class="kw">define</span> (adjoin-position row col board)
  (<span class="fu">cons</span> (make-position row col) board))

(<span class="kw">define</span> (safe? positions)
  (<span class="kw">let</span> ((row1 (get-row (<span class="fu">car</span> positions))))
    (<span class="kw">define</span> (helper rest-of-queens cols-apart)
      (<span class="kw">or</span> (<span class="fu">null?</span> rest-of-queens)
          (<span class="kw">let</span> ((row2 (get-row (<span class="fu">car</span> rest-of-queens))))
            (<span class="kw">and</span> (<span class="fu">not</span> (<span class="fu">=</span> row1 row2))
                 (<span class="fu">not</span> (<span class="fu">=</span> row1 (<span class="fu">-</span> row2 cols-apart)))
                 (<span class="fu">not</span> (<span class="fu">=</span> row1 (<span class="fu">+</span> row2 cols-apart)))
                 (helper (<span class="fu">cdr</span> rest-of-queens) (<span class="fu">+</span> cols-apart <span class="cn">1</span>))))))
    (helper (<span class="fu">cdr</span> positions) <span class="cn">1</span>)))</code></pre>
<p>I’ve moved <code>queen-cols</code> to the top level so that <a href="#ex2.43">Exercise&nbsp;2.43</a> can access it.</p>
<pre><code class="blockcode">(<span class="kw">define</span> (queen-cols k board-size)
  (<span class="kw">if</span> (<span class="fu">=</span> k <span class="cn">0</span>)
      (<span class="fu">list</span> empty-board)
      (<span class="fu">filter</span> safe?
              (flatmap
               (<span class="kw">lambda</span> (rest-of-queens)
                 (<span class="fu">map</span> (<span class="kw">lambda</span> (new-row)
                        (adjoin-position new-row k rest-of-queens))
                      (enumerate-interval <span class="cn">1</span> board-size)))
               (queen-cols (<span class="fu">-</span> k <span class="cn">1</span>) board-size)))))

(<span class="kw">define</span> (queens board-size)
  (queen-cols board-size board-size))

(queens <span class="cn">0</span>) <span class="op">=&gt;</span> <span class="vs">&#39;(())</span>
(queens <span class="cn">1</span>) <span class="op">=&gt;</span> <span class="vs">&#39;(((1 1)))</span></code></pre>
<p>The number of solution for each board size matches <a href="https://oeis.org/A000170">OEIS sequence A000170</a>:</p>
<pre><code class="blockcode">(<span class="fu">map</span> (<span class="kw">lambda</span> (n) (<span class="fu">length</span> (queens n))) (enumerate-interval <span class="cn">0</span> <span class="cn">8</span>))
<span class="op">=&gt;</span> <span class="vs">&#39;(1 1 0 0 2 10 4 40 92)</span></code></pre>
<p>Here is the first solution (out of 92) it gives for the eight-queens puzzle:</p>
<pre><code class="blockcode">(<span class="fu">car</span> (queens <span class="cn">8</span>)) <span class="op">=&gt;</span> <span class="vs">&#39;((4 8) (2 7) (7 6) (3 5) (6 4) (8 3) (5 2) (1 1))</span></code></pre>
<p>Plotting it on a chess board, we can see that no queen is under attack:</p>
<figure><svg class="diagram" viewBox="0 0 330 328" style="max-width:330px"><text x="36.857" y="13.714">1</text><text x="73.429" y="13.714">2</text><text x="110" y="13.714">3</text><text x="146.571" y="13.714">4</text><text x="183.143" y="13.714">5</text><text x="219.714" y="13.714">6</text><text x="256.286" y="13.714">7</text><text x="292.857" y="13.714">8</text><text x="36.857" y="50.286">Q</text><text x="256.286" y="86.857">Q</text><text x="183.143" y="123.429">Q</text><text x="292.857" y="160">Q</text><text x="73.429" y="196.571">Q</text><text x="146.571" y="233.143">Q</text><text x="219.714" y="269.714">Q</text><text x="110" y="306.286">Q</text><text x=".286" y="50.286">1</text><text x=".286" y="86.857">2</text><text x=".286" y="123.429">3</text><text x=".286" y="160">4</text><text x=".286" y="196.571">5</text><text x=".286" y="233.143">6</text><text x=".286" y="269.714">7</text><text x=".286" y="306.286">8</text><path d="M22.857 27.429h292.572m-292.572 0V320M59.429 27.429V320M96 27.429V320m36.571-292.571V320m36.572-292.571V320m36.571-292.571V320m36.572-292.571V320m36.571-292.571V320m36.572-292.571V320M22.857 64h292.572M22.857 100.571h292.572M22.857 137.143h292.572M22.857 173.714h292.572M22.857 210.286h292.572M22.857 246.857h292.572M22.857 283.429h292.572M22.857 320h292.572"/></svg></figure>
<h3 id="ex2.43" class="anchor">
<a class="anchor__link link" href="#ex2.43" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.43">Exercise 2.43<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#ex2.42">Ex 2.42</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>queen-cols</code>
</li>
</ul>
</li>
</ul>
</aside>
<p>Interchanging the nested mappings slows down the program because the <code>queen-cols</code> recursion gets re-evaluated for every <code>enumerate-interval</code> result. If the recursive call was bound outside the mappings using <code>let</code>, then either nesting would be fine.</p>
<p>To quantify how much slower it is, we will analyze both solutions. Let <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">T_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>T</mi><mi>k</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup></mrow><annotation encoding="application/x-tex">T&#x27;_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.035em;vertical-align:-0.2831079999999999em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.4168920000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2831079999999999em;"><span></span></span></span></span></span></span></span></span></span> be the number of operations performed by <code>(queen-cols k <span class="cn">8</span>)</code> using the original program and Louis’s program, respectively, and let <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>N</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">N_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> be the number of results it returns. In the base case, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mn>0</mn></msub><mo>=</mo><msubsup><mi>T</mi><mn>0</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><mo>=</mo><msub><mi>C</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">T_0=T&#x27;_0=C_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.24810799999999997em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.4518920000000004em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24810799999999997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> for some constant <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>C</mi><mn>0</mn></msub><mtext>.</mtext></mrow><annotation encoding="application/x-tex">C_0\htmlClass{math-punctuation}{\text{.}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="enclosing math-punctuation"><span class="mord text"><span class="mord">.</span></span></span></span></span></span> For <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi><mo>≥</mo><mn>1</mn><mtext>,</mtext></mrow><annotation encoding="application/x-tex">k≥1\htmlClass{math-punctuation}{\text{,}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83041em;vertical-align:-0.13597em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord">1</span><span class="enclosing math-punctuation"><span class="mord text"><span class="mord">,</span></span></span></span></span></span> we have <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mi>k</mi></msub><mo>=</mo><msub><mi>T</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>W</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">T_k=T_{k-1}+W_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.891661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> where <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">T_{k-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.891661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span> is due to the recursive call and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>W</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">W_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> represents the other work done by <code>queen-cols</code>. Since Louis’s program repeats the recursive call, it takes <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>T</mi><mi>k</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><mo>=</mo><mn>8</mn><msubsup><mi>T</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><mo>+</mo><msub><mi>W</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">T&#x27;_k=8T&#x27;_{k-1}+W_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.035em;vertical-align:-0.2831079999999999em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.4168920000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2831079999999999em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.093331em;vertical-align:-0.34143899999999994em;"></span><span class="mord">8</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.4168920000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.34143899999999994em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> operations. <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>W</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">W_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> includes <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>C</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">C_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> constant work; <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>C</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">C_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> for each of the <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn><msub><mi>N</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">8N_{k-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.891661em;vertical-align:-0.208331em;"></span><span class="mord">8</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span> candidate boards it maps and filters; and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>C</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">C_3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> in <code>safe?</code> for each of the <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> positions in all the boards. Put together, we have</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>W</mi><mi>k</mi></msub><mo>=</mo><msub><mi>C</mi><mn>1</mn></msub><mo>+</mo><mo stretchy="false">(</mo><msub><mi>C</mi><mn>2</mn></msub><mo>+</mo><msub><mi>C</mi><mn>3</mn></msub><mi>k</mi><mo stretchy="false">)</mo><mn>8</mn><msub><mi>N</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">W_k = C_1 + (C_2 + C_3k)8N_{k-1}.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mclose">)</span><span class="mord">8</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mord">.</span></span></span></span></span></p>
<p>Let’s implement these equations in Scheme:</p>
<pre><code class="blockcode">(<span class="kw">define</span> C0) (<span class="kw">define</span> C1) (<span class="kw">define</span> C2) (<span class="kw">define</span> C3)

(<span class="kw">define</span> (T k) (<span class="kw">if</span> (<span class="fu">=</span> k <span class="cn">0</span>) C0 (<span class="fu">+</span> (T (<span class="fu">-</span> k <span class="cn">1</span>)) (W k))))
(<span class="kw">define</span> (T-louis k) (<span class="kw">if</span> (<span class="fu">=</span> k <span class="cn">0</span>) C0 (<span class="fu">+</span> (<span class="fu">*</span> <span class="cn">8</span> (T-louis (<span class="fu">-</span> k <span class="cn">1</span>))) (W k))))

(<span class="kw">define</span> (W k) (<span class="fu">+</span> C1 (<span class="fu">*</span> (<span class="fu">+</span> C2 (<span class="fu">*</span> C3 k)) <span class="cn">8</span> (N (<span class="fu">-</span> k <span class="cn">1</span>)))))
(<span class="kw">define</span> (N k) (<span class="fu">length</span> (queen-cols k <span class="cn">8</span>)))</code></pre>
<p>To estimate how much slower Louis’s program is, all we have to do is choose reasonable values for the constants and then divide <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>T</mi><mn>8</mn><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup></mrow><annotation encoding="application/x-tex">T&#x27;_8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.24810799999999997em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.4518920000000004em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24810799999999997em;"><span></span></span></span></span></span></span></span></span></span> by <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mn>8</mn></msub><mtext>:</mtext></mrow><annotation encoding="application/x-tex">T_8\htmlClass{math-punctuation}{\text{:}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="enclosing math-punctuation"><span class="mord text"><span class="mord">:</span></span></span></span></span></span></p>
<pre><code class="blockcode">(<span class="kw">define</span> (louis-slowdown v0 v1 v2 v3)
  (<span class="kw">set!</span> C0 v0) (<span class="kw">set!</span> C1 v1) (<span class="kw">set!</span> C2 v2) (<span class="kw">set!</span> C3 v3)
  (<span class="fu">inexact</span> (<span class="fu">/</span> (T-louis <span class="cn">8</span>) (T <span class="cn">8</span>))))

(louis-slowdown <span class="cn">1</span> <span class="cn">1</span> <span class="cn">01</span> <span class="cn">01</span>) <span class="op">~&gt;</span> <span class="cn">1598.2301736709533</span>
(louis-slowdown <span class="cn">1</span> <span class="cn">3</span> <span class="cn">10</span> <span class="cn">15</span>) <span class="op">~&gt;</span> <span class="cn">1355.8443654944654</span>
(louis-slowdown <span class="cn">0</span> <span class="cn">5</span> <span class="cn">10</span> <span class="cn">05</span>) <span class="op">~&gt;</span> <span class="cn">1667.9916268313882</span></code></pre>
<p>Louis’s program is slower than the original by three orders of magnitude.</p>
<h2 id="2.2.4" class="anchor">
<a class="anchor__link link" href="#2.2.4" aria-hidden="true">#</a> <span class="number">2.2.4</span> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_sec_2.2.4">Example: A Picture Language<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h2>
<h3 id="2.2.4.1" class="anchor">
<a class="anchor__link link" href="#2.2.4.1" aria-hidden="true">#</a> <span class="number">2.2.4.1</span> The picture language
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.2.4.5">2.2.4.5</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>beside</code>
</li>
<li class="flat__item nowrap">
<code>flip-vert</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.44">Ex 2.44</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>up-split</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.49">Ex 2.49</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>wave</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.50">Ex 2.50</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>flip-horiz</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.51">Ex 2.51</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>below</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> wave2 (beside wave (flip-vert wave)))
(<span class="kw">define</span> wave4 (below wave2 wave2))

(<span class="kw">define</span> (flipped-pairs painter)
  (<span class="kw">let</span> ((painter2 (beside painter (flip-vert painter))))
    (below painter2 painter2)))

(<span class="kw">define</span> (right-split painter n)
  (<span class="kw">if</span> (<span class="fu">=</span> n <span class="cn">0</span>)
      painter
      (<span class="kw">let</span> ((smaller (right-split painter (<span class="fu">-</span> n <span class="cn">1</span>))))
        (beside painter (below smaller smaller)))))

(<span class="kw">define</span> (corner-split painter n)
  (<span class="kw">if</span> (<span class="fu">=</span> n <span class="cn">0</span>)
      painter
      (<span class="kw">let</span> ((up (up-split painter (<span class="fu">-</span> n <span class="cn">1</span>)))
            (right (right-split painter (<span class="fu">-</span> n <span class="cn">1</span>))))
        (<span class="kw">let</span> ((top-left (beside up up))
              (bottom-right (below right right))
              (corner (corner-split painter (<span class="fu">-</span> n <span class="cn">1</span>))))
          (beside (below painter top-left)
                  (below bottom-right corner))))))

(<span class="kw">define</span> (square-limit painter n)
  (<span class="kw">let</span> ((quarter (corner-split painter n)))
    (<span class="kw">let</span> ((half (beside (flip-horiz quarter) quarter)))
      (below (flip-vert half) half))))</code></pre>
<h3 id="ex2.44" class="anchor">
<a class="anchor__link link" href="#ex2.44" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.44">Exercise 2.44<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.2.4.5">2.2.4.5</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>beside</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.51">Ex 2.51</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>below</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> (up-split painter n)
  (<span class="kw">if</span> (<span class="fu">=</span> n <span class="cn">0</span>)
      painter
      (<span class="kw">let</span> ((smaller (up-split painter (<span class="fu">-</span> n <span class="cn">1</span>))))
        (below painter (beside smaller smaller)))))</code></pre>
<h3 id="2.2.4.2" class="anchor">
<a class="anchor__link link" href="#2.2.4.2" aria-hidden="true">#</a> <span class="number">2.2.4.2</span> Higher-order operations
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.2.4.1">2.2.4.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>corner-split</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.2.4.5">2.2.4.5</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>beside</code>
</li>
<li class="flat__item nowrap">
<code>flip-vert</code>
</li>
<li class="flat__item nowrap">
<code>identity</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.50">Ex 2.50</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>flip-horiz</code>
</li>
<li class="flat__item nowrap">
<code>rotate180</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.51">Ex 2.51</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>below</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> (square-of-four tl tr bl br)
  (<span class="kw">lambda</span> (painter)
    (<span class="kw">let</span> ((top (beside (tl painter) (tr painter)))
          (bottom (beside (bl painter)
                          br painter)))
      (below bottom top))))

(<span class="kw">define</span> (flipped-pairs painter)
  (<span class="kw">let</span> ((combine4 (square-of-four identity flip-vert
                                  identity flip-vert)))
    (combine4 painter)))

(<span class="kw">define</span> (square-limit painter n)
  (<span class="kw">let</span> ((combine4 (square-of-four flip-horiz identity
                                  rotate180 flip-vert)))
    (combine4 (corner-split painter n))))</code></pre>
<h3 id="ex2.45" class="anchor">
<a class="anchor__link link" href="#ex2.45" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.45">Exercise 2.45<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.2.4.5">2.2.4.5</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>beside</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.51">Ex 2.51</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>below</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> (split comb split-comb)
  (<span class="kw">define</span> (splitter painter n)
    (<span class="kw">if</span> (<span class="fu">=</span> n <span class="cn">0</span>)
        painter
        (<span class="kw">let</span> ((smaller (splitter painter (<span class="fu">-</span> n <span class="cn">1</span>))))
          (comb painter (split-comb smaller smaller)))))
  splitter)

(<span class="kw">define</span> right-split (split beside below))
(<span class="kw">define</span> up-split (split below beside))</code></pre>
<h3 id="2.2.4.3" class="anchor">
<a class="anchor__link link" href="#2.2.4.3" aria-hidden="true">#</a> <span class="number">2.2.4.3</span> Frames
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#ex2.46">Ex 2.46</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>add-vect</code>
</li>
<li class="flat__item nowrap">
<code>scale-vect</code>
</li>
<li class="flat__item nowrap">
<code>xcor-vect</code>
</li>
<li class="flat__item nowrap">
<code>ycor-vect</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.47">Ex 2.47</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>edge1-frame</code>
</li>
<li class="flat__item nowrap">
<code>edge2-frame</code>
</li>
<li class="flat__item nowrap">
<code>origin-frame</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> (frame-coord-map frame)
  (<span class="kw">lambda</span> (v)
    (add-vect
     (origin-frame frame)
     (add-vect (scale-vect (xcor-vect v) (edge1-frame frame))
               (scale-vect (ycor-vect v) (edge2-frame frame))))))</code></pre>
<h3 id="ex2.46" class="anchor">
<a class="anchor__link link" href="#ex2.46" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.46">Exercise 2.46<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<pre><code class="blockcode">(<span class="kw">define</span> make-vect <span class="fu">cons</span>)
(<span class="kw">define</span> xcor-vect <span class="fu">car</span>)
(<span class="kw">define</span> ycor-vect <span class="fu">cdr</span>)

(<span class="kw">define</span> (add-vect u v)
  (make-vect (<span class="fu">+</span> (xcor-vect u) (xcor-vect v))
             (<span class="fu">+</span> (ycor-vect u) (ycor-vect v))))
(<span class="kw">define</span> (sub-vect u v)
  (make-vect (<span class="fu">-</span> (xcor-vect u) (xcor-vect v))
             (<span class="fu">-</span> (ycor-vect u) (ycor-vect v))))
(<span class="kw">define</span> (scale-vect s v)
  (make-vect (<span class="fu">*</span> s (xcor-vect v))
             (<span class="fu">*</span> s (ycor-vect v))))

(add-vect (make-vect <span class="cn">1</span> <span class="cn">2</span>) (make-vect <span class="cn">3</span> <span class="cn">4</span>)) <span class="op">=&gt;</span> (make-vect <span class="cn">4</span> <span class="cn">6</span>)
(sub-vect (make-vect <span class="cn">1</span> <span class="cn">2</span>) (make-vect <span class="cn">3</span> <span class="cn">4</span>)) <span class="op">=&gt;</span> (make-vect <span class="cn">-2</span> <span class="cn">-2</span>)
(scale-vect <span class="cn">2</span> (make-vect <span class="cn">1</span> <span class="cn">2</span>)) <span class="op">=&gt;</span> (make-vect <span class="cn">2</span> <span class="cn">4</span>)</code></pre>
<h3 id="ex2.47" class="anchor">
<a class="anchor__link link" href="#ex2.47" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.47">Exercise 2.47<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<p>First representation:</p>
<pre><code class="blockcode">(<span class="kw">define</span> (make-frame origin edge1 edge2)
  (<span class="fu">list</span> origin edge1 edge2))

(<span class="kw">define</span> origin-frame <span class="fu">car</span>)
(<span class="kw">define</span> edge1-frame <span class="fu">cadr</span>)
(<span class="kw">define</span> edge2-frame <span class="fu">caddr</span>)</code></pre>
<p>Second representation:</p>
<pre><code class="blockcode">(<span class="kw">define</span> (make-frame origin edge1 edge2)
  (<span class="fu">cons</span> origin (<span class="fu">cons</span> edge1 edge2)))

(<span class="kw">define</span> origin-frame <span class="fu">car</span>)
(<span class="kw">define</span> edge1-frame <span class="fu">cadr</span>)
(<span class="kw">define</span> edge2-frame <span class="fu">cddr</span>)</code></pre>
<h3 id="2.2.4.4" class="anchor">
<a class="anchor__link link" href="#2.2.4.4" aria-hidden="true">#</a> <span class="number">2.2.4.4</span> Painters
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.2.4.3">2.2.4.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>frame-coord-map</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.48">Ex 2.48</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>end-segment</code>
</li>
<li class="flat__item nowrap">
<code>start-segment</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> (draw-line p1 p2)
  (<span class="fu">display</span> (format <span class="cn">&quot;Line from ~s to ~s</span><span class="co">\n</span><span class="cn">&quot;</span> p1 p2)))

(<span class="kw">define</span> (segments-&gt;painter segment-list)
  (<span class="kw">lambda</span> (frame)
    (<span class="fu">for-each</span>
     (<span class="kw">lambda</span> (segment)
       (draw-line ((frame-coord-map frame)
                   (start-segment segment))
                  ((frame-coord-map frame)
                   (end-segment segment))))
     segment-list)))</code></pre>
<h3 id="ex2.48" class="anchor">
<a class="anchor__link link" href="#ex2.48" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.48">Exercise 2.48<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<pre><code class="blockcode">(<span class="kw">define</span> make-segment <span class="fu">cons</span>)
(<span class="kw">define</span> start-segment <span class="fu">car</span>)
(<span class="kw">define</span> end-segment <span class="fu">cdr</span>)</code></pre>
<h3 id="ex2.49" class="anchor">
<a class="anchor__link link" href="#ex2.49" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.49">Exercise 2.49<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.2.4.4">2.2.4.4</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>segments-&gt;painter</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.46">Ex 2.46</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>make-vect</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.48">Ex 2.48</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>make-segment</code>
</li>
</ul>
</li>
</ul>
</aside>
<ol type="a">
<li><p>The painter that draws the outline of the designated frame:</p>
<pre><code class="blockcode">(<span class="kw">define</span> outline
  (segments-&gt;painter
   (<span class="fu">list</span> (make-segment (make-vect <span class="cn">0</span> <span class="cn">0</span>) (make-vect <span class="cn">1</span> <span class="cn">0</span>))
         (make-segment (make-vect <span class="cn">0</span> <span class="cn">1</span>) (make-vect <span class="cn">1</span> <span class="cn">1</span>))
         (make-segment (make-vect <span class="cn">0</span> <span class="cn">0</span>) (make-vect <span class="cn">0</span> <span class="cn">1</span>))
         (make-segment (make-vect <span class="cn">1</span> <span class="cn">0</span>) (make-vect <span class="cn">1</span> <span class="cn">1</span>)))))</code></pre></li>
<li><p>The painter that draws an “X” by connecting opposite corners of the frame:</p>
<pre><code class="blockcode">(<span class="kw">define</span> x
  (segments-&gt;painter
   (<span class="fu">list</span> (make-segment (make-vect <span class="cn">0</span> <span class="cn">0</span>) (make-vect <span class="cn">1</span> <span class="cn">1</span>))
         (make-segment (make-vect <span class="cn">0</span> <span class="cn">1</span>) (make-vect <span class="cn">1</span> <span class="cn">0</span>)))))</code></pre></li>
<li><p>The painter that draws a diamond shape by connecting the midpoints of the sides of the frame:</p>
<pre><code class="blockcode">(<span class="kw">define</span> diamond
  (segments-&gt;painter
   (<span class="fu">list</span> (make-segment (make-vect <span class="cn">0.5</span> <span class="cn">0.0</span>) (make-vect <span class="cn">1.0</span> <span class="cn">0.5</span>))
         (make-segment (make-vect <span class="cn">0.0</span> <span class="cn">0.5</span>) (make-vect <span class="cn">0.5</span> <span class="cn">1.0</span>))
         (make-segment (make-vect <span class="cn">0.0</span> <span class="cn">0.5</span>) (make-vect <span class="cn">0.5</span> <span class="cn">0.0</span>))
         (make-segment (make-vect <span class="cn">0.5</span> <span class="cn">1.0</span>) (make-vect <span class="cn">1.0</span> <span class="cn">0.5</span>)))))</code></pre></li>
<li><p>The <code>wave</code> painter:</p>
<pre><code class="blockcode">(<span class="kw">define</span> wave-segments
  (<span class="fu">list</span> (make-segment (make-vect <span class="cn">0.46</span> <span class="cn">0.00</span>) (make-vect <span class="cn">0.37</span> <span class="cn">0.22</span>))
        (make-segment (make-vect <span class="cn">0.37</span> <span class="cn">0.22</span>) (make-vect <span class="cn">0.46</span> <span class="cn">0.34</span>))
        (make-segment (make-vect <span class="cn">0.46</span> <span class="cn">0.34</span>) (make-vect <span class="cn">0.37</span> <span class="cn">0.33</span>))
        (make-segment (make-vect <span class="cn">0.37</span> <span class="cn">0.33</span>) (make-vect <span class="cn">0.22</span> <span class="cn">0.45</span>))
        (make-segment (make-vect <span class="cn">0.22</span> <span class="cn">0.45</span>) (make-vect <span class="cn">0.00</span> <span class="cn">0.28</span>))
        (make-segment (make-vect <span class="cn">0.00</span> <span class="cn">0.33</span>) (make-vect <span class="cn">0.22</span> <span class="cn">0.55</span>))
        (make-segment (make-vect <span class="cn">0.22</span> <span class="cn">0.55</span>) (make-vect <span class="cn">0.39</span> <span class="cn">0.42</span>))
        (make-segment (make-vect <span class="cn">0.39</span> <span class="cn">0.42</span>) (make-vect <span class="cn">0.31</span> <span class="cn">1.00</span>))
        (make-segment (make-vect <span class="cn">0.54</span> <span class="cn">0.00</span>) (make-vect <span class="cn">0.63</span> <span class="cn">0.22</span>))
        (make-segment (make-vect <span class="cn">0.63</span> <span class="cn">0.22</span>) (make-vect <span class="cn">0.54</span> <span class="cn">0.34</span>))
        (make-segment (make-vect <span class="cn">0.54</span> <span class="cn">0.34</span>) (make-vect <span class="cn">0.63</span> <span class="cn">0.33</span>))
        (make-segment (make-vect <span class="cn">0.63</span> <span class="cn">0.33</span>) (make-vect <span class="cn">1.00</span> <span class="cn">0.67</span>))
        (make-segment (make-vect <span class="cn">1.00</span> <span class="cn">0.72</span>) (make-vect <span class="cn">0.61</span> <span class="cn">0.42</span>))
        (make-segment (make-vect <span class="cn">0.61</span> <span class="cn">0.42</span>) (make-vect <span class="cn">0.69</span> <span class="cn">1.00</span>))
        (make-segment (make-vect <span class="cn">0.39</span> <span class="cn">1.00</span>) (make-vect <span class="cn">0.50</span> <span class="cn">0.68</span>))
        (make-segment (make-vect <span class="cn">0.50</span> <span class="cn">0.68</span>) (make-vect <span class="cn">0.61</span> <span class="cn">1.00</span>))))
(<span class="kw">define</span> wave
  (segments-&gt;painter wave-segments))</code></pre></li>
</ol>
<h3 id="2.2.4.5" class="anchor">
<a class="anchor__link link" href="#2.2.4.5" aria-hidden="true">#</a> <span class="number">2.2.4.5</span> Transforming and combining painters
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.2.4.3">2.2.4.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>frame-coord-map</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.46">Ex 2.46</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>make-vect</code>
</li>
<li class="flat__item nowrap">
<code>sub-vect</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.47">Ex 2.47</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>make-frame</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> (transform-painter painter origin corner1 corner2)
  (<span class="kw">lambda</span> (frame)
    (<span class="kw">let</span> ((m (frame-coord-map frame)))
      (<span class="kw">let</span> ((new-origin (m origin)))
        (painter (make-frame new-origin
                             (sub-vect (m corner1) new-origin)
                             (sub-vect (m corner2) new-origin)))))))

(<span class="kw">define</span> (identity painter) painter)

(<span class="kw">define</span> (flip-vert painter)
  (transform-painter
   painter
   (make-vect <span class="cn">0</span> <span class="cn">1</span>)
   (make-vect <span class="cn">1</span> <span class="cn">1</span>)
   (make-vect <span class="cn">0</span> <span class="cn">0</span>)))

(<span class="kw">define</span> (shrink-to-upper-right painter)
  (transform-painter
   painter
   (make-vect <span class="cn">0.5</span> <span class="cn">0.5</span>)
   (make-vect <span class="cn">1</span> <span class="cn">0.5</span>)
   (make-vect <span class="cn">0.5</span> <span class="cn">1</span>)))

(<span class="kw">define</span> (rotate90 painter)
  (transform-painter
   painter
   (make-vect <span class="cn">1</span> <span class="cn">0</span>)
   (make-vect <span class="cn">1</span> <span class="cn">1</span>)
   (make-vect <span class="cn">0</span> <span class="cn">0</span>)))

(<span class="kw">define</span> (squash-inwards painter)
  (transform-painter
   painter
   (make-vect <span class="cn">0</span> <span class="cn">0</span>)
   (make-vect <span class="cn">0.65</span> <span class="cn">0.35</span>)
   (make-vect <span class="cn">0.35</span> <span class="cn">0.65</span>)))

(<span class="kw">define</span> (beside painter1 painter2)
  (<span class="kw">let</span> ((split-point (make-vect <span class="cn">0.5</span> <span class="cn">0</span>)))
    (<span class="kw">let</span> ((paint-left
           (transform-painter
            painter1
            (make-vect <span class="cn">0</span> <span class="cn">0</span>)
            split-point
            (make-vect <span class="cn">0</span> <span class="cn">1</span>)))
          (paint-right
           (transform-painter
            painter2
            split-point
            (make-vect <span class="cn">1</span> <span class="cn">0</span>)
            (make-vect <span class="cn">0.5</span> <span class="cn">1</span>))))
      (<span class="kw">lambda</span> (frame)
        (paint-left frame)
        (paint-right frame)))))</code></pre>
<h3 id="ex2.50" class="anchor">
<a class="anchor__link link" href="#ex2.50" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.50">Exercise 2.50<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.2.4.5">2.2.4.5</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>transform-painter</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.46">Ex 2.46</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>make-vect</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> (flip-horiz painter)
  (transform-painter
   painter
   (make-vect <span class="cn">1</span> <span class="cn">0</span>)
   (make-vect <span class="cn">0</span> <span class="cn">0</span>)
   (make-vect <span class="cn">1</span> <span class="cn">1</span>)))

(<span class="kw">define</span> (rotate180 painter)
  (transform-painter
   painter
   (make-vect <span class="cn">1</span> <span class="cn">1</span>)
   (make-vect <span class="cn">0</span> <span class="cn">1</span>)
   (make-vect <span class="cn">1</span> <span class="cn">0</span>)))

(<span class="kw">define</span> (rotate270 painter)
  (transform-painter
   painter
   (make-vect <span class="cn">0</span> <span class="cn">1</span>)
   (make-vect <span class="cn">0</span> <span class="cn">0</span>)
   (make-vect <span class="cn">1</span> <span class="cn">1</span>)))</code></pre>
<h3 id="ex2.51" class="anchor">
<a class="anchor__link link" href="#ex2.51" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.51">Exercise 2.51<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.2.4.5">2.2.4.5</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>beside</code>
</li>
<li class="flat__item nowrap">
<code>rotate90</code>
</li>
<li class="flat__item nowrap">
<code>transform-painter</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.46">Ex 2.46</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>make-vect</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.50">Ex 2.50</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>rotate270</code>
</li>
</ul>
</li>
</ul>
</aside>
<p>Analogous to the <code>beside</code> procedure:</p>
<pre><code class="blockcode">(<span class="kw">define</span> (below painter1 painter2)
  (<span class="kw">let</span> ((split-point (make-vect <span class="cn">0</span> <span class="cn">0.5</span>)))
    (<span class="kw">let</span> ((paint-bottom
           (transform-painter
            painter1
            (make-vect <span class="cn">0</span> <span class="cn">0</span>)
            (make-vect <span class="cn">1</span> <span class="cn">0.5</span>)
            split-point))
          (paint-top
           (transform-painter
            painter2
            split-point
            (make-vect <span class="cn">1</span> <span class="cn">0.5</span>)
            (make-vect <span class="cn">0</span> <span class="cn">1</span>))))
      (<span class="kw">lambda</span> (frame)
        (paint-bottom frame)
        (paint-top frame)))))</code></pre>
<p>In terms of <code>beside</code> and rotations:</p>
<pre><code class="blockcode">(<span class="kw">define</span> (below painter1 painter2)
  (rotate90
   (beside (rotate270 painter1)
           (rotate270 painter2))))</code></pre>
<h3 id="ex2.52" class="anchor">
<a class="anchor__link link" href="#ex2.52" aria-hidden="true">#</a> <a class="link" href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-15.html#%25_thm_2.52">Exercise 2.52<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.2.4.1">2.2.4.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>right-split</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.2.4.2">2.2.4.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>square-of-four</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.2.4.4">2.2.4.4</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>segments-&gt;painter</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.2.4.5">2.2.4.5</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>beside</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.44">Ex 2.44</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>up-split</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.46">Ex 2.46</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>make-vect</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.48">Ex 2.48</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>make-segment</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.49">Ex 2.49</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>wave-segments</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.50">Ex 2.50</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>flip-horiz</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.51">Ex 2.51</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>below</code>
</li>
</ul>
</li>
</ul>
</aside>
<ol type="a">
<li><p>I changed <code>wave</code> to add a smile:</p>
<pre><code class="blockcode">(<span class="kw">define</span> smile-segments
  (<span class="fu">list</span> (make-segment (make-vect <span class="cn">0.46</span> <span class="cn">0.13</span>) (make-vect <span class="cn">0.46</span> <span class="cn">0.17</span>))
        (make-segment (make-vect <span class="cn">0.46</span> <span class="cn">0.24</span>) (make-vect <span class="cn">0.50</span> <span class="cn">0.27</span>))
        (make-segment (make-vect <span class="cn">0.54</span> <span class="cn">0.13</span>) (make-vect <span class="cn">0.54</span> <span class="cn">0.17</span>))
        (make-segment (make-vect <span class="cn">0.54</span> <span class="cn">0.24</span>) (make-vect <span class="cn">0.50</span> <span class="cn">0.27</span>))))
(<span class="kw">define</span> wave
  (segments-&gt;painter (<span class="fu">append</span> wave-segments smile-segments)))</code></pre></li>
<li><p>I changed <code>corner-split</code> to use only one copy of the <code>up-split</code> and <code>right-split</code> images instead of two:</p>
<pre><code class="blockcode">(<span class="kw">define</span> (corner-split painter n)
  (<span class="kw">if</span> (<span class="fu">=</span> n <span class="cn">0</span>)
      painter
      (<span class="kw">let</span> ((up (up-split painter (<span class="fu">-</span> n <span class="cn">1</span>)))
            (right (right-split painter (<span class="fu">-</span> n <span class="cn">1</span>)))
            (corner (corner-split painter (<span class="fu">-</span> n <span class="cn">1</span>))))
        (beside (below painter up)
                (below right corner)))))</code></pre></li>
<li><p>I changed <code>square-limit</code> to orient the corners differently:</p>
<pre><code class="blockcode">(<span class="kw">define</span> (square-limit painter n)
  (<span class="kw">let</span> ((quarter (corner-split painter n)))
    (<span class="kw">let</span> ((flipped (flip-horiz quarter)))
      (square-of-four flipped quarter flipped quarter))))</code></pre></li>
</ol>
</main>
<nav class="pagenav pagenav--bottom" aria-label="page">
  <div class="pagenav__item pagenav__item--left">
    <a class="pagenav__link link" href="1.html" aria-label="previous page">
      <svg width="12" height="11" aria-hidden="true"><use xlink:href="#left"/>
      </svg><span class="pagenav__prev">Prev</span>
    </a>
  </div>
  <div class="pagenav__item pagenav__item--center">
    <a class="pagenav__link link" href="index.html" aria-label="parent page">
      <svg width="11" height="12" aria-hidden="true"><use xlink:href="#up"/>
      </svg><span class="pagenav__up">Up</span>
    </a>
  </div>
  <div class="pagenav__item pagenav__item--right">
    <a class="pagenav__link link" href="3.html" aria-label="next page">
      <span class="pagenav__next">Next</span
        ><svg width="12" height="11" aria-hidden="true"
        ><use xlink:href="#right"/></svg>
    </a>
  </div>
</nav>
<footer class="footer">
  <p>© 2021 Mitchell Kember</p>
</footer>
</body>
</html>
