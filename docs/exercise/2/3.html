<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SICP Section 2.3 Exercises</title>
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css">
  <link rel="stylesheet" href="../../style.css">
</head>
<body>
<div hidden>
  <svg>
    <symbol id="up" viewBox="0 0 11 12">
      <path fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" d="M5.5.8v10.4m4.457-5.943L5.5.8 1.043 5.257"/>
    </symbol>
    <symbol id="left" viewBox="0 0 12 11">
      <path fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" d="M.8 5.5h10.4M5.257 9.957L.8 5.5l4.457-4.457"/>
    </symbol>
    <symbol id="right" viewBox="0 0 12 11">
      <use xlink:href="#left" transform="matrix(-1 0 0 1 12 0)"/>
    </symbol>
    <symbol id="external" viewBox="0 0 24 24">
      <path fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" d="M10.688 5.438H4.125A2.65 2.65 0 001.5 8.063v11.812A2.65 2.65 0 004.125 22.5h11.813a2.65 2.65 0 002.624-2.625v-6.563m-9.187 1.313L22.5 1.5m-6.563 0H22.5v6.563"/>
    </symbol>
  </svg>
</div>
<a class="skip-link" href="#main">Skip to main content</a>
<header class="header">
  <a class="title link" href="../../index.html">SICP Study</a>
  <nav class="sitenav" aria-label="site">
    <a class="sitenav__item link"
        href="../../text/index.html" aria-label="textbook notes">Text</a>
    <a class="sitenav__item link"
        href="../../lecture/index.html" aria-label="lecture notes">Lecture</a>
    <a class="sitenav__item sitenav__item--active link"
        href="../../exercise/index.html" aria-label="exercises">Exercise</a>
    <a class="sitenav__item sitenav__item--last link"
        href="https://github.com/mk12/sicp" aria-label="GitHub repository">
      Source
      <svg class="github-mark" width="25" height="25" viewBox="0 0 136 133" aria-hidden="true">
        <path fill="currentColor" d="M67.866.002C30.387.002 0 30.39 0 67.877c0 29.988 19.446 55.425 46.417 64.404 3.396.621 4.633-1.475 4.633-3.275 0-1.608-.058-5.879-.091-11.541-18.88 4.1-22.863-9.1-22.863-9.1-3.087-7.838-7.537-9.925-7.537-9.925-6.163-4.213.466-4.13.466-4.13 6.813.484 10.396 6.996 10.396 6.996 6.054 10.371 15.888 7.375 19.754 5.642.617-4.387 2.367-7.38 4.309-9.075-15.071-1.712-30.917-7.537-30.917-33.546 0-7.408 2.646-13.466 6.988-18.212-.7-1.717-3.03-8.617.662-17.963 0 0 5.7-1.825 18.667 6.959 5.412-1.505 11.22-2.259 16.992-2.284 5.762.025 11.57.78 16.991 2.284 12.959-8.784 18.646-6.959 18.646-6.959 3.704 9.346 1.375 16.246.675 17.963 4.35 4.746 6.98 10.804 6.98 18.212 0 26.075-15.872 31.813-30.992 33.492 2.437 2.096 4.608 6.237 4.608 12.57 0 9.072-.083 16.392-.083 18.617 0 1.817 1.22 3.93 4.666 3.267 26.95-8.996 46.38-34.417 46.38-64.396 0-37.487-30.392-67.875-67.88-67.875"/>
      </svg>      
    </a>
  </nav>
</header>
<nav class="pagenav pagenav--top" aria-label="page">
  <div class="pagenav__item pagenav__item--left">
    <a class="pagenav__link link" href="2.html" aria-label="previous page">
      <svg width="12" height="11" aria-hidden="true"><use xlink:href="#left"/>
      </svg><span class="pagenav__prev">Prev</span>
    </a>
  </div>
  <div class="pagenav__item pagenav__item--center">
    <a class="pagenav__link link" href="index.html" aria-label="parent page">
      <svg width="11" height="12" aria-hidden="true"><use xlink:href="#up"/>
      </svg><span class="pagenav__up">Up</span>
    </a>
  </div>
  <div class="pagenav__item pagenav__item--right">
    <a class="pagenav__link link" href="4.html" aria-label="next page">
      <span class="pagenav__next">Next</span
        ><svg width="12" height="11" aria-hidden="true"
        ><use xlink:href="#right"/></svg>
    </a>
  </div>
</nav>
<main id="main">
<h1 id="2.3" class="anchor">
<a class="anchor__link link" href="#2.3" aria-hidden="true">#</a> <span class="number">2.3</span> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-16.html">Symbolic Data<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h1>
<h2 id="2.3.1" class="anchor">
<a class="anchor__link link" href="#2.3.1" aria-hidden="true">#</a> <span class="number">2.3.1</span> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-16.html#%25_sec_2.3.1">Quotation<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h2>
<pre><code class="blockcode">(<span class="kw">define</span> a <span class="cn">1</span>)
(<span class="kw">define</span> b <span class="cn">2</span>)

(<span class="fu">list</span> a b) <span class="op">=&gt;</span> <span class="vs">'(1 2)</span>
(<span class="fu">list</span> <span class="vs">'a 'b</span>) <span class="op">=&gt;</span> <span class="vs">'(a b)</span>
(<span class="fu">list</span> <span class="vs">'a</span> b) <span class="op">=&gt;</span> <span class="vs">'(a 2)</span>

(<span class="fu">car</span> <span class="vs">'(a b c)</span>) <span class="op">=&gt;</span> <span class="vs">'a</span>
(<span class="fu">cdr</span> <span class="vs">'(a b c)</span>) <span class="op">=&gt;</span> <span class="vs">'(b c)</span>

(<span class="kw">define</span> (<span class="fu">memq</span> item x)
  (<span class="kw">cond</span> ((<span class="fu">null?</span> x) <span class="cn">#f</span>)
        ((<span class="fu">eq?</span> item (<span class="fu">car</span> x)) x)
        (<span class="kw">else</span> (<span class="fu">memq</span> item (<span class="fu">cdr</span> x)))))

(<span class="fu">memq</span> <span class="vs">'apple '(pear banana prune)</span>) <span class="op">=&gt;</span> <span class="cn">#f</span>
(<span class="fu">memq</span> <span class="vs">'apple '(x (apple sauce) y apple pear)</span>) <span class="op">=&gt;</span> <span class="vs">'(apple pear)</span></code></pre>
<h3 id="ex2.53" class="anchor">
<a class="anchor__link link" href="#ex2.53" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-16.html#%25_thm_2.53">Exercise 2.53<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.3.1">2.3.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>memq</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="fu">list</span> <span class="vs">'a 'b 'c</span>) <span class="op">=&gt;</span> <span class="vs">'(a b c)</span>
(<span class="fu">list</span> (<span class="fu">list</span> <span class="vs">'george</span>)) <span class="op">=&gt;</span> <span class="vs">'((george))</span>
(<span class="fu">cdr</span> <span class="vs">'((x1 x2) (y1 y2))</span>) <span class="op">=&gt;</span> <span class="vs">'((y1 y2))</span>
(<span class="fu">cadr</span> <span class="vs">'((x1 x2) (y1 y2))</span>) <span class="op">=&gt;</span> <span class="vs">'(y1 y2)</span>
(<span class="fu">pair?</span> (<span class="fu">car</span> <span class="vs">'(a short list)</span>)) <span class="op">=&gt;</span> <span class="cn">#f</span>
(<span class="fu">memq</span> <span class="vs">'red '((red shoes) (blue socks))</span>) <span class="op">=&gt;</span> <span class="cn">#f</span>
(<span class="fu">memq</span> <span class="vs">'red '(red shoes blue socks)</span>) <span class="op">=&gt;</span> <span class="vs">'(red shoes blue socks)</span></code></pre>
<h3 id="ex2.54" class="anchor">
<a class="anchor__link link" href="#ex2.54" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-16.html#%25_thm_2.54">Exercise 2.54<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<pre><code class="blockcode">(<span class="kw">define</span> (<span class="fu">equal?</span> list1 list2)
  (<span class="kw">let</span> ((null1 (<span class="fu">null?</span> list1))
        (null2 (<span class="fu">null?</span> list2)))
    (<span class="kw">or</span> (<span class="kw">and</span> null1 null2)
        (<span class="kw">and</span> (<span class="fu">not</span> (<span class="kw">or</span> null1 null2))
             (<span class="fu">eq?</span> (<span class="fu">car</span> list1) (<span class="fu">car</span> list2))
             (<span class="fu">equal?</span> (<span class="fu">cdr</span> list1) (<span class="fu">cdr</span> list2))))))

(<span class="fu">equal?</span> <span class="vs">'(this is a list) '(this is a list)</span>) <span class="op">=&gt;</span> <span class="cn">#t</span>
(<span class="fu">equal?</span> <span class="vs">'(this is a list) '(this (is a) list)</span>) <span class="op">=&gt;</span> <span class="cn">#f</span></code></pre>
<h3 id="ex2.55" class="anchor">
<a class="anchor__link link" href="#ex2.55" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-16.html#%25_thm_2.55">Exercise 2.55<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<p>This happens because the Lisp reader expands each <code>'<span class="ss">exp</span></code> to <code>(<span class="kw">quote</span> <span class="ss">exp</span>)</code> before evaluation, so <code>''abracadabra</code> evaluates to a list of two symbols:</p>
<pre><code class="blockcode">(<span class="fu">car</span> <span class="vs">''abracadabra</span>)
<span class="op">=&gt;</span> (<span class="fu">car</span> (<span class="kw">quote</span> <span class="vs">(quote abracadabra)</span>))
<span class="op">=&gt;</span> (<span class="fu">car</span> <span class="vs">'(quote abracadabra)</span>)
<span class="op">=&gt;</span> <span class="vs">'quote</span></code></pre>
<h2 id="2.3.2" class="anchor">
<a class="anchor__link link" href="#2.3.2" aria-hidden="true">#</a> <span class="number">2.3.2</span> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-16.html#%25_sec_2.3.2">Example: Symbolic Differentiation<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h2>
<pre><code class="blockcode">(<span class="kw">define</span> (deriv expr var)
  (<span class="kw">cond</span> ((<span class="fu">number?</span> expr) <span class="cn">0</span>)
        ((variable? expr)
         (<span class="kw">if</span> (same-variable? expr var) <span class="cn">1 0</span>))
        ((sum? expr)
         (make-sum (deriv (addend expr) var)
                   (deriv (augend expr) var)))
        ((product? expr)
         (make-sum (make-product (multiplier expr)
                                 (deriv (multiplicand expr) var))
                   (make-product (deriv (multiplier expr) var)
                                 (multiplicand expr))))
        (<span class="kw">else</span> (<span class="fu">error</span> <span class="vs">'deriv</span> <span class="cn">"unknown expr type"</span> expr))))

(<span class="kw">define</span> (variable? x) (<span class="fu">symbol?</span> x))
(<span class="kw">define</span> (same-variable? v1 v2)
  (<span class="kw">and</span> (variable? v1) (variable? v2) (<span class="fu">eq?</span> v1 v2)))

(<span class="kw">define</span> (make-sum a1 a2) (<span class="fu">list</span> <span class="vs">'+</span> a1 a2))
(<span class="kw">define</span> (make-product m1 m2) (<span class="fu">list</span> <span class="vs">'*</span> m1 m2))

(<span class="kw">define</span> (sum? expr)
  (<span class="kw">and</span> (<span class="fu">pair?</span> expr) (<span class="fu">eq?</span> (<span class="fu">car</span> expr) <span class="vs">'+</span>)))
(<span class="kw">define</span> addend <span class="fu">cadr</span>)
(<span class="kw">define</span> augend <span class="fu">caddr</span>)

(<span class="kw">define</span> (product? expr)
  (<span class="kw">and</span> (<span class="fu">pair?</span> expr) (<span class="fu">eq?</span> (<span class="fu">car</span> expr) <span class="vs">'*</span>)))
(<span class="kw">define</span> multiplier <span class="fu">cadr</span>)
(<span class="kw">define</span> multiplicand <span class="fu">caddr</span>)

(deriv <span class="vs">'(+ x 3) 'x</span>)
<span class="op">=&gt;</span> <span class="vs">'(+ 1 0)</span>
(deriv <span class="vs">'(* x y) 'x</span>)
<span class="op">=&gt;</span> <span class="vs">'(+ (* x 0) (* 1 y))</span>
(deriv <span class="vs">'(* (* x y) (+ x 3)) 'x</span>)
<span class="op">=&gt;</span> <span class="vs">'(+ (* (* x y) (+ 1 0))
       (* (+ (* x 0) (* 1 y))
          (+ x 3)))</span>

(<span class="kw">define</span> (=number? expr num)
  (<span class="kw">and</span> (<span class="fu">number?</span> expr) (<span class="fu">=</span> expr num)))

(<span class="kw">define</span> (make-sum a1 a2)
  (<span class="kw">cond</span> ((=number? a1 <span class="cn">0</span>) a2)
        ((=number? a2 <span class="cn">0</span>) a1)
        ((<span class="kw">and</span> (<span class="fu">number?</span> a1) (<span class="fu">number?</span> a2)) (<span class="fu">+</span> a1 a2))
        (<span class="kw">else</span> (<span class="fu">list</span> <span class="vs">'+</span> a1 a2))))

(<span class="kw">define</span> (make-product m1 m2)
  (<span class="kw">cond</span> ((<span class="kw">or</span> (=number? m1 <span class="cn">0</span>) (=number? m2 <span class="cn">0</span>)) <span class="cn">0</span>)
        ((=number? m1 <span class="cn">1</span>) m2)
        ((=number? m2 <span class="cn">1</span>) m1)
        ((<span class="kw">and</span> (<span class="fu">number?</span> m1) (<span class="fu">number?</span> m2)) (<span class="fu">*</span> m1 m2))
        (<span class="kw">else</span> (<span class="fu">list</span> <span class="vs">'*</span> m1 m2))))

(deriv <span class="vs">'(+ x 3) 'x</span>) <span class="op">=&gt;</span> <span class="cn">1</span>
(deriv <span class="vs">'(* x y) 'x</span>) <span class="op">=&gt;</span> <span class="vs">'y</span>
(deriv <span class="vs">'(* (* x y) (+ x 3)) 'x</span>) <span class="op">=&gt;</span> <span class="vs">'(+ (* x y) (* y (+ x 3)))</span></code></pre>
<h3 id="ex2.56" class="anchor">
<a class="anchor__link link" href="#ex2.56" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-16.html#%25_thm_2.56">Exercise 2.56<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.3.2">2.3.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>=number?</code>
</li>
<li class="flat__item nowrap">
<code>addend</code>
</li>
<li class="flat__item nowrap">
<code>augend</code>
</li>
<li class="flat__item nowrap">
<code>make-product</code>
</li>
<li class="flat__item nowrap">
<code>make-sum</code>
</li>
<li class="flat__item nowrap">
<code>multiplicand</code>
</li>
<li class="flat__item nowrap">
<code>multiplier</code>
</li>
<li class="flat__item nowrap">
<code>product?</code>
</li>
<li class="flat__item nowrap">
<code>same-variable?</code>
</li>
<li class="flat__item nowrap">
<code>sum?</code>
</li>
<li class="flat__item nowrap">
<code>variable?</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> (deriv expr var)
  (<span class="kw">cond</span> ((<span class="fu">number?</span> expr) <span class="cn">0</span>)
        ((variable? expr)
         (<span class="kw">if</span> (same-variable? expr var) <span class="cn">1 0</span>))
        ((sum? expr)
         (make-sum (deriv (addend expr) var)
                   (deriv (augend expr) var)))
        ((product? expr)
         (make-sum (make-product (multiplier expr)
                                 (deriv (multiplicand expr) var))
                   (make-product (deriv (multiplier expr) var)
                                 (multiplicand expr))))
        ((exponentiation? expr)
         (make-product
          (exponent expr)
          (make-product (make-exponentiation (base expr) (<span class="fu">-</span> (exponent expr) <span class="cn">1</span>))
                        (deriv (base expr) var))))
        (<span class="kw">else</span> (<span class="fu">error</span> <span class="vs">'deriv</span> <span class="cn">"unknown expr type"</span> expr))))

(<span class="kw">define</span> (make-exponentiation b e)
  (<span class="kw">cond</span> ((=number? e <span class="cn">0</span>) <span class="cn">1</span>)
        ((=number? e <span class="cn">1</span>) b)
        ((=number? b <span class="cn">1</span>) <span class="cn">1</span>)
        (<span class="kw">else</span> (<span class="fu">list</span> <span class="vs">'**</span> b e))))

(<span class="kw">define</span> (exponentiation? expr)
  (<span class="kw">and</span> (<span class="fu">pair?</span> expr) (<span class="fu">eq?</span> (<span class="fu">car</span> expr) <span class="vs">'**</span>)))
(<span class="kw">define</span> base <span class="fu">cadr</span>)
(<span class="kw">define</span> exponent <span class="fu">caddr</span>)

(deriv <span class="vs">'(* 3 (** x 5)) 'x</span>) <span class="op">=&gt;</span> <span class="vs">'(* 3 (* 5 (** x 4)))</span></code></pre>
<h3 id="ex2.57" class="anchor">
<a class="anchor__link link" href="#ex2.57" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-16.html#%25_thm_2.57">Exercise 2.57<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="2.html#2.2.3.1">2.2.3.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>accumulate</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.3.2">2.3.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>make-product</code>
</li>
<li class="flat__item nowrap">
<code>make-sum</code>
</li>
<li class="flat__item nowrap">
<code>product?</code>
</li>
<li class="flat__item nowrap">
<code>same-variable?</code>
</li>
<li class="flat__item nowrap">
<code>sum?</code>
</li>
<li class="flat__item nowrap">
<code>variable?</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">paste</span> (<a href="#2.3.2">:2.3.2</a> deriv))

(<span class="kw">define</span> addend <span class="fu">cadr</span>)
(<span class="kw">define</span> (augend sum)
  (accumulate make-sum <span class="cn">0</span> (<span class="fu">cddr</span> sum)))
(<span class="kw">define</span> multiplier <span class="fu">cadr</span>)
(<span class="kw">define</span> (multiplicand product)
  (accumulate make-product <span class="cn">1</span> (<span class="fu">cddr</span> product)))

(deriv <span class="vs">'(* x y (+ x 3)) 'x</span>) <span class="op">=&gt;</span> <span class="vs">'(+ (* x y) (* y (+ x 3)))</span></code></pre>
<h3 id="ex2.58" class="anchor">
<a class="anchor__link link" href="#ex2.58" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-16.html#%25_thm_2.58">Exercise 2.58<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.3.1">2.3.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>memq</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.3.2">2.3.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>=number?</code>
</li>
<li class="flat__item nowrap">
<code>same-variable?</code>
</li>
<li class="flat__item nowrap">
<code>variable?</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">paste</span> (<a href="#2.3.2">:2.3.2</a> deriv))</code></pre>
<ol type="a">
<li><p>Fully parenthesized infix form:</p>
<pre><code class="blockcode">(<span class="kw">define</span> (make-sum a1 a2)
  (<span class="kw">cond</span> ((=number? a1 <span class="cn">0</span>) a2)
        ((=number? a2 <span class="cn">0</span>) a1)
        ((<span class="kw">and</span> (<span class="fu">number?</span> a1) (<span class="fu">number?</span> a2)) (<span class="fu">+</span> a1 a2))
        (<span class="kw">else</span> (<span class="fu">list</span> a1 <span class="vs">'+</span> a2))))

(<span class="kw">define</span> (make-product m1 m2)
  (<span class="kw">cond</span> ((<span class="kw">or</span> (=number? m1 <span class="cn">0</span>) (=number? m2 <span class="cn">0</span>)) <span class="cn">0</span>)
        ((=number? m1 <span class="cn">1</span>) m2)
        ((=number? m2 <span class="cn">1</span>) m1)
        ((<span class="kw">and</span> (<span class="fu">number?</span> m1) (<span class="fu">number?</span> m2)) (<span class="fu">*</span> m1 m2))
        (<span class="kw">else</span> (<span class="fu">list</span> m1 <span class="vs">'*</span> m2))))

(<span class="kw">define</span> (sum? expr)
  (<span class="kw">and</span> (<span class="fu">pair?</span> expr) (<span class="fu">eq?</span> (<span class="fu">cadr</span> expr) <span class="vs">'+</span>)))
(<span class="kw">define</span> addend <span class="fu">car</span>)
(<span class="kw">define</span> augend <span class="fu">caddr</span>)

(<span class="kw">define</span> (product? expr)
  (<span class="kw">and</span> (<span class="fu">pair?</span> expr) (<span class="fu">eq?</span> (<span class="fu">cadr</span> expr) <span class="vs">'*</span>)))
(<span class="kw">define</span> multiplier <span class="fu">car</span>)
(<span class="kw">define</span> multiplicand <span class="fu">caddr</span>)

(deriv <span class="vs">'(x + (3 * (x + (y + 2)))) 'x</span>) <span class="op">=&gt;</span> <span class="cn">4</span></code></pre></li>
<li><p>Standard algebraic notation:</p>
<pre><code class="blockcode">(<span class="kw">define</span> (has op expr)
  (<span class="kw">and</span> (<span class="fu">pair?</span> expr) (<span class="fu">memq</span> op expr)))

(<span class="kw">define</span> (unwrap expr)
  (<span class="kw">if</span> (<span class="kw">and</span> (<span class="fu">pair?</span> expr) (<span class="fu">null?</span> (<span class="fu">cdr</span> expr)))
      (<span class="fu">car</span> expr)
      expr))

(<span class="kw">define</span> (before op expr)
  (<span class="kw">define</span> (iter expr)
    (<span class="kw">if</span> (<span class="fu">eq?</span> op (<span class="fu">car</span> expr))
        <span class="vs">'()</span>
        (<span class="fu">cons</span> (<span class="fu">car</span> expr) (iter (<span class="fu">cdr</span> expr)))))
  (unwrap (iter expr)))

(<span class="kw">define</span> (after op expr)
  (unwrap (<span class="fu">cdr</span> (<span class="fu">memq</span> op expr))))

(<span class="kw">define</span> (sum? expr) (has <span class="vs">'+</span> expr))
(<span class="kw">define</span> (addend expr) (before <span class="vs">'+</span> expr))
(<span class="kw">define</span> (augend expr) (after <span class="vs">'+</span> expr))

(<span class="kw">define</span> (product? expr) (<span class="kw">and</span> (<span class="fu">not</span> (sum? expr)) (has <span class="vs">'*</span> expr)))
(<span class="kw">define</span> (multiplier expr) (before <span class="vs">'*</span> expr))
(<span class="kw">define</span> (multiplicand expr) (after <span class="vs">'*</span> expr))

(deriv <span class="vs">'(x + 3 * (x + y + 2)) 'x</span>) <span class="op">=&gt;</span> <span class="cn">4</span>
(deriv <span class="vs">'(3 * (x + y * 2) + x + 1) 'x</span>) <span class="op">=&gt;</span> <span class="cn">4</span></code></pre></li>
</ol>
<h2 id="2.3.3" class="anchor">
<a class="anchor__link link" href="#2.3.3" aria-hidden="true">#</a> <span class="number">2.3.3</span> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-16.html#%25_sec_2.3.3">Example: Representing Sets<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h2>
<h3 id="2.3.3.1" class="anchor">
<a class="anchor__link link" href="#2.3.3.1" aria-hidden="true">#</a> <span class="number">2.3.3.1</span> Sets as unordered lists
</h3>
<pre><code class="blockcode">(<span class="kw">define</span> (element-of-set? x set)
  (<span class="kw">and</span> (<span class="fu">not</span> (<span class="fu">null?</span> set))
       (<span class="kw">or</span> (<span class="fu">equal?</span> x (<span class="fu">car</span> set))
           (element-of-set? x (<span class="fu">cdr</span> set)))))

(<span class="kw">define</span> (adjoin-set x set)
  (<span class="kw">if</span> (element-of-set? x set)
      set
      (<span class="fu">cons</span> x set)))

(<span class="kw">define</span> (intersection-set set1 set2)
  (<span class="kw">cond</span> ((<span class="fu">null?</span> set1) <span class="vs">'()</span>)
        ((<span class="fu">null?</span> set2) <span class="vs">'()</span>)
        ((element-of-set? (<span class="fu">car</span> set1) set2)
         (<span class="fu">cons</span> (<span class="fu">car</span> set1)
               (intersection-set (<span class="fu">cdr</span> set1) set2)))
        (<span class="kw">else</span> (intersection-set (<span class="fu">cdr</span> set1) set2))))

(adjoin-set <span class="cn">1</span> <span class="vs">'()</span>) <span class="op">=&gt;</span> <span class="vs">'(1)</span>
(adjoin-set <span class="cn">1</span> <span class="vs">'(1)</span>) <span class="op">=&gt;</span> <span class="vs">'(1)</span>
(adjoin-set <span class="cn">1</span> <span class="vs">'(2 3)</span>) <span class="op">=&gt;</span> <span class="vs">'(1 2 3)</span>

(element-of-set? <span class="cn">1</span> <span class="vs">'()</span>) <span class="op">=&gt;</span> <span class="cn">#f</span>
(element-of-set? <span class="cn">1</span> <span class="vs">'(1)</span>) <span class="op">=&gt;</span> <span class="cn">#t</span>
(element-of-set? <span class="cn">1</span> <span class="vs">'(3 2 1)</span>) <span class="op">=&gt;</span> <span class="cn">#t</span>

(intersection-set <span class="vs">'() '(1 2)</span>) <span class="op">=&gt;</span> <span class="vs">'()</span>
(intersection-set <span class="vs">'(1) '(1 2)</span>) <span class="op">=&gt;</span> <span class="vs">'(1)</span>
(intersection-set <span class="vs">'(2) '(1 2)</span>) <span class="op">=&gt;</span> <span class="vs">'(2)</span>
(intersection-set <span class="vs">'(2 1) '(1 2)</span>) <span class="op">=&gt;</span> <span class="vs">'(2 1)</span></code></pre>
<h3 id="ex2.59" class="anchor">
<a class="anchor__link link" href="#ex2.59" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-16.html#%25_thm_2.59">Exercise 2.59<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="2.html#2.2.3.1">2.2.3.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>accumulate</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.3.3.1">2.3.3.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>adjoin-set</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> (union-set set1 set2)
  (accumulate adjoin-set set2 set1))

(union-set <span class="vs">'() '(1 2 3)</span>) <span class="op">=&gt;</span> <span class="vs">'(1 2 3)</span>
(union-set <span class="vs">'(1 2 3) '()</span>) <span class="op">=&gt;</span> <span class="vs">'(1 2 3)</span>
(union-set <span class="vs">'(1 2) '(2 3)</span>) <span class="op">=&gt;</span> <span class="vs">'(1 2 3)</span></code></pre>
<h3 id="ex2.60" class="anchor">
<a class="anchor__link link" href="#ex2.60" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-16.html#%25_thm_2.60">Exercise 2.60<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<p>To allow duplicates, we only need to change <code>adjoin-set</code> and <code>union-set</code>:</p>
<pre><code class="blockcode">(<span class="kw">define</span> adjoin-set <span class="fu">cons</span>)
(<span class="kw">define</span> union-set <span class="fu">append</span>)</code></pre>
<p>To compare the efficiency of each representation, let <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span> be the number of unique elements in the set, and let <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> be the duplication factor (so the list contains <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">kn</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">n</span></span></span></span> elements in total).</p>
<table>
<thead>
<tr>
<th>Procedure</th>
<th>Non-duplicate</th>
<th>Duplicate</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>adjoin-set</code></td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Θ(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></td>
</tr>
<tr>
<td><code>union-set</code></td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Θ(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>k</mi><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(kn)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></td>
</tr>
<tr>
<td><code>element-of-set?</code></td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Θ(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>k</mi><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(kn)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></td>
</tr>
<tr>
<td><code>intersection-set</code></td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Θ(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></td>
<td><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>k</mi><mi>n</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O((kn)^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">n</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></td>
</tr>
</tbody>
</table>
<p>Which representation is more efficient depends on <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi><mtext>.</mtext></mrow><annotation encoding="application/x-tex">k\htmlClass{math-punctuation}{\text{.}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="enclosing math-punctuation"><span class="mord text"><span class="mord">.</span></span></span></span></span></span> If it’s small, meaning inserting a duplicate is rare, then allowing duplicates is more efficient. For general use, it’s best to disallow duplicates because <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> is unbounded and we cannot predict it.</p>
<h3 id="2.3.3.2" class="anchor">
<a class="anchor__link link" href="#2.3.3.2" aria-hidden="true">#</a> <span class="number">2.3.3.2</span> Sets as ordered lists
</h3>
<pre><code class="blockcode">(<span class="kw">define</span> (element-of-set? x set)
  (<span class="kw">and</span> (<span class="fu">not</span> (<span class="fu">null?</span> set))
       (<span class="fu">&lt;=</span> (<span class="fu">car</span> set) x)
       (<span class="kw">or</span> (<span class="fu">=</span> (<span class="fu">car</span> set) x)
           (element-of-set? x (<span class="fu">cdr</span> set)))))

(<span class="kw">define</span> (intersection-set set1 set2)
  (<span class="kw">if</span> (<span class="kw">or</span> (<span class="fu">null?</span> set1) (<span class="fu">null?</span> set2))
      <span class="vs">'()</span>
      (<span class="kw">let</span> ((x1 (<span class="fu">car</span> set1))
            (x2 (<span class="fu">car</span> set2)))
        (<span class="kw">cond</span> ((<span class="fu">=</span> x1 x2) (<span class="fu">cons</span> x1 (intersection-set (<span class="fu">cdr</span> set1) (<span class="fu">cdr</span> set2))))
              ((<span class="fu">&lt;</span> x1 x2) (intersection-set (<span class="fu">cdr</span> set1) set2))
              (<span class="kw">else</span> (intersection-set set1 (<span class="fu">cdr</span> set2)))))))

(element-of-set? <span class="cn">2</span> <span class="vs">'()</span>) <span class="op">=&gt;</span> <span class="cn">#f</span>
(element-of-set? <span class="cn">2</span> <span class="vs">'(2)</span>) <span class="op">=&gt;</span> <span class="cn">#t</span>
(element-of-set? <span class="cn">2</span> <span class="vs">'(1 2 3)</span>) <span class="op">=&gt;</span> <span class="cn">#t</span>

(intersection-set <span class="vs">'() '(1 2)</span>) <span class="op">=&gt;</span> <span class="vs">'()</span>
(intersection-set <span class="vs">'(1) '(1 2)</span>) <span class="op">=&gt;</span> <span class="vs">'(1)</span>
(intersection-set <span class="vs">'(2) '(1 2)</span>) <span class="op">=&gt;</span> <span class="vs">'(2)</span>
(intersection-set <span class="vs">'(1 2) '(1 2)</span>) <span class="op">=&gt;</span> <span class="vs">'(1 2)</span></code></pre>
<h3 id="ex2.61" class="anchor">
<a class="anchor__link link" href="#ex2.61" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-16.html#%25_thm_2.61">Exercise 2.61<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<pre><code class="blockcode">(<span class="kw">define</span> (adjoin-set x set)
  (<span class="kw">cond</span> ((<span class="fu">null?</span> set) (<span class="fu">list</span> x))
        ((<span class="fu">=</span> x (<span class="fu">car</span> set)) set)
        ((<span class="fu">&lt;</span> x (<span class="fu">car</span> set)) (<span class="fu">cons</span> x set))
        (<span class="kw">else</span> (<span class="fu">cons</span> (<span class="fu">car</span> set) (adjoin-set x (<span class="fu">cdr</span> set))))))

(adjoin-set <span class="cn">1</span> <span class="vs">'()</span>) <span class="op">=&gt;</span> <span class="vs">'(1)</span>
(adjoin-set <span class="cn">1</span> <span class="vs">'(1)</span>) <span class="op">=&gt;</span> <span class="vs">'(1)</span>
(adjoin-set <span class="cn">2</span> <span class="vs">'(1)</span>) <span class="op">=&gt;</span> <span class="vs">'(1 2)</span>
(adjoin-set <span class="cn">2</span> <span class="vs">'(1 3)</span>) <span class="op">=&gt;</span> <span class="vs">'(1 2 3)</span></code></pre>
<h3 id="ex2.62" class="anchor">
<a class="anchor__link link" href="#ex2.62" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-16.html#%25_thm_2.62">Exercise 2.62<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<pre><code class="blockcode">(<span class="kw">define</span> (union-set set1 set2)
  (<span class="kw">cond</span> ((<span class="fu">null?</span> set1) set2)
        ((<span class="fu">null?</span> set2) set1)
        (<span class="kw">else</span>
         (<span class="kw">let</span> ((x1 (<span class="fu">car</span> set1))
               (x2 (<span class="fu">car</span> set2)))
           (<span class="kw">cond</span> ((<span class="fu">=</span> x1 x2) (<span class="fu">cons</span> x1 (union-set (<span class="fu">cdr</span> set1) (<span class="fu">cdr</span> set2))))
                 ((<span class="fu">&lt;</span> x1 x2) (<span class="fu">cons</span> x1 (union-set (<span class="fu">cdr</span> set1) set2)))
                 (<span class="kw">else</span> (<span class="fu">cons</span> x2 (union-set set1 (<span class="fu">cdr</span> set2)))))))))

(union-set <span class="vs">'() '(1 2 3)</span>) <span class="op">=&gt;</span> <span class="vs">'(1 2 3)</span>
(union-set <span class="vs">'(1 2 3) '()</span>) <span class="op">=&gt;</span> <span class="vs">'(1 2 3)</span>
(union-set <span class="vs">'(1 2) '(2 3)</span>) <span class="op">=&gt;</span> <span class="vs">'(1 2 3)</span></code></pre>
<h3 id="2.3.3.3" class="anchor">
<a class="anchor__link link" href="#2.3.3.3" aria-hidden="true">#</a> <span class="number">2.3.3.3</span> Sets as binary trees
</h3>
<pre><code class="blockcode">(<span class="kw">define</span> make-tree <span class="fu">list</span>)
(<span class="kw">define</span> entry <span class="fu">car</span>)
(<span class="kw">define</span> left-branch <span class="fu">cadr</span>)
(<span class="kw">define</span> right-branch <span class="fu">caddr</span>)

(<span class="kw">define</span> (element-of-set? x set)
  (<span class="kw">and</span> (<span class="fu">not</span> (<span class="fu">null?</span> set))
       (<span class="kw">or</span> (<span class="fu">=</span> x (entry set))
           (<span class="kw">and</span> (<span class="fu">&lt;</span> x (entry set))
                (element-of-set? x (left-branch set)))
           (<span class="kw">and</span> (<span class="fu">&gt;</span> x (entry set))
                (element-of-set? x (right-branch set))))))

(<span class="kw">define</span> (adjoin-set x set)
  (<span class="kw">cond</span> ((<span class="fu">null?</span> set) (make-tree x <span class="vs">'() '()</span>))
        ((<span class="fu">=</span> x (entry set)) set)
        ((<span class="fu">&lt;</span> x (entry set))
         (make-tree (entry set)
                    (adjoin-set x (left-branch set))
                    (right-branch set)))
        ((<span class="fu">&gt;</span> x (entry set))
         (make-tree (entry set)
                    (left-branch set)
                    (adjoin-set x (right-branch set))))))

(adjoin-set <span class="cn">1</span> <span class="vs">'()</span>) <span class="op">=&gt;</span> <span class="vs">'(1 () ())</span>
(adjoin-set <span class="cn">1</span> <span class="vs">'(1 () ())</span>) <span class="op">=&gt;</span> <span class="vs">'(1 () ())</span>
(adjoin-set <span class="cn">1</span> <span class="vs">'(2 () (3 () ()))</span>) <span class="op">=&gt;</span> <span class="vs">'(2 (1 () ()) (3 () ()))</span>

(element-of-set? <span class="cn">1</span> <span class="vs">'()</span>) <span class="op">=&gt;</span> <span class="cn">#f</span>
(element-of-set? <span class="cn">1</span> <span class="vs">'(1 () ())</span>) <span class="op">=&gt;</span> <span class="cn">#t</span>
(element-of-set? <span class="cn">1</span> <span class="vs">'(2 (1 () ()) (3 () ()))</span>) <span class="op">=&gt;</span> <span class="cn">#t</span></code></pre>
<h3 id="ex2.63" class="anchor">
<a class="anchor__link link" href="#ex2.63" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-16.html#%25_thm_2.63">Exercise 2.63<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.3.3.3">2.3.3.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>entry</code>
</li>
<li class="flat__item nowrap">
<code>left-branch</code>
</li>
<li class="flat__item nowrap">
<code>right-branch</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> (tree-&gt;list-1 tree)
  (<span class="kw">if</span> (<span class="fu">null?</span> tree)
      <span class="vs">'()</span>
      (<span class="fu">append</span> (tree-&gt;list-1 (left-branch tree))
              (<span class="fu">cons</span> (entry tree)
                    (tree-&gt;list-1 (right-branch tree))))))

(<span class="kw">define</span> (tree-&gt;list-2 tree)
  (<span class="kw">define</span> (copy-to-list tree result-list)
    (<span class="kw">if</span> (<span class="fu">null?</span> tree)
        result-list
        (copy-to-list (left-branch tree)
                      (<span class="fu">cons</span> (entry tree)
                            (copy-to-list (right-branch tree)
                                          result-list)))))
  (copy-to-list tree <span class="vs">'()</span>))</code></pre>
<p>Here are the trees from Figure 2.16, all representing the set <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">{</mo><mn>1</mn><mo separator="true">,</mo><mn>3</mn><mo separator="true">,</mo><mn>5</mn><mo separator="true">,</mo><mn>7</mn><mo separator="true">,</mo><mn>9</mn><mo separator="true">,</mo><mn>11</mn><mo stretchy="false">}</mo><mtext>:</mtext></mrow><annotation encoding="application/x-tex">\{1,3,5,7,9,11\}\htmlClass{math-punctuation}{\text{:}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">3</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">7</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">9</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mord">1</span><span class="mclose">}</span><span class="enclosing math-punctuation"><span class="mord text"><span class="mord">:</span></span></span></span></span></span></p>
<pre><code class="blockcode">(<span class="kw">define</span> t1 <span class="vs">'(7 (3 (1 () ()) (5 () ())) (9 () (11 () ())))</span>)
(<span class="kw">define</span> t2 <span class="vs">'(3 (1 () ()) (7 (5 () ()) (9 () (11 () ()))))</span>)
(<span class="kw">define</span> t3 <span class="vs">'(5 (3 (1 () ()) ()) (9 (7 () ()) (11 () ())))</span>)</code></pre>
<ol type="a">
<li><p>Yes, the two procedures produce the same result for every tree. In particular, they produce the ordered list representation of the set. The first performs an in-order traversal and appends intermediate results (left to right), while the second performs a reverse in-order traversal and prepends elements to the result (right to left).</p>
<pre><code class="blockcode">(tree-&gt;list-1 t1)
<span class="op">=&gt;</span> (tree-&gt;list-2 t1)
<span class="op">=&gt;</span> (tree-&gt;list-1 t2)
<span class="op">=&gt;</span> (tree-&gt;list-2 t2)
<span class="op">=&gt;</span> (tree-&gt;list-1 t3)
<span class="op">=&gt;</span> (tree-&gt;list-2 t3)
<span class="op">=&gt;</span> <span class="vs">'(1 3 5 7 9 11)</span></code></pre></li>
<li><p>The first procedure does linear work at each node, so it grows as <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mi>n</mi><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Θ(n\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span> for a balanced tree. The second procedure does constant work at each node, so it grows as <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Θ(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span> for any tree whether balanced or not. The second procedure is more efficient.</p></li>
</ol>
<h3 id="ex2.64" class="anchor">
<a class="anchor__link link" href="#ex2.64" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-16.html#%25_thm_2.64">Exercise 2.64<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.3.3.3">2.3.3.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>make-tree</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> (list-&gt;tree elements)
  (<span class="fu">car</span> (partial-tree elements (<span class="fu">length</span> elements))))

(<span class="kw">define</span> (partial-tree elts n)
  (<span class="kw">if</span> (<span class="fu">=</span> n <span class="cn">0</span>)
      (<span class="fu">cons</span> <span class="vs">'()</span> elts)
      (<span class="kw">let*</span> ((left-size (<span class="fu">quotient</span> (<span class="fu">-</span> n <span class="cn">1</span>) <span class="cn">2</span>))
             (left-result (partial-tree elts left-size))
             (left-tree (<span class="fu">car</span> left-result))
             (non-left-elts (<span class="fu">cdr</span> left-result))
             (this-entry (<span class="fu">car</span> non-left-elts))
             (right-size (<span class="fu">-</span> n (<span class="fu">+</span> left-size <span class="cn">1</span>)))
             (right-result (partial-tree (<span class="fu">cdr</span> non-left-elts) right-size))
             (right-tree (<span class="fu">car</span> right-result))
             (remaining-elts (<span class="fu">cdr</span> right-result)))
        (<span class="fu">cons</span> (make-tree this-entry left-tree right-tree)
              remaining-elts))))

(list-&gt;tree <span class="vs">'(1 3 5 7 9 11)</span>)
<span class="op">=&gt;</span> <span class="vs">'(5 (1 () (3 () ())) (9 (7 () ()) (11 () ())))</span></code></pre>
<ol type="a">
<li><p>The procedure <code>partial-tree</code> works by partitioning the first <code>n</code> elements of <code>elts</code> around a central element and recursively producing left and right subtrees. It uses truncated division to work when <code>n</code> is even or odd. It passes on the list of remaining elements to avoid re-traversing the list. Here is the tree it produces for the example:</p>
<figure><svg class="diagram" viewBox="0 0 128 127" style="max-width:128px"><text x="55.143" y="13.714">5</text><path d="M54.857 18.286 36.571 54.857M64 18.286l18.286 36.571"/><text x="27.714" y="68.571">1</text><text x="82.571" y="68.571">9</text><path d="m36.571 73.143 13.715 27.428m32-27.428-13.715 27.428m22.858-27.428 13.714 27.428"/><text x="46" y="123.429">3</text><text x="64.286" y="123.429">7</text><text x="100.857" y="123.429">11</text></svg></figure></li>
<li><p>The procedure <code>list-&gt;tree</code> does constant work at each node, so it grows as <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mtext>.</mtext></mrow><annotation encoding="application/x-tex">Θ(n)\htmlClass{math-punctuation}{\text{.}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="enclosing math-punctuation"><span class="mord text"><span class="mord">.</span></span></span></span></span></span></p></li>
</ol>
<h3 id="ex2.65" class="anchor">
<a class="anchor__link link" href="#ex2.65" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-16.html#%25_thm_2.65">Exercise 2.65<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.3.3.2">2.3.3.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>intersection-set</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.62">Ex 2.62</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>union-set</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.63">Ex 2.63</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>tree-&gt;list-2</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.64">Ex 2.64</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>list-&gt;tree</code>
</li>
</ul>
</li>
</ul>
</aside>
<p>We can convert the balanced binary tree to an ordered list, use the <code>union-set</code> and <code>intersection-set</code> we already implemented for ordered lists, and then convert back to a tree. This is <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Θ(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span> because each step is linear.</p>
<pre><code class="blockcode">(<span class="kw">define</span> (union-tree set1 set2)
  (list-&gt;tree (union-set (tree-&gt;list-2 set1) (tree-&gt;list-2 set2))))

(<span class="kw">define</span> (intersection-tree set1 set2)
  (list-&gt;tree (intersection-set (tree-&gt;list-2 set1) (tree-&gt;list-2 set2))))

(<span class="kw">define</span> t1 <span class="vs">'(1 () ())</span>)
(<span class="kw">define</span> t2 <span class="vs">'(2 () ())</span>)
(<span class="kw">define</span> t23 <span class="vs">'(2 () (3 () ()))</span>)
(<span class="kw">define</span> t123 <span class="vs">'(2 (1 () ()) (3 () ()))</span>)

(union-tree <span class="vs">'()</span> t123) <span class="op">=&gt;</span> t123
(union-tree t123 <span class="vs">'()</span>) <span class="op">=&gt;</span> t123
(union-tree t123 t123) <span class="op">=&gt;</span> t123
(union-tree t1 t23) <span class="op">=&gt;</span> t123
(union-tree t2 t23) <span class="op">=&gt;</span> t23
(union-tree t23 t123) <span class="op">=&gt;</span> t123

(intersection-tree <span class="vs">'()</span> t123) <span class="op">=&gt;</span> <span class="vs">'()</span>
(intersection-tree t123 <span class="vs">'()</span>) <span class="op">=&gt;</span> <span class="vs">'()</span>
(intersection-tree t1 t123) <span class="op">=&gt;</span> t1
(intersection-tree t2 t123) <span class="op">=&gt;</span> t2
(intersection-tree t123 t123) <span class="op">=&gt;</span> t123
(intersection-tree t23 t123) <span class="op">=&gt;</span> t23</code></pre>
<h3 id="2.3.3.4" class="anchor">
<a class="anchor__link link" href="#2.3.3.4" aria-hidden="true">#</a> <span class="number">2.3.3.4</span> Sets and information retrieval
</h3>
<pre><code class="blockcode">(<span class="kw">define</span> (lookup given-key set-of-records)
  (<span class="kw">cond</span> ((<span class="fu">null?</span> set-of-records) <span class="cn">#f</span>)
        ((<span class="fu">equal?</span> given-key (key (<span class="fu">car</span> set-of-records)))
         (<span class="fu">car</span> set-of-records))
        (<span class="kw">else</span> (lookup given-key (<span class="fu">cdr</span> set-of-records)))))

(<span class="kw">define</span> key <span class="fu">car</span>)

(lookup <span class="cn">3</span> <span class="vs">'((1 flour) (2 water) (3 salt))</span>) <span class="op">=&gt;</span> <span class="vs">'(3 salt)</span></code></pre>
<h3 id="ex2.66" class="anchor">
<a class="anchor__link link" href="#ex2.66" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-16.html#%25_thm_2.66">Exercise 2.66<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.3.3.3">2.3.3.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>entry</code>
</li>
<li class="flat__item nowrap">
<code>left-branch</code>
</li>
<li class="flat__item nowrap">
<code>right-branch</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.3.3.4">2.3.3.4</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>key</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> (lookup given-key set-of-records)
  (<span class="kw">if</span> (<span class="fu">null?</span> set-of-records)
      <span class="cn">#f</span>
      (<span class="kw">let*</span> ((record (entry set-of-records))
             (rec-key (key record)))
        (<span class="kw">cond</span> ((<span class="fu">=</span> given-key rec-key) record)
              ((<span class="fu">&lt;</span> given-key rec-key)
               (lookup given-key (left-branch set-of-records)))
              ((<span class="fu">&gt;</span> given-key rec-key)
               (lookup given-key (right-branch set-of-records)))))))

(lookup <span class="cn">3</span> <span class="vs">'((2 water) ((1 flour) () ()) ((3 salt) () ()))</span>) <span class="op">=&gt;</span> <span class="vs">'(3 salt)</span></code></pre>
<h2 id="2.3.4" class="anchor">
<a class="anchor__link link" href="#2.3.4" aria-hidden="true">#</a> <span class="number">2.3.4</span> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-16.html#%25_sec_2.3.4">Example: Huffman Encoding Trees<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h2>
<h3 id="2.3.4.1" class="anchor">
<a class="anchor__link link" href="#2.3.4.1" aria-hidden="true">#</a> <span class="number">2.3.4.1</span> Representing Huffman trees
</h3>
<pre><code class="blockcode">(<span class="kw">define</span> (make-leaf symbol weight) (<span class="fu">list</span> <span class="vs">'leaf</span> symbol weight))
(<span class="kw">define</span> (leaf? object) (<span class="fu">eq?</span> (<span class="fu">car</span> object) <span class="vs">'leaf</span>))
(<span class="kw">define</span> symbol-leaf <span class="fu">cadr</span>)
(<span class="kw">define</span> weight-leaf <span class="fu">caddr</span>)

(<span class="kw">define</span> (make-code-tree left right)
  (<span class="fu">list</span> left
        right
        (<span class="fu">append</span> (symbols left) (symbols right))
        (<span class="fu">+</span> (weight left) (weight right))))
(<span class="kw">define</span> left-branch <span class="fu">car</span>)
(<span class="kw">define</span> right-branch <span class="fu">cadr</span>)

(<span class="kw">define</span> (symbols tree)
  (<span class="kw">if</span> (leaf? tree)
      (<span class="fu">list</span> (symbol-leaf tree))
      (<span class="fu">caddr</span> tree)))
(<span class="kw">define</span> (weight tree)
  (<span class="kw">if</span> (leaf? tree)
      (weight-leaf tree)
      (<span class="fu">cadddr</span> tree)))</code></pre>
<h3 id="2.3.4.2" class="anchor">
<a class="anchor__link link" href="#2.3.4.2" aria-hidden="true">#</a> <span class="number">2.3.4.2</span> The decoding procedure
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.3.4.1">2.3.4.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>leaf?</code>
</li>
<li class="flat__item nowrap">
<code>left-branch</code>
</li>
<li class="flat__item nowrap">
<code>right-branch</code>
</li>
<li class="flat__item nowrap">
<code>symbol-leaf</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> (decode bits tree)
  (<span class="kw">define</span> (decode-1 bits current-branch)
    (<span class="kw">if</span> (<span class="fu">null?</span> bits)
        <span class="vs">'()</span>
        (<span class="kw">let</span> ((next-branch (choose-branch (<span class="fu">car</span> bits) current-branch)))
          (<span class="kw">if</span> (leaf? next-branch)
              (<span class="fu">cons</span> (symbol-leaf next-branch)
                    (decode-1 (<span class="fu">cdr</span> bits) tree))
              (decode-1 (<span class="fu">cdr</span> bits) next-branch)))))
  (decode-1 bits tree))

(<span class="kw">define</span> (choose-branch bit branch)
  (<span class="kw">cond</span> ((<span class="fu">=</span> bit <span class="cn">0</span>) (left-branch branch))
        ((<span class="fu">=</span> bit <span class="cn">1</span>) (right-branch branch))
        (<span class="kw">else</span> (<span class="fu">error</span> <span class="vs">'choose-branch</span> <span class="cn">"bit should be 0 or 1"</span> bit))))</code></pre>
<h3 id="2.3.4.3" class="anchor">
<a class="anchor__link link" href="#2.3.4.3" aria-hidden="true">#</a> <span class="number">2.3.4.3</span> Sets of weighted elements
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.3.4.1">2.3.4.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>make-leaf</code>
</li>
<li class="flat__item nowrap">
<code>weight</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> (adjoin-set x set)
  (<span class="kw">cond</span> ((<span class="fu">null?</span> set) (<span class="fu">list</span> x))
        ((<span class="fu">&lt;</span> (weight x) (weight (<span class="fu">car</span> set)))
         (<span class="fu">cons</span> x set))
        (<span class="kw">else</span> (<span class="fu">cons</span> (<span class="fu">car</span> set)
                    (adjoin-set x (<span class="fu">cdr</span> set))))))

(<span class="kw">define</span> (make-leaf-set pairs)
  (<span class="kw">if</span> (<span class="fu">null?</span> pairs)
      <span class="vs">'()</span>
      (<span class="kw">let</span> ((pair (<span class="fu">car</span> pairs)))
        (adjoin-set (make-leaf (<span class="fu">car</span> pair) (<span class="fu">cadr</span> pair))
                    (make-leaf-set (<span class="fu">cdr</span> pairs))))))</code></pre>
<h3 id="ex2.67" class="anchor">
<a class="anchor__link link" href="#ex2.67" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-16.html#%25_thm_2.67">Exercise 2.67<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.3.4.1">2.3.4.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>make-code-tree</code>
</li>
<li class="flat__item nowrap">
<code>make-leaf</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.3.4.2">2.3.4.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>decode</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> sample-tree
  (make-code-tree (make-leaf <span class="vs">'A</span> <span class="cn">4</span>)
                  (make-code-tree (make-leaf <span class="vs">'B</span> <span class="cn">2</span>)
                                  (make-code-tree (make-leaf <span class="vs">'D</span> <span class="cn">1</span>)
                                                  (make-leaf <span class="vs">'C</span> <span class="cn">1</span>)))))

(<span class="kw">define</span> sample-message <span class="vs">'(0 1 1 0 0 1 0 1 0 1 1 1 0)</span>)
(<span class="kw">define</span> sample-decoded <span class="vs">'(A D A B B C A)</span>)

(decode sample-message sample-tree) <span class="op">=&gt;</span> sample-decoded
(decode <span class="vs">'(0 1 2)</span> sample-tree) <span class="er">=!&gt;</span> <span class="cn">"bit should be 0 or 1: 2"</span></code></pre>
<h3 id="ex2.68" class="anchor">
<a class="anchor__link link" href="#ex2.68" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-16.html#%25_thm_2.68">Exercise 2.68<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.3.3.1">2.3.3.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>element-of-set?</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.3.4.1">2.3.4.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>leaf?</code>
</li>
<li class="flat__item nowrap">
<code>left-branch</code>
</li>
<li class="flat__item nowrap">
<code>right-branch</code>
</li>
<li class="flat__item nowrap">
<code>symbols</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.67">Ex 2.67</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>sample-decoded</code>
</li>
<li class="flat__item nowrap">
<code>sample-message</code>
</li>
<li class="flat__item nowrap">
<code>sample-tree</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> (encode message tree)
  (<span class="kw">if</span> (<span class="fu">null?</span> message)
      <span class="vs">'()</span>
      (<span class="fu">append</span> (encode-symbol (<span class="fu">car</span> message) tree)
              (encode (<span class="fu">cdr</span> message) tree))))

(<span class="kw">define</span> (encode-symbol symbol tree)
  (<span class="kw">cond</span> ((leaf? tree) <span class="vs">'()</span>)
        ((element-of-set? symbol (symbols (left-branch tree)))
         (<span class="fu">cons</span> <span class="cn">0</span> (encode-symbol symbol (left-branch tree))))
        ((element-of-set? symbol (symbols (right-branch tree)))
         (<span class="fu">cons</span> <span class="cn">1</span> (encode-symbol symbol (right-branch tree))))
        (<span class="kw">else</span> (<span class="fu">error</span> <span class="vs">'encode-symbol</span> <span class="cn">"symbol not in tree"</span> symbol))))

(encode sample-decoded sample-tree) <span class="op">=&gt;</span> sample-message
(encode <span class="vs">'(Z)</span> sample-tree) <span class="er">=!&gt;</span> <span class="cn">"symbol not in tree: Z"</span></code></pre>
<h3 id="ex2.69" class="anchor">
<a class="anchor__link link" href="#ex2.69" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-16.html#%25_thm_2.69">Exercise 2.69<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.3.4.1">2.3.4.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>make-code-tree</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.3.4.3">2.3.4.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>adjoin-set</code>
</li>
<li class="flat__item nowrap">
<code>make-leaf-set</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.68">Ex 2.68</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>encode-symbol</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> (generate-huffman-tree pairs)
  (successive-merge (make-leaf-set pairs)))

(<span class="kw">define</span> (successive-merge set)
  (<span class="kw">if</span> (<span class="fu">null?</span> (<span class="fu">cdr</span> set))
      (<span class="fu">car</span> set)
      (successive-merge
       (adjoin-set (make-code-tree (<span class="fu">car</span> set) (<span class="fu">cadr</span> set))
                   (<span class="fu">cddr</span> set)))))

(<span class="kw">define</span> abcd-tree (generate-huffman-tree <span class="vs">'((A 5) (B 10) (C 2) (D 1))</span>))
(encode-symbol <span class="vs">'A</span> abcd-tree) <span class="op">=&gt;</span> <span class="vs">'(0 1)</span>
(encode-symbol <span class="vs">'B</span> abcd-tree) <span class="op">=&gt;</span> <span class="vs">'(1)</span>
(encode-symbol <span class="vs">'C</span> abcd-tree) <span class="op">=&gt;</span> <span class="vs">'(0 0 1)</span>
(encode-symbol <span class="vs">'D</span> abcd-tree) <span class="op">=&gt;</span> <span class="vs">'(0 0 0)</span></code></pre>
<h3 id="ex2.70" class="anchor">
<a class="anchor__link link" href="#ex2.70" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-16.html#%25_thm_2.70">Exercise 2.70<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#ex2.68">Ex 2.68</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>encode</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.69">Ex 2.69</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>generate-huffman-tree</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="blockcode">(<span class="kw">define</span> rock-tree
  (generate-huffman-tree
   <span class="vs">'((a 2) (boom 1) (get 2) (job 2) (na 16) (sha 3) (yip 9) (wah 1))</span>))

(<span class="kw">define</span> song
  <span class="vs">'(get a job sha na na na na na na na na
    get a job sha na na na na na na na na
    wah yip yip yip yip yip yip yip yip yip
    sha boom)</span>)

(<span class="kw">define</span> encoded-song (encode song rock-tree))
(<span class="fu">length</span> encoded-song) <span class="op">=&gt;</span> <span class="cn">84</span>
encoded-song
<span class="op">=&gt;</span> <span class="vs">'(1 1 1 1 1 1 1 0 0 1 1 1 1 0 1 1 1 0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 0 0 1 1 1
     1 0 1 1 1 0 0 0 0 0 0 0 0 0 1 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1
     1 1 0 1 1 0 1 1)</span></code></pre>
<p>This encoding requires 84 bits. A fixed-length code for the eight-symbol alphabet would require <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mo><mi>log</mi><mo>⁡</mo></mo><mn>2</mn></msub><mn>8</mn><mo>=</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">\log_2 8 = 3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.93858em;vertical-align:-0.24414em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.20696799999999996em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">8</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span></span></span></span> bits per symbol, and the song uses 36 symbols, so the fixed-length coded message would need at least <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>3</mn><mo>×</mo><mn>36</mn><mo>=</mo><mn>108</mn></mrow><annotation encoding="application/x-tex">3 \times 36 = 108</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span><span class="mord">6</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">8</span></span></span></span> bits. Using the variable-length encoding saves about 22% storage.</p>
<h3 id="ex2.71" class="anchor">
<a class="anchor__link link" href="#ex2.71" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-16.html#%25_thm_2.71">Exercise 2.71<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#ex2.68">Ex 2.68</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>encode-symbol</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.69">Ex 2.69</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>generate-huffman-tree</code>
</li>
</ul>
</li>
</ul>
</aside>
<p>Given an alphabet of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span> symbols whose relative frequencies are consecutive powers of two, the Huffman tree will have a diagonal shape with every right branch going to a leaf. Here are the trees with leaf weights shown for 5 and 10 symbols:</p>
<figure><svg class="diagram" viewBox="0 0 256 218" style="max-width:256px"><text x="64.286" y="68.571">16</text><text x="55.143" y="86.857">8</text><text x="46" y="105.143">4</text><text x="9.429" y="123.429">1</text><text x="36.857" y="123.429">2</text><text x="219.714" y="68.571">512</text><text x="210.571" y="86.857">256</text><text x="201.429" y="105.143">128</text><text x="192.286" y="123.429">64</text><text x="183.143" y="141.714">32</text><text x="174" y="160">16</text><text x="164.857" y="178.286">8</text><text x="155.714" y="196.571">4</text><text x="119.143" y="214.857">1</text><text x="146.571" y="214.857">2</text><text x="36.857" y="13.714">n=5</text><text x="192.286" y="13.714">n=10</text><path d="M54.857 36.571 27.429 91.429m27.428-54.858L64 54.857m-18.286 0 9.143 18.286m-18.286 0 9.143 18.286m-18.285 0-9.143 18.285m9.143-18.285 9.142 18.285m173.715-73.143-54.857 109.715m54.857-109.715 9.143 18.286m-18.286 0 9.143 18.286m-18.286 0 9.143 18.286m-18.286 0L192 109.714m-18.286 0L182.857 128m-18.286 0 9.143 18.286m-18.285 0L128 201.143m27.429-54.857 9.142 18.285m-18.285 0 9.143 18.286m-18.286 0 9.143 18.286"/></svg></figure>
<p>The tree looks like this because the merging algorithm ends up accumulating everything into one tree. At each stage, the weight of the tree is less than the weight of the next leaf. For example, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mo>+</mo><mn>2</mn><mo>&lt;</mo><mn>4</mn><mtext>,</mtext></mrow><annotation encoding="application/x-tex">1+2&lt;4\htmlClass{math-punctuation}{\text{,}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68354em;vertical-align:-0.0391em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord">4</span><span class="enclosing math-punctuation"><span class="mord text"><span class="mord">,</span></span></span></span></span></span> and in general <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mn>0</mn></msup><mo>+</mo><mo>⋯</mo><mo>+</mo><msup><mn>2</mn><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msup><mo>=</mo><msup><mn>2</mn><mi>k</mi></msup><mo>−</mo><mn>1</mn><mo>&lt;</mo><msup><mn>2</mn><mi>k</mi></msup><mtext>.</mtext></mrow><annotation encoding="application/x-tex">2^0+\cdots+2^{k-1}=2^k-1&lt;2^k\htmlClass{math-punctuation}{\text{.}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8491079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.932438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68354em;vertical-align:-0.0391em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.849108em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span><span class="enclosing math-punctuation"><span class="mord text"><span class="mord">.</span></span></span></span></span></span></p>
<p>In this encoding, the most frequent symbol requires one bit and the least frequent symbol requires <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> bits. We can verify this for a random <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mtext>:</mtext></mrow><annotation encoding="application/x-tex">n\htmlClass{math-punctuation}{\text{:}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span><span class="enclosing math-punctuation"><span class="mord text"><span class="mord">:</span></span></span></span></span></span></p>
<pre><code class="blockcode">(<span class="kw">define</span> (alphabet-frequencies n)
  (<span class="kw">define</span> (helper i)
    (<span class="kw">if</span> (<span class="fu">&gt;</span> i n)
        <span class="vs">'()</span>
        (<span class="fu">cons</span> (<span class="fu">list</span> i (<span class="fu">expt</span> <span class="cn">2</span> (<span class="fu">-</span> n i))) (helper (<span class="fu">+</span> i <span class="cn">1</span>)))))
  (helper <span class="cn">1</span>))

(alphabet-frequencies <span class="cn">5</span>)
<span class="op">=&gt;</span> <span class="vs">'((1 16) (2 8) (3 4) (4 2) (5 1))</span>

(<span class="kw">define</span> n (<span class="fu">+</span> <span class="cn">2</span> (random <span class="cn">25</span>)))
(<span class="kw">define</span> tree (generate-huffman-tree (alphabet-frequencies n)))

(encode-symbol <span class="cn">1</span> tree) <span class="op">=&gt;</span> <span class="vs">'(1)</span>
(<span class="fu">length</span> (encode-symbol n tree)) <span class="op">=&gt;</span> (<span class="fu">-</span> n <span class="cn">1</span>)</code></pre>
<p>In the special case where <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>=</mo><mn>1</mn><mtext>,</mtext></mrow><annotation encoding="application/x-tex">n=1\htmlClass{math-punctuation}{\text{,}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord">1</span><span class="enclosing math-punctuation"><span class="mord text"><span class="mord">,</span></span></span></span></span></span> the lone symbol requires zero bits:</p>
<pre><code class="blockcode">(<span class="kw">define</span> tree (generate-huffman-tree (alphabet-frequencies <span class="cn">1</span>)))
(encode-symbol <span class="cn">1</span> tree) <span class="op">=&gt;</span> <span class="vs">'()</span></code></pre>
<h3 id="ex2.72" class="anchor">
<a class="anchor__link link" href="#ex2.72" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-16.html#%25_thm_2.72">Exercise 2.72<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<p>The <code>encode-symbol</code> procedure from <a href="#ex2.68">Exercise&nbsp;2.68</a> grows as <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Θ(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span> in the best case, when taking the first left branch to a leaf, and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Θ(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> in the worst case, when visiting every non-leaf node. Assuming a tree as described in <a href="#ex2.71">Exercise&nbsp;2.71</a>, it is <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Θ(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span> for the most frequent symbol due to scanning the left branch’s symbols first, and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Θ(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> for the least frequent symbol as this is the worst case just described.</p>
</main>
<nav class="pagenav pagenav--bottom" aria-label="page">
  <div class="pagenav__item pagenav__item--left">
    <a class="pagenav__link link" href="2.html" aria-label="previous page">
      <svg width="12" height="11" aria-hidden="true"><use xlink:href="#left"/>
      </svg><span class="pagenav__prev">Prev</span>
    </a>
  </div>
  <div class="pagenav__item pagenav__item--center">
    <a class="pagenav__link link" href="index.html" aria-label="parent page">
      <svg width="11" height="12" aria-hidden="true"><use xlink:href="#up"/>
      </svg><span class="pagenav__up">Up</span>
    </a>
  </div>
  <div class="pagenav__item pagenav__item--right">
    <a class="pagenav__link link" href="4.html" aria-label="next page">
      <span class="pagenav__next">Next</span
        ><svg width="12" height="11" aria-hidden="true"
        ><use xlink:href="#right"/></svg>
    </a>
  </div>
</nav>
<footer class="footer">
  <p>© 2022 Mitchell Kember</p>
</footer>
</body>
</html>
