<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SICP Section 2.5 Exercises</title>
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css">
  <link rel="stylesheet" href="../../style.css">
</head>
<body>
<div hidden>
  <svg>
    <symbol id="up" viewBox="0 0 11 12">
      <path fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" d="M5.5.8v10.4m4.457-5.943L5.5.8 1.043 5.257"/>
    </symbol>
    <symbol id="left" viewBox="0 0 12 11">
      <path fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" d="M.8 5.5h10.4M5.257 9.957L.8 5.5l4.457-4.457"/>
    </symbol>
    <symbol id="right" viewBox="0 0 12 11">
      <use xlink:href="#left" transform="matrix(-1 0 0 1 12 0)"/>
    </symbol>
    <symbol id="external" viewBox="0 0 24 24">
      <path fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" d="M10.688 5.438H4.125A2.65 2.65 0 001.5 8.063v11.812A2.65 2.65 0 004.125 22.5h11.813a2.65 2.65 0 002.624-2.625v-6.563m-9.187 1.313L22.5 1.5m-6.563 0H22.5v6.563"/>
    </symbol>
  </svg>
</div>
<a class="skip-link" href="#main">Skip to main content</a>
<header class="header">
  <a class="title link" href="../../index.html">SICP Study</a>
  <nav class="sitenav" aria-label="site">
    <a class="sitenav__item link"
        href="../../text/index.html" aria-label="textbook notes">Text</a>
    <a class="sitenav__item link"
        href="../../lecture/index.html" aria-label="lecture notes">Lecture</a>
    <a class="sitenav__item sitenav__item--active link"
        href="../../exercise/index.html" aria-label="exercises">Exercise</a>
    <a class="sitenav__item sitenav__item--last link"
        href="https://github.com/mk12/sicp" aria-label="GitHub repository">
      Source
      <svg class="github-mark" width="25" height="25" viewBox="0 0 136 133" aria-hidden="true">
        <path fill="currentColor" d="M67.866.002C30.387.002 0 30.39 0 67.877c0 29.988 19.446 55.425 46.417 64.404 3.396.621 4.633-1.475 4.633-3.275 0-1.608-.058-5.879-.091-11.541-18.88 4.1-22.863-9.1-22.863-9.1-3.087-7.838-7.537-9.925-7.537-9.925-6.163-4.213.466-4.13.466-4.13 6.813.484 10.396 6.996 10.396 6.996 6.054 10.371 15.888 7.375 19.754 5.642.617-4.387 2.367-7.38 4.309-9.075-15.071-1.712-30.917-7.537-30.917-33.546 0-7.408 2.646-13.466 6.988-18.212-.7-1.717-3.03-8.617.662-17.963 0 0 5.7-1.825 18.667 6.959 5.412-1.505 11.22-2.259 16.992-2.284 5.762.025 11.57.78 16.991 2.284 12.959-8.784 18.646-6.959 18.646-6.959 3.704 9.346 1.375 16.246.675 17.963 4.35 4.746 6.98 10.804 6.98 18.212 0 26.075-15.872 31.813-30.992 33.492 2.437 2.096 4.608 6.237 4.608 12.57 0 9.072-.083 16.392-.083 18.617 0 1.817 1.22 3.93 4.666 3.267 26.95-8.996 46.38-34.417 46.38-64.396 0-37.487-30.392-67.875-67.88-67.875"/>
      </svg>      
    </a>
  </nav>
</header>
<nav class="pagenav pagenav--top" aria-label="page">
  <div class="pagenav__item pagenav__item--left">
    <a class="pagenav__link link" href="4.html" aria-label="previous page">
      <svg width="12" height="11" aria-hidden="true"><use xlink:href="#left"/>
      </svg><span class="pagenav__prev">Prev</span>
    </a>
  </div>
  <div class="pagenav__item pagenav__item--center">
    <a class="pagenav__link link" href="index.html" aria-label="parent page">
      <svg width="11" height="12" aria-hidden="true"><use xlink:href="#up"/>
      </svg><span class="pagenav__up">Up</span>
    </a>
  </div>
  <div class="pagenav__item pagenav__item--right">
    <a class="pagenav__link link" href="../3/index.html" aria-label="next page">
      <span class="pagenav__next">Next</span
        ><svg width="12" height="11" aria-hidden="true"
        ><use xlink:href="#right"/></svg>
    </a>
  </div>
</nav>
<main id="main">
<h1 id="2.5" class="anchor">
<a class="anchor__link link" href="#2.5" aria-hidden="true">#</a> <span class="number">2.5</span> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html">Systems with Generic Operations<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h1>
<h2 id="2.5.1" class="anchor">
<a class="anchor__link link" href="#2.5.1" aria-hidden="true">#</a> <span class="number">2.5.1</span> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html#%25_sec_2.5.1">Generic Arithmetic Operations<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h2>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="1.html#2.1.1">2.1.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>add-rat</code>
</li>
<li class="flat__item nowrap">
<code>denom</code>
</li>
<li class="flat__item nowrap">
<code>div-rat</code>
</li>
<li class="flat__item nowrap">
<code>mul-rat</code>
</li>
<li class="flat__item nowrap">
<code>numer</code>
</li>
<li class="flat__item nowrap">
<code>sub-rat</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="4.html#2.4.2">2.4.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>attach-tag</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="4.html#2.4.3">2.4.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>add-complex</code>
</li>
<li class="flat__item nowrap">
<code>apply-generic</code>
</li>
<li class="flat__item nowrap">
<code>apply-specific</code>
</li>
<li class="flat__item nowrap">
<code>div-complex</code>
</li>
<li class="flat__item nowrap">
<code>make-from-mag-ang</code>
</li>
<li class="flat__item nowrap">
<code>make-from-real-imag</code>
</li>
<li class="flat__item nowrap">
<code>mul-complex</code>
</li>
<li class="flat__item nowrap">
<code>polar-pkg</code>
</li>
<li class="flat__item nowrap">
<code>rectangular-pkg</code>
</li>
<li class="flat__item nowrap">
<code>sub-complex</code>
</li>
<li class="flat__item nowrap">
<code>using</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="../3/3.html#3.3.3.3">3.3.3.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>put</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="1.html#ex2.1">Ex 2.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>make-rat</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="codeblock">(<span class="kw">define</span> (add x y) (apply-generic <span class="qu">'add</span> x y))
(<span class="kw">define</span> (sub x y) (apply-generic <span class="qu">'sub</span> x y))
(<span class="kw">define</span> (mul x y) (apply-generic <span class="qu">'mul</span> x y))
(<span class="kw">define</span> (div x y) (apply-generic <span class="qu">'div</span> x y))

(<span class="kw">define</span> (scheme-number-pkg)
  (<span class="kw">define</span> (tag x) (attach-tag <span class="qu">'scheme-number</span> x))
  (put <span class="qu">'add '(scheme-number scheme-number)</span> (<span class="kw">lambda</span> (x y) (tag (<span class="fu">+</span> x y))))
  (put <span class="qu">'sub '(scheme-number scheme-number)</span> (<span class="kw">lambda</span> (x y) (tag (<span class="fu">-</span> x y))))
  (put <span class="qu">'mul '(scheme-number scheme-number)</span> (<span class="kw">lambda</span> (x y) (tag (<span class="fu">*</span> x y))))
  (put <span class="qu">'div '(scheme-number scheme-number)</span> (<span class="kw">lambda</span> (x y) (tag (<span class="fu">/</span> x y))))
  (put <span class="qu">'make 'scheme-number</span> tag))

(<span class="kw">define</span> (make-scheme-number n)
  (apply-specific <span class="qu">'make 'scheme-number</span> n))

(<span class="kw">define</span> (rational-pkg)
  (<span class="kw">define</span> (tag x) (attach-tag <span class="qu">'rational</span> x))
  (put <span class="qu">'add '(rational rational)</span> (<span class="kw">lambda</span> (x y) (tag (add-rat x y))))
  (put <span class="qu">'sub '(rational rational)</span> (<span class="kw">lambda</span> (x y) (tag (sub-rat x y))))
  (put <span class="qu">'mul '(rational rational)</span> (<span class="kw">lambda</span> (x y) (tag (mul-rat x y))))
  (put <span class="qu">'div '(rational rational)</span> (<span class="kw">lambda</span> (x y) (tag (div-rat x y))))
  (put <span class="qu">'make 'rational</span> (<span class="kw">lambda</span> (n d) (tag (make-rat n d)))))

(<span class="kw">define</span> (make-rational n d)
  (apply-specific <span class="qu">'make 'rational</span> n d))

(<span class="kw">define</span> (complex-pkg)
  (<span class="kw">define</span> (tag z) (attach-tag <span class="qu">'complex</span> z))
  (rectangular-pkg)
  (polar-pkg)
  (put <span class="qu">'add '(complex complex)</span> (<span class="kw">lambda</span> (z1 z2) (tag (add-complex z1 z2))))
  (put <span class="qu">'sub '(complex complex)</span> (<span class="kw">lambda</span> (z1 z2) (tag (sub-complex z1 z2))))
  (put <span class="qu">'mul '(complex complex)</span> (<span class="kw">lambda</span> (z1 z2) (tag (mul-complex z1 z2))))
  (put <span class="qu">'div '(complex complex)</span> (<span class="kw">lambda</span> (z1 z2) (tag (div-complex z1 z2))))
  (put <span class="qu">'make-from-real-imag 'complex</span>
       (<span class="kw">lambda</span> (x y) (tag (make-from-real-imag x y))))
  (put <span class="qu">'make-from-mag-ang 'complex</span>
       (<span class="kw">lambda</span> (r a) (tag (make-from-mag-ang r a)))))

(<span class="kw">define</span> (make-complex-from-real-imag x y)
  (apply-specific <span class="qu">'make-from-real-imag 'complex</span> x y))
(<span class="kw">define</span> (make-complex-from-mag-ang r a)
  (apply-specific <span class="qu">'make-from-mag-ang 'complex</span> r a))

(<span class="kw">define</span> (numeric-pkg)
  (scheme-number-pkg)
  (rational-pkg)
  (complex-pkg))

(using numeric-pkg)

(add (make-scheme-number <span class="cn">1</span>) (make-scheme-number <span class="cn">2</span>))
<span class="op">=&gt;</span> (make-scheme-number <span class="cn">3</span>)

(mul (make-rational <span class="cn">1 2</span>) (make-rational <span class="cn">3 4</span>))
<span class="op">=&gt;</span> (make-rational <span class="cn">3 8</span>)

(sub (make-complex-from-mag-ang <span class="cn">1 0</span>) (make-complex-from-real-imag <span class="cn">1 1</span>))
<span class="op">=&gt;</span> (make-complex-from-real-imag <span class="cn">0 -1</span>)</code></pre>
<h3 id="ex2.77" class="anchor">
<a class="anchor__link link" href="#ex2.77" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html#%25_thm_2.77">Exercise 2.77<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="../1/1.html#1.1.4">1.1.4</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>square</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="4.html#2.4.3">2.4.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>angle</code>
</li>
<li class="flat__item nowrap">
<code>apply-generic</code>
</li>
<li class="flat__item nowrap">
<code>imag-part</code>
</li>
<li class="flat__item nowrap">
<code>magnitude</code>
</li>
<li class="flat__item nowrap">
<code>real-part</code>
</li>
<li class="flat__item nowrap">
<code>using</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.1">2.5.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>complex-pkg</code>
</li>
<li class="flat__item nowrap">
<code>make-complex-from-real-imag</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="../3/3.html#3.3.3.3">3.3.3.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>get</code>
</li>
<li class="flat__item nowrap">
<code>put</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="codeblock">(<span class="kw">define</span> (complex-components-pkg)
  (put <span class="qu">'real-part '(complex)</span> real-part)
  (put <span class="qu">'imag-part '(complex)</span> imag-part)
  (put <span class="qu">'magnitude '(complex)</span> magnitude)
  (put <span class="qu">'angle '(complex)</span> angle))</code></pre>
<p>This works because these selectors were defined in <a href="4.html#2.4.3">§&nbsp;2.4.3</a> using <code>apply-generic</code>, so now they will dispatch back to themselves when given a data object tagged <code>'complex</code>. In other words, we are telling the system to strip off the type tag and try again.</p>
<pre><code class="codeblock">(using complex-pkg complex-components-pkg)

(<span class="kw">define</span> z (make-complex-from-real-imag <span class="cn">3 4</span>))

(magnitude z)
<span class="op">=&gt;</span> (magnitude <span class="qu">'(complex rectangular 3 . 4)</span>)
<span class="op">=&gt;</span> (apply-generic <span class="qu">'magnitude '(complex rectangular 3 . 4)</span>)    <span class="at">; 1st call</span>
<span class="op">=&gt;</span> (<span class="fu">apply</span> (get <span class="qu">'magnitude '(complex)</span>) <span class="qu">'((rectangular 3 . 4))</span>)
<span class="op">=&gt;</span> (magnitude <span class="qu">'(rectangular 3 . 4)</span>)
<span class="op">=&gt;</span> (apply-generic <span class="qu">'magnitude '(rectangular 3 . 4)</span>)            <span class="at">; 2nd call</span>
<span class="op">=&gt;</span> (<span class="fu">apply</span> (get <span class="qu">'magnitude '(rectangular)</span>) <span class="qu">'((3 . 4))</span>)
<span class="op">=&gt;</span> (<span class="fu">sqrt</span> (<span class="fu">+</span> (square <span class="cn">3</span>) (square <span class="cn">4</span>)))
<span class="op">=&gt;</span> (<span class="fu">sqrt</span> (<span class="fu">+</span> <span class="cn">9 16</span>))
<span class="op">=&gt;</span> (<span class="fu">sqrt</span> <span class="cn">25</span>)
<span class="op">=&gt;</span> <span class="cn">5</span></code></pre>
<p>In this example, <code>apply-generic</code> is invoked twice: once on the outer <code>'complex</code> object and again on the inner <code>'rectangular</code> object. Each invocation strips off one type tag.</p>
<h3 id="ex2.78" class="anchor">
<a class="anchor__link link" href="#ex2.78" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html#%25_thm_2.78">Exercise 2.78<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="4.html#2.4.3">2.4.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>using</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="../3/3.html#3.3.3.3">3.3.3.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>get</code>
</li>
<li class="flat__item nowrap">
<code>put</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="codeblock">(<span class="kw">define</span> (attach-tag type-tag contents)
  (<span class="kw">if</span> (<span class="fu">eq?</span> type-tag <span class="qu">'scheme-number</span>)
      contents
      (<span class="fu">cons</span> type-tag contents)))
(<span class="kw">define</span> (type-tag datum)
  (<span class="kw">cond</span> ((<span class="fu">pair?</span> datum) (<span class="fu">car</span> datum))
        ((<span class="fu">number?</span> datum) <span class="qu">'scheme-number</span>)
        (<span class="kw">else</span> (<span class="fu">error</span> <span class="qu">'type-tag</span> <span class="cn">"bad tagged datum"</span> datum))))
(<span class="kw">define</span> (contents datum)
  (<span class="kw">cond</span> ((<span class="fu">pair?</span> datum) (<span class="fu">cdr</span> datum))
        ((<span class="fu">number?</span> datum) datum)
        (<span class="kw">else</span> (<span class="fu">error</span> <span class="qu">'contents</span> <span class="cn">"bad tagged datum"</span> datum))))

(attach-tag <span class="qu">'foo 'a</span>) <span class="op">=&gt;</span> <span class="qu">'(foo . a)</span>
(attach-tag <span class="qu">'scheme-number</span> <span class="cn">1</span>) <span class="op">=&gt;</span> <span class="cn">1</span>
(type-tag <span class="qu">'(foo . a)</span>) <span class="op">=&gt;</span> <span class="qu">'foo</span>
(type-tag <span class="cn">1</span>) <span class="op">=&gt;</span> <span class="qu">'scheme-number</span>
(contents <span class="qu">'(foo . a)</span>) <span class="op">=&gt;</span> <span class="qu">'a</span>
(contents <span class="cn">1</span>) <span class="op">=&gt;</span> <span class="cn">1</span>

(<span class="kw">paste</span> (<a href="4.html#2.4.3">:2.4.3</a> apply-generic) (<a href="#2.5.1">:2.5.1</a> add div mul scheme-number-pkg sub))

(using scheme-number-pkg)

(add <span class="cn">1 2</span>) <span class="op">=&gt;</span> <span class="cn">3</span>
(mul <span class="cn">3 4</span>) <span class="op">=&gt;</span> <span class="cn">12</span></code></pre>
<h3 id="ex2.79" class="anchor">
<a class="anchor__link link" href="#ex2.79" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html#%25_thm_2.79">Exercise 2.79<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="1.html#2.1.1">2.1.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>denom</code>
</li>
<li class="flat__item nowrap">
<code>numer</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="4.html#2.4.3">2.4.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>apply-generic</code>
</li>
<li class="flat__item nowrap">
<code>imag-part</code>
</li>
<li class="flat__item nowrap">
<code>real-part</code>
</li>
<li class="flat__item nowrap">
<code>using</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.1">2.5.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>make-complex-from-mag-ang</code>
</li>
<li class="flat__item nowrap">
<code>make-complex-from-real-imag</code>
</li>
<li class="flat__item nowrap">
<code>make-rational</code>
</li>
<li class="flat__item nowrap">
<code>make-scheme-number</code>
</li>
<li class="flat__item nowrap">
<code>numeric-pkg</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="../3/3.html#3.3.3.3">3.3.3.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>put</code>
</li>
</ul>
</li>
</ul>
</aside>
<p>In addition to Scheme numbers, rationals, and complex numbers, we’ll also make it work for integers and reals. This will be used to implement <code>drop</code> in <a href="#ex2.85">Exercise&nbsp;2.85</a>.</p>
<pre><code class="codeblock">(<span class="kw">define</span> (equ-pkg)
  (put <span class="qu">'equ? '(scheme-number scheme-number)</span> <span class="fu">=</span>)
  (put <span class="qu">'equ? '(integer integer)</span> <span class="fu">=</span>)
  (put <span class="qu">'equ? '(real real)</span> <span class="fu">=</span>)
  (put <span class="qu">'equ? '(rational rational)</span>
       (<span class="kw">lambda</span> (x y)
         (<span class="kw">and</span> (<span class="fu">=</span> (numer x) (numer y))
              (<span class="fu">=</span> (denom x) (denom y)))))
  (put <span class="qu">'equ? '(complex complex)</span>
       (<span class="kw">lambda</span> (z1 z2)
         (<span class="kw">and</span> (<span class="fu">=</span> (real-part z1) (real-part z2))
              (<span class="fu">=</span> (imag-part z1) (imag-part z2))))))

(<span class="kw">define</span> (equ? x y) (apply-generic <span class="qu">'equ?</span> x y))

(using numeric-pkg equ-pkg)

(equ? (make-scheme-number <span class="cn">1</span>) (make-scheme-number <span class="cn">1</span>)) <span class="op">=&gt;</span> <span class="cn">#t</span>
(equ? (make-scheme-number <span class="cn">1</span>) (make-scheme-number <span class="cn">2</span>)) <span class="op">=&gt;</span> <span class="cn">#f</span>
(equ? (make-rational <span class="cn">1 2</span>) (make-rational <span class="cn">2 4</span>)) <span class="op">=&gt;</span> <span class="cn">#t</span>
(equ? (make-rational <span class="cn">1 3</span>) (make-rational <span class="cn">2 4</span>)) <span class="op">=&gt;</span> <span class="cn">#f</span>
(equ? (make-complex-from-real-imag <span class="cn">1 0</span>) (make-complex-from-mag-ang <span class="cn">1 0</span>)) <span class="op">=&gt;</span> <span class="cn">#t</span>
(equ? (make-complex-from-real-imag <span class="cn">1 1</span>) (make-complex-from-mag-ang <span class="cn">1 0</span>)) <span class="op">=&gt;</span> <span class="cn">#f</span></code></pre>
<h3 id="ex2.80" class="anchor">
<a class="anchor__link link" href="#ex2.80" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html#%25_thm_2.80">Exercise 2.80<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="1.html#2.1.1">2.1.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>numer</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="4.html#2.4.3">2.4.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>apply-generic</code>
</li>
<li class="flat__item nowrap">
<code>imag-part</code>
</li>
<li class="flat__item nowrap">
<code>real-part</code>
</li>
<li class="flat__item nowrap">
<code>using</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.1">2.5.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>make-complex-from-mag-ang</code>
</li>
<li class="flat__item nowrap">
<code>make-complex-from-real-imag</code>
</li>
<li class="flat__item nowrap">
<code>make-rational</code>
</li>
<li class="flat__item nowrap">
<code>make-scheme-number</code>
</li>
<li class="flat__item nowrap">
<code>numeric-pkg</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="../3/3.html#3.3.3.3">3.3.3.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>put</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="codeblock">(<span class="kw">define</span> (zero-pkg)
  (put <span class="qu">'=zero? '(scheme-number)</span> <span class="fu">zero?</span>)
  (put <span class="qu">'=zero? '(rational)</span>
       (<span class="kw">lambda</span> (x) (<span class="fu">zero?</span> (numer x))))
  (put <span class="qu">'=zero? '(complex)</span>
       (<span class="kw">lambda</span> (x) (<span class="kw">and</span> (<span class="fu">zero?</span> (real-part x))
                        (<span class="fu">zero?</span> (imag-part x))))))

(<span class="kw">define</span> (=zero? n) (apply-generic <span class="qu">'=zero?</span> n))

(using numeric-pkg zero-pkg)

(=zero? (make-scheme-number <span class="cn">0</span>)) <span class="op">=&gt;</span> <span class="cn">#t</span>
(=zero? (make-scheme-number <span class="cn">1</span>)) <span class="op">=&gt;</span> <span class="cn">#f</span>
(=zero? (make-rational <span class="cn">0 1</span>)) <span class="op">=&gt;</span> <span class="cn">#t</span>
(=zero? (make-rational <span class="cn">1 1</span>)) <span class="op">=&gt;</span> <span class="cn">#f</span>
(=zero? (make-complex-from-mag-ang <span class="cn">0 2</span>)) <span class="op">=&gt;</span> <span class="cn">#t</span>
(=zero? (make-complex-from-real-imag <span class="cn">0 1</span>)) <span class="op">=&gt;</span> <span class="cn">#f</span></code></pre>
<h2 id="2.5.2" class="anchor">
<a class="anchor__link link" href="#2.5.2" aria-hidden="true">#</a> <span class="number">2.5.2</span> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html#%25_sec_2.5.2">Combining Data of Different Types<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h2>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="4.html#2.4.2">2.4.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>contents</code>
</li>
<li class="flat__item nowrap">
<code>type-tag</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="4.html#2.4.3">2.4.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>using</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.1">2.5.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>make-complex-from-real-imag</code>
</li>
<li class="flat__item nowrap">
<code>make-scheme-number</code>
</li>
<li class="flat__item nowrap">
<code>numeric-pkg</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="../3/3.html#3.3.3.3">3.3.3.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>get</code>
</li>
<li class="flat__item nowrap">
<code>put</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="codeblock">(<span class="kw">define</span> (get-coercion type1 type2)
  (get <span class="qu">'coerce</span> (<span class="fu">list</span> type1 type2)))
(<span class="kw">define</span> (put-coercion type1 type2 coerce)
  (put <span class="qu">'coerce</span> (<span class="fu">list</span> type1 type2) coerce))

(<span class="kw">define</span> (apply-generic op . args)
  (<span class="kw">let*</span> ((type-tags (<span class="fu">map</span> type-tag args))
         (proc (get op type-tags)))
    (<span class="kw">define</span> (err)
      (<span class="fu">error</span> <span class="qu">'apply-generic</span> <span class="cn">"no method for types"</span> op type-tags))
    (<span class="kw">if</span> proc
        (<span class="fu">apply</span> proc (<span class="fu">map</span> contents args))
        (<span class="kw">if</span> (<span class="fu">=</span> (<span class="fu">length</span> args) <span class="cn">2</span>)
            (<span class="kw">let*</span> ((type1 (<span class="fu">car</span> type-tags))
                   (type2 (<span class="fu">cadr</span> type-tags))
                   (a1 (<span class="fu">car</span> args))
                   (a2 (<span class="fu">cadr</span> args))
                   (t1-&gt;t2 (get-coercion type1 type2))
                   (t2-&gt;t1 (get-coercion type2 type1)))
              (<span class="kw">cond</span> (t1-&gt;t2 (apply-generic op (t1-&gt;t2 a1) a2))
                    (t2-&gt;t1 (apply-generic op a1 (t2-&gt;t1 a2)))
                    (<span class="kw">else</span> (err))))
            (err)))))

(<span class="kw">paste</span> (<a href="#2.5.1">:2.5.1</a> add div mul sub))

(<span class="kw">define</span> (scheme-number-to-complex-pkg)
  (<span class="kw">define</span> (coerce n)
    (make-complex-from-real-imag (contents n) <span class="cn">0</span>))
  (put-coercion <span class="qu">'scheme-number 'complex</span> coerce))

(using numeric-pkg scheme-number-to-complex-pkg)

(add (make-scheme-number <span class="cn">1</span>) (make-complex-from-real-imag <span class="cn">0 1</span>))
<span class="op">=&gt;</span> (add (make-complex-from-real-imag <span class="cn">0 1</span>) (make-scheme-number <span class="cn">1</span>))
<span class="op">=&gt;</span> (make-complex-from-real-imag <span class="cn">1 1</span>)</code></pre>
<h3 id="ex2.81" class="anchor">
<a class="anchor__link link" href="#ex2.81" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html#%25_thm_2.81">Exercise 2.81<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="4.html#2.4.2">2.4.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>attach-tag</code>
</li>
<li class="flat__item nowrap">
<code>contents</code>
</li>
<li class="flat__item nowrap">
<code>type-tag</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="4.html#2.4.3">2.4.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>using</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.1">2.5.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>complex-pkg</code>
</li>
<li class="flat__item nowrap">
<code>make-complex-from-real-imag</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.2">2.5.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>apply-generic</code>
</li>
<li class="flat__item nowrap">
<code>get-coercion</code>
</li>
<li class="flat__item nowrap">
<code>put-coercion</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="../3/3.html#3.3.3.3">3.3.3.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>get</code>
</li>
<li class="flat__item nowrap">
<code>put</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="codeblock">(<span class="kw">define</span> (identity-pkg)
  (put-coercion <span class="qu">'scheme-number 'scheme-number</span> (<span class="kw">lambda</span> (x) x))
  (put-coercion <span class="qu">'complex 'complex</span> (<span class="kw">lambda</span> (x) x)))

(<span class="kw">define</span> (exp-pkg)
  (<span class="kw">define</span> (tag x) (attach-tag <span class="qu">'scheme-number</span> x))
  (put <span class="qu">'exp '(scheme-number scheme-number)</span> (<span class="kw">lambda</span> (x y) (tag (<span class="fu">expt</span> x y)))))

(<span class="kw">define</span> (exp x y) (apply-generic <span class="qu">'exp</span> x y))</code></pre>
<ol type="a">
<li><p>If we call <code>exp</code> with two complex numbers, it will enter an infinite recursion because it will keep trying to unnecessarily coerce the first argument to the type of the second.</p>
<pre><code class="codeblock">(using complex-pkg identity-pkg exp-pkg)

(<span class="kw">define</span> z (make-complex-from-real-imag <span class="cn">0 0</span>))
(exp z z) <span class="er">=&gt;...</span></code></pre></li>
<li><p>Louis is wrong: nothing needs to be done about coercion with arguments of the same type. As long as we don’t install any self-coercions as tried above, <code>apply-generic</code> will fail to find a coercion and report an error.</p></li>
<li><p>This implementation doesn’t coerce two arguments of the same type:</p>
<pre><code class="codeblock">(<span class="kw">define</span> (new-apply-generic op . args)
  (<span class="kw">let*</span> ((type-tags (<span class="fu">map</span> type-tag args))
         (proc (get op type-tags)))
    (<span class="kw">define</span> (err)
      (<span class="fu">error</span> <span class="qu">'new-apply-generic</span> <span class="cn">"no method for types"</span> op type-tags))
    (<span class="kw">if</span> proc
        (<span class="fu">apply</span> proc (<span class="fu">map</span> contents args))
        (<span class="kw">if</span> (<span class="fu">=</span> (<span class="fu">length</span> args) <span class="cn">2</span>)
            (<span class="kw">let</span> ((type1 (<span class="fu">car</span> type-tags))
                  (type2 (<span class="fu">cadr</span> type-tags)))
              (<span class="kw">if</span> (<span class="fu">eq?</span> type1 type2)
                  (err)
                  (<span class="kw">let</span> ((a1 (<span class="fu">car</span> args))
                        (a2 (<span class="fu">cadr</span> args))
                        (t1-&gt;t2 (get-coercion type1 type2))
                        (t2-&gt;t1 (get-coercion type2 type1)))
                    (<span class="kw">cond</span> (t1-&gt;t2 (new-apply-generic op (t1-&gt;t2 a1) a2))
                          (t2-&gt;t1 (new-apply-generic op a1 (t2-&gt;t1 a2)))
                          (<span class="kw">else</span> (err))))))
            (err)))))

(<span class="kw">define</span> (exp x y) (new-apply-generic <span class="qu">'exp</span> x y))

(exp z z) <span class="er">=!&gt;</span> <span class="cn">"no method for types"</span></code></pre></li>
</ol>
<h3 id="ex2.82" class="anchor">
<a class="anchor__link link" href="#ex2.82" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html#%25_thm_2.82">Exercise 2.82<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="4.html#2.4.2">2.4.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>attach-tag</code>
</li>
<li class="flat__item nowrap">
<code>contents</code>
</li>
<li class="flat__item nowrap">
<code>type-tag</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="4.html#2.4.3">2.4.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>add-complex</code>
</li>
<li class="flat__item nowrap">
<code>using</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.1">2.5.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>make-complex-from-real-imag</code>
</li>
<li class="flat__item nowrap">
<code>make-scheme-number</code>
</li>
<li class="flat__item nowrap">
<code>numeric-pkg</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.2">2.5.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>add</code>
</li>
<li class="flat__item nowrap">
<code>get-coercion</code>
</li>
<li class="flat__item nowrap">
<code>scheme-number-to-complex-pkg</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="../3/3.html#3.3.3.3">3.3.3.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>get</code>
</li>
<li class="flat__item nowrap">
<code>put</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="codeblock">(<span class="kw">define</span> (get-coercion-or-id from to)
  (<span class="kw">if</span> (<span class="fu">eq?</span> from to)
      (<span class="kw">lambda</span> (x) x)
      (get-coercion from to)))
(<span class="kw">define</span> (all-good? xs)
  (<span class="kw">or</span> (<span class="fu">null?</span> xs)
      (<span class="kw">and</span> (<span class="fu">car</span> xs)
           (all-good? (<span class="fu">cdr</span> xs)))))
(<span class="kw">define</span> (coerce-all vals types to)
  (<span class="kw">let</span> ((cs (<span class="fu">map</span> (<span class="kw">lambda</span> (from) (get-coercion-or-id from to)) types)))
    (<span class="kw">if</span> (all-good? cs)
        (<span class="fu">map</span> (<span class="kw">lambda</span> (c v) (c v)) cs vals)
        <span class="cn">#f</span>)))

(<span class="kw">define</span> (apply-generic op . args)
  (<span class="kw">let*</span> ((type-tags (<span class="fu">map</span> type-tag args))
         (proc (get op type-tags)))
    (<span class="kw">define</span> (try tt)
      (when (<span class="fu">null?</span> tt)
        (<span class="fu">error</span> <span class="qu">'apply-generic</span> <span class="cn">"no method for types"</span> op type-tags))
      (<span class="kw">let*</span> ((try-type (<span class="fu">car</span> tt))
             (coerced-args (coerce-all args type-tags try-type))
             (new-type-tags (<span class="fu">map</span> (<span class="kw">lambda</span> (x) try-type) type-tags))
             (proc (get op new-type-tags)))
        (<span class="kw">if</span> proc
            (<span class="fu">apply</span> proc (<span class="fu">map</span> contents coerced-args))
            (try (<span class="fu">cdr</span> tt)))))
    (<span class="kw">if</span> proc
        (<span class="fu">apply</span> proc (<span class="fu">map</span> contents args))
        (try type-tags))))

(<span class="kw">define</span> (add3c-pkg)
  (<span class="kw">define</span> (tag z) (attach-tag <span class="qu">'complex</span> z))
  (put <span class="qu">'add3c '(complex complex complex)</span>
       (<span class="kw">lambda</span> (z1 z2 z3)
         (tag (add-complex z1 (add-complex z2 z3))))))

(<span class="kw">define</span> (add3c z1 z2 z3) (apply-generic <span class="qu">'add3c</span> z1 z2 z3))

(using numeric-pkg scheme-number-to-complex-pkg add3c-pkg)

(add3c (make-scheme-number <span class="cn">1</span>)
       (make-complex-from-real-imag <span class="cn">1 1</span>)
       (make-scheme-number <span class="cn">1</span>))
<span class="op">=&gt;</span> (make-complex-from-real-imag <span class="cn">3 1</span>)</code></pre>
<p>This won’t work if two complex numbers are supplied and the operation takes one real number and one complex number. It only works for operations given the exact types they need, or for operations that take arguments that are all of the same type (assuming all the necessary coercions are possible).</p>
<h3 id="ex2.83" class="anchor">
<a class="anchor__link link" href="#ex2.83" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html#%25_thm_2.83">Exercise 2.83<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="1.html#2.1.1">2.1.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>denom</code>
</li>
<li class="flat__item nowrap">
<code>numer</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="4.html#2.4.2">2.4.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>attach-tag</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="4.html#2.4.3">2.4.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>apply-generic</code>
</li>
<li class="flat__item nowrap">
<code>apply-specific</code>
</li>
<li class="flat__item nowrap">
<code>using</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.1">2.5.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>add</code>
</li>
<li class="flat__item nowrap">
<code>complex-pkg</code>
</li>
<li class="flat__item nowrap">
<code>div</code>
</li>
<li class="flat__item nowrap">
<code>make-complex-from-real-imag</code>
</li>
<li class="flat__item nowrap">
<code>make-rational</code>
</li>
<li class="flat__item nowrap">
<code>rational-pkg</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="../3/3.html#3.3.3.3">3.3.3.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>put</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="codeblock">(<span class="kw">define</span> (integer-pkg)
  (<span class="kw">define</span> (tag x) (attach-tag <span class="qu">'integer</span> x))
  (put <span class="qu">'add '(integer integer)</span> (<span class="kw">lambda</span> (x y) (tag (<span class="fu">+</span> x y))))
  (put <span class="qu">'sub '(integer integer)</span> (<span class="kw">lambda</span> (x y) (tag (<span class="fu">-</span> x y))))
  (put <span class="qu">'mul '(integer integer)</span> (<span class="kw">lambda</span> (x y) (tag (<span class="fu">*</span> x y))))
  (put <span class="qu">'div '(integer integer)</span>
       (<span class="kw">lambda</span> (x y)
         (<span class="kw">let</span> ((z (<span class="fu">/</span> x y)))
           (<span class="kw">if</span> (<span class="fu">integer?</span> z) (tag z) (make-rational x y)))))
  (put <span class="qu">'make 'integer</span> tag))

(<span class="kw">define</span> (make-integer x) (apply-specific <span class="qu">'make 'integer</span> x))

(<span class="kw">define</span> (real-pkg)
  (<span class="kw">define</span> (tag x) (attach-tag <span class="qu">'real</span> x))
  (put <span class="qu">'add '(real real)</span> (<span class="kw">lambda</span> (x y) (tag (<span class="fu">+</span> x y))))
  (put <span class="qu">'sub '(real real)</span> (<span class="kw">lambda</span> (x y) (tag (<span class="fu">-</span> x y))))
  (put <span class="qu">'mul '(real real)</span> (<span class="kw">lambda</span> (x y) (tag (<span class="fu">*</span> x y))))
  (put <span class="qu">'div '(real real)</span> (<span class="kw">lambda</span> (x y) (tag (<span class="fu">/</span> x y))))
  (put <span class="qu">'make 'real</span> tag))

(<span class="kw">define</span> (make-real x) (apply-specific <span class="qu">'make 'real</span> x))</code></pre>
<p>The <code>extended-numeric-pkg</code> is like <code>numeric-pkg</code> from <a href="#2.5.1">§&nbsp;2.5.1</a>, but it splits <code>'scheme-number</code> into <code>'integer</code> and <code>'real</code>.</p>
<pre><code class="codeblock">(<span class="kw">define</span> (extended-numeric-pkg)
  (integer-pkg)
  (rational-pkg)
  (real-pkg)
  (complex-pkg))

(<span class="kw">define</span> (raise-pkg)
  (<span class="kw">define</span> (integer-&gt;rational n)
    (make-rational n <span class="cn">1</span>))
  (<span class="kw">define</span> (rational-&gt;real x)
    (make-real (<span class="fu">inexact</span> (<span class="fu">/</span> (numer x) (denom x)))))
  (<span class="kw">define</span> (real-&gt;complex n)
    (make-complex-from-real-imag n <span class="cn">0</span>))
  (put <span class="qu">'raise '(integer)</span> integer-&gt;rational)
  (put <span class="qu">'raise '(rational)</span> rational-&gt;real)
  (put <span class="qu">'raise '(real)</span> real-&gt;complex))

(<span class="kw">define</span> (raise x) (apply-generic <span class="qu">'raise</span> x))

(using extended-numeric-pkg raise-pkg)

(add (make-integer <span class="cn">1</span>) (make-integer <span class="cn">2</span>)) <span class="op">=&gt;</span> (make-integer <span class="cn">3</span>)
(div (make-integer <span class="cn">10</span>) (make-integer <span class="cn">2</span>)) <span class="op">=&gt;</span> (make-integer <span class="cn">5</span>)
(div (make-integer <span class="cn">1</span>) (make-integer <span class="cn">2</span>)) <span class="op">=&gt;</span> (make-rational <span class="cn">1 2</span>)

(raise (make-integer <span class="cn">1</span>)) <span class="op">=&gt;</span> (make-rational <span class="cn">1 1</span>)
(raise (make-rational <span class="cn">1 2</span>)) <span class="op">=&gt;</span> (make-real <span class="cn">0.5</span>)
(raise (make-real <span class="cn">0.5</span>)) <span class="op">=&gt;</span> (make-complex-from-real-imag <span class="cn">0.5 0</span>)</code></pre>
<h3 id="ex2.84" class="anchor">
<a class="anchor__link link" href="#ex2.84" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html#%25_thm_2.84">Exercise 2.84<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="4.html#2.4.2">2.4.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>contents</code>
</li>
<li class="flat__item nowrap">
<code>type-tag</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="4.html#2.4.3">2.4.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>using</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.1">2.5.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>make-complex-from-real-imag</code>
</li>
<li class="flat__item nowrap">
<code>make-rational</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="../3/3.html#3.3.3.3">3.3.3.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>get</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.83">Ex 2.83</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>extended-numeric-pkg</code>
</li>
<li class="flat__item nowrap">
<code>make-integer</code>
</li>
<li class="flat__item nowrap">
<code>make-real</code>
</li>
<li class="flat__item nowrap">
<code>raise</code>
</li>
<li class="flat__item nowrap">
<code>raise-pkg</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="codeblock">(<span class="kw">define</span> numeric-tower
  <span class="qu">'(integer rational real complex)</span>)

(<span class="kw">define</span> (tower-bottom? type) (<span class="fu">eq?</span> type <span class="qu">'integer</span>))
(<span class="kw">define</span> (tower-top? type) (<span class="fu">eq?</span> type <span class="qu">'complex</span>))

(<span class="kw">define</span> (tower-position type)
  (<span class="kw">define</span> (iter tower n)
    (<span class="kw">cond</span> ((<span class="fu">null?</span> tower) <span class="cn">#f</span>)
          ((<span class="fu">eq?</span> type (<span class="fu">car</span> tower)) n)
          (<span class="kw">else</span> (iter (<span class="fu">cdr</span> tower) (<span class="fu">+</span> n <span class="cn">1</span>)))))
  (iter numeric-tower <span class="cn">0</span>))

(<span class="kw">define</span> (apply-generic op . args)
  (<span class="kw">let*</span> ((type-tags (<span class="fu">map</span> type-tag args))
         (vals (<span class="fu">map</span> contents args))
         (proc (get op type-tags)))
    (<span class="kw">define</span> (err)
      (<span class="fu">error</span> <span class="qu">'apply-generic</span> <span class="cn">"no method for types"</span> op type-tags))
    (<span class="kw">cond</span> (proc (<span class="fu">apply</span> proc vals))
          ((<span class="fu">null?</span> args) (err))
          ((<span class="fu">null?</span> (<span class="fu">cdr</span> args))
           (<span class="kw">if</span> (tower-top? (<span class="fu">car</span> type-tags))
               (err)
               (apply-generic op (raise (<span class="fu">car</span> args)))))
          ((<span class="fu">null?</span> (<span class="fu">cddr</span> args))
           (<span class="kw">let</span> ((a1 (<span class="fu">car</span> args))
                 (a2 (<span class="fu">cadr</span> args))
                 (p1 (tower-position (<span class="fu">car</span> type-tags)))
                 (p2 (tower-position (<span class="fu">cadr</span> type-tags))))
             (<span class="kw">cond</span> ((<span class="kw">or</span> (<span class="fu">not</span> p1) (<span class="fu">not</span> p2) (<span class="fu">=</span> p1 p2)) (err))
                   ((<span class="fu">&lt;</span> p1 p2) (apply-generic op (raise a1) a2))
                   (<span class="kw">else</span> (apply-generic op a1 (raise a2))))))
          (<span class="kw">else</span> (err)))))

(<span class="kw">paste</span> (<a href="#2.5.1">:2.5.1</a> add div mul sub))

(using extended-numeric-pkg raise-pkg)

(add (make-integer <span class="cn">1</span>) (make-complex-from-real-imag <span class="cn">2.0 3.0</span>))
<span class="op">=&gt;</span> (make-complex-from-real-imag <span class="cn">3.0 3.0</span>)

(add (make-rational <span class="cn">1 2</span>) (make-real <span class="cn">0.5</span>))
<span class="op">=&gt;</span> (make-real <span class="cn">1.0</span>)

(div (make-real <span class="cn">1</span>) (make-integer <span class="cn">2</span>))
<span class="op">=&gt;</span> (make-real <span class="cn">0.5</span>)</code></pre>
<h3 id="ex2.85" class="anchor">
<a class="anchor__link link" href="#ex2.85" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html#%25_thm_2.85">Exercise 2.85<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="1.html#2.1.1">2.1.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>denom</code>
</li>
<li class="flat__item nowrap">
<code>numer</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="4.html#2.4.2">2.4.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>contents</code>
</li>
<li class="flat__item nowrap">
<code>type-tag</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="4.html#2.4.3">2.4.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>real-part</code>
</li>
<li class="flat__item nowrap">
<code>using</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.1">2.5.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>make-complex-from-real-imag</code>
</li>
<li class="flat__item nowrap">
<code>make-rational</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="../3/3.html#3.3.3.3">3.3.3.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>get</code>
</li>
<li class="flat__item nowrap">
<code>put</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.79">Ex 2.79</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>equ-pkg</code>
</li>
<li class="flat__item nowrap">
<code>equ?</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.83">Ex 2.83</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>extended-numeric-pkg</code>
</li>
<li class="flat__item nowrap">
<code>make-integer</code>
</li>
<li class="flat__item nowrap">
<code>make-real</code>
</li>
<li class="flat__item nowrap">
<code>raise</code>
</li>
<li class="flat__item nowrap">
<code>raise-pkg</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.84">Ex 2.84</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>tower-bottom?</code>
</li>
<li class="flat__item nowrap">
<code>tower-position</code>
</li>
<li class="flat__item nowrap">
<code>tower-top?</code>
</li>
</ul>
</li>
</ul>
</aside>
<p>Projection from reals to rationals is the hardest. Instead of designing an algorithm to find the nearest rational, we’ll cheat and use the procedures <code>exact</code>, <code>numerator</code>, and <code>denominator</code> which deal with Scheme’s built-in rational numbers.</p>
<pre><code class="codeblock">(<span class="kw">define</span> (project-pkg)
  (<span class="kw">define</span> (complex-&gt;real x)
    (make-real (real-part x)))
  (<span class="kw">define</span> (real-&gt;rational x)
    (<span class="kw">let</span> ((y (<span class="fu">exact</span> x)))
      (make-rational (<span class="fu">numerator</span> y) (<span class="fu">denominator</span> y))))
  (<span class="kw">define</span> (rational-&gt;integer r)
    (make-integer (<span class="fu">quotient</span> (numer r) (denom r))))
  (put <span class="qu">'project '(complex)</span> complex-&gt;real)
  (put <span class="qu">'project '(real)</span> real-&gt;rational)
  (put <span class="qu">'project '(rational)</span> rational-&gt;integer))

(<span class="kw">define</span> (project x) (apply-generic <span class="qu">'project</span> x))

(<span class="kw">define</span> (drop x)
  (<span class="kw">let</span> ((type (type-tag x)))
    (<span class="kw">if</span> (tower-bottom? type)
        x
        (<span class="kw">let*</span> ((down (project x))
               (down-up (raise down)))
          (<span class="kw">if</span> (equ? x down-up) (drop down) x)))))

(<span class="kw">define</span> (apply-generic op . args)
  (<span class="kw">let*</span> ((type-tags (<span class="fu">map</span> type-tag args))
         (vals (<span class="fu">map</span> contents args))
         (proc (get op type-tags)))
    (<span class="kw">define</span> (err)
      (<span class="fu">error</span> <span class="qu">'apply-generic</span> <span class="cn">"no method for types"</span> op type-tags))
    (<span class="kw">cond</span> (proc
           (<span class="kw">let</span> ((result (<span class="fu">apply</span> proc vals)))
             (<span class="kw">if</span> (<span class="kw">and</span> (<span class="fu">pair?</span> result)
                      (tower-position (type-tag result))
                      (<span class="fu">not</span> (<span class="kw">or</span> (<span class="fu">eq?</span> op <span class="qu">'raise</span>) (<span class="fu">eq?</span> op <span class="qu">'project</span>))))
                 (drop result)
                 result)))
          ((<span class="fu">null?</span> args) (err))
          ((<span class="fu">null?</span> (<span class="fu">cdr</span> args))
           (<span class="kw">if</span> (tower-top? (<span class="fu">car</span> type-tags))
               (err)
               (apply-generic op (raise (<span class="fu">car</span> args)))))
          ((<span class="fu">null?</span> (<span class="fu">cddr</span> args))
           (<span class="kw">let</span> ((a1 (<span class="fu">car</span> args))
                 (a2 (<span class="fu">cadr</span> args))
                 (p1 (tower-position (<span class="fu">car</span> type-tags)))
                 (p2 (tower-position (<span class="fu">cadr</span> type-tags))))
             (<span class="kw">cond</span> ((<span class="kw">or</span> (<span class="fu">not</span> p1) (<span class="fu">not</span> p2) (<span class="fu">=</span> p1 p2)) (err))
                   ((<span class="fu">&lt;</span> p1 p2) (apply-generic op (raise a1) a2))
                   (<span class="kw">else</span> (apply-generic op a1 (raise a2))))))
          (<span class="kw">else</span> (err)))))

(<span class="kw">paste</span> (<a href="#2.5.1">:2.5.1</a> add div mul sub))

(using extended-numeric-pkg equ-pkg raise-pkg project-pkg)

(div (make-real <span class="cn">1</span>) (make-complex-from-real-imag <span class="cn">2 0</span>)) <span class="op">=&gt;</span> (make-rational <span class="cn">1 2</span>)
(add (make-complex-from-real-imag <span class="cn">1 0</span>) (make-integer <span class="cn">1</span>)) <span class="op">=&gt;</span> (make-integer <span class="cn">2</span>)
(mul (make-rational <span class="cn">3 2</span>) (make-real <span class="cn">8</span>)) <span class="op">=&gt;</span> (make-integer <span class="cn">12</span>)
(sub (make-real <span class="cn">2</span>) (make-real <span class="cn">0.5</span>)) <span class="op">=&gt;</span> (make-rational <span class="cn">3 2</span>)</code></pre>
<h3 id="ex2.86" class="anchor">
<a class="anchor__link link" href="#ex2.86" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html#%25_thm_2.86">Exercise 2.86<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="1.html#2.1.1">2.1.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>denom</code>
</li>
<li class="flat__item nowrap">
<code>numer</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="4.html#2.4.2">2.4.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>attach-tag</code>
</li>
<li class="flat__item nowrap">
<code>contents</code>
</li>
<li class="flat__item nowrap">
<code>type-tag</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="4.html#2.4.3">2.4.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>angle</code>
</li>
<li class="flat__item nowrap">
<code>apply-specific</code>
</li>
<li class="flat__item nowrap">
<code>imag-part</code>
</li>
<li class="flat__item nowrap">
<code>magnitude</code>
</li>
<li class="flat__item nowrap">
<code>make-from-mag-ang</code>
</li>
<li class="flat__item nowrap">
<code>make-from-real-imag</code>
</li>
<li class="flat__item nowrap">
<code>real-part</code>
</li>
<li class="flat__item nowrap">
<code>using</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.1">2.5.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>make-complex-from-mag-ang</code>
</li>
<li class="flat__item nowrap">
<code>make-complex-from-real-imag</code>
</li>
<li class="flat__item nowrap">
<code>make-rational</code>
</li>
<li class="flat__item nowrap">
<code>rational-pkg</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="../3/3.html#3.3.3.3">3.3.3.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>put</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.79">Ex 2.79</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>equ-pkg</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.83">Ex 2.83</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>integer-pkg</code>
</li>
<li class="flat__item nowrap">
<code>make-integer</code>
</li>
<li class="flat__item nowrap">
<code>make-real</code>
</li>
<li class="flat__item nowrap">
<code>raise</code>
</li>
<li class="flat__item nowrap">
<code>raise-pkg</code>
</li>
<li class="flat__item nowrap">
<code>real-pkg</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.85">Ex 2.85</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>add</code>
</li>
<li class="flat__item nowrap">
<code>apply-generic</code>
</li>
<li class="flat__item nowrap">
<code>div</code>
</li>
<li class="flat__item nowrap">
<code>mul</code>
</li>
<li class="flat__item nowrap">
<code>project-pkg</code>
</li>
<li class="flat__item nowrap">
<code>sub</code>
</li>
</ul>
</li>
</ul>
</aside>
<p>To support complex numbers whose components are themselves tagged data objects, we must rewrite all the complex number operations using generic procedures like <code>add</code> instead of specific procedures like <code>+</code>. Before we can do that, we need generic procedures for squares, square roots, and trigonometric functions. Thanks to the automatic coercion in <a href="#ex2.85">Exercise&nbsp;2.85</a>’s <code>apply-generic</code>, we only need to define them for <code>'real</code>.</p>
<pre><code class="codeblock">(<span class="kw">define</span> (square x) (mul x x))

(<span class="kw">define</span> (sqrt-trig-pkg)
  (<span class="kw">define</span> (tag x) (attach-tag <span class="qu">'real</span> x))
  (put <span class="qu">'square-root '(real)</span> (<span class="kw">lambda</span> (x) (tag (<span class="fu">sqrt</span> x))))
  (put <span class="qu">'sine '(real)</span> (<span class="kw">lambda</span> (x) (tag (<span class="fu">sin</span> x))))
  (put <span class="qu">'cosine '(real)</span> (<span class="kw">lambda</span> (x) (tag (<span class="fu">cos</span> x))))
  (put <span class="qu">'atan2 '(real real)</span> (<span class="kw">lambda</span> (y x) (tag (<span class="fu">atan</span> y x)))))

(<span class="kw">define</span> (square-root x) (apply-generic <span class="qu">'square-root</span> x))
(<span class="kw">define</span> (sine x) (apply-generic <span class="qu">'sine</span> x))
(<span class="kw">define</span> (cosine x) (apply-generic <span class="qu">'cosine</span> x))
(<span class="kw">define</span> (atan2 x y) (apply-generic <span class="qu">'atan2</span> x y))</code></pre>
<p>Now we can rewrite the rectangular and polar packages:</p>
<pre><code class="codeblock">(<span class="kw">define</span> (rectangular-pkg)
  (<span class="kw">define</span> real-part <span class="fu">car</span>)
  (<span class="kw">define</span> imag-part <span class="fu">cdr</span>)
  (<span class="kw">define</span> make-from-real-imag <span class="fu">cons</span>)
  (<span class="kw">define</span> (magnitude z)
    (square-root (add (square (real-part z))
                      (square (imag-part z)))))
  (<span class="kw">define</span> (angle z)
    (atan2 (imag-part z) (real-part z)))
  (<span class="kw">define</span> (make-from-mag-ang r a)
    (<span class="fu">cons</span> (mul r (cosine a)) (mul r (sine a))))
  (<span class="kw">define</span> (tag x) (attach-tag <span class="qu">'rectangular</span> x))
  (put <span class="qu">'real-part '(rectangular)</span> real-part)
  (put <span class="qu">'imag-part '(rectangular)</span> imag-part)
  (put <span class="qu">'magnitude '(rectangular)</span> magnitude)
  (put <span class="qu">'angle '(rectangular)</span> angle)
  (put <span class="qu">'make-from-real-imag 'rectangular</span>
       (<span class="kw">lambda</span> (x y) (tag (make-from-real-imag x y))))
  (put <span class="qu">'make-from-mag-ang 'rectangular</span>
       (<span class="kw">lambda</span> (r a) (tag (make-from-mag-ang r a)))))

(<span class="kw">define</span> (polar-pkg)
  (<span class="kw">define</span> magnitude <span class="fu">car</span>)
  (<span class="kw">define</span> angle <span class="fu">cdr</span>)
  (<span class="kw">define</span> make-from-mag-ang <span class="fu">cons</span>)
  (<span class="kw">define</span> (real-part z)
    (mul (magnitude z) (cosine (angle z))))
  (<span class="kw">define</span> (imag-part z)
    (mul (magnitude z) (sine (angle z))))
  (<span class="kw">define</span> (make-from-real-imag x y)
    (<span class="fu">cons</span> (square-root (add (square x) (square y)))
          (atan2 y x)))
  (<span class="kw">define</span> (tag x) (attach-tag <span class="qu">'polar</span> x))
  (put <span class="qu">'real-part '(polar)</span> real-part)
  (put <span class="qu">'imag-part '(polar)</span> imag-part)
  (put <span class="qu">'magnitude '(polar)</span> magnitude)
  (put <span class="qu">'angle '(polar)</span> angle)
  (put <span class="qu">'make-from-real-imag 'polar</span>
       (<span class="kw">lambda</span> (x y) (tag (make-from-real-imag x y))))
  (put <span class="qu">'make-from-mag-ang 'polar</span>
       (<span class="kw">lambda</span> (r a) (tag (make-from-mag-ang r a)))))</code></pre>
<p>Next, we will rewrite the complex package:</p>
<pre><code class="codeblock">(<span class="kw">define</span> (add-complex z1 z2)
  (make-from-real-imag (add (real-part z1) (real-part z2))
                       (add (imag-part z1) (imag-part z2))))
(<span class="kw">define</span> (sub-complex z1 z2)
  (make-from-real-imag (sub (real-part z1) (real-part z2))
                       (sub (imag-part z1) (imag-part z2))))
(<span class="kw">define</span> (mul-complex z1 z2)
  (make-from-mag-ang (mul (magnitude z1) (magnitude z2))
                     (add (angle z1) (angle z2))))
(<span class="kw">define</span> (div-complex z1 z2)
  (make-from-mag-ang (div (magnitude z1) (magnitude z2))
                     (sub (angle z1) (angle z2))))

(<span class="kw">paste</span> (<a href="#2.5.1">:2.5.1</a> complex-pkg))</code></pre>
<p>Finally, we need to fix some procedures in other packages that assumed a complex number’s real part and imaginary part were plain Scheme numbers. Fixing <code>equ?</code> is tricky because the <code>equ?</code> from <a href="#ex2.79">Exercise&nbsp;2.79</a> used the old <code>apply-generic</code> without coercion. That was fine since we only use it in <code>drop</code> on <code>x</code> and <code>(raise (project x))</code>, which must be the same type. But now, if they are complex numbers, their component types might be different. So in the new <code>'complex</code> implementation of <code>equ?</code>, we need to recursively invoke a version of <code>equ?</code> that supports coercion.</p>
<pre><code class="codeblock">(<span class="kw">define</span> (complex-patch-pkg)
  (<span class="kw">define</span> (equ-with-coercion? x y) (apply-generic <span class="qu">'equ?</span> x y))
  (put <span class="qu">'equ? '(complex complex)</span>
       (<span class="kw">lambda</span> (z1 z2)
         (<span class="kw">and</span> (equ-with-coercion? (real-part z1) (real-part z2))
              (equ-with-coercion? (imag-part z1) (imag-part z2)))))
  (put <span class="qu">'raise '(real)</span>
       (<span class="kw">lambda</span> (x) (make-complex-from-real-imag (make-real x) (make-real <span class="cn">0</span>))))
  (put <span class="qu">'project '(complex)</span>
       (<span class="kw">lambda</span> (x)
         (<span class="kw">let</span> ((r (real-part x)))
           (<span class="kw">case</span> (type-tag r)
             ((real) r)
             ((rational) (raise r))
             ((integer) (raise (raise r))))))))</code></pre>
<p>Putting it all together:</p>
<pre><code class="codeblock">(<span class="kw">define</span> (final-numeric-pkg)
  (integer-pkg)
  (rational-pkg)
  (real-pkg)
  (complex-pkg)
  (sqrt-trig-pkg)
  (equ-pkg)
  (raise-pkg)
  (project-pkg)
  (complex-patch-pkg))

(using final-numeric-pkg)

(add (make-complex-from-mag-ang (make-rational <span class="cn">1 2</span>) (make-integer <span class="cn">0</span>))
     (make-complex-from-real-imag (make-rational <span class="cn">3 4</span>) (make-real <span class="cn">2</span>)))
<span class="op">=&gt;</span> (make-complex-from-real-imag (make-rational <span class="cn">5 4</span>) (make-integer <span class="cn">2</span>))

(div (make-complex-from-mag-ang (make-integer <span class="cn">3</span>) (make-real <span class="cn">1</span>))
     (make-complex-from-mag-ang (make-rational <span class="cn">1 2</span>) (make-real <span class="cn">1</span>)))
<span class="op">=&gt;</span> (make-integer <span class="cn">6</span>)</code></pre>
<h2 id="2.5.3" class="anchor">
<a class="anchor__link link" href="#2.5.3" aria-hidden="true">#</a> <span class="number">2.5.3</span> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html#%25_sec_2.5.3">Example: Symbolic Algebra<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h2>
<h3 id="2.5.3.1" class="anchor">
<a class="anchor__link link" href="#2.5.3.1" aria-hidden="true">#</a> <span class="number">2.5.3.1</span> Arithmetic on polynomials
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="3.html#2.3.2">2.3.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>same-variable?</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.3.2">2.5.3.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>adjoin-term</code>
</li>
<li class="flat__item nowrap">
<code>coeff</code>
</li>
<li class="flat__item nowrap">
<code>empty-termlist?</code>
</li>
<li class="flat__item nowrap">
<code>first-term</code>
</li>
<li class="flat__item nowrap">
<code>make-term</code>
</li>
<li class="flat__item nowrap">
<code>order</code>
</li>
<li class="flat__item nowrap">
<code>rest-terms</code>
</li>
<li class="flat__item nowrap">
<code>the-empty-termlist</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="../3/3.html#3.3.3.3">3.3.3.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>put</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.78">Ex 2.78</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>add</code>
</li>
<li class="flat__item nowrap">
<code>attach-tag</code>
</li>
<li class="flat__item nowrap">
<code>mul</code>
</li>
</ul>
</li>
</ul>
</aside>
<p>We are following <a href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html#footnote_Temp_303">Footnote&nbsp;58</a> and using the generic arithmetic system from <a href="#ex2.78">Exercise&nbsp;2.78</a>, where Scheme numbers are not explicitly tagged.</p>
<pre><code class="codeblock">(<span class="kw">define</span> make-poly <span class="fu">cons</span>)
(<span class="kw">define</span> variable <span class="fu">car</span>)
(<span class="kw">define</span> term-list <span class="fu">cdr</span>)

(<span class="kw">define</span> (polynomial-pkg)
  (<span class="kw">define</span> (add-poly p1 p2)
    (<span class="kw">if</span> (same-variable? (variable p1) (variable p2))
        (make-poly (variable p1)
                   (add-terms (term-list p1) (term-list p2)))
        (<span class="fu">error</span> <span class="qu">'add-poly</span> <span class="cn">"polys not in same var"</span> p1 p2)))
  (<span class="kw">define</span> (mul-poly p1 p2)
    (<span class="kw">if</span> (same-variable? (variable p1) (variable p2))
        (make-poly (variable p1)
                   (mul-terms (term-list p1) (term-list p2)))
        (<span class="fu">error</span> <span class="qu">'mul-poly</span> <span class="cn">"polys not in same var"</span> p1 p2)))
  (<span class="kw">define</span> (tag p) (attach-tag <span class="qu">'polynomial</span> p))
  (put <span class="qu">'make 'polynomial</span> (<span class="kw">lambda</span> (var terms) (tag (make-poly var terms))))
  (put <span class="qu">'add '(polynomial polynomial)</span> (<span class="kw">lambda</span> (p1 p2) (tag (add-poly p1 p2))))
  (put <span class="qu">'mul '(polynomial polynomial)</span> (<span class="kw">lambda</span> (p1 p2) (tag (mul-poly p1 p2)))))

(<span class="kw">define</span> (add-terms l1 l2)
  (<span class="kw">cond</span> ((empty-termlist? l1) l2)
        ((empty-termlist? l2) l1)
        (<span class="kw">else</span>
         (<span class="kw">let</span> ((t1 (first-term l1))
               (t2 (first-term l2)))
           (<span class="kw">cond</span> ((<span class="fu">&gt;</span> (order t1) (order t2))
                  (adjoin-term t1
                               (add-terms (rest-terms l1) l2)))
                 ((<span class="fu">&lt;</span> (order t1) (order t2))
                  (adjoin-term t2
                               (add-terms l1 (rest-terms l2))))
                 (<span class="kw">else</span>
                  (adjoin-term (make-term (order t1)
                                          (add (coeff t1) (coeff t2)))
                               (add-terms (rest-terms l1)
                                          (rest-terms l2)))))))))

(<span class="kw">define</span> (mul-terms l1 l2)
  (<span class="kw">if</span> (empty-termlist? l1)
      (the-empty-termlist)
      (add-terms (mul-term-by-all-terms (first-term l1) l2)
                 (mul-terms (rest-terms l1) l2))))

(<span class="kw">define</span> (mul-term-by-all-terms t1 l)
  (<span class="kw">if</span> (empty-termlist? l)
      (the-empty-termlist)
      (<span class="kw">let</span> ((t2 (first-term l)))
        (adjoin-term (make-term (<span class="fu">+</span> (order t1) (order t2))
                                (mul (coeff t1) (coeff t2)))
                     (mul-term-by-all-terms t1 (rest-terms l))))))</code></pre>
<h3 id="2.5.3.2" class="anchor">
<a class="anchor__link link" href="#2.5.3.2" aria-hidden="true">#</a> <span class="number">2.5.3.2</span> Representing term lists
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="4.html#2.4.3">2.4.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>apply-specific</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="../3/3.html#3.3.3.3">3.3.3.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>put</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.78">Ex 2.78</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>apply-generic</code>
</li>
<li class="flat__item nowrap">
<code>attach-tag</code>
</li>
</ul>
</li>
</ul>
</aside>
<p>We have to use <code>apply-generic</code> below because importing <code>=zero?</code> from <a href="#ex2.87">Exercise&nbsp;2.87</a> would cause an import cycle.</p>
<pre><code class="codeblock">(<span class="kw">define</span> (adjoin-term term term-list)
  (<span class="kw">if</span> (apply-generic <span class="qu">'=zero?</span> (coeff term))
      term-list
      (<span class="fu">cons</span> term term-list)))

(<span class="kw">define</span> (the-empty-termlist) <span class="qu">'()</span>)
(<span class="kw">define</span> first-term <span class="fu">car</span>)
(<span class="kw">define</span> rest-terms <span class="fu">cdr</span>)
(<span class="kw">define</span> empty-termlist? <span class="fu">null?</span>)

(<span class="kw">define</span> make-term <span class="fu">list</span>)
(<span class="kw">define</span> order <span class="fu">car</span>)
(<span class="kw">define</span> coeff <span class="fu">cadr</span>)

(<span class="kw">define</span> (make-polynomial var terms)
  (apply-specific <span class="qu">'make 'polynomial</span> var terms))</code></pre>
<p>This package is used in <a href="#ex2.90">Exercise&nbsp;2.90</a>:</p>
<pre><code class="codeblock">(<span class="kw">define</span> (sparse-termlist-pkg)
  (<span class="kw">define</span> (tag tl) (attach-tag <span class="qu">'sparse-termlist</span> tl))
  (put <span class="qu">'make 'sparse-termlist</span> tag)
  <span class="at">;; Curried so that it only dispatches on the term list, not the term.</span>
  (put <span class="qu">'adjoin-term '(sparse-termlist)</span>
       (<span class="kw">lambda</span> (tl) (<span class="kw">lambda</span> (t) (tag (adjoin-term t tl)))))
  (put <span class="qu">'the-empty-termlist 'sparse-termlist</span>
       (<span class="kw">lambda</span> () (tag (the-empty-termlist))))
  (put <span class="qu">'first-term '(sparse-termlist)</span> first-term)
  (put <span class="qu">'rest-terms '(sparse-termlist)</span> (<span class="kw">lambda</span> (tl) (tag (rest-terms tl))))
  (put <span class="qu">'empty-termlist? '(sparse-termlist)</span> empty-termlist?))</code></pre>
<h3 id="ex2.87" class="anchor">
<a class="anchor__link link" href="#ex2.87" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html#%25_thm_2.87">Exercise 2.87<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="4.html#2.4.3">2.4.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>using</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.3.1">2.5.3.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>polynomial-pkg</code>
</li>
<li class="flat__item nowrap">
<code>term-list</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.3.2">2.5.3.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>coeff</code>
</li>
<li class="flat__item nowrap">
<code>empty-termlist?</code>
</li>
<li class="flat__item nowrap">
<code>first-term</code>
</li>
<li class="flat__item nowrap">
<code>make-polynomial</code>
</li>
<li class="flat__item nowrap">
<code>rest-terms</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="../3/3.html#3.3.3.3">3.3.3.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>put</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.78">Ex 2.78</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>add</code>
</li>
<li class="flat__item nowrap">
<code>apply-generic</code>
</li>
<li class="flat__item nowrap">
<code>mul</code>
</li>
<li class="flat__item nowrap">
<code>scheme-number-pkg</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="codeblock">(<span class="kw">define</span> (zero-pkg)
  (<span class="kw">define</span> (poly-zero? p)
    (<span class="kw">define</span> (all-zero? terms)
      (<span class="kw">or</span> (empty-termlist? terms)
          (<span class="kw">and</span> (=zero? (coeff (first-term terms)))
               (all-zero? (rest-terms terms)))))
    (all-zero? (term-list p)))
  (put <span class="qu">'=zero? '(scheme-number)</span> <span class="fu">zero?</span>)
  (put <span class="qu">'=zero? '(polynomial)</span> poly-zero?))

(<span class="kw">define</span> (=zero? n) (apply-generic <span class="qu">'=zero?</span> n))

(using scheme-number-pkg polynomial-pkg zero-pkg)

(=zero? (make-polynomial <span class="qu">'x '()</span>)) <span class="op">=&gt;</span> <span class="cn">#t</span>
(=zero? (make-polynomial <span class="qu">'x '((2 0))</span>)) <span class="op">=&gt;</span> <span class="cn">#t</span>
(=zero? (make-polynomial <span class="qu">'x '((2 1) (1 0))</span>)) <span class="op">=&gt;</span> <span class="cn">#f</span>

(add (make-polynomial <span class="qu">'x '((100 1) (2 3))</span>)
     (make-polynomial <span class="qu">'x '((3 1) (2 2) (0 5))</span>))
<span class="op">=&gt;</span> (make-polynomial <span class="qu">'x '((100 1) (3 1) (2 5) (0 5))</span>)

(mul (make-polynomial <span class="qu">'x '((2 1) (0 1))</span>)
     (make-polynomial <span class="qu">'x '((1 2))</span>))
<span class="op">=&gt;</span> (make-polynomial <span class="qu">'x '((3 2) (1 2))</span>)

(add (make-polynomial <span class="qu">'x '()</span>) (make-polynomial <span class="qu">'y '()</span>))
<span class="er">=!&gt;</span> <span class="cn">"polys not in same var"</span></code></pre>
<h3 id="ex2.88" class="anchor">
<a class="anchor__link link" href="#ex2.88" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html#%25_thm_2.88">Exercise 2.88<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="4.html#2.4.3">2.4.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>using</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.3.1">2.5.3.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>polynomial-pkg</code>
</li>
<li class="flat__item nowrap">
<code>term-list</code>
</li>
<li class="flat__item nowrap">
<code>variable</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.3.2">2.5.3.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>adjoin-term</code>
</li>
<li class="flat__item nowrap">
<code>coeff</code>
</li>
<li class="flat__item nowrap">
<code>empty-termlist?</code>
</li>
<li class="flat__item nowrap">
<code>first-term</code>
</li>
<li class="flat__item nowrap">
<code>make-polynomial</code>
</li>
<li class="flat__item nowrap">
<code>make-term</code>
</li>
<li class="flat__item nowrap">
<code>order</code>
</li>
<li class="flat__item nowrap">
<code>rest-terms</code>
</li>
<li class="flat__item nowrap">
<code>the-empty-termlist</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="../3/3.html#3.3.3.3">3.3.3.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>put</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.78">Ex 2.78</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>add</code>
</li>
<li class="flat__item nowrap">
<code>apply-generic</code>
</li>
<li class="flat__item nowrap">
<code>scheme-number-pkg</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.87">Ex 2.87</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>zero-pkg</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="codeblock">(<span class="kw">define</span> (negate-terms tl)
  (<span class="kw">if</span> (empty-termlist? tl)
      (the-empty-termlist)
      (<span class="kw">let*</span> ((term (first-term tl))
             (new-term (make-term (order term) (negate (coeff term)))))
        (adjoin-term new-term
                     (negate-terms (rest-terms tl))))))

(<span class="kw">define</span> (negate-pkg)
  (put <span class="qu">'negate '(scheme-number)</span> <span class="fu">-</span>)
  (put <span class="qu">'negate '(polynomial)</span>
       (<span class="kw">lambda</span> (p)
         (make-polynomial (variable p) (negate-terms (term-list p))))))

(<span class="kw">define</span> (negate x) (apply-generic <span class="qu">'negate</span> x))
(<span class="kw">define</span> (sub x y) (add x (negate y)))

(using scheme-number-pkg polynomial-pkg zero-pkg negate-pkg)

(negate <span class="cn">1</span>) <span class="op">=&gt;</span> <span class="cn">-1</span>
(sub <span class="cn">5 2</span>) <span class="op">=&gt;</span> <span class="cn">3</span>

(negate (make-polynomial <span class="qu">'x '((2 1))</span>))
<span class="op">=&gt;</span> (make-polynomial <span class="qu">'x '((2 -1))</span>)

(sub (make-polynomial <span class="qu">'x '((3 1) (1 2))</span>)
     (make-polynomial <span class="qu">'x '((2 2) (1 1) (0 -1))</span>))
<span class="op">=&gt;</span> (make-polynomial <span class="qu">'x '((3 1) (2 -2) (1 1) (0 1))</span>)</code></pre>
<h3 id="ex2.89" class="anchor">
<a class="anchor__link link" href="#ex2.89" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html#%25_thm_2.89">Exercise 2.89<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="#2.5.3.2">2.5.3.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>coeff</code>
</li>
<li class="flat__item nowrap">
<code>empty-termlist?</code>
</li>
<li class="flat__item nowrap">
<code>make-term</code>
</li>
<li class="flat__item nowrap">
<code>order</code>
</li>
<li class="flat__item nowrap">
<code>rest-terms</code>
</li>
<li class="flat__item nowrap">
<code>the-empty-termlist</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="../3/3.html#3.3.3.3">3.3.3.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>put</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.78">Ex 2.78</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>attach-tag</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.87">Ex 2.87</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>=zero?</code>
</li>
</ul>
</li>
</ul>
</aside>
<p>As mentioned in <a href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html#footnote_Temp_304">Footnote&nbsp;59</a>, we are assuming that <code>adjoin-term</code> is always called with a higher-order term than appears in the list.</p>
<pre><code class="codeblock">(<span class="kw">define</span> (adjoin-term term term-list)
  (<span class="kw">let</span> ((o (order term)))
    (<span class="kw">define</span> (iter term-list len)
      (<span class="kw">cond</span> ((<span class="fu">&lt;</span> len o) (iter (<span class="fu">cons</span> <span class="cn">0</span> term-list) (<span class="fu">+</span> len <span class="cn">1</span>)))
            ((<span class="fu">=</span> len o) (<span class="fu">cons</span> (coeff term) term-list))
            (<span class="kw">else</span> (<span class="fu">error</span> <span class="qu">'adjoin-term</span> <span class="cn">"term list already has order"</span> o))))
    (<span class="kw">if</span> (=zero? (coeff term))
        term-list
        (iter term-list (<span class="fu">length</span> term-list)))))

(<span class="kw">define</span> (first-term term-list)
  (make-term (<span class="fu">-</span> (<span class="fu">length</span> term-list) <span class="cn">1</span>)
             (<span class="fu">car</span> term-list)))

(adjoin-term (make-term <span class="cn">3 1</span>) (the-empty-termlist)) <span class="op">=&gt;</span> <span class="qu">'(1 0 0 0)</span>
(first-term <span class="qu">'(1 0 0 0)</span>) <span class="op">=&gt;</span> (make-term <span class="cn">3 1</span>)

(adjoin-term (make-term <span class="cn">0 1</span>) <span class="qu">'(2)</span>) <span class="er">=!&gt;</span> <span class="cn">"term list already has order: 0"</span></code></pre>
<p>This package is used in <a href="#ex2.90">Exercise&nbsp;2.90</a>:</p>
<pre><code class="codeblock">(<span class="kw">define</span> (dense-termlist-pkg)
  (<span class="kw">define</span> (tag tl) (attach-tag <span class="qu">'dense-termlist</span> tl))
  (put <span class="qu">'make 'dense-termlist</span> tag)
  <span class="at">;; Curried so that it only dispatches on the term list, not the term.</span>
  (put <span class="qu">'adjoin-term '(dense-termlist)</span>
       (<span class="kw">lambda</span> (tl) (<span class="kw">lambda</span> (t) (tag (adjoin-term t tl)))))
  (put <span class="qu">'the-empty-termlist 'dense-termlist</span>
       (<span class="kw">lambda</span> () (tag (the-empty-termlist))))
  (put <span class="qu">'first-term '(dense-termlist)</span> first-term)
  (put <span class="qu">'rest-terms '(dense-termlist)</span> (<span class="kw">lambda</span> (tl) (tag (rest-terms tl))))
  (put <span class="qu">'empty-termlist? '(dense-termlist)</span> empty-termlist?))</code></pre>
<h3 id="ex2.90" class="anchor">
<a class="anchor__link link" href="#ex2.90" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html#%25_thm_2.90">Exercise 2.90<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="3.html#2.3.2">2.3.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>same-variable?</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="4.html#2.4.3">2.4.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>apply-specific</code>
</li>
<li class="flat__item nowrap">
<code>using</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.3.1">2.5.3.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>make-poly</code>
</li>
<li class="flat__item nowrap">
<code>term-list</code>
</li>
<li class="flat__item nowrap">
<code>variable</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.3.2">2.5.3.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>coeff</code>
</li>
<li class="flat__item nowrap">
<code>make-polynomial</code>
</li>
<li class="flat__item nowrap">
<code>make-term</code>
</li>
<li class="flat__item nowrap">
<code>order</code>
</li>
<li class="flat__item nowrap">
<code>sparse-termlist-pkg</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="../3/3.html#3.3.3.3">3.3.3.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>put</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.78">Ex 2.78</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>add</code>
</li>
<li class="flat__item nowrap">
<code>apply-generic</code>
</li>
<li class="flat__item nowrap">
<code>attach-tag</code>
</li>
<li class="flat__item nowrap">
<code>mul</code>
</li>
<li class="flat__item nowrap">
<code>scheme-number-pkg</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.87">Ex 2.87</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>=zero?</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.88">Ex 2.88</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>negate</code>
</li>
<li class="flat__item nowrap">
<code>sub</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.89">Ex 2.89</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>dense-termlist-pkg</code>
</li>
</ul>
</li>
</ul>
</aside>
<p>To allow sparse and dense representations of polynomials to coexist, we must redefine the arithmetic operations using generic term list selectors:</p>
<pre><code class="codeblock">(<span class="kw">define</span> (the-empty-termlist)
  (apply-specific <span class="qu">'the-empty-termlist 'sparse-termlist</span>))
(<span class="kw">define</span> (empty-termlist? tl) (apply-generic <span class="qu">'empty-termlist?</span> tl))
(<span class="kw">define</span> (first-term tl) (apply-generic <span class="qu">'first-term</span> tl))
(<span class="kw">define</span> (rest-terms tl) (apply-generic <span class="qu">'rest-terms</span> tl))
(<span class="kw">define</span> (adjoin-term term tl) ((apply-generic <span class="qu">'adjoin-term</span> tl) term))

(<span class="kw">paste</span> (<a href="#2.5.3.1">:2.5.3.1</a> add-terms mul-term-by-all-terms mul-terms polynomial-pkg)
       (<a href="#ex2.87">?2.87</a> zero-pkg) (<a href="#ex2.88">?2.88</a> negate-pkg negate-terms))

(using sparse-termlist-pkg dense-termlist-pkg scheme-number-pkg polynomial-pkg
       zero-pkg negate-pkg)</code></pre>
<p>Let’s define some polynomials using a helper that infers the representation:</p>
<pre><code class="codeblock">(<span class="kw">define</span> (poly var terms)
  (<span class="kw">let</span> ((type (<span class="kw">if</span> (<span class="kw">or</span> (<span class="fu">null?</span> terms) (<span class="fu">pair?</span> (<span class="fu">car</span> terms)))
                  <span class="qu">'sparse-termlist
                  'dense-termlist</span>)))
    (apply-specific <span class="qu">'make 'polynomial</span> var (apply-specific <span class="qu">'make</span> type terms))))

(<span class="kw">define</span> sparse-a (poly <span class="qu">'x '((3 3) (0 1))</span>))
(<span class="kw">define</span> dense-a (poly <span class="qu">'x '(3 0 0 1)</span>))

(<span class="kw">define</span> sparse-b (poly <span class="qu">'x '((2 3) (1 3) (0 2))</span>))
(<span class="kw">define</span> dense-b (poly <span class="qu">'x '(0 3 3 2)</span>))

(<span class="kw">define</span> sparse-a+b (poly <span class="qu">'x '((3 3) (2 3) (1 3) (0 3))</span>))
(<span class="kw">define</span> dense-a+b (poly <span class="qu">'x '(3 3 3 3)</span>))

(<span class="kw">define</span> sparse-a*b (poly <span class="qu">'x '((5 9) (4 9) (3 6) (2 3) (1 3) (0 2))</span>))
(<span class="kw">define</span> dense-a*b (poly <span class="qu">'x '(9 9 6 3 3 2)</span>))</code></pre>
<p>Make sure the sparse and dense versions are equal:</p>
<pre><code class="codeblock">(=zero? (sub sparse-a dense-a)) <span class="op">=&gt;</span> <span class="cn">#t</span>
(=zero? (sub sparse-b dense-b)) <span class="op">=&gt;</span> <span class="cn">#t</span>
(=zero? (sub sparse-a+b dense-a+b)) <span class="op">=&gt;</span> <span class="cn">#t</span>
(=zero? (sub sparse-a*b dense-a*b)) <span class="op">=&gt;</span> <span class="cn">#t</span></code></pre>
<p>For addition, the second argument determines the result’s representation:</p>
<pre><code class="codeblock">(add sparse-a sparse-b) <span class="op">=&gt;</span> sparse-a+b
(add dense-a sparse-b) <span class="op">=&gt;</span> sparse-a+b
(add dense-a dense-b) <span class="op">=&gt;</span> dense-a+b
(add sparse-a dense-b) <span class="op">=&gt;</span> dense-a+b</code></pre>
<p>For multiplication, the result is always sparse:</p>
<pre><code class="codeblock">(mul sparse-a sparse-b) <span class="op">=&gt;</span> sparse-a*b
(mul dense-a sparse-b) <span class="op">=&gt;</span> sparse-a*b
(mul dense-a dense-b) <span class="op">=&gt;</span> sparse-a*b
(mul sparse-a dense-b) <span class="op">=&gt;</span> sparse-a*b</code></pre>
<h3 id="ex2.91" class="anchor">
<a class="anchor__link link" href="#ex2.91" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html#%25_thm_2.91">Exercise 2.91<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="3.html#2.3.2">2.3.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>same-variable?</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="4.html#2.4.3">2.4.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>using</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.3.1">2.5.3.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>add-terms</code>
</li>
<li class="flat__item nowrap">
<code>mul-term-by-all-terms</code>
</li>
<li class="flat__item nowrap">
<code>polynomial-pkg</code>
</li>
<li class="flat__item nowrap">
<code>term-list</code>
</li>
<li class="flat__item nowrap">
<code>variable</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.3.2">2.5.3.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>adjoin-term</code>
</li>
<li class="flat__item nowrap">
<code>make-polynomial</code>
</li>
<li class="flat__item nowrap">
<code>make-term</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.3.2">2.5.3.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>coeff</code>
</li>
<li class="flat__item nowrap">
<code>empty-termlist?</code>
</li>
<li class="flat__item nowrap">
<code>first-term</code>
</li>
<li class="flat__item nowrap">
<code>order</code>
</li>
<li class="flat__item nowrap">
<code>the-empty-termlist</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="../3/3.html#3.3.3.3">3.3.3.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>put</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.78">Ex 2.78</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>apply-generic</code>
</li>
<li class="flat__item nowrap">
<code>div</code>
</li>
<li class="flat__item nowrap">
<code>scheme-number-pkg</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.87">Ex 2.87</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>zero-pkg</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.88">Ex 2.88</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>negate-pkg</code>
</li>
<li class="flat__item nowrap">
<code>negate-terms</code>
</li>
<li class="flat__item nowrap">
<code>sub</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="codeblock">(<span class="kw">define</span> (div-terms l1 l2)
  (<span class="kw">if</span> (empty-termlist? l1)
      (<span class="fu">list</span> (the-empty-termlist)
            (the-empty-termlist))
      (<span class="kw">let</span> ((t1 (first-term l1))
            (t2 (first-term l2)))
        (<span class="kw">if</span> (<span class="fu">&gt;</span> (order t2) (order t1))
            (<span class="fu">list</span> (the-empty-termlist) l1)
            (<span class="kw">let*</span> ((new-c (div (coeff t1) (coeff t2)))
                   (new-o (sub (order t1) (order t2)))
                   (new-term (make-term new-o new-c))
                   (multiplied (mul-term-by-all-terms new-term l2))
                   (new-l1 (add-terms l1 (negate-terms multiplied)))
                   (rest-of-result (div-terms new-l1 l2)))
              (<span class="fu">list</span> (adjoin-term new-term (<span class="fu">car</span> rest-of-result))
                    (<span class="fu">cadr</span> rest-of-result)))))))

(<span class="kw">define</span> (polynomial-div-pkg)
  (<span class="kw">define</span> (div-poly p1 p2)
    (<span class="kw">if</span> (same-variable? (variable p1) (variable p2))
        (<span class="kw">let</span> ((var (variable p1))
              (result (div-terms (term-list p1) (term-list p2))))
          (<span class="fu">list</span> (make-polynomial var (<span class="fu">car</span> result))
                (make-polynomial var (<span class="fu">cadr</span> result))))
        (<span class="fu">error</span> <span class="qu">'div-poly</span> <span class="cn">"polys not in same var"</span> p1 p2)))
  (put <span class="qu">'div '(polynomial polynomial)</span> div-poly))

(using scheme-number-pkg polynomial-pkg zero-pkg negate-pkg polynomial-div-pkg)</code></pre>
<p>Now we can test the example given in the exercise:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><msup><mi>x</mi><mn>5</mn></msup><mo>−</mo><mn>1</mn></mrow><mrow><msup><mi>x</mi><mn>2</mn></msup><mo>−</mo><mn>1</mn></mrow></mfrac><mo>=</mo><msup><mi>x</mi><mn>3</mn></msup><mo>+</mo><mi>x</mi><mo separator="true">,</mo><mtext>  </mtext><mtext>remainder</mtext><mtext>  </mtext><mi>x</mi><mo>−</mo><mn>1.</mn></mrow><annotation encoding="application/x-tex">\frac{x^5 - 1}{x^2 - 1} = x^3 + x,\;\text{remainder}\;x - 1.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.260438em;vertical-align:-0.7693300000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.9474379999999999em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord text"><span class="mord">remainder</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">.</span></span></span></span></span></p>
<pre><code class="codeblock">(div (make-polynomial <span class="qu">'x '((5 1) (0 -1))</span>)
     (make-polynomial <span class="qu">'x '((2 1) (0 -1))</span>))
<span class="op">=&gt;</span> (<span class="fu">list</span> (make-polynomial <span class="qu">'x '((3 1) (1 1))</span>)
         (make-polynomial <span class="qu">'x '((1 1) (0 -1))</span>))</code></pre>
<p>And some other examples:</p>
<pre><code class="codeblock">(div (make-polynomial <span class="qu">'x '((2 2))</span>)
     (make-polynomial <span class="qu">'x '((1 2))</span>))
<span class="op">=&gt;</span> (<span class="fu">list</span> (make-polynomial <span class="qu">'x '((1 1))</span>)
         (make-polynomial <span class="qu">'x '()</span>))

(div (make-polynomial <span class="qu">'x '((1 2))</span>)
     (make-polynomial <span class="qu">'x '((2 2))</span>))
<span class="op">=&gt;</span> (<span class="fu">list</span> (make-polynomial <span class="qu">'x '()</span>)
         (make-polynomial <span class="qu">'x '((1 2))</span>))</code></pre>
<h3 id="2.5.3.3" class="anchor">
<a class="anchor__link link" href="#2.5.3.3" aria-hidden="true">#</a> <span class="number">2.5.3.3</span> Hierarchies of types in symbolic algebra
</h3>
<h3 id="ex2.92" class="anchor">
<a class="anchor__link link" href="#ex2.92" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html#%25_thm_2.92">Exercise 2.92<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="3.html#2.3.2">2.3.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>same-variable?</code>
</li>
<li class="flat__item nowrap">
<code>variable?</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="4.html#2.4.3">2.4.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>using</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.3.1">2.5.3.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>add-terms</code>
</li>
<li class="flat__item nowrap">
<code>make-poly</code>
</li>
<li class="flat__item nowrap">
<code>mul-term-by-all-terms</code>
</li>
<li class="flat__item nowrap">
<code>mul-terms</code>
</li>
<li class="flat__item nowrap">
<code>term-list</code>
</li>
<li class="flat__item nowrap">
<code>variable</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.3.2">2.5.3.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>adjoin-term</code>
</li>
<li class="flat__item nowrap">
<code>coeff</code>
</li>
<li class="flat__item nowrap">
<code>empty-termlist?</code>
</li>
<li class="flat__item nowrap">
<code>first-term</code>
</li>
<li class="flat__item nowrap">
<code>make-polynomial</code>
</li>
<li class="flat__item nowrap">
<code>make-term</code>
</li>
<li class="flat__item nowrap">
<code>order</code>
</li>
<li class="flat__item nowrap">
<code>rest-terms</code>
</li>
<li class="flat__item nowrap">
<code>the-empty-termlist</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="../3/3.html#3.3.3.3">3.3.3.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>put</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.78">Ex 2.78</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>add</code>
</li>
<li class="flat__item nowrap">
<code>attach-tag</code>
</li>
<li class="flat__item nowrap">
<code>contents</code>
</li>
<li class="flat__item nowrap">
<code>mul</code>
</li>
<li class="flat__item nowrap">
<code>scheme-number-pkg</code>
</li>
<li class="flat__item nowrap">
<code>type-tag</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.87">Ex 2.87</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>zero-pkg</code>
</li>
</ul>
</li>
</ul>
</aside>
<p>To add or multiply of polynomials in different variables, we first need to coerce them to a common variable. We’ll choose the variable that comes first alphabetically.</p>
<p>Suppose we’re coercing a polynomial from <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi><mtext>.</mtext></mrow><annotation encoding="application/x-tex">x\htmlClass{math-punctuation}{\text{.}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span><span class="enclosing math-punctuation"><span class="mord text"><span class="mord">.</span></span></span></span></span></span> For a term with a numerical coefficient like <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>5</mn><msup><mi>y</mi><mn>2</mn></msup><mtext>,</mtext></mrow><annotation encoding="application/x-tex">5y^2\htmlClass{math-punctuation}{\text{,}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.008548em;vertical-align:-0.19444em;"></span><span class="mord">5</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="enclosing math-punctuation"><span class="mord text"><span class="mord">,</span></span></span></span></span></span> we’ll change it to a constant term with a polynomial coefficient: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mn>5</mn><msup><mi>y</mi><mn>2</mn></msup><mo stretchy="false">)</mo><msup><mi>x</mi><mn>0</mn></msup><mtext>.</mtext></mrow><annotation encoding="application/x-tex">(5y^2)x^0\htmlClass{math-punctuation}{\text{.}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">5</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span><span class="enclosing math-punctuation"><span class="mord text"><span class="mord">.</span></span></span></span></span></span> For a term with a polynomial coefficient like <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mn>3</mn><mi>x</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><msup><mi>y</mi><mn>2</mn></msup><mtext>,</mtext></mrow><annotation encoding="application/x-tex">(3x+1)y^2\htmlClass{math-punctuation}{\text{,}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">3</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="enclosing math-punctuation"><span class="mord text"><span class="mord">,</span></span></span></span></span></span> we’ll first coerce the coefficient to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> (already done) and then multiply it by <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><msup><mi>y</mi><mn>2</mn></msup><mo stretchy="false">)</mo><msup><mi>x</mi><mn>0</mn></msup><mtext>,</mtext></mrow><annotation encoding="application/x-tex">(y^2)x^0\htmlClass{math-punctuation}{\text{,}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span><span class="enclosing math-punctuation"><span class="mord text"><span class="mord">,</span></span></span></span></span></span> resulting in <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mn>3</mn><msup><mi>y</mi><mn>2</mn></msup><mo stretchy="false">)</mo><msup><mi>x</mi><mn>1</mn></msup><mo>+</mo><mo stretchy="false">(</mo><msup><mi>y</mi><mn>2</mn></msup><mo stretchy="false">)</mo><msup><mi>x</mi><mn>0</mn></msup><mtext>.</mtext></mrow><annotation encoding="application/x-tex">(3y^2)x^1+(y^2)x^0\htmlClass{math-punctuation}{\text{.}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">3</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span><span class="enclosing math-punctuation"><span class="mord text"><span class="mord">.</span></span></span></span></span></span> For this to work, we need to support adding and multiplying Scheme numbers with polynomials, since coefficients can be a mix of the two.</p>
<pre><code class="codeblock">(<span class="kw">define</span> (polynomial-pkg)
  (<span class="kw">define</span> (singleton t)
    (adjoin-term t (the-empty-termlist)))
  (<span class="kw">define</span> (constant-term var term)
    (make-term <span class="cn">0</span> (make-polynomial var (singleton term))))
  (<span class="kw">define</span> (variable&lt;? a b)
    (<span class="fu">string&lt;?</span> (<span class="fu">symbol-&gt;string</span> a) (<span class="fu">symbol-&gt;string</span> b)))
  (<span class="kw">define</span> (principal-variable v1 v2)
    (<span class="kw">if</span> (variable&lt;? v1 v2) v1 v2))
  (<span class="kw">define</span> (coerce-term t from to)
    (<span class="kw">case</span> (type-tag (coeff t))
      ((scheme-number) (singleton (constant-term from t)))
      ((polynomial)
       (<span class="kw">let</span> ((tl (term-list (coerce-poly (contents (coeff t)) to))))
         (<span class="kw">if</span> (<span class="fu">zero?</span> (order t))
             tl
             (mul-term-by-all-terms
              (constant-term from (make-term (order t) <span class="cn">1</span>))
              tl))))
      (<span class="kw">else</span> (<span class="fu">error</span> <span class="qu">'coerce-term</span> <span class="cn">"invalid coeff type"</span> (coeff t)))))
  (<span class="kw">define</span> (coerce-termlist tl from to)
    (<span class="kw">if</span> (empty-termlist? tl)
        tl
        (add-terms
         (coerce-term (first-term tl) from to)
         (coerce-termlist (rest-terms tl) from to))))
  (<span class="kw">define</span> (coerce-poly p var)
    (<span class="kw">if</span> (same-variable? (variable p) var)
        p
        (make-poly var (coerce-termlist (term-list p) (variable p) var))))
  (<span class="kw">define</span> (binary-op term-fn)
    (<span class="kw">lambda</span> (p1 p2)
      (<span class="kw">let</span> ((var (principal-variable (variable p1) (variable p2))))
        (make-poly var (term-fn (term-list (coerce-poly p1 var))
                                (term-list (coerce-poly p2 var)))))))
  (<span class="kw">define</span> add-poly (binary-op add-terms))
  (<span class="kw">define</span> mul-poly (binary-op mul-terms))
  (<span class="kw">define</span> (add-mixed x p)
    (make-poly (variable p)
               (add-terms (singleton (make-term <span class="cn">0</span> x)) (term-list p))))
  (<span class="kw">define</span> (mul-mixed x p)
    (make-poly (variable p)
               (<span class="fu">map</span> (<span class="kw">lambda</span> (t) (make-term (order t) (mul x (coeff t))))
                    (term-list p))))
  (<span class="kw">define</span> (tag p) (attach-tag <span class="qu">'polynomial</span> p))
  (put <span class="qu">'make 'polynomial</span> (<span class="kw">lambda</span> (var terms) (tag (make-poly var terms))))
  (put <span class="qu">'add '(polynomial polynomial)</span> (<span class="kw">lambda</span> (p1 p2) (tag (add-poly p1 p2))))
  (put <span class="qu">'mul '(polynomial polynomial)</span> (<span class="kw">lambda</span> (p1 p2) (tag (mul-poly p1 p2))))
  (put <span class="qu">'add '(scheme-number polynomial)</span> (<span class="kw">lambda</span> (x p) (tag (add-mixed x p))))
  (put <span class="qu">'add '(polynomial scheme-number)</span> (<span class="kw">lambda</span> (p x) (tag (add-mixed x p))))
  (put <span class="qu">'mul '(scheme-number polynomial)</span> (<span class="kw">lambda</span> (x p) (tag (mul-mixed x p))))
  (put <span class="qu">'mul '(polynomial scheme-number)</span> (<span class="kw">lambda</span> (p x) (tag (mul-mixed x p)))))

(using scheme-number-pkg polynomial-pkg zero-pkg)</code></pre>
<p>Here’s a simple test:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>x</mi><mo>+</mo><mi>y</mi><mo>=</mo><mi>y</mi><mo>+</mo><mi>x</mi><mo>=</mo><mn>1</mn><msup><mi>x</mi><mn>1</mn></msup><mo>+</mo><mrow><mo fence="true">(</mo><mn>1</mn><msup><mi>y</mi><mn>1</mn></msup><mo fence="true">)</mo></mrow><msup><mi>x</mi><mn>0</mn></msup><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">x + y = y + x = 1x^1 + \left(1y^1\right)x^0.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.9474379999999999em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.2141179999999998em;vertical-align:-0.35001em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord">1</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span><span class="mord">.</span></span></span></span></span></p>
<pre><code class="codeblock">(add (make-polynomial <span class="qu">'x '((1 1))</span>) (make-polynomial <span class="qu">'y '((1 1))</span>))
<span class="op">=&gt;</span> (add (make-polynomial <span class="qu">'y '((1 1))</span>) (make-polynomial <span class="qu">'x '((1 1))</span>))
<span class="op">=&gt;</span> (make-polynomial <span class="qu">'x `((1 1) (0 ,</span>(make-polynomial <span class="qu">'y '((1 1))</span>)<span class="qu">))</span>)</code></pre>
<p>Here’s a more complicated test:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.24999999999999992em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mphantom><mo>=</mo></mphantom><mo stretchy="false">(</mo><mi>y</mi><msup><mi>x</mi><mn>3</mn></msup><mo>+</mo><mn>2</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>y</mi><mo>+</mo><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mrow><mo fence="true">(</mo><mn>1</mn><msup><mi>y</mi><mn>1</mn></msup><mo fence="true">)</mo></mrow><msup><mi>x</mi><mn>5</mn></msup><mo>+</mo><mrow><mo fence="true">(</mo><mn>1</mn><msup><mi>y</mi><mn>2</mn></msup><mo>+</mo><mn>1</mn><msup><mi>y</mi><mn>1</mn></msup><mo fence="true">)</mo></mrow><msup><mi>x</mi><mn>3</mn></msup><mo>+</mo><mn>2</mn><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mrow><mo fence="true">(</mo><mn>2</mn><msup><mi>y</mi><mn>1</mn></msup><mo>+</mo><mn>2</mn><msup><mi>y</mi><mn>0</mn></msup><mo fence="true">)</mo></mrow><msup><mi>x</mi><mn>0</mn></msup><mi mathvariant="normal">.</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
&amp;\phantom{=} (yx^3 + 2)(y + x^2 + 1) \\
&amp;= \left(1y^1\right)x^5 + \left(1y^2 + 1y^1\right)x^3 + 2x^2
+ \left(2y^1 + 2y^0\right)x^0.
\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.048216em;vertical-align:-1.274108em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.774108em;"><span style="top:-3.774108em;"><span class="pstrut" style="height:2.864108em;"></span><span class="mord"></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:2.864108em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.274108em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.774108em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel" style="color:transparent;">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span><span style="top:-2.385892em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord">1</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord">1</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord">2</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span><span class="mord">.</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.274108em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<pre><code class="codeblock">(mul (make-polynomial <span class="qu">'x `((3 ,</span>(make-polynomial <span class="qu">'y '((1 1))</span>)<span class="qu">) (0 2))</span>)
     (make-polynomial <span class="qu">'y `((1 1) (0 ,</span>(make-polynomial <span class="qu">'x '((2 1) (0 1))</span>)<span class="qu">))</span>))
<span class="op">=&gt;</span> (make-polynomial <span class="qu">'x `((5 ,</span>(make-polynomial <span class="qu">'y '((1 1))</span>)<span class="qu">)
                         (3 ,</span>(make-polynomial <span class="qu">'y '((2 1) (1 1))</span>)<span class="qu">)
                         (2 2)
                         (0 ,</span>(make-polynomial <span class="qu">'y '((1 2) (0 2))</span>)<span class="qu">))</span>)</code></pre>
<h3 id="2.5.3.4" class="anchor">
<a class="anchor__link link" href="#2.5.3.4" aria-hidden="true">#</a> <span class="number">2.5.3.4</span> Extended exercise: Rational functions
</h3>
<h3 id="ex2.93" class="anchor">
<a class="anchor__link link" href="#ex2.93" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html#%25_thm_2.93">Exercise 2.93<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="1.html#2.1.1">2.1.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>denom</code>
</li>
<li class="flat__item nowrap">
<code>numer</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="4.html#2.4.3">2.4.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>using</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.1">2.5.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>make-rational</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.3.1">2.5.3.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>polynomial-pkg</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.3.2">2.5.3.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>make-polynomial</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="../3/3.html#3.3.3.3">3.3.3.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>put</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.78">Ex 2.78</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>add</code>
</li>
<li class="flat__item nowrap">
<code>attach-tag</code>
</li>
<li class="flat__item nowrap">
<code>div</code>
</li>
<li class="flat__item nowrap">
<code>mul</code>
</li>
<li class="flat__item nowrap">
<code>scheme-number-pkg</code>
</li>
<li class="flat__item nowrap">
<code>sub</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.87">Ex 2.87</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>zero-pkg</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="codeblock">(<span class="kw">define</span> (make-rat n d) (<span class="fu">cons</span> n d))

(<span class="kw">define</span> (add-rat x y)
  (make-rat (add (mul (numer x) (denom y))
                 (mul (numer y) (denom x)))
            (mul (denom x) (denom y))))
(<span class="kw">define</span> (sub-rat x y)
  (make-rat (sub (mul (numer x) (denom y))
                 (mul (numer y) (denom x)))
            (mul (denom x) (denom y))))
(<span class="kw">define</span> (mul-rat x y)
  (make-rat (mul (numer x) (numer y))
            (mul (denom x) (denom y))))
(<span class="kw">define</span> (div-rat x y)
  (make-rat (mul (numer x) (denom y))
            (mul (denom x) (numer y))))

(<span class="kw">paste</span> (<a href="#2.5.1">:2.5.1</a> rational-pkg))

(using scheme-number-pkg zero-pkg polynomial-pkg rational-pkg)</code></pre>
<p>This gives a correct answer, but does not reduce it to lowest terms:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><msup><mi>x</mi><mn>3</mn></msup><mo>+</mo><mn>1</mn></mrow><mrow><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mn>1</mn></mrow></mfrac><mo>+</mo><mfrac><mrow><msup><mi>x</mi><mn>3</mn></msup><mo>+</mo><mn>1</mn></mrow><mrow><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mn>1</mn></mrow></mfrac><mo>=</mo><mfrac><mrow><mn>2</mn><msup><mi>x</mi><mn>5</mn></msup><mo>+</mo><mn>2</mn><msup><mi>x</mi><mn>3</mn></msup><mo>+</mo><mn>2</mn><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mn>2</mn></mrow><mrow><msup><mi>x</mi><mn>4</mn></msup><mo>+</mo><mn>2</mn><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mn>1</mn></mrow></mfrac><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">\frac{x^3 + 1}{x^2 + 1} + \frac{x^3 + 1}{x^2 + 1}
= \frac{2x^5 + 2x^3 + 2x^2 + 2}{x^4 + 2x^2 + 1}.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.260438em;vertical-align:-0.7693300000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.260438em;vertical-align:-0.7693300000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.260438em;vertical-align:-0.7693300000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord">.</span></span></span></span></span></p>
<pre><code class="codeblock">(<span class="kw">define</span> p1 (make-polynomial <span class="qu">'x '((2 1) (0 1))</span>))
(<span class="kw">define</span> p2 (make-polynomial <span class="qu">'x '((3 1) (0 1))</span>))
(<span class="kw">define</span> rf (make-rational p2 p1))

(add rf rf)
<span class="op">=&gt;</span> (make-rational (make-polynomial <span class="qu">'x '((5 2) (3 2) (2 2) (0 2))</span>)
                  (make-polynomial <span class="qu">'x '((4 1) (2 2) (0 1))</span>))</code></pre>
<h3 id="ex2.94" class="anchor">
<a class="anchor__link link" href="#ex2.94" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html#%25_thm_2.94">Exercise 2.94<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="3.html#2.3.2">2.3.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>same-variable?</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="4.html#2.4.3">2.4.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>using</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.3.1">2.5.3.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>polynomial-pkg</code>
</li>
<li class="flat__item nowrap">
<code>term-list</code>
</li>
<li class="flat__item nowrap">
<code>variable</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.3.2">2.5.3.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>empty-termlist?</code>
</li>
<li class="flat__item nowrap">
<code>make-polynomial</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="../3/3.html#3.3.3.3">3.3.3.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>put</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.78">Ex 2.78</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>apply-generic</code>
</li>
<li class="flat__item nowrap">
<code>scheme-number-pkg</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.87">Ex 2.87</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>zero-pkg</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.88">Ex 2.88</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>negate-pkg</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.91">Ex 2.91</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>div-terms</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="codeblock">(<span class="kw">define</span> (remainder-terms l1 l2)
  (<span class="fu">cadr</span> (div-terms l1 l2)))

(<span class="kw">define</span> (gcd-terms a b)
  (<span class="kw">if</span> (empty-termlist? b)
      a
      (gcd-terms b (remainder-terms a b))))

(<span class="kw">define</span> (greatest-common-divisor-pkg)
  (<span class="kw">define</span> (gcd-poly p1 p2)
    (<span class="kw">if</span> (same-variable? (variable p1) (variable p2))
        (<span class="kw">let</span> ((tl (gcd-terms (term-list p1) (term-list p2))))
          (make-polynomial (variable p1) tl))
        (<span class="fu">error</span> <span class="qu">'gcd-poly</span> <span class="cn">"polys not in same var"</span> p1 p2)))
  (put <span class="qu">'greatest-common-divisor '(scheme-number scheme-number)</span> <span class="fu">gcd</span>)
  (put <span class="qu">'greatest-common-divisor '(polynomial polynomial)</span> gcd-poly))

(<span class="kw">define</span> (greatest-common-divisor a b)
  (apply-generic <span class="qu">'greatest-common-divisor</span> a b))

(using scheme-number-pkg polynomial-pkg zero-pkg negate-pkg
       greatest-common-divisor-pkg)</code></pre>
<p>Now it works for integers:</p>
<pre><code class="codeblock">(greatest-common-divisor <span class="cn">128 40</span>) <span class="op">=&gt;</span> <span class="cn">8</span></code></pre>
<p>And for polynomials:</p>
<pre><code class="codeblock">(<span class="kw">define</span> p1 (make-polynomial <span class="qu">'x '((4 1) (3 -1) (2 -2) (1 2))</span>))
(<span class="kw">define</span> p2 (make-polynomial <span class="qu">'x '((3 1) (1 -1))</span>))

(greatest-common-divisor p1 p2)
<span class="op">=&gt;</span> (make-polynomial <span class="qu">'x '((2 -1) (1 1))</span>)</code></pre>
<h3 id="ex2.95" class="anchor">
<a class="anchor__link link" href="#ex2.95" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html#%25_thm_2.95">Exercise 2.95<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="4.html#2.4.2">2.4.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>contents</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="4.html#2.4.3">2.4.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>using</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.3.1">2.5.3.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>polynomial-pkg</code>
</li>
<li class="flat__item nowrap">
<code>term-list</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.3.2">2.5.3.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>make-polynomial</code>
</li>
<li class="flat__item nowrap">
<code>the-empty-termlist</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.78">Ex 2.78</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>mul</code>
</li>
<li class="flat__item nowrap">
<code>scheme-number-pkg</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.87">Ex 2.87</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>zero-pkg</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.88">Ex 2.88</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>negate-pkg</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.91">Ex 2.91</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>polynomial-div-pkg</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.94">Ex 2.94</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>gcd-terms</code>
</li>
<li class="flat__item nowrap">
<code>greatest-common-divisor</code>
</li>
<li class="flat__item nowrap">
<code>greatest-common-divisor-pkg</code>
</li>
<li class="flat__item nowrap">
<code>remainder-terms</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="codeblock">(using scheme-number-pkg polynomial-pkg zero-pkg negate-pkg polynomial-div-pkg
       greatest-common-divisor-pkg)

(<span class="kw">define</span> p1 (make-polynomial <span class="qu">'x '((2 1) (1 -2) (0 1))</span>))
(<span class="kw">define</span> p2 (make-polynomial <span class="qu">'x '((2 11) (0 7))</span>))
(<span class="kw">define</span> p3 (make-polynomial <span class="qu">'x '((1 13) (0 5))</span>))
(<span class="kw">define</span> q1 (mul p1 p2))
(<span class="kw">define</span> q2 (mul p1 p3))</code></pre>
<p>For brevity, we’ll give names to the term lists of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Q</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">Q_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Q</mi><mn>2</mn></msub><mtext>:</mtext></mrow><annotation encoding="application/x-tex">Q_2\htmlClass{math-punctuation}{\text{:}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="enclosing math-punctuation"><span class="mord text"><span class="mord">:</span></span></span></span></span></span></p>
<pre><code class="codeblock">(<span class="kw">define</span> q1-tl (term-list (contents q1)))
(<span class="kw">define</span> q2-tl (term-list (contents q2)))</code></pre>
<p>Tracing through the GCD calculation, we see that it reduces to the remainder of dividing the original two polynomials:</p>
<pre><code class="codeblock">(gcd-terms q1-tl q2-tl)
<span class="op">=&gt;</span> (gcd-terms q2-tl (remainder-terms q1-tl q2-tl))
<span class="op">=&gt;</span> (gcd-terms (remainder-terms q1-tl q2-tl)
              (remainder-terms q2-tl (remainder-terms q1-tl q2-tl)))
<span class="op">=&gt;</span> (gcd-terms (remainder-terms q1-tl q2-tl)
              (the-empty-termlist))
<span class="op">=&gt;</span> (remainder-terms q1-tl q2-tl)
<span class="op">=&gt;</span> <span class="qu">'((2 1458/169) (1 -2916/169) (0 1458/169))</span></code></pre>
<p>The problem is that <code>div-terms</code> from <a href="#ex2.91">Exercise&nbsp;2.91</a> calls <code>div</code> on coefficients, so they end up as fractions. In this case, we have to multiply by a factor of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>169</mn><mi mathvariant="normal">/</mi><mn>1458</mn></mrow><annotation encoding="application/x-tex">169/1458</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord">6</span><span class="mord">9</span><span class="mord">/</span><span class="mord">1</span><span class="mord">4</span><span class="mord">5</span><span class="mord">8</span></span></span></span> to get the desired answer, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>P</mi><mn>1</mn></msub><mtext>:</mtext></mrow><annotation encoding="application/x-tex">P_1\htmlClass{math-punctuation}{\text{:}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="enclosing math-punctuation"><span class="mord text"><span class="mord">:</span></span></span></span></span></span></p>
<pre><code class="codeblock">(mul (greatest-common-divisor q1 q2)
     (make-polynomial <span class="qu">'x '((0 169/1458))</span>))
<span class="op">=&gt;</span> p1</code></pre>
<h3 id="ex2.96" class="anchor">
<a class="anchor__link link" href="#ex2.96" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html#%25_thm_2.96">Exercise 2.96<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="2.html#2.2.3.1">2.2.3.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>accumulate</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="3.html#2.3.2">2.3.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>same-variable?</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="4.html#2.4.3">2.4.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>using</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.3.1">2.5.3.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>mul-term-by-all-terms</code>
</li>
<li class="flat__item nowrap">
<code>polynomial-pkg</code>
</li>
<li class="flat__item nowrap">
<code>term-list</code>
</li>
<li class="flat__item nowrap">
<code>variable</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.3.2">2.5.3.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>coeff</code>
</li>
<li class="flat__item nowrap">
<code>empty-termlist?</code>
</li>
<li class="flat__item nowrap">
<code>first-term</code>
</li>
<li class="flat__item nowrap">
<code>make-polynomial</code>
</li>
<li class="flat__item nowrap">
<code>make-term</code>
</li>
<li class="flat__item nowrap">
<code>order</code>
</li>
<li class="flat__item nowrap">
<code>rest-terms</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="../3/3.html#3.3.3.3">3.3.3.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>put</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.78">Ex 2.78</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>mul</code>
</li>
<li class="flat__item nowrap">
<code>scheme-number-pkg</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.87">Ex 2.87</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>zero-pkg</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.88">Ex 2.88</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>negate-pkg</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.91">Ex 2.91</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>div-terms</code>
</li>
<li class="flat__item nowrap">
<code>polynomial-div-pkg</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.94">Ex 2.94</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>greatest-common-divisor</code>
</li>
<li class="flat__item nowrap">
<code>remainder-terms</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.95">Ex 2.95</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>p1</code>
</li>
<li class="flat__item nowrap">
<code>q1</code>
</li>
<li class="flat__item nowrap">
<code>q2</code>
</li>
</ul>
</li>
</ul>
</aside>
<pre><code class="codeblock">(<span class="kw">paste</span> (<a href="#ex2.94">?2.94</a> greatest-common-divisor-pkg))

(using scheme-number-pkg polynomial-pkg zero-pkg negate-pkg polynomial-div-pkg
       greatest-common-divisor-pkg)</code></pre>
<ol type="a">
<li><p>Polynomial GCD with integer coefficients:</p>
<pre><code class="codeblock">(<span class="kw">define</span> (pseudoremainder-terms l1 l2)
  (<span class="kw">let*</span> ((o1 (order (first-term l1)))
         (o2 (order (first-term l2)))
         (c (coeff (first-term l2)))
         (integerizing-factor (<span class="fu">expt</span> c (<span class="fu">+</span> <span class="cn">1</span> o1 (<span class="fu">-</span> o2))))
         (term (make-term <span class="cn">0</span> integerizing-factor))
         (ml1 (mul-term-by-all-terms term l1)))
    (remainder-terms ml1 l2)))

(<span class="kw">define</span> (gcd-terms a b)
  (<span class="kw">if</span> (empty-termlist? b)
      a
      (gcd-terms b (pseudoremainder-terms a b))))

(greatest-common-divisor q1 q2)
<span class="op">=&gt;</span> (make-polynomial <span class="qu">'x '((2 1458) (1 -2916) (0 1458))</span>)
<span class="op">=&gt;</span> (mul p1 (make-polynomial <span class="qu">'x '((0 1458))</span>))</code></pre></li>
<li><p>Polynomial GCD with reduced integer coefficients:</p>
<pre><code class="codeblock">(<span class="kw">define</span> (termlist-coeffs tl)
  (<span class="kw">if</span> (empty-termlist? tl)
      <span class="qu">'()</span>
      (<span class="fu">cons</span> (coeff (first-term tl))
            (termlist-coeffs (rest-terms tl)))))

(<span class="kw">define</span> (gcd-terms a b)
  (<span class="kw">if</span> (empty-termlist? b)
      (<span class="kw">let*</span> ((cs (termlist-coeffs a))
             (coeff-gcd (accumulate <span class="fu">gcd</span> (<span class="fu">car</span> cs) (<span class="fu">cdr</span> cs))))
        (mul-term-by-all-terms (make-term <span class="cn">0</span> (<span class="fu">/</span> coeff-gcd)) a))
      (gcd-terms b (pseudoremainder-terms a b))))

(greatest-common-divisor q1 q2)
<span class="op">=&gt;</span> (make-polynomial <span class="qu">'x '((2 1) (1 -2) (0 1))</span>)
<span class="op">=&gt;</span> p1</code></pre></li>
</ol>
<h3 id="ex2.97" class="anchor">
<a class="anchor__link link" href="#ex2.97" aria-hidden="true">#</a> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html#%25_thm_2.97">Exercise 2.97<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h3>
<aside class="imports">
<h4>
Imports:
</h4>
<ul class="flat">
<li class="flat__item">
<a href="1.html#2.1.1">2.1.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>denom</code>
</li>
<li class="flat__item nowrap">
<code>numer</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="2.html#2.2.3.1">2.2.3.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>accumulate</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="3.html#2.3.2">2.3.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>same-variable?</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="4.html#2.4.3">2.4.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>using</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.1">2.5.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>make-rational</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.3.1">2.5.3.1</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>mul-term-by-all-terms</code>
</li>
<li class="flat__item nowrap">
<code>polynomial-pkg</code>
</li>
<li class="flat__item nowrap">
<code>term-list</code>
</li>
<li class="flat__item nowrap">
<code>variable</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#2.5.3.2">2.5.3.2</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>coeff</code>
</li>
<li class="flat__item nowrap">
<code>first-term</code>
</li>
<li class="flat__item nowrap">
<code>make-polynomial</code>
</li>
<li class="flat__item nowrap">
<code>make-term</code>
</li>
<li class="flat__item nowrap">
<code>order</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="../3/3.html#3.3.3.3">3.3.3.3</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>put</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.78">Ex 2.78</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>add</code>
</li>
<li class="flat__item nowrap">
<code>apply-generic</code>
</li>
<li class="flat__item nowrap">
<code>attach-tag</code>
</li>
<li class="flat__item nowrap">
<code>div</code>
</li>
<li class="flat__item nowrap">
<code>mul</code>
</li>
<li class="flat__item nowrap">
<code>scheme-number-pkg</code>
</li>
<li class="flat__item nowrap">
<code>sub</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.87">Ex 2.87</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>zero-pkg</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.88">Ex 2.88</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>negate-pkg</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.91">Ex 2.91</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>div-terms</code>
</li>
<li class="flat__item nowrap">
<code>polynomial-div-pkg</code>,
</li>
</ul>
</li>
<li class="flat__item">
<a href="#ex2.96">Ex 2.96</a>
<ul class="flat">
<li class="flat__item nowrap">
<code>gcd-terms</code>
</li>
<li class="flat__item nowrap">
<code>termlist-coeffs</code>
</li>
</ul>
</li>
</ul>
</aside>
<ol type="a">
<li><p>Reducing a rational function to lowest terms:</p>
<pre><code class="codeblock">(<span class="kw">define</span> (termlist-order tl) (order (first-term tl)))
(<span class="kw">define</span> (quotient-terms l1 l2) (<span class="fu">car</span> (div-terms l1 l2)))

(<span class="kw">define</span> (reduce-terms n d)
  (<span class="kw">let*</span> ((nd-gcd (gcd-terms n d))
         (leading-coeff (coeff (first-term nd-gcd)))
         (exponent (<span class="fu">+</span> <span class="cn">1</span>
                      (<span class="fu">max</span> (termlist-order n) (termlist-order d))
                      (<span class="fu">-</span> (termlist-order nd-gcd))))
         (integerizing-factor (<span class="fu">expt</span> leading-coeff exponent))
         (term1 (make-term <span class="cn">0</span> integerizing-factor))
         (n/gcd (quotient-terms (mul-term-by-all-terms term1 n) nd-gcd))
         (d/gcd (quotient-terms (mul-term-by-all-terms term1 d) nd-gcd))
         (all-coeffs (<span class="fu">append</span> (termlist-coeffs n/gcd)
                             (termlist-coeffs d/gcd)))
         (coeff-gcd (accumulate <span class="fu">gcd</span> (<span class="fu">car</span> all-coeffs) (<span class="fu">cdr</span> all-coeffs)))
         (term2 (make-term <span class="cn">0</span> (<span class="fu">/</span> coeff-gcd)))
         (nn (mul-term-by-all-terms term2 n/gcd))
         (dd (mul-term-by-all-terms term2 d/gcd)))
    (<span class="fu">list</span> nn dd)))

(<span class="kw">define</span> (reduce-poly n d)
  (<span class="kw">if</span> (same-variable? (variable n) (variable d))
      (<span class="kw">let</span> ((var (variable n))
            (reduced (reduce-terms (term-list n) (term-list d))))
        (<span class="fu">list</span> (make-polynomial var (<span class="fu">car</span> reduced))
              (make-polynomial var (<span class="fu">cadr</span> reduced))))
      (<span class="fu">error</span> <span class="qu">'reduce-poly</span> <span class="cn">"polys not in same var"</span> n d)))</code></pre></li>
<li><p>Rational arithmetic system supporting integers and polynomials:</p>
<pre><code class="codeblock">(<span class="kw">define</span> (reduce-integers n d)
  (<span class="kw">let</span> ((g (<span class="fu">gcd</span> n d)))
    (<span class="fu">list</span> (<span class="fu">/</span> n g) (<span class="fu">/</span> d g))))

(<span class="kw">define</span> (reduce-pkg)
  (put <span class="qu">'reduce '(scheme-number scheme-number)</span> reduce-integers)
  (put <span class="qu">'reduce '(polynomial polynomial)</span> reduce-poly))

(<span class="kw">define</span> (reduce n d) (apply-generic <span class="qu">'reduce</span> n d))

(<span class="kw">define</span> (make-rat n d)
  (<span class="kw">let</span> ((reduced (reduce n d)))
    (<span class="fu">cons</span> (<span class="fu">car</span> reduced) (<span class="fu">cadr</span> reduced))))

(<span class="kw">paste</span> (<a href="#ex2.93">?2.93</a> add-rat div-rat mul-rat sub-rat) (<a href="#2.5.1">:2.5.1</a> rational-pkg))

(using scheme-number-pkg polynomial-pkg zero-pkg negate-pkg polynomial-div-pkg
       rational-pkg reduce-pkg)</code></pre>
<p>Now it works for integers: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle scriptlevel="0" displaystyle="true"><mfrac><mn>4</mn><mn>7</mn></mfrac><mo>+</mo><mfrac><mn>30</mn><mn>33</mn></mfrac><mo>=</mo><mfrac><mn>114</mn><mn>77</mn></mfrac><mi mathvariant="normal">.</mi></mstyle></mrow><annotation encoding="application/x-tex">\displaystyle\frac{4}{7} + \frac{30}{33}
= \frac{114}{77}.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">7</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">3</span><span class="mord">3</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">3</span><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">7</span><span class="mord">7</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mord">1</span><span class="mord">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord">.</span></span></span></span></p>
<pre><code class="codeblock">(add (make-rational <span class="cn">4 7</span>) (make-rational <span class="cn">30 33</span>))
<span class="op">=&gt;</span> (make-rational <span class="cn">114 77</span>)</code></pre>
<p>And for polynomials: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle scriptlevel="0" displaystyle="true"><mfrac><mrow><mi>x</mi><mo>+</mo><mn>1</mn></mrow><mrow><msup><mi>x</mi><mn>3</mn></msup><mo>−</mo><mn>1</mn></mrow></mfrac><mo>+</mo><mfrac><mi>x</mi><mrow><msup><mi>x</mi><mn>2</mn></msup><mo>−</mo><mn>1</mn></mrow></mfrac><mo>=</mo><mfrac><mrow><msup><mi>x</mi><mn>3</mn></msup><mo>+</mo><mn>2</mn><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mn>3</mn><mi>x</mi><mo>+</mo><mn>1</mn></mrow><mrow><msup><mi>x</mi><mn>4</mn></msup><mo>+</mo><msup><mi>x</mi><mn>3</mn></msup><mo>−</mo><mi>x</mi><mo>−</mo><mn>1</mn></mrow></mfrac><mi mathvariant="normal">.</mi></mstyle></mrow><annotation encoding="application/x-tex">\displaystyle\frac{x + 1}{x^3 - 1}
+ \frac{x}{x^2 - 1} = \frac{x^3 + 2x^2 + 3x + 1}{x^4 + x^3 - x - 1}.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.09077em;vertical-align:-0.7693300000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.8768900000000002em;vertical-align:-0.7693300000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.10756em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.260438em;vertical-align:-0.7693300000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">3</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord">.</span></span></span></span></p>
<pre><code class="codeblock">(<span class="kw">define</span> p1 (make-polynomial <span class="qu">'x '((1 1) (0 1))</span>))
(<span class="kw">define</span> p2 (make-polynomial <span class="qu">'x '((3 1) (0 -1))</span>))
(<span class="kw">define</span> p3 (make-polynomial <span class="qu">'x '((1 1))</span>))
(<span class="kw">define</span> p4 (make-polynomial <span class="qu">'x '((2 1) (0 -1))</span>))

(<span class="kw">define</span> rf1 (make-rational p1 p2))
(<span class="kw">define</span> rf2 (make-rational p3 p4))

(add rf1 rf2)
<span class="op">=&gt;</span> (make-rational (make-polynomial <span class="qu">'x '((3 1) (2 2) (1 3) (0 1))</span>)
                  (make-polynomial <span class="qu">'x '((4 1) (3 1) (1 -1) (0 -1))</span>))</code></pre></li>
</ol>
</main>
<nav class="pagenav pagenav--bottom" aria-label="page">
  <div class="pagenav__item pagenav__item--left">
    <a class="pagenav__link link" href="4.html" aria-label="previous page">
      <svg width="12" height="11" aria-hidden="true"><use xlink:href="#left"/>
      </svg><span class="pagenav__prev">Prev</span>
    </a>
  </div>
  <div class="pagenav__item pagenav__item--center">
    <a class="pagenav__link link" href="index.html" aria-label="parent page">
      <svg width="11" height="12" aria-hidden="true"><use xlink:href="#up"/>
      </svg><span class="pagenav__up">Up</span>
    </a>
  </div>
  <div class="pagenav__item pagenav__item--right">
    <a class="pagenav__link link" href="../3/index.html" aria-label="next page">
      <span class="pagenav__next">Next</span
        ><svg width="12" height="11" aria-hidden="true"
        ><use xlink:href="#right"/></svg>
    </a>
  </div>
</nav>
<footer class="footer">
  <p>© 2022 Mitchell Kember</p>
</footer>
</body>
</html>
