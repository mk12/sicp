<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Mitchell Kember">
  <title>SICP Section 2.5 Notes</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
   var mathElements = document.getElementsByClassName("math");
   var macros = [];
   for (var i = 0; i < mathElements.length; i++) {
    var texText = mathElements[i].firstChild;
    if (mathElements[i].tagName == "SPAN") {
     katex.render(texText.data, mathElements[i], {
      displayMode: mathElements[i].classList.contains('display'),
      throwOnError: false,
      macros: macros,
      fleqn: false
     });
  }}});
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" />
  <link rel="stylesheet" href="../../assets/style.css">
</head>
<body>
<header class="header">
  <a class="title" href="../../index.html">SICP Study</a>
  <span class="gap"></span>
  <nav class="sitenav">
    <a class="sitenav__item sitenav__item--active" href="../../text/index.html">Text</a>
    <a class="sitenav__item" href="../../lecture/index.html">Lecture</a>
    <a class="sitenav__item" href="../../exercise/index.html">Exercise</a>
    <a class="sitenav__item" href="https://github.com/mk12/sicp">Source <svg class="github-mark" width="25" height="25" viewBox="0 0 136 133" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g transform="matrix(1,0,0,1,-568.001,-447.669)">
      <g transform="matrix(4.16667,0,0,4.16667,0,0)">
          <g transform="matrix(1,0,0,1,152.608,139.345)">
              <path d="M0,-31.904C-8.995,-31.904 -16.288,-24.611 -16.288,-15.614C-16.288,-8.417 -11.621,-2.312 -5.148,-0.157C-4.333,-0.008 -4.036,-0.511 -4.036,-0.943C-4.036,-1.329 -4.05,-2.354 -4.058,-3.713C-8.589,-2.729 -9.545,-5.897 -9.545,-5.897C-10.286,-7.778 -11.354,-8.279 -11.354,-8.279C-12.833,-9.29 -11.242,-9.27 -11.242,-9.27C-9.607,-9.154 -8.747,-7.591 -8.747,-7.591C-7.294,-5.102 -4.934,-5.821 -4.006,-6.237C-3.858,-7.29 -3.438,-8.008 -2.972,-8.415C-6.589,-8.826 -10.392,-10.224 -10.392,-16.466C-10.392,-18.244 -9.757,-19.698 -8.715,-20.837C-8.883,-21.249 -9.442,-22.905 -8.556,-25.148C-8.556,-25.148 -7.188,-25.586 -4.076,-23.478C-2.777,-23.839 -1.383,-24.02 0.002,-24.026C1.385,-24.02 2.779,-23.839 4.08,-23.478C7.19,-25.586 8.555,-25.148 8.555,-25.148C9.444,-22.905 8.885,-21.249 8.717,-20.837C9.761,-19.698 10.392,-18.244 10.392,-16.466C10.392,-10.208 6.583,-8.831 2.954,-8.428C3.539,-7.925 4.06,-6.931 4.06,-5.411C4.06,-3.234 4.04,-1.477 4.04,-0.943C4.04,-0.507 4.333,0 5.16,-0.159C11.628,-2.318 16.291,-8.419 16.291,-15.614C16.291,-24.611 8.997,-31.904 0,-31.904"/>
          </g>
      </g>
  </g>
</svg></a>
  </nav>
</header>
<nav class="pagenav pagenav--top">
  <div class="pagenav__item pagenav__item--prev"><a class="pagenav__link" href="4.html">← Prev</a></div>
  <div class="pagenav__item pagenav__item--up"><a class="pagenav__link" href="index.html">↑ Up</a></div>
  <div class="pagenav__item pagenav__item--next"><a class="pagenav__link" href="../3/index.html">Next →</a></div>
</nav>
<h1>
Systems with Generic Operations<small class="number">2.5</small>
</h1>
<ul>
<li>The key idea in the <a href="#data-directed-programming-and-additivity">previous section</a>: link specific data operations to multiple representations using generic procedures.</li>
<li>We can extend this further to create operations that are generic over different kinds of arguments, not just different representations of the same kind of data.</li>
<li>We have seen several different arithmetic packages – primitive numbers, rational numbers, intervals, and complex numbers.</li>
<li>We will use data-directed techniques to write procedures that work on all of these data structures.</li>
<li>This will require many abstraction barriers.</li>
<li>The result will be additive (modular) – easy to add new types.</li>
</ul>
<h2 id="2.5.1" class="anchor">
<a class="anchor__link" href="#2.5.1">#</a>Generic Arithmetic Operations<small class="number">2.5.1</small>
</h3>
<ul>
<li>We want <code>add</code> to work for primitive numbers, rational numbers, and complex numbers.</li>
<li>We will attach a type tag to each kind of number.</li>
<li>Just as we did in our first data-directed example, we will install a “package” for each kind of data.</li>
<li>For complex numbers we have two levels of tagging: a <code>'complex</code> tag on top of the <code>'rectangular</code> or <code>'polar</code> tag.</li>
<li>The tags get stripped off as the data is passed down through packages to the appropriate specific procedure.</li>
</ul>
<h2 id="2.5.2" class="anchor">
<a class="anchor__link" href="#2.5.2">#</a>Combining Data of Different Types<small class="number">2.5.2</small>
</h3>
<ul>
<li>In our unified arithmetic system, we ignored an important issue.</li>
<li>We did not consider the possibility of operations that cross type boundaries, like adding a Scheme number to a rational.</li>
<li>One solution would be to design a procedure for each possible combination of types.</li>
<li>This is cumbersome, and it violates modularity.</li>
</ul>
<h3 id="2.5.2.1" class="anchor">
<a class="anchor__link" href="#2.5.2.1">#</a>Coercion
</h3>
<ul>
<li>Often the different data types are not completely independent.</li>
<li>For example, any real number can be expressed as a complex number with an imaginary part of zero (but not vice versa).</li>
<li>We can make all operations work on combinations of Scheme numbers and complex numbers by promoting, or coercing, the former to the latter type and then using the complex number procedure.</li>
<li>Here is a typical coercion procedure:</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode scheme"><code class="sourceCode scheme"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>(<span class="ex">define</span><span class="fu"> </span>(scheme-number-&gt;complex n)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  (make-complex-from-real-imag (contents n) <span class="dv">0</span>))</span></code></pre></div>
<ul>
<li>In addition to the generic procedure table, we would need a special coercion table.</li>
<li>We can modify <code>apply-generic</code> to try coercion if there is no specific procedure available for the given types.</li>
<li>The big advantage of coercion is that, although we may need to write many coercion procedures, we only need to write specific operation procedures once per type.</li>
<li>It gets more complicated: what if both types can be converted to a third type? What if A can be converted to B and then from B to C? We have a graph of relations among the types.</li>
</ul>
<h3 id="2.5.2.2" class="anchor">
<a class="anchor__link" href="#2.5.2.2">#</a>Hierarchies of types
</h3>
<ul>
<li>Integers are a subtype of rationals, which are a subtype of real numbers, and so on for complex numbers.</li>
<li>We have supertypes going in the opposite order.</li>
<li>A simple hierarchy where each type has at most one supertype and most one subtype is called a tower.</li>
<li>Coercion then simply becomes a matter of raising the argument whose type is lower in the tower to the level of the other type.</li>
<li>We can write fewer procedures by allowing types to <em>inherit</em> the operations on supertypes.</li>
<li>In some cases we can also lower a value down the type tower.</li>
</ul>
<h3 id="2.5.2.3" class="anchor">
<a class="anchor__link" href="#2.5.2.3">#</a>Inadequacies of hierarchies
</h3>
<ul>
<li>In general, a type may have more than one subtype (not a tower).</li>
<li>Having multiple super types is tricky, since the type can be raised via multiple paths to search for a procedure.</li>
<li>Large numbers of interrelated types conflicts with modularity.</li>
</ul>
<h2 id="2.5.3" class="anchor">
<a class="anchor__link" href="#2.5.3">#</a>Example: Symbolic Algebra<small class="number">2.5.3</small>
</h3>
<ul>
<li>The manipulation of symbolic algebraic expressions is hard.</li>
<li>We can view them as hierarchical structures – a tree of operators applied to operands.</li>
<li>A complete system would be exceedingly complex.</li>
<li>We will just look at the arithmetic of polynomials.</li>
</ul>
<h3 id="2.5.3.1" class="anchor">
<a class="anchor__link" href="#2.5.3.1">#</a>Arithmetic on polynomials
</h3>
<ul>
<li>A polynomial is relative to certain variables, the <em>indeterminates</em>.</li>
<li>We will only consider univariate polynomials.</li>
<li>The polynomial is a sum of terms, each being a coefficient, a power of the indeterminate, or a product of the two.</li>
<li>A coefficient is an algebraic expression that is not dependent upon the indeterminate of the polynomial.</li>
<li>Our polynomials will be syntactic forms, not representations of mathematical functions.</li>
<li>This means that replacing each <span class="math inline">x</span> with <span class="math inline">y</span> creates a different polynomial, although they could represent the same function.</li>
<li>We will only do addition and multiplication.</li>
<li>Both operands must have the same indeterminate.</li>
<li>The <em>poly</em> data structure consists of a variable (the indeterminate) and a list of terms.</li>
<li>Our system works with polynomials with polynomial coefficients “for free” because of data-directed recursion – because we are using generic procedures.</li>
</ul>
<h3 id="2.5.3.2" class="anchor">
<a class="anchor__link" href="#2.5.3.2">#</a>Representing term lists
</h3>
<ul>
<li>Our procedures <code>add-terms</code> and <code>mul-terms</code> always access term lists sequentially from highest to lowest order.</li>
<li>So, we need some kind of ordered list representation.</li>
<li>We can choose between <em>dense</em> and <em>sparse</em> representations.</li>
<li>Dense term lists, where most coefficients are nonzero, are best represented by simple lists.</li>
<li>Sparse term lists, where there are many zeros, are better represented by some kind of associative list or map.</li>
</ul>
<h3 id="2.5.3.3" class="anchor">
<a class="anchor__link" href="#2.5.3.3">#</a>Hierarchies of types in symbolic algebra
</h3>
<ul>
<li>Our polynomial system used complex objects that had objects of many different parts as types.</li>
<li>It was recursive data abstraction because the terms of the polynomial could themselves be polynomials.</li>
<li>The data types in polynomial algebra cannot be arranged in a tower.</li>
<li>Controlling coercion is a hard problem in these systems.</li>
</ul>
<h3 id="2.5.3.4" class="anchor">
<a class="anchor__link" href="#2.5.3.4">#</a>Extended exercise: Rational functions
</h3>
<ul>
<li>Rational functions are “fractions” with polynomial numerators and denominators.</li>
<li>We can use our old rational package, but we need to change a few things (like using generic <code>add</code>, <code>mul</code>, etc.).</li>
<li>We can reduce rational functions as long as we can compute the GCD of two polynomials (which in turn uses the remainder operation on two polynomials).</li>
<li>Problem: we end up with a GCD polynomial that has fractional coefficients. Solution: multiply the first argument by an <em>integerizing factor</em>.</li>
<li>We can use our GCD procedure to reduce rational functions to lowest terms:
<ol type="1">
<li>Compute the integerized GCD of the numerator and denominator.</li>
<li>Multiply the numerator and denominator by an integerizing factor: the leading coefficient of the GCD raised to the power <span class="math inline">1 + O_1 - O_2</span>, where <span class="math inline">O_2</span> is the order of the GCD and <span class="math inline">O_1</span> is the maximum of order of the numerator and the order of the denominator.</li>
<li>Divide the new numerator and new denominator by the GCD.</li>
<li>Divide both by the GCD of all their coefficients.</li>
</ol></li>
<li>This GCD algorithm, or something like it, is at the heart of every system that does operations on rational functions.</li>
<li>This one is very slow. Probabilistic algorithms are faster.</li>
</ul>
<nav class="pagenav pagenav--bottom">
  <div class="pagenav__item pagenav__item--prev"><a class="pagenav__link" href="4.html">← Prev</a></div>
  <div class="pagenav__item pagenav__item--up"><a class="pagenav__link" href="index.html">↑ Up</a></div>
  <div class="pagenav__item pagenav__item--next"><a class="pagenav__link" href="../3/index.html">Next →</a></div>
</nav>
<footer class="footer">© 2020 Mitchell Kember</footer>
</body>
</html>
