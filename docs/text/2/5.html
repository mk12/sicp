<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Mitchell Kember">
  <title>SICP Section 2.5 Notes</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
   var mathElements = document.getElementsByClassName("math");
   var macros = [];
   for (var i = 0; i < mathElements.length; i++) {
    var texText = mathElements[i].firstChild;
    if (mathElements[i].tagName == "SPAN") {
     katex.render(texText.data, mathElements[i], {
      displayMode: mathElements[i].classList.contains('display'),
      throwOnError: false,
      macros: macros,
      fleqn: false
     });
  }}});
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" />
  <link rel="stylesheet" href="../../assets/style.css">
</head>
<body>
<header class="header ">
  <a class="title link" href="../../index.html">SICP Study</a>
  <nav class="sitenav" aria-label="primary">
    <a class="sitenav__item link  sitenav__item--active"
      href="../../text/index.html">Text</a>
    <a class="sitenav__item link "
      href="../../lecture/index.html">Lecture</a>
    <a class="sitenav__item link "
      href="../../exercise/index.html">Exercise</a>
    <a class="sitenav__item sitenav__item--last link"
      href="https://github.com/mk12/sicp">Source
      <svg alt="GitHub Mark" class="github-mark" width="25" height="25" viewBox="0 0 136 133">
        <path d="M67.866.002C30.387.002 0 30.39 0 67.877c0 29.988 19.446 55.425 46.417 64.404 3.396.621 4.633-1.475 4.633-3.275 0-1.608-.058-5.879-.091-11.541-18.88 4.1-22.863-9.1-22.863-9.1-3.087-7.838-7.537-9.925-7.537-9.925-6.163-4.213.466-4.13.466-4.13 6.813.484 10.396 6.996 10.396 6.996 6.054 10.371 15.888 7.375 19.754 5.642.617-4.387 2.367-7.38 4.309-9.075-15.071-1.712-30.917-7.537-30.917-33.546 0-7.408 2.646-13.466 6.988-18.212-.7-1.717-3.03-8.617.662-17.963 0 0 5.7-1.825 18.667 6.959 5.412-1.505 11.22-2.259 16.992-2.284 5.762.025 11.57.78 16.991 2.284 12.959-8.784 18.646-6.959 18.646-6.959 3.704 9.346 1.375 16.246.675 17.963 4.35 4.746 6.98 10.804 6.98 18.212 0 26.075-15.872 31.813-30.992 33.492 2.437 2.096 4.608 6.237 4.608 12.57 0 9.072-.083 16.392-.083 18.617 0 1.817 1.22 3.93 4.666 3.267 26.95-8.996 46.38-34.417 46.38-64.396 0-37.487-30.392-67.875-67.88-67.875"/>
      </svg>
    </a>
  </nav>
</header>
<nav class="pagenav pagenav--top" aria-label="secondary">
  <div class="pagenav__item pagenav__item--prev">
    <a class="pagenav__link link" href="4.html">
      <svg alt="" class="arrow" width="18" height="18" viewBox="0 0 24 24">
    <path d="M5 12h14M5 12l6 6M5 12l6-6"/>
  </svg> Prev
    </a>
  </div>
  <div class="pagenav__item pagenav__item--up">
    <a class="pagenav__link link" href="index.html"><svg alt="" class="arrow" width="18" height="18" viewBox="0 0 24 24">
    <path d="M12 5v14M18 11l-6-6M6 11l6-6"/>
  </svg> Up</a>
  </div>
  <div class="pagenav__item pagenav__item--next">
    <a class="pagenav__link link" href="../3/index.html">
      Next <svg alt="" class="arrow" width="18" height="18" viewBox="0 0 24 24">
    <path d="M5 12h14M13 18l6-6M13 6l6 6"/>
  </svg>
    </a>
  </div>
  </nav>
<main>

<h1>
<small class="number">2.5</small>Systems with Generic Operations
</h1>
<ul>
<li>The key idea in <a href="4.html#2.4.3">§ 2.4.3</a>: link specific data operations to multiple representations using generic procedures.</li>
<li>We can extend this further to create operations that are generic over different kinds of arguments, not just different representations of the same kind of data.</li>
<li>We have seen several different arithmetic packages—primitive numbers, rational numbers, intervals, and complex numbers.</li>
<li>We will use data-directed techniques to write procedures that work on all of these data structures.</li>
<li>This will require many abstraction barriers.</li>
<li>The result will be additive (modular)—easy to add new types.</li>
</ul>
<h2 id="2.5.1" class="anchor">
<a class="anchor__link link" href="#2.5.1">#</a><small class="number">2.5.1</small>Generic Arithmetic Operations
</h3>
<ul>
<li>We want <code>add</code> to work for primitive numbers, rational numbers, and complex numbers.</li>
<li>We will attach a type tag to each kind of number.</li>
<li>Just as we did in our first data-directed example, we will install a “package” for each kind of data.</li>
<li>For complex numbers we have two levels of tagging: a <code>'complex</code> tag on top of the <code>'rectangular</code> or <code>'polar</code> tag.</li>
<li>The tags get stripped off as the data is passed down through packages to the appropriate specific procedure.</li>
</ul>
<h2 id="2.5.2" class="anchor">
<a class="anchor__link link" href="#2.5.2">#</a><small class="number">2.5.2</small>Combining Data of Different Types
</h3>
<ul>
<li>In our unified arithmetic system, we ignored an important issue.</li>
<li>We did not consider the possibility of operations that cross type boundaries, like adding a Scheme number to a rational.</li>
<li>One solution would be to design a procedure for each possible combination of types.</li>
<li>This is cumbersome, and it violates modularity.</li>
</ul>
<h3 id="2.5.2.1" class="anchor">
<a class="anchor__link link" href="#2.5.2.1">#</a>Coercion
</h3>
<ul>
<li>Often the different data types are not completely independent.</li>
<li>For example, any real number can be expressed as a complex number with an imaginary part of zero (but not vice versa).</li>
<li>We can make all operations work on combinations of Scheme numbers and complex numbers by promoting, or coercing, the former to the latter type and then using the complex number procedure.</li>
<li>Here is a typical coercion procedure:</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode scheme"><code class="sourceCode scheme"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">define</span> (scheme-number-&gt;complex n)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  (make-complex-from-real-imag (contents n) <span class="cn">0</span>))</span></code></pre></div>
<ul>
<li>In addition to the generic procedure table, we would need a special coercion table.</li>
<li>We can modify <code>apply-generic</code> to try coercion if there is no specific procedure available for the given types.</li>
<li>The big advantage of coercion is that, although we may need to write many coercion procedures, we only need to write specific operation procedures once per type.</li>
<li>It gets more complicated: what if both types can be converted to a third type? What if A can be converted to B and then from B to C? We have a graph of relations among the types.</li>
</ul>
<h3 id="2.5.2.2" class="anchor">
<a class="anchor__link link" href="#2.5.2.2">#</a>Hierarchies of types
</h3>
<ul>
<li>Integers are a subtype of rationals, which are a subtype of real numbers, and so on for complex numbers.</li>
<li>We have supertypes going in the opposite order.</li>
<li>A simple hierarchy where each type has at most one supertype and most one subtype is called a tower.</li>
<li>Coercion then simply becomes a matter of raising the argument whose type is lower in the tower to the level of the other type.</li>
<li>We can write fewer procedures by allowing types to <em>inherit</em> the operations on supertypes.</li>
<li>In some cases we can also lower a value down the type tower.</li>
</ul>
<h3 id="2.5.2.3" class="anchor">
<a class="anchor__link link" href="#2.5.2.3">#</a>Inadequacies of hierarchies
</h3>
<ul>
<li>In general, a type may have more than one subtype (not a tower).</li>
<li>Having multiple super types is tricky, since the type can be raised via multiple paths to search for a procedure.</li>
<li>Large numbers of interrelated types conflicts with modularity.</li>
</ul>
<h2 id="2.5.3" class="anchor">
<a class="anchor__link link" href="#2.5.3">#</a><small class="number">2.5.3</small>Example: Symbolic Algebra
</h3>
<ul>
<li>The manipulation of symbolic algebraic expressions is hard.</li>
<li>We can view them as hierarchical structures—a tree of operators applied to operands.</li>
<li>A complete system would be exceedingly complex.</li>
<li>We will just look at the arithmetic of polynomials.</li>
</ul>
<h3 id="2.5.3.1" class="anchor">
<a class="anchor__link link" href="#2.5.3.1">#</a>Arithmetic on polynomials
</h3>
<ul>
<li>A polynomial is relative to certain variables, the <em>indeterminates</em>.</li>
<li>We will only consider univariate polynomials.</li>
<li>The polynomial is a sum of terms, each being a coefficient, a power of the indeterminate, or a product of the two.</li>
<li>A coefficient is an algebraic expression that is not dependent upon the indeterminate of the polynomial.</li>
<li>Our polynomials will be syntactic forms, not representations of mathematical functions.</li>
<li>This means that replacing each <span class="math inline">x</span> with <span class="math inline">y</span> creates a different polynomial, although they could represent the same function.</li>
<li>We will only do addition and multiplication.</li>
<li>Both operands must have the same indeterminate.</li>
<li>The <em>poly</em> data structure consists of a variable (the indeterminate) and a list of terms.</li>
<li>Our system works with polynomials with polynomial coefficients “for free” because of data-directed recursion—because we are using generic procedures.</li>
</ul>
<h3 id="2.5.3.2" class="anchor">
<a class="anchor__link link" href="#2.5.3.2">#</a>Representing term lists
</h3>
<ul>
<li>Our procedures <code>add-terms</code> and <code>mul-terms</code> always access term lists sequentially from highest to lowest order.</li>
<li>So, we need some kind of ordered list representation.</li>
<li>We can choose between <em>dense</em> and <em>sparse</em> representations.</li>
<li>Dense term lists, where most coefficients are nonzero, are best represented by simple lists.</li>
<li>Sparse term lists, where there are many zeros, are better represented by some kind of associative list or map.</li>
</ul>
<h3 id="2.5.3.3" class="anchor">
<a class="anchor__link link" href="#2.5.3.3">#</a>Hierarchies of types in symbolic algebra
</h3>
<ul>
<li>Our polynomial system used complex objects that had objects of many different parts as types.</li>
<li>It was recursive data abstraction because the terms of the polynomial could themselves be polynomials.</li>
<li>The data types in polynomial algebra cannot be arranged in a tower.</li>
<li>Controlling coercion is a hard problem in these systems.</li>
</ul>
<h3 id="2.5.3.4" class="anchor">
<a class="anchor__link link" href="#2.5.3.4">#</a>Extended exercise: Rational functions
</h3>
<ul>
<li>Rational functions are “fractions” with polynomial numerators and denominators.</li>
<li>We can use our old rational package, but we need to change a few things (like using generic <code>add</code>, <code>mul</code>, etc.).</li>
<li>We can reduce rational functions as long as we can compute the GCD of two polynomials (which in turn uses the remainder operation on two polynomials).</li>
<li>Problem: we end up with a GCD polynomial that has fractional coefficients. Solution: multiply the first argument by an <em>integerizing factor</em>.</li>
<li>We can use our GCD procedure to reduce rational functions to lowest terms:
<ol type="1">
<li>Compute the integerized GCD of the numerator and denominator.</li>
<li>Multiply the numerator and denominator by an integerizing factor: the leading coefficient of the GCD raised to the power <span class="math inline">1 + O_1 - O_2</span>, where <span class="math inline">O_2</span> is the order of the GCD and <span class="math inline">O_1</span> is the maximum of order of the numerator and the order of the denominator.</li>
<li>Divide the new numerator and new denominator by the GCD.</li>
<li>Divide both by the GCD of all their coefficients.</li>
</ol></li>
<li>This GCD algorithm, or something like it, is at the heart of every system that does operations on rational functions.</li>
<li>This one is very slow. Probabilistic algorithms are faster.</li>
</ul>
</main>
<nav class="pagenav pagenav--bottom" aria-label="secondary">
  <div class="pagenav__item pagenav__item--prev">
    <a class="pagenav__link link" href="4.html">
      <svg alt="" class="arrow" width="18" height="18" viewBox="0 0 24 24">
    <path d="M5 12h14M5 12l6 6M5 12l6-6"/>
  </svg> Prev
    </a>
  </div>
  <div class="pagenav__item pagenav__item--up">
    <a class="pagenav__link link" href="index.html"><svg alt="" class="arrow" width="18" height="18" viewBox="0 0 24 24">
    <path d="M12 5v14M18 11l-6-6M6 11l6-6"/>
  </svg> Up</a>
  </div>
  <div class="pagenav__item pagenav__item--next">
    <a class="pagenav__link link" href="../3/index.html">
      Next <svg alt="" class="arrow" width="18" height="18" viewBox="0 0 24 24">
    <path d="M5 12h14M13 18l6-6M13 6l6 6"/>
  </svg>
    </a>
  </div>
  </nav>
<footer class="footer">
  <p>© 2020 Mitchell Kember</p>
</footer>
</body>
</html>
