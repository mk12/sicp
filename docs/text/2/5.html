<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SICP Section 2.5 Notes</title>
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css">
  <link rel="stylesheet" href="../../style.css">
</head>
<body>
<div hidden>
  <svg>
    <symbol id="up" viewBox="0 0 11 12">
      <path fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" d="M5.5.8v10.4m4.457-5.943L5.5.8 1.043 5.257"/>
    </symbol>
    <symbol id="left" viewBox="0 0 12 11">
      <path fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" d="M.8 5.5h10.4M5.257 9.957L.8 5.5l4.457-4.457"/>
    </symbol>
    <symbol id="right" viewBox="0 0 12 11">
      <use xlink:href="#left" transform="matrix(-1 0 0 1 12 0)"/>
    </symbol>
    <symbol id="external" viewBox="0 0 24 24">
      <path fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" d="M10.688 5.438H4.125A2.65 2.65 0 001.5 8.063v11.812A2.65 2.65 0 004.125 22.5h11.813a2.65 2.65 0 002.624-2.625v-6.563m-9.187 1.313L22.5 1.5m-6.563 0H22.5v6.563"/>
    </symbol>
    <symbol id="circle-left" viewBox="0 0 18 18" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="9" stroke-width="1.69" transform="matrix(.8889 0 0 .8889 -1.667 -1.667)"/>
      <path stroke-width="1.5" d="M5.229 9h7.542M9 5.229L5.229 9 9 12.771"/>
    </symbol>
  </svg>
</div>
<a class="skip-link" href="#main">Skip to main content</a>
<header class="header">
  <a class="title link" href="../../index.html">SICP Study</a>
  <nav class="sitenav" aria-label="site">
    <a class="sitenav__item sitenav__item--active link"
        href="../../text/index.html" aria-label="textbook notes">Text</a>
    <a class="sitenav__item link"
        href="../../lecture/index.html" aria-label="lecture notes">Lecture</a>
    <a class="sitenav__item link"
        href="../../exercise/index.html" aria-label="exercises">Exercise</a>
    <a class="sitenav__item sitenav__item--last link"
        href="https://github.com/mk12/sicp" aria-label="GitHub repository">
      Source
      <svg class="github-mark" width="25" height="25" viewBox="0 0 136 133" aria-hidden="true">
        <path fill="currentColor" d="M67.866.002C30.387.002 0 30.39 0 67.877c0 29.988 19.446 55.425 46.417 64.404 3.396.621 4.633-1.475 4.633-3.275 0-1.608-.058-5.879-.091-11.541-18.88 4.1-22.863-9.1-22.863-9.1-3.087-7.838-7.537-9.925-7.537-9.925-6.163-4.213.466-4.13.466-4.13 6.813.484 10.396 6.996 10.396 6.996 6.054 10.371 15.888 7.375 19.754 5.642.617-4.387 2.367-7.38 4.309-9.075-15.071-1.712-30.917-7.537-30.917-33.546 0-7.408 2.646-13.466 6.988-18.212-.7-1.717-3.03-8.617.662-17.963 0 0 5.7-1.825 18.667 6.959 5.412-1.505 11.22-2.259 16.992-2.284 5.762.025 11.57.78 16.991 2.284 12.959-8.784 18.646-6.959 18.646-6.959 3.704 9.346 1.375 16.246.675 17.963 4.35 4.746 6.98 10.804 6.98 18.212 0 26.075-15.872 31.813-30.992 33.492 2.437 2.096 4.608 6.237 4.608 12.57 0 9.072-.083 16.392-.083 18.617 0 1.817 1.22 3.93 4.666 3.267 26.95-8.996 46.38-34.417 46.38-64.396 0-37.487-30.392-67.875-67.88-67.875"/>
      </svg>      
    </a>
  </nav>
</header>
<nav class="pagenav pagenav--top" aria-label="page">
  <div class="pagenav__item pagenav__item--left">
    <a class="pagenav__link link" href="4.html" aria-label="previous page">
      <svg width="12" height="11" aria-hidden="true"><use xlink:href="#left"/>
      </svg><span class="pagenav__prev">Prev</span>
    </a>
  </div>
  <div class="pagenav__item pagenav__item--center">
    <a class="pagenav__link link" href="index.html" aria-label="parent page">
      <svg width="11" height="12" aria-hidden="true"><use xlink:href="#up"/>
      </svg><span class="pagenav__up">Up</span>
    </a>
  </div>
  <div class="pagenav__item pagenav__item--right">
    <a class="pagenav__link link" href="../3/index.html" aria-label="next page">
      <span class="pagenav__next">Next</span
        ><svg width="12" height="11" aria-hidden="true"
        ><use xlink:href="#right"/></svg>
    </a>
  </div>
</nav>
<main id="main">
<h1>
<span class="number">2.5</span> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html">Systems with Generic Operations<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h1>
<ul>
<li>In <a href="4.html">§&nbsp;2.4</a> we saw how to create operations that work on multiple data representations.</li>
<li>We can extend this further to create operations that are generic over different kinds of arguments, not just different representations of the same kind of data.</li>
<li>We will develop a general arithmetic system using data-directed programming that works on several kinds of numbers.</li>
</ul>
<h2 id="2.5.1" class="anchor">
<a class="anchor__link link" href="#2.5.1" aria-hidden="true">#</a> <span class="number">2.5.1</span> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html#%25_sec_2.5.1">Generic Arithmetic Operations<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h2>
<ul>
<li>We want <code>add</code> to work for primitive, rational, and complex numbers.</li>
<li>We will attach a type tag to each kind of number. Complex numbers will have two levels of tagging: a <code>'complex</code> tag on top of the <code>'rectangular</code> or <code>'polar</code> tag.</li>
<li>The tags get stripped off as the data is passed down through packages to the appropriate specific procedure.</li>
</ul>
<pre><code class="codeblock">(<span class="kw">define</span> (add x y) (apply-generic <span class="qu">'add</span> x y))
(<span class="kw">define</span> (sub x y) (apply-generic <span class="qu">'sub</span> x y))
(<span class="kw">define</span> (mul x y) (apply-generic <span class="qu">'mul</span> x y))
(<span class="kw">define</span> (div x y) (apply-generic <span class="qu">'div</span> x y))</code></pre>
<ul>
<li>Here is the arithmetic package for Scheme numbers:</li>
</ul>
<pre><code class="codeblock">(<span class="kw">define</span> (install-scheme-number-package)
  (<span class="kw">define</span> (tag x)
    (attach-tag <span class="qu">'scheme-number</span> x))
  (put <span class="qu">'add '(scheme-number scheme-number)</span>
       (<span class="kw">lambda</span> (x y) (tag (<span class="fu">+</span> x y))))
  (put <span class="qu">'sub '(scheme-number scheme-number)</span>
       (<span class="kw">lambda</span> (x y) (tag (<span class="fu">-</span> x y))))
  (put <span class="qu">'mul '(scheme-number scheme-number)</span>
       (<span class="kw">lambda</span> (x y) (tag (<span class="fu">*</span> x y))))
  (put <span class="qu">'div '(scheme-number scheme-number)</span>
       (<span class="kw">lambda</span> (x y) (tag (<span class="fu">/</span> x y))))
  (put <span class="qu">'make 'scheme-number</span>
       (<span class="kw">lambda</span> (x) (tag x)))
  <span class="qu">'done</span>)

(<span class="kw">define</span> (make-scheme-number n)
  ((get <span class="qu">'make 'scheme-number</span>) n))</code></pre>
<ul>
<li>We can implement similar packages for rational and complex numbers.</li>
</ul>
<aside><h4>Exercises:</h4> <ul class="flat"><li class="flat__item"><a href="../../exercise/2/5.html#ex2.77">2.77</a>, </li><li class="flat__item"><a href="../../exercise/2/5.html#ex2.78">2.78</a>, </li><li class="flat__item"><a href="../../exercise/2/5.html#ex2.79">2.79</a>, </li><li class="flat__item"><a href="../../exercise/2/5.html#ex2.80">2.80</a></li></ul></aside>
<h2 id="2.5.2" class="anchor">
<a class="anchor__link link" href="#2.5.2" aria-hidden="true">#</a> <span class="number">2.5.2</span> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html#%25_sec_2.5.2">Combining Data of Different Types<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h2>
<ul>
<li>In our unified arithmetic system, we ignored an important issue: we did not consider operations that cross type boundaries, like adding a Scheme number to a rational.</li>
<li>One solution would be to design a procedure for every possible combination of types. But this is cumbersome, and it violates modularity.</li>
</ul>
<h3 id="2.5.2.1" class="anchor">
<a class="anchor__link link" href="#2.5.2.1" aria-hidden="true">#</a> Coercion
</h3>
<ul>
<li>Often the different data types are not completely independent.</li>
<li>For example, any real number can be expressed as a complex number with an imaginary part of zero.</li>
<li>We can make all operations work on combinations of Scheme numbers and complex numbers by first <em>coercing</em> the former to the latter.</li>
<li>Here is a typical coercion procedure:</li>
</ul>
<pre><code class="codeblock">(<span class="kw">define</span> (scheme-number-&gt;complex n)
  (make-complex-from-real-imag (contents n) <span class="cn">0</span>))</code></pre>
<ul>
<li>The big advantage of coercion is that, although we may need to write many coercion procedures, we only need to implement each operation once per type.</li>
<li>We could modify <code>apply-generic</code> to try coercion if there is no specific procedure available for the given types.</li>
<li>But it gets complicated. What if both types can be converted to a third type? What if multiple coercions are required? We end up with a graph of relations among types.</li>
</ul>
<h3 id="2.5.2.2" class="anchor">
<a class="anchor__link link" href="#2.5.2.2" aria-hidden="true">#</a> Hierarchies of types
</h3>
<ul>
<li>We can simplify the problem by using a <em>type hierarchy</em> instead of an arbitrary graph.</li>
<li>In the hiearchy, each type is related to supertypes above it and subtypes below it.</li>
<li>A <em>tower</em> is a hiearchy where each type has at most one supertype and subtype.</li>
<li>Our numeric tower comprises integers, rationals, real numbers, and complex numbers.</li>
<li>Coercion then simply becomes a matter of raising the argument whose type is lower in the tower to the level of the other type.</li>
<li>We can write fewer procedures by allowing types to <em>inherit</em> their supertype’s operations.</li>
<li>In some cases we can simplify results by lowering a value down the type tower.</li>
</ul>
<h3 id="2.5.2.3" class="anchor">
<a class="anchor__link link" href="#2.5.2.3" aria-hidden="true">#</a> Inadequacies of hierarchies
</h3>
<ul>
<li>In general, a type may have more than one subtype. This is easy to deal with.</li>
<li>Allowing multiple super types (known as <em>multiple inheritance</em>) is tricky, since the type can be raised via multiple paths to search for a procedure.</li>
<li>Having large numbers of interrelated types conflicts with modularity.</li>
</ul>
<div id="q1" class="highlight">
<a class="highlight__link link" href="../highlight.html#2.5-q1" aria-label="view quote in highlights page"><svg class="circle-arrow" width="18" height="18" aria-hidden="true"><use xlink:href="#circle-left"/></svg> Highlights</a>
<blockquote>
<p>Developing a useful, general framework for expressing the relations among different types of entities (what philosophers call “ontology”) seems intractably difficult. The main difference between the confusion that existed ten years ago and the confusion that exists now is that now a variety of inadequate ontological theories have been embodied in a plethora of correspondingly inadequate programming languages. For example, much of the complexity of object-oriented programming languages—and the subtle and confusing differences among contemporary object-oriented languages—centers on the treatment of generic operations on interrelated types. <a class="citation" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html#footnote_Temp_289" title="SICP Chapter 2, Footnote 52">(Footnote&nbsp;2.52)</a></p>
</blockquote>
</div>
<aside><h4>Exercises:</h4> <ul class="flat"><li class="flat__item"><a href="../../exercise/2/5.html#ex2.81">2.81</a>, </li><li class="flat__item"><a href="../../exercise/2/5.html#ex2.82">2.82</a>, </li><li class="flat__item"><a href="../../exercise/2/5.html#ex2.83">2.83</a>, </li><li class="flat__item"><a href="../../exercise/2/5.html#ex2.84">2.84</a>, </li><li class="flat__item"><a href="../../exercise/2/5.html#ex2.85">2.85</a>, </li><li class="flat__item"><a href="../../exercise/2/5.html#ex2.86">2.86</a></li></ul></aside>
<h2 id="2.5.3" class="anchor">
<a class="anchor__link link" href="#2.5.3" aria-hidden="true">#</a> <span class="number">2.5.3</span> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html#%25_sec_2.5.3">Example: Symbolic Algebra<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h2>
<ul>
<li>Manipulating symbolic algebraic expressions is hard.</li>
<li>We can view them as trees of operators applied to operands.</li>
<li>To keep things simple, we’ll stick to polynomials.</li>
</ul>
<h3 id="2.5.3.1" class="anchor">
<a class="anchor__link link" href="#2.5.3.1" aria-hidden="true">#</a> Arithmetic on polynomials
</h3>
<ul>
<li>Polynomials are expressed in terms of variables called <em>indeterminates</em>.</li>
<li>A <em>univariate</em> polynomial has the form <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>c</mi><mn>0</mn></msub><mo>+</mo><msub><mi>c</mi><mn>1</mn></msub><mi>x</mi><mo>+</mo><msub><mi>c</mi><mn>2</mn></msub><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mo>⋯</mo><mo>+</mo><msub><mi>c</mi><mi>n</mi></msub><msup><mi>x</mi><mi>n</mi></msup><mtext>.</mtext></mrow><annotation encoding="application/x-tex">c_0 + c_1x + c_2x^2 + \cdots + c_nx^n\htmlClass{math-punctuation}{\text{.}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.964108em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.814392em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="enclosing math-punctuation"><span class="mord text"><span class="mord">.</span></span></span></span></span></span></li>
<li>To avoid thorny issues of identity and sameness, we will consider our polynomials to be syntactic forms, not representations of mathematical functions.</li>
<li>We will implement addition and multiplication for polynomials in the same variable.</li>
</ul>
<pre><code class="codeblock">(<span class="kw">define</span> (add-poly p1 p2)
  (<span class="kw">if</span> (same-variable? (variable p1) (variable p2))
      (make-poly (variable p1)
                 (add-terms (term-list p1)
                            (term-list p2)))
      (<span class="fu">error</span> <span class="cn">"polys not in same var"</span> p1 p2)))

(<span class="kw">define</span> (mul-poly p1 p2)
  (<span class="kw">if</span> (same-variable? (variable p1) (variable p2))
      (make-poly (variable p1)
                 (mul-terms (term-list p1)
                            (term-list p2)))
      (<span class="fu">error</span> <span class="cn">"polys not in same var"</span> p1 p2)))</code></pre>
<ul>
<li>We will install these procedures in our generic arithmetic system:</li>
</ul>
<pre><code class="codeblock">(<span class="kw">define</span> (install-polynomial-package)
  <span class="at">;; Internal procedures</span>
  (<span class="kw">define</span> (make-poly variable term-list)
    (<span class="fu">cons</span> variable term-list))
  (<span class="kw">define</span> (variable p) (<span class="fu">car</span> p))
  (<span class="kw">define</span> (term-list p) (<span class="fu">cdr</span> p))
  (<span class="kw">define</span> (add-poly p1 p2) ...)
  (<span class="kw">define</span> (mul-poly p1 p2) ...)

  <span class="at">;; Interface to rest of the system</span>
  (<span class="kw">define</span> (tag p) (attach-tag <span class="qu">'polynomial</span> p))
  (put <span class="qu">'add '(polynomial polynomial)</span>
       (<span class="kw">lambda</span> (p1 p2) (tag (add-poly p1 p2))))
  (put <span class="qu">'mul '(polynomial polynomial)</span>
       (<span class="kw">lambda</span> (p1 p2) (tag (mul-poly p1 p2))))
  (put <span class="qu">'make 'polynomial</span>
       (<span class="kw">lambda</span> (var terms) (tag (make-poly var terms))))
  <span class="qu">'done</span>)</code></pre>
<ul>
<li>Here is the implementation of <code>add-terms</code>:</li>
</ul>
<pre><code class="codeblock">(<span class="kw">define</span> (add-terms L1 L2)
  (<span class="kw">cond</span> ((empty-termlist? L1) L2)
        ((empty-termlist? L2) L1)
        (<span class="kw">else</span>
         (<span class="kw">let</span> ((t1 (first-term L1)) (t2 (first-term L2)))
           (<span class="kw">cond</span> ((<span class="fu">&gt;</span> (order t1) (order t2))
                  (adjoin-term
                   t1 (add-terms (rest-terms L1) L2)))
                 ((<span class="fu">&lt;</span> (order t1) (order t2))
                  (adjoin-term
                   t2 (add-terms L1 (rest-terms L2))))
                 (<span class="kw">else</span>
                  (adjoin-term
                   (make-term (order t1)
                              (add (coeff t1) (coeff t2)))
                   (add-terms (rest-terms L1)
                              (rest-terms L2)))))))))</code></pre>
<ul>
<li>Since it uses the generic <code>add</code> internally, the system automatically works with polynomials whose coefficients are themselves polynomials in a different variable!</li>
</ul>
<h3 id="2.5.3.2" class="anchor">
<a class="anchor__link link" href="#2.5.3.2" aria-hidden="true">#</a> Representing term lists
</h3>
<ul>
<li>Our procedures <code>add-terms</code> and <code>mul-terms</code> always access terms sequentially from highest to lowest order, so we need some kind of ordered representation.</li>
<li>For <em>dense</em> polynomials (mostly nonzero coefficients), a simple list is best.
<ul>
<li><em>Example</em>: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>x</mi><mn>5</mn></msup><mo>+</mo><mn>2</mn><msup><mi>x</mi><mn>4</mn></msup><mo>+</mo><mn>3</mn><msup><mi>x</mi><mn>2</mn></msup><mo>−</mo><mn>2</mn><mi>x</mi><mo>−</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">x^5+2x^4+3x^2-2x-5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord">3</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">5</span></span></span></span> becomes <code><span class="qu">'(1 2 3 -2 -5)</span></code>.</li>
</ul></li>
<li>For <em>sparse</em> polynomials (mostly zero coefficients), an associative list is best.
<ul>
<li><em>Example</em>: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>x</mi><mn>100</mn></msup><mo>+</mo><mn>2</mn><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">x^{100}+2x^2+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">0</span><span class="mord mtight">0</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> becomes <code><span class="qu">'((100 1) (2 2) (0 1))</span></code>.</li>
</ul></li>
<li>Here is an associative list representation:</li>
</ul>
<pre><code class="codeblock">(<span class="kw">define</span> (adjoin-term term term-list)
  (<span class="kw">if</span> (=zero? (coeff term))
      term-list
      (<span class="fu">cons</span> term term-list)))
(<span class="kw">define</span> (the-empty-termlist) <span class="qu">'()</span>)
(<span class="kw">define</span> (first-term term-list) (<span class="fu">car</span> term-list))
(<span class="kw">define</span> (rest-terms term-list) (<span class="fu">cdr</span> term-list))
(<span class="kw">define</span> (empty-termlist? term-list) (<span class="fu">null?</span> term-list))
(<span class="kw">define</span> (make-term order coeff) (<span class="fu">list</span> order coeff))
(<span class="kw">define</span> (order term) (<span class="fu">car</span> term))
(<span class="kw">define</span> (coeff term) (<span class="fu">cadr</span> term))</code></pre>
<aside><h4>Exercises:</h4> <ul class="flat"><li class="flat__item"><a href="../../exercise/2/5.html#ex2.87">2.87</a>, </li><li class="flat__item"><a href="../../exercise/2/5.html#ex2.88">2.88</a>, </li><li class="flat__item"><a href="../../exercise/2/5.html#ex2.89">2.89</a>, </li><li class="flat__item"><a href="../../exercise/2/5.html#ex2.90">2.90</a>, </li><li class="flat__item"><a href="../../exercise/2/5.html#ex2.91">2.91</a></li></ul></aside>
<h3 id="2.5.3.3" class="anchor">
<a class="anchor__link link" href="#2.5.3.3" aria-hidden="true">#</a> Hierarchies of types in symbolic algebra
</h3>
<ul>
<li>The data types in our polynomial algebra cannot easily be arranged in a tower.</li>
<li>For example, how would we coerce <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><msup><mi>y</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">(x+1)y^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mi>y</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><msup><mi>x</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">(y+1)x^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span> to a common type?</li>
</ul>
<blockquote>
<p>It should not be surprising that controlling coercion is a serious problem in the design of large-scale algebraic-manipulation systems. Much of the complexity of such systems is concerned with relationships among diverse types. Indeed, it is fair to say that we do not yet completely understand coercion. In fact, we do not yet completely understand the concept of a data type. Nevertheless, what we know provides us with powerful structuring and modularity principles to support the design of large systems. <a class="citation" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-18.html#%25_sec_2.5.3" title="SICP Section 2.5.3">(Section&nbsp;2.5.3)</a></p>
</blockquote>
<aside><h4>Exercises:</h4> <ul class="flat"><li class="flat__item"><a href="../../exercise/2/5.html#ex2.92">2.92</a></li></ul></aside>
<h3 id="2.5.3.4" class="anchor">
<a class="anchor__link link" href="#2.5.3.4" aria-hidden="true">#</a> Extended exercise: Rational functions
</h3>
<ul>
<li>Rational functions are “fractions” with polynomial numerators and denominators.</li>
<li>We can use our rational package from <a href="#2.5.1">§&nbsp;2.5.1</a>, but we need to change a few things.</li>
<li>To reduce rational functions, we need to be able to compute the GCD of polynomials, which in turn requires computing the remainder after polynomial division.</li>
<li>To avoid fractional coefficients, we can multiply the result by an <em>integerizing factor</em>.</li>
<li>Here is our algorithm for reducing a rational function to lowest terms:
<ol type="1">
<li>Compute the integerized GCD of the numerator and denominator.</li>
<li>Multiply the numerator and denominator by an integerizing factor: the leading coefficient of the GCD raised to the power <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mo>+</mo><mi>max</mi><mo>⁡</mo><mo stretchy="false">{</mo><msub><mi>O</mi><mtext>N</mtext></msub><mo separator="true">,</mo><msub><mi>O</mi><mtext>D</mtext></msub><mo stretchy="false">}</mo><mo>−</mo><msub><mi>O</mi><mtext>G</mtext></msub><mtext>,</mtext></mrow><annotation encoding="application/x-tex">1 + \max\{O_\text{N}, O_\text{D}\} - O_\text{G}\htmlClass{math-punctuation}{\text{,}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">max</span><span class="mopen">{</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">D</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">}</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">G</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="enclosing math-punctuation"><span class="mord text"><span class="mord">,</span></span></span></span></span></span> where those constants refer to the order of the numerator, denominator, and GCD, respectively.</li>
<li>Divide the results of (2) by the GCD from (1).</li>
<li>Divide the results of (3) by the GCD of all their coefficients.</li>
</ol></li>
<li>The GCD algorithm is at the heart of every system that does operations on rational functions. Ours is very slow. Probabilistic algorithms like Zippel’s are faster.</li>
</ul>
<aside><h4>Exercises:</h4> <ul class="flat"><li class="flat__item"><a href="../../exercise/2/5.html#ex2.93">2.93</a>, </li><li class="flat__item"><a href="../../exercise/2/5.html#ex2.94">2.94</a>, </li><li class="flat__item"><a href="../../exercise/2/5.html#ex2.95">2.95</a>, </li><li class="flat__item"><a href="../../exercise/2/5.html#ex2.96">2.96</a>, </li><li class="flat__item"><a href="../../exercise/2/5.html#ex2.97">2.97</a></li></ul></aside>
</main>
<nav class="pagenav pagenav--bottom" aria-label="page">
  <div class="pagenav__item pagenav__item--left">
    <a class="pagenav__link link" href="4.html" aria-label="previous page">
      <svg width="12" height="11" aria-hidden="true"><use xlink:href="#left"/>
      </svg><span class="pagenav__prev">Prev</span>
    </a>
  </div>
  <div class="pagenav__item pagenav__item--center">
    <a class="pagenav__link link" href="index.html" aria-label="parent page">
      <svg width="11" height="12" aria-hidden="true"><use xlink:href="#up"/>
      </svg><span class="pagenav__up">Up</span>
    </a>
  </div>
  <div class="pagenav__item pagenav__item--right">
    <a class="pagenav__link link" href="../3/index.html" aria-label="next page">
      <span class="pagenav__next">Next</span
        ><svg width="12" height="11" aria-hidden="true"
        ><use xlink:href="#right"/></svg>
    </a>
  </div>
</nav>
<footer class="footer">
  <p>© 2022 Mitchell Kember</p>
</footer>
</body>
</html>
