<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SICP Section 3.1 Notes</title>
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css">
  <link rel="stylesheet" href="../../style.css">
</head>
<body>
<div hidden>
  <svg>
    <symbol id="up" viewBox="0 0 11 12">
      <path fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" d="M5.5.8v10.4m4.457-5.943L5.5.8 1.043 5.257"/>
    </symbol>
    <symbol id="left" viewBox="0 0 12 11">
      <path fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" d="M.8 5.5h10.4M5.257 9.957L.8 5.5l4.457-4.457"/>
    </symbol>
    <symbol id="right" viewBox="0 0 12 11">
      <use xlink:href="#left" transform="matrix(-1 0 0 1 12 0)"/>
    </symbol>
    <symbol id="external" viewBox="0 0 24 24">
      <path fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" d="M10.688 5.438H4.125A2.65 2.65 0 001.5 8.063v11.812A2.65 2.65 0 004.125 22.5h11.813a2.65 2.65 0 002.624-2.625v-6.563m-9.187 1.313L22.5 1.5m-6.563 0H22.5v6.563"/>
    </symbol>
    <symbol id="circle-left" viewBox="0 0 18 18" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="9" stroke-width="1.69" transform="matrix(.8889 0 0 .8889 -1.667 -1.667)"/>
      <path stroke-width="1.5" d="M5.229 9h7.542M9 5.229L5.229 9 9 12.771"/>
    </symbol>
  </svg>
</div>
<a class="skip-link" href="#main">Skip to main content</a>
<header class="header">
  <a class="title link" href="../../index.html">SICP Study</a>
  <nav class="sitenav" aria-label="site">
    <a class="sitenav__item sitenav__item--active link"
        href="../../text/index.html" aria-label="textbook notes">Text</a>
    <a class="sitenav__item link"
        href="../../lecture/index.html" aria-label="lecture notes">Lecture</a>
    <a class="sitenav__item link"
        href="../../exercise/index.html" aria-label="exercises">Exercise</a>
    <a class="sitenav__item sitenav__item--last link"
        href="https://github.com/mk12/sicp" aria-label="GitHub repository">
      Source
      <svg class="github-mark" width="25" height="25" viewBox="0 0 136 133" aria-hidden="true">
        <path fill="currentColor" d="M67.866.002C30.387.002 0 30.39 0 67.877c0 29.988 19.446 55.425 46.417 64.404 3.396.621 4.633-1.475 4.633-3.275 0-1.608-.058-5.879-.091-11.541-18.88 4.1-22.863-9.1-22.863-9.1-3.087-7.838-7.537-9.925-7.537-9.925-6.163-4.213.466-4.13.466-4.13 6.813.484 10.396 6.996 10.396 6.996 6.054 10.371 15.888 7.375 19.754 5.642.617-4.387 2.367-7.38 4.309-9.075-15.071-1.712-30.917-7.537-30.917-33.546 0-7.408 2.646-13.466 6.988-18.212-.7-1.717-3.03-8.617.662-17.963 0 0 5.7-1.825 18.667 6.959 5.412-1.505 11.22-2.259 16.992-2.284 5.762.025 11.57.78 16.991 2.284 12.959-8.784 18.646-6.959 18.646-6.959 3.704 9.346 1.375 16.246.675 17.963 4.35 4.746 6.98 10.804 6.98 18.212 0 26.075-15.872 31.813-30.992 33.492 2.437 2.096 4.608 6.237 4.608 12.57 0 9.072-.083 16.392-.083 18.617 0 1.817 1.22 3.93 4.666 3.267 26.95-8.996 46.38-34.417 46.38-64.396 0-37.487-30.392-67.875-67.88-67.875"/>
      </svg>      
    </a>
  </nav>
</header>
<nav class="pagenav pagenav--top" aria-label="page">
  <div class="pagenav__item pagenav__item--left">
    <a class="pagenav__link link" href="index.html" aria-label="previous page">
      <svg width="12" height="11" aria-hidden="true"><use xlink:href="#left"/>
      </svg><span class="pagenav__prev">Prev</span>
    </a>
  </div>
  <div class="pagenav__item pagenav__item--center">
    <a class="pagenav__link link" href="index.html" aria-label="parent page">
      <svg width="11" height="12" aria-hidden="true"><use xlink:href="#up"/>
      </svg><span class="pagenav__up">Up</span>
    </a>
  </div>
  <div class="pagenav__item pagenav__item--right">
    <a class="pagenav__link link" href="2.html" aria-label="next page">
      <span class="pagenav__next">Next</span
        ><svg width="12" height="11" aria-hidden="true"
        ><use xlink:href="#right"/></svg>
    </a>
  </div>
</nav>
<main id="main">
<h1>
<span class="number">3.1</span> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-20.html">Assignment and Local State<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h1>
<ul>
<li>The world is populated by independent objects possessing individual, changing state.</li>
<li>When we say an object “has state,<span class="tuck">”</span> we mean its behavior is influenced by its history.</li>
<li>Instead of remembering an object’s history, we can summarize it with <em>state variables</em>.</li>
<li>For example, the state variable for a bank account would record its current balance.</li>
</ul>
<blockquote>
<p>Indeed, the view that a system is composed of separate objects is most useful when the state variables of the system can be grouped into closely coupled subsystems that are only loosely coupled to other subsystems. <a class="citation" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-20.html" title="SICP Section 3.1">(Section&nbsp;3.1)</a></p>
</blockquote>
<ul>
<li>To model state variables in our programming language, we need an <em>assignment operator</em> that changes the value associated with a name.</li>
</ul>
<h2 id="3.1.1" class="anchor">
<a class="anchor__link link" href="#3.1.1" aria-hidden="true">#</a> <span class="number">3.1.1</span> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-20.html#%25_sec_3.1.1">Local State Variables<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h2>
<ul>
<li>Let’s model the situation of withdrawing money from a bank account.</li>
<li><code>(withdraw <span class="mv">amount</span>)</code> should withdraw the given amount and return the new balance.</li>
<li>If you try to withdraw too much, it should return the string “Insufficient funds.<span class="tuck">”</span></li>
<li>Suppose we begin with $100:</li>
</ul>
<pre><code class="codeblock">(withdraw <span class="cn">25</span>)
<span class="cs">→ 75</span>

(withdraw <span class="cn">25</span>)
<span class="cs">→ 50</span>

(withdraw <span class="cn">60</span>)
<span class="cs">→ "Insufficient funds"</span>

(withdraw <span class="cn">15</span>)
<span class="cs">→ 35</span></code></pre>
<ul>
<li>Notice that <code>(withdraw <span class="cn">25</span>)</code> was called twice, but returned different values.</li>
<li>This is a new kind of behavior. Up until now, the returned value of a procedure depended only on the arguments, like a mathematical function.</li>
<li>Here’s how we implement <code>withdraw</code>:</li>
</ul>
<pre><code class="codeblock">(<span class="kw">define</span> balance <span class="cn">100</span>)

(<span class="kw">define</span> (withdraw amount)
  (<span class="kw">if</span> (<span class="fu">&gt;=</span> balance amount)
      (<span class="kw">begin</span> (<span class="kw">set!</span> balance (<span class="fu">-</span> balance amount))
             balance)
      <span class="cn">"Insufficient funds"</span>))</code></pre>
<ul>
<li>This uses the special form <code>(<span class="kw">set!</span> <span class="mv">name</span> <span class="mv">new-value</span>)</code> to change the value of <code>balance</code>.</li>
<li>The expression <code>(<span class="kw">begin</span> <span class="mv">exp1</span> <span class="mv">exp2</span> ... <span class="mv">expn</span>)</code> evaluates all the expressions in sequence and returns the value of the last one.</li>
<li>Instead of defining <code>balance</code> globally, we can <em>encapsulate</em> it within <code>withdraw</code>:</li>
</ul>
<pre><code class="codeblock">(<span class="kw">define</span> withdraw
  (<span class="kw">let</span> ((balance <span class="cn">100</span>))
    (<span class="kw">lambda</span> (amount)
      (<span class="kw">if</span> (<span class="fu">&gt;=</span> balance amount)
          (<span class="kw">begin</span> (<span class="kw">set!</span> balance (<span class="fu">-</span> balance amount))
                 balance)
          <span class="cn">"Insufficient funds"</span>))))</code></pre>
<ul>
<li>Unfortunately, the substitution model of evaluation from <a href="../1/1.html#1.1.5">§&nbsp;1.1.5</a> is no longer adequate once we have assignment in our procedures.</li>
<li>For now, we technically have no way to understand how these procedures work. We will develop a new model soon.</li>
<li>The following procedure creates “withdraw processors”:</li>
</ul>
<pre><code class="codeblock">(<span class="kw">define</span> (make-withdraw balance)
  (<span class="kw">lambda</span> (amount)
    (<span class="kw">if</span> (<span class="fu">&gt;=</span> balance amount)
        (<span class="kw">begin</span> (<span class="kw">set!</span> balance (<span class="fu">-</span> balance amount))
               balance)
        <span class="cn">"Insufficient funds"</span>)))

(<span class="kw">define</span> W1 (make-withdraw <span class="cn">100</span>))
(<span class="kw">define</span> W2 (make-withdraw <span class="cn">100</span>))

(W1 <span class="cn">50</span>)
<span class="cs">→ 50</span>

(W2 <span class="cn">70</span>)
<span class="cs">→ 30</span>

(W2 <span class="cn">40</span>)
<span class="cs">→ "Insufficient funds"</span>

(W1 <span class="cn">40</span>)
<span class="cs">→ 10</span></code></pre>
<ul>
<li><code>W1</code> and <code>W2</code> are completely independent objects, each with its own local state variable.</li>
<li>We can also create a “bank-account object” that responds to multiple messages, all operating on the same local state:</li>
</ul>
<pre><code class="codeblock">(<span class="kw">define</span> (make-account balance)
  (<span class="kw">define</span> (withdraw amount)
    (<span class="kw">if</span> (<span class="fu">&gt;=</span> balance amount)
        (<span class="kw">begin</span> (<span class="kw">set!</span> balance (<span class="fu">-</span> balance amount))
               balance)
        <span class="cn">"Insufficient funds"</span>))
  (<span class="kw">define</span> (deposit amount)
    (<span class="kw">set!</span> balance (<span class="fu">+</span> balance amount))
    balance)
  (<span class="kw">define</span> (dispatch m)
    (<span class="kw">cond</span> ((<span class="fu">eq?</span> m <span class="qu">'withdraw</span>) withdraw)
          ((<span class="fu">eq?</span> m <span class="qu">'deposit</span>) deposit)
          (<span class="kw">else</span> (<span class="fu">error</span> <span class="cn">"unknown request"</span> m))))
  dispatch)</code></pre>
<aside><h4>Exercises:</h4> <ul class="flat"><li class="flat__item"><a href="../../exercise/3/1.html#ex3.1">3.1</a>, </li><li class="flat__item"><a href="../../exercise/3/1.html#ex3.2">3.2</a>, </li><li class="flat__item"><a href="../../exercise/3/1.html#ex3.3">3.3</a>, </li><li class="flat__item"><a href="../../exercise/3/1.html#ex3.4">3.4</a></li></ul></aside>
<h2 id="3.1.2" class="anchor">
<a class="anchor__link link" href="#3.1.2" aria-hidden="true">#</a> <span class="number">3.1.2</span> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-20.html#%25_sec_3.1.2">The Benefits of Introducing Assignment<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h2>
<div id="q1" class="highlight">
<a class="highlight__link link" href="../highlight.html#3.1-q1" aria-label="view quote in highlights page"><svg class="circle-arrow" width="18" height="18" aria-hidden="true"><use xlink:href="#circle-left"/></svg> Highlights</a>
<blockquote>
<p>Introducing assignment into our programming language leads us into a thicket of difficult conceptual issues. Nevertheless, viewing systems as collections of objects with local state is a powerful technique for maintaining a modular design. <a class="citation" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-20.html#%25_sec_3.1.2" title="SICP Section 3.1.2">(Section&nbsp;3.1.2)</a></p>
</blockquote>
</div>
<ul>
<li>Consider the procedure <code>rand</code>. We want it to return an integer chosen at random each time we evaluate <code>(rand)</code>.</li>
<li>Suppose we have the procedure <code>rand-update</code> that takes one argument.
<ul>
<li>We first call it with an initial value <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub><mtext>,</mtext></mrow><annotation encoding="application/x-tex">x_1\htmlClass{math-punctuation}{\text{,}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="enclosing math-punctuation"><span class="mord text"><span class="mord">,</span></span></span></span></span></span> and it returns an integer <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mn>2</mn></msub><mtext>.</mtext></mrow><annotation encoding="application/x-tex">x_2\htmlClass{math-punctuation}{\text{.}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="enclosing math-punctuation"><span class="mord text"><span class="mord">.</span></span></span></span></span></span></li>
<li>We call it with <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mn>2</mn></msub><mtext>,</mtext></mrow><annotation encoding="application/x-tex">x_2\htmlClass{math-punctuation}{\text{,}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="enclosing math-punctuation"><span class="mord text"><span class="mord">,</span></span></span></span></span></span> and it gives us <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mn>3</mn></msub><mtext>,</mtext></mrow><annotation encoding="application/x-tex">x_3\htmlClass{math-punctuation}{\text{,}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="enclosing math-punctuation"><span class="mord text"><span class="mord">,</span></span></span></span></span></span> and so on.</li>
<li>The sequence of values <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>x</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">x_1, x_2, \dots, x_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> will have the desired statistical properties (random uniform distribution).</li>
<li>This is a <em>pseudorandom</em> sequence, since each number is a function of the previous one.</li>
</ul></li>
<li>We could implement <code>rand</code> like this:</li>
</ul>
<pre><code class="codeblock">(<span class="kw">define</span> rand
  (<span class="kw">let</span> ((x random-init))
    (<span class="kw">lambda</span> ()
      (<span class="kw">set!</span> x (rand-update x))
      x)))</code></pre>
<blockquote>
<p>The Monte Carlo method consists of choosing sample experiments at random from a large set and then making deductions on the basis of the probabilities estimated from tabulating the results of those experiments. <a class="citation" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-20.html#%25_sec_3.1.2" title="SICP Section 3.1.2">(Section&nbsp;3.1.2)</a></p>
</blockquote>
<ul>
<li>We can use the Monte Carlo method to approximate <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>π</mi><mtext>,</mtext></mrow><annotation encoding="application/x-tex">π\htmlClass{math-punctuation}{\text{,}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="enclosing math-punctuation"><span class="mord text"><span class="mord">,</span></span></span></span></span></span> knowing that the probability that two randomly chosen integers have 1 as their GCD is <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>6</mn><mi mathvariant="normal">/</mi><msup><mi>π</mi><mn>2</mn></msup><mtext>.</mtext></mrow><annotation encoding="application/x-tex">6/π^2\htmlClass{math-punctuation}{\text{.}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord">6</span><span class="mord">/</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="enclosing math-punctuation"><span class="mord text"><span class="mord">.</span></span></span></span></span></span></li>
<li>If we had to use <code>rand-update</code> directly, our Monte Carlo program would betray some painful breaches of modularity.</li>
</ul>
<blockquote>
<p>The general phenomenon illustrated by the Monte Carlo example is this: From the point of view of one part of a complex process, the other parts appear to change with time. They have hidden time-varying local state. If we wish to write computer programs whose structure reflects this decomposition, we make computational objects (such as bank accounts and random-number generators) whose behavior changes with time. We model state with local state variables, and we model the changes of state with assignments to those variables. <a class="citation" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-20.html#%25_sec_3.1.2" title="SICP Section 3.1.2">(Section&nbsp;3.1.2)</a></p>
</blockquote>
<aside><h4>Exercises:</h4> <ul class="flat"><li class="flat__item"><a href="../../exercise/3/1.html#ex3.5">3.5</a>, </li><li class="flat__item"><a href="../../exercise/3/1.html#ex3.6">3.6</a></li></ul></aside>
<h2 id="3.1.3" class="anchor">
<a class="anchor__link link" href="#3.1.3" aria-hidden="true">#</a> <span class="number">3.1.3</span> <a class="link" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-20.html#%25_sec_3.1.3">The Costs of Introducing Assignment<span class="nowrap">⁠<svg class="external" width="24" height="24" aria-hidden="true"><use xlink:href="#external"/></svg></span></a>
</h2>
<ul>
<li>The advantages of local state and assignment come at a price.</li>
<li>The substitution model of procedure application is no longer sufficient to properly interpret out programs.</li>
<li>Programming without the use of assignment, as we have done in the first two chapters, is called <em>functional programming</em>.</li>
<li>Observe what happens when we try using the substitution model:</li>
</ul>
<pre><code class="codeblock">(<span class="kw">define</span> (make-simplified-withdraw balance)
  (<span class="kw">lambda</span> (amount)
    (<span class="kw">set!</span> balance (<span class="fu">-</span> balance amount))
    balance))
((make-simplified-withdraw <span class="cn">25</span>) <span class="cn">20</span>)
((<span class="kw">lambda</span> (amount) (<span class="kw">set!</span> balance (<span class="fu">-</span> <span class="cn">25</span> amount)) <span class="cn">25</span>) <span class="cn">20</span>)
(<span class="kw">set!</span> balance (<span class="fu">-</span> <span class="cn">25 20</span>)) <span class="cn">25</span></code></pre>
<ul>
<li>Adhering to the substitution model, we set <code>balance</code> to 5 and then return 25 as the value of the expression.</li>
<li>This is wrong. We shouldn’t have substituted 25 for <code>balance</code> everywhere, because the assignment changed it.</li>
<li>Before, a variable was simply a name for a value.</li>
<li>Now, since a variable can change, it somehow refers to a place where a value can be stored, and this value can be changed.</li>
</ul>
<h3 id="3.1.3.1" class="anchor">
<a class="anchor__link link" href="#3.1.3.1" aria-hidden="true">#</a> Sameness and change
</h3>
<ul>
<li>By introducing change into our computational models, many previously straightforward notions become problematic.</li>
<li>Consider the concept of two things being “the same.<span class="tuck">”</span></li>
<li>If we have <code>(make-withdraw <span class="cn">25</span>)</code> and <code>(make-withdraw <span class="cn">25</span>)</code>, are they the same? No, because they can have different local state.</li>
<li>A language that supports “equals can be substituted for equals” is <em>referentially transparent</em>. <code>set!</code> violates this.</li>
<li>Reasoning about programs that use assignment is much more difficult for this reason.</li>
<li>The concepts of “sameness” and “change” chase each other around in circles; it is hard to formally define them.</li>
<li>If we have <code>(<span class="kw">define</span> peter-acc (make-account <span class="cn">100</span>))</code>, there is a big difference between defining <code>paul-acc</code> in the same way and defining it with <code>(<span class="kw">define</span> paul-acc peter-acc)</code>.</li>
<li>In the first case, they have distinct accounts. In the second, both refer to the same account—this is called <em>aliasing</em>.</li>
<li>As long as we never modify objects, we can regard them to be precisely the totality of their pieces.</li>
<li>This is no longer valid in the presence of change, because “identity” is something different from the pieces.</li>
<li>A bank account is still “the same” account after a withdrawal. Conversely, two distinct accounts with the same balance are “different.<span class="tuck">”</span></li>
<li>The name is attached to an identity rather than the data itself.</li>
</ul>
<h3 id="3.1.3.2" class="anchor">
<a class="anchor__link link" href="#3.1.3.2" aria-hidden="true">#</a> Pitfalls of imperative programming
</h3>
<ul>
<li>Programming that makes extensive use of assignment is called <em>imperative programming</em>.</li>
<li>Imperative programs are susceptible to bugs that cannot occur in functional programs.</li>
<li>Things get even worse when we throw concurrency into the mix.</li>
</ul>
<div id="q2" class="highlight">
<a class="highlight__link link" href="../highlight.html#3.1-q2" aria-label="view quote in highlights page"><svg class="circle-arrow" width="18" height="18" aria-hidden="true"><use xlink:href="#circle-left"/></svg> Highlights</a>
<blockquote>
<p>In general, programming with assignment forces us to carefully consider the relative orders of the assignments to make sure that each statement is using the correct version of the variables that have been changed. This issue simply does not arise in functional programs. <a class="citation" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-20.html#%25_sec_3.1.3" title="SICP Section 3.1.3">(Section&nbsp;3.1.3)</a></p>
<p>In view of this, it is ironic that introductory programming is most often taught in a highly imperative style. This may be a vestige of a belief, common throughout the 1960s and 1970s, that programs that call procedures must inherently be less efficient than programs that perform assignments. … Alternatively it may reflect a view that step-by-step assignment is easier for beginners to visualize than procedure call. Whatever the reason, it often saddles beginning programmers with “should I set this variable before or after that one” concerns that can complicate programming and obscure the important ideas. <a class="citation" href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book-Z-H-20.html#footnote_Temp_339" title="SICP Chapter 3, Footnote 11">(Footnote&nbsp;3.11)</a></p>
</blockquote>
</div>
<aside><h4>Exercises:</h4> <ul class="flat"><li class="flat__item"><a href="../../exercise/3/1.html#ex3.7">3.7</a>, </li><li class="flat__item"><a href="../../exercise/3/1.html#ex3.8">3.8</a></li></ul></aside>
</main>
<nav class="pagenav pagenav--bottom" aria-label="page">
  <div class="pagenav__item pagenav__item--left">
    <a class="pagenav__link link" href="index.html" aria-label="previous page">
      <svg width="12" height="11" aria-hidden="true"><use xlink:href="#left"/>
      </svg><span class="pagenav__prev">Prev</span>
    </a>
  </div>
  <div class="pagenav__item pagenav__item--center">
    <a class="pagenav__link link" href="index.html" aria-label="parent page">
      <svg width="11" height="12" aria-hidden="true"><use xlink:href="#up"/>
      </svg><span class="pagenav__up">Up</span>
    </a>
  </div>
  <div class="pagenav__item pagenav__item--right">
    <a class="pagenav__link link" href="2.html" aria-label="next page">
      <span class="pagenav__next">Next</span
        ><svg width="12" height="11" aria-hidden="true"
        ><use xlink:href="#right"/></svg>
    </a>
  </div>
</nav>
<footer class="footer">
  <p>© 2022 Mitchell Kember</p>
</footer>
</body>
</html>
